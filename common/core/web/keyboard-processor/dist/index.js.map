{"version":3,"file":"index.js","sourceRoot":"/keyman/","sources":["node_modules/@keymanapp/web-environment/environment.inc.ts","node_modules/@keymanapp/web-utils/src/deepCopy.ts","node_modules/@keymanapp/web-utils/src/globalObject.ts","node_modules/@keymanapp/web-utils/src/version.ts","node_modules/@keymanapp/web-utils/src/kmwstring.ts","node_modules/@keymanapp/web-utils/src/deviceSpec.ts","node_modules/@keymanapp/web-utils/src/index.ts","src/text/codes.ts","src/text/deadkeys.ts","src/text/outputTarget.ts","src/text/keyEvent.ts","src/text/ruleBehavior.ts","src/text/defaultOutput.ts","src/keyboards/defaultLayouts.ts","src/keyboards/activeLayout.ts","src/text/systemStores.ts","src/text/kbdInterface.ts","src/keyboards/keyboard.ts","src/text/keyMapping.ts","src/text/keyboardProcessor.ts"],"names":[],"mappings":"AAAA,qCAAqC;AACrC,IAAU,GAAG,CAKZ;AALD,WAAU,GAAG;IAAC,IAAA,MAAM,CAKnB;IALa,WAAA,MAAM;QAAC,IAAA,WAAW,CAK/B;QALoB,WAAA,WAAW;YACnB,mBAAO,GAAG,MAAM,CAAC;YACjB,iBAAK,GAAG,GAAG,CAAC;YACZ,uBAAW,GAAG,OAAO,CAAC;YACtB,0BAAc,GAAG,8BAA8B,CAAC;QAC7D,CAAC,EALoB,WAAW,GAAX,kBAAW,KAAX,kBAAW,QAK/B;IAAD,CAAC,EALa,MAAM,GAAN,UAAM,KAAN,UAAM,QAKnB;AAAD,CAAC,EALS,GAAG,KAAH,GAAG,QAKZ;ACND,IAAU,GAAG,CAwBZ;AAxBD,WAAU,GAAG;IAAC,IAAA,MAAM,CAwBnB;IAxBa,WAAA,MAAM;QAAC,IAAA,KAAK,CAwBzB;QAxBoB,WAAA,KAAK;YACxB;;;;;;;;eAQG;YACH,SAAgB,QAAQ,CAAI,CAAG,EAAE,EAAG;gBAClC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC;gBACjB,KAAK,IAAI,CAAC,IAAI,CAAC,EAAE;oBACf,IAAG,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,QAAQ,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE;wBAC3C,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,KAAK,KAAK,CAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;wBAC/C,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;qBACrB;yBACI;wBACH,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;qBACb;iBACF;gBAED,OAAO,CAAC,CAAC;YACX,CAAC;YAbe,cAAQ,WAavB,CAAA;QACH,CAAC,EAxBoB,KAAK,GAAL,YAAK,KAAL,YAAK,QAwBzB;IAAD,CAAC,EAxBa,MAAM,GAAN,UAAM,KAAN,UAAM,QAwBnB;AAAD,CAAC,EAxBS,GAAG,KAAH,GAAG,QAwBZ;ACxBD,IAAU,GAAG,CA+BZ;AA/BD,WAAU,GAAG;IAAC,IAAA,MAAM,CA+BnB;IA/Ba,WAAA,MAAM;QAAC,IAAA,KAAK,CA+BzB;QA/BoB,WAAA,KAAK;YACxB;;;;;eAKG;YACH,SAAgB,eAAe;gBAC7B,2DAA2D;gBAC3D,6GAA6G;gBAC7G,sGAAsG;gBACtG,IAAG,OAAO,UAAU,IAAI,WAAW,EAAE;oBACnC,OAAO,UAAU,CAAC,CAAE,6CAA6C;oBACjE,mFAAmF;iBACpF;qBAAM,IAAG,OAAO,MAAM,IAAI,WAAW,EAAE;oBACtC,aAAa;oBACb,OAAO,MAAM,CAAC,CAAC,4BAA4B;oBAC3C,aAAa;iBACd;qBAAM,IAAG,OAAO,IAAI,IAAI,WAAW,EAAE;oBACpC,aAAa;oBACb,OAAO,IAAI,CAAC,CAAC,mBAAmB;iBACjC;qBAAM;oBACL,+EAA+E;oBAC/E,+EAA+E;oBAC/E,+CAA+C;oBAC/C,EAAE;oBACF,wFAAwF;oBACxF,aAAa;oBACb,OAAQ,MAAmC,CAAC;iBAC7C;YACH,CAAC;YAvBe,qBAAe,kBAuB9B,CAAA;QACH,CAAC,EA/BoB,KAAK,GAAL,YAAK,KAAL,YAAK,QA+BzB;IAAD,CAAC,EA/Ba,MAAM,GAAN,UAAM,KAAN,UAAM,QA+BnB;AAAD,CAAC,EA/BS,GAAG,KAAH,GAAG,QA+BZ;AC/BD,qFAAqF;AACrF,+EAA+E;AAE/E,IAAU,GAAG,CA4GZ;AA5GD,WAAU,GAAG;IAAC,IAAA,MAAM,CA4GnB;IA5Ga,WAAA,MAAM;QAAC,IAAA,KAAK,CA4GzB;QA5GoB,WAAA,KAAK;YACxB,yBAAyB;YACzB;gBAeE;;;;mBAIG;gBACH,iBAAY,IAAuB;oBACjC,sFAAsF;oBACtF,IAAG,IAAI,KAAK,SAAS,IAAI,IAAI,KAAK,IAAI,EAAE;wBACtC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,0BAA0B,CAAC,UAAU,CAAC,CAAC;wBAC3E,OAAO;qBACR;oBAED,IAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;wBACtB,IAAI,UAAU,GAAG,IAAgB,CAAC;wBAClC,IAAG,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;4BACxB,MAAM,IAAI,KAAK,CAAC,gEAAgE,CAAC,CAAC;yBACnF;6BAAM;4BACL,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;4BACxC,OAAO;yBACR;qBACF;oBAED,mCAAmC;oBACnC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC5B,IAAI,cAAc,GAAa,EAAE,CAAC;oBAElC,IAAG,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;wBACnB,MAAM,IAAI,KAAK,CAAC,gEAAgE,CAAC,CAAC;qBACnF;oBAED,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBAClC,IAAI,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;wBACnC,IAAG,KAAK,CAAC,KAAK,CAAC,EAAE;4BACf,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;yBACjE;wBAED,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;qBAC5B;oBAED,IAAI,CAAC,UAAU,GAAG,cAAc,CAAC;gBACnC,CAAC;gBAED,sBAAI,0BAAK;yBAAT;wBACE,OAAO,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;oBAC5B,CAAC;;;mBAAA;gBAED,sBAAI,0BAAK;yBAAT;wBACE,OAAO,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;oBAC5B,CAAC;;;mBAAA;gBAED,0BAAQ,GAAR;oBACE,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACnC,CAAC;gBAED,wBAAM,GAAN;oBACE,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACzB,CAAC;gBAED,wBAAM,GAAN,UAAO,KAAc;oBACnB,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gBACpC,CAAC;gBAED,0BAAQ,GAAR,UAAS,KAAc;oBACrB,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACnC,CAAC;gBAED,2BAAS,GAAT,UAAU,KAAc;oBACtB,2FAA2F;oBAC3F,IAAI,SAAS,GAAY,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC;oBAC1E,IAAI,QAAQ,GAAW,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC;oBAE7H,IAAI,CAAS,CAAC;oBACd,KAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,EAAE,CAAC,EAAE,EAAE;wBAC5B,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;wBACrD,IAAG,KAAK,IAAI,CAAC,EAAE;4BACb,OAAO,KAAK,CAAC;yBACd;qBACF;oBAED,IAAI,QAAQ,GAAG,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC;oBAC9D,GAAG;wBACD,IAAG,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE;4BAClB,OAAO,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;yBAC3B;wBACD,CAAC,EAAE,CAAC;qBACL,QAAQ,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE;oBAE9B,SAAS;oBACT,OAAO,CAAC,CAAC;gBACX,CAAC;gBAvGsB,eAAO,GAAG,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBAE7E,qGAAqG;gBACrG,+FAA+F;gBACxE,kCAA0B,GAAG,IAAI,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE3E,kGAAkG;gBAClG,6FAA6F;gBACtE,0BAAkB,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC;gBAE1C,+BAAuB,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;gBA8FzE,cAAC;aAAA,AAzGD,IAyGC;YAzGY,aAAO,UAyGnB,CAAA;QACH,CAAC,EA5GoB,KAAK,GAAL,YAAK,KAAL,YAAK,QA4GzB;IAAD,CAAC,EA5Ga,MAAM,GAAN,UAAM,KAAN,UAAM,QA4GnB;AAAD,CAAC,EA5GS,GAAG,KAAH,GAAG,QA4GZ;AC/GD;;;IAGI;AA6CJ;;;;;;GAMG;AACH,MAAM,CAAC,eAAe,GAAG,UAAS,GAAG;IACnC,IAAI,KAAK,GAAG,EAAE,EAAE,CAAC,CAAC;IAClB,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACrC,IAAI,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7B,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,QAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE;YAChE,MAAM,IAAI,UAAU,CAAC,qBAAqB,GAAG,CAAC,CAAC,CAAC;SACjD;QACD,IAAI,CAAC,GAAG,OAAO,EAAE;YACf,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SACf;aAAM;YACL,CAAC,IAAI,OAAO,CAAC;YACb,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC;YAC/B,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,GAAG,MAAM,CAAC,CAAC;SAClC;KACF;IACD,OAAO,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;AACrD,CAAC,CAAA;AAED;;;;;;;GAOG;AACH,MAAM,CAAC,SAAS,CAAC,aAAa,GAAG,UAAS,cAAc;IACtD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,IAAI,aAAa,GAAG,CAAC,CAAC;IAEtB,IAAI,cAAc,GAAG,CAAC,IAAI,cAAc,IAAK,GAAG,CAAC,MAAM,EAAE;QACvD,OAAO,GAAG,CAAC;KACZ;IAED,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,cAAc,EAAE,CAAC,EAAE,EAAE;QACtC,aAAa,GAAG,GAAG,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QAC/C,IAAG,aAAa,KAAK,IAAI;YAAE,OAAO,GAAG,CAAC;KACvC;IAED,IAAI,KAAK,GAAG,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;IAC1C,IAAI,KAAK,IAAI,MAAM,IAAI,KAAK,IAAI,MAAM,IAAI,GAAG,CAAC,MAAM,GAAG,aAAa,GAAG,CAAC,EAAE;QACxE,IAAI,MAAM,GAAG,GAAG,CAAC,UAAU,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;QAC/C,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,EAAE;YACxC,OAAO,CAAC,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,MAAM,GAAG,MAAM,CAAC,GAAG,OAAO,CAAC;SAC/D;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC,CAAA;AAED;;;;;;;GAOG;AACH,MAAM,CAAC,SAAS,CAAC,UAAU,GAAG,UAAS,WAAW,EAAE,SAAS;IAC3D,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,IAAI,aAAa,GAAG,GAAG,CAAC,OAAO,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAExD,IAAG,aAAa,GAAG,CAAC,EAAE;QACpB,OAAO,aAAa,CAAC;KACtB;IAED,IAAI,cAAc,GAAG,CAAC,CAAC;IACvB,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,aAAa,EAAE,CAAC,GAAG,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC;QAAE,cAAc,EAAE,CAAC;IACzF,OAAO,cAAc,CAAC;AACxB,CAAC,CAAA;AAED;;;;;;;GAOG;AACH,MAAM,CAAC,SAAS,CAAC,cAAc,GAAG,UAAS,WAAW,EAAE,SAAS;IAE/D,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,IAAI,aAAa,GAAG,GAAG,CAAC,WAAW,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAE5D,IAAG,aAAa,GAAG,CAAC,EAAE;QACpB,OAAO,aAAa,CAAC;KACtB;IAED,IAAI,cAAc,GAAG,CAAC,CAAC;IACvB,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,aAAa,EAAE,CAAC,GAAG,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC;QAAE,cAAc,EAAE,CAAC;IACzF,OAAO,cAAc,CAAC;AACxB,CAAC,CAAA;AAED;;;;GAIG;AACH,MAAM,CAAC,SAAS,CAAC,SAAS,GAAG;IAC3B,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEvB,IAAG,GAAG,CAAC,MAAM,IAAI,CAAC;QAAE,OAAO,CAAC,CAAC;IAE7B,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,aAAa,GAAG,CAAC,EAAE,aAAa,KAAK,IAAI,EAAE,CAAC,EAAE;QAC3D,aAAa,GAAG,GAAG,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;IACjD,OAAO,CAAC,CAAC;AACX,CAAC,CAAA;AAED;;;;;;;;;GASG;AACH,MAAM,CAAC,SAAS,CAAC,QAAQ,GAAG,UAAS,UAAU,EAAE,QAAQ;IACvD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,IAAI,kBAAkB,GAAG,GAAG,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAC;IAChE,IAAI,gBAAgB,GAAG,GAAG,CAAC,sBAAsB,CAAC,QAAQ,CAAC,CAAC;IAC5D,IAAG,kBAAkB,KAAK,IAAI,IAAI,gBAAgB,KAAK,IAAI;QACzD,OAAO,EAAE,CAAC;;QAEV,OAAO,GAAG,CAAC,KAAK,CAAC,kBAAkB,EAAE,gBAAgB,CAAC,CAAC;AAC3D,CAAC,CAAA;AAED;;;;;;;;GAQG;AACH,MAAM,CAAC,SAAS,CAAC,SAAS,GAAG,UAAS,KAAK,EAAE,MAAO;IAElD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,IAAG,KAAK,GAAG,CAAC,EACZ;QACE,KAAK,GAAG,GAAG,CAAC,SAAS,EAAE,GAAG,KAAK,CAAC;KACjC;IACF,IAAG,KAAK,GAAG,CAAC;QAAE,KAAK,GAAG,CAAC,CAAC;IACvB,IAAI,aAAa,GAAG,GAAG,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;IACtD,IAAI,WAAW,GAAG,aAAa,CAAC;IAEhC,IAAG,aAAa,KAAK,IAAI;QAAE,OAAO,EAAE,CAAC;IAErC,IAAG,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;QACvB,WAAW,GAAG,GAAG,CAAC,MAAM,CAAC;KAC1B;SAAM;QACL,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE;YAAE,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;KAC5E;IACD,IAAG,WAAW,KAAK,IAAI;QACrB,OAAO,GAAG,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;;QAEpC,OAAO,GAAG,CAAC,SAAS,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;AACrD,CAAC,CAAA;AAED;;;;;;;;GAQG;AACH,MAAM,CAAC,SAAS,CAAC,YAAY,GAAG,UAAS,MAAM,EAAE,MAAM;IAErD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,EAAC,cAAc,EAAC,cAAc,CAAC;IAErD,IAAG,OAAM,CAAC,MAAM,CAAC,IAAI,WAAW,EAChC;QACE,cAAc,GAAG,GAAG,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC;QACpD,cAAc,GAAI,GAAG,CAAC,MAAM,CAAC;KAC9B;SAED;QACE,IAAG,MAAM,GAAG,MAAM,EAAE;YAAE,IAAI,CAAC,GAAG,MAAM,CAAC;YAAC,MAAM,GAAG,MAAM,CAAC;YAAC,MAAM,GAAG,CAAC,CAAC;SAAE;QAEpE,cAAc,GAAG,GAAG,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC;QACpD,cAAc,GAAG,GAAG,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC;KACrD;IACD,IAAG,KAAK,CAAC,cAAc,CAAC,IAAI,cAAc,KAAK,IAAI;QAAE,cAAc,GAAG,CAAC,CAAC;IACxE,IAAG,KAAK,CAAC,cAAc,CAAC,IAAI,cAAc,KAAK,IAAI;QAAE,cAAc,GAAG,GAAG,CAAC,MAAM,CAAC;IAEjF,OAAO,GAAG,CAAC,SAAS,CAAC,cAAc,EAAE,cAAc,CAAC,CAAC;AACvD,CAAC,CAAA;AAED;;EAEE;AAEF;;;;;;;GAOG;AACH,MAAM,CAAC,SAAS,CAAC,WAAW,GAAG,UAAS,aAAa;IACnD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEvB,IAAG,aAAa,KAAK,IAAI,IAAI,aAAa,GAAG,CAAC,IAAI,aAAa,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE;QACjF,OAAO,IAAI,CAAC;KACb;IAED,IAAI,KAAK,GAAG,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;IAC1C,IAAI,KAAK,IAAI,MAAM,IAAI,KAAK,IAAI,MAAM,IAAI,GAAG,CAAC,MAAM,GAAG,aAAa,GAAG,CAAC,EAAE;QACxE,IAAI,MAAM,GAAG,GAAG,CAAC,UAAU,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;QAC/C,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,EAAE;YACxC,IAAG,aAAa,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE;gBAClC,OAAO,IAAI,CAAC;aACb;YACD,OAAO,aAAa,GAAG,CAAC,CAAC;SAC1B;KACF;IACD,OAAO,aAAa,GAAG,CAAC,CAAC;AAC3B,CAAC,CAAA;AAED;;;;;;;EAOE;AACF,MAAM,CAAC,SAAS,CAAC,WAAW,GAAG,UAAS,aAAa;IACnD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEvB,IAAG,aAAa,IAAI,IAAI,IAAI,aAAa,IAAI,CAAC,IAAI,aAAa,GAAG,GAAG,CAAC,MAAM,EAAE;QAC5E,OAAO,IAAI,CAAC;KACb;IAED,IAAI,MAAM,GAAG,GAAG,CAAC,UAAU,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;IAC/C,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,aAAa,GAAG,CAAC,EAAE;QAC7D,IAAI,KAAK,GAAG,GAAG,CAAC,UAAU,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;QAC9C,IAAG,KAAK,IAAI,MAAM,IAAI,KAAK,IAAI,MAAM,EAAE;YACrC,OAAO,aAAa,GAAG,CAAC,CAAC;SAC1B;KACF;IACD,OAAO,aAAa,GAAG,CAAC,CAAC;AAC3B,CAAC,CAAA;AAED;;;;;GAKG;AACH,MAAM,CAAC,SAAS,CAAC,sBAAsB,GAAG,UAAS,cAAc;IAE/D,IAAG,cAAc,KAAK,IAAI;QAAE,OAAO,IAAI,CAAC;IAExC,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,IAAI,aAAa,GAAG,CAAC,CAAC;IAEtB,IAAG,cAAc,GAAG,CAAC,EAAE;QACrB,aAAa,GAAG,GAAG,CAAC,MAAM,CAAC;QAC3B,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,cAAc,EAAE,CAAC,EAAE;YACpC,aAAa,GAAG,GAAG,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QACjD,OAAO,aAAa,CAAC;KACtB;IAED,IAAG,cAAc,IAAI,GAAG,CAAC,SAAS,EAAE;QAAE,OAAO,GAAG,CAAC,MAAM,CAAC;IAExD,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,cAAc,EAAE,CAAC,EAAE;QACpC,aAAa,GAAG,GAAG,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;IACjD,OAAO,aAAa,CAAC;AACvB,CAAC,CAAA;AAED;;;;;GAKG;AACH,MAAM,CAAC,SAAS,CAAC,sBAAsB,GAAG,UAAS,aAAa;IAC9D,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEvB,IAAG,aAAa,KAAK,IAAI;QACvB,OAAO,IAAI,CAAC;SACT,IAAG,aAAa,IAAI,CAAC;QACxB,OAAO,CAAC,CAAC;SACN,IAAG,aAAa,GAAG,CAAC;QACvB,OAAO,GAAG,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,SAAS,EAAE,CAAC;;QAE7C,OAAO,GAAG,CAAC,MAAM,CAAC,CAAC,EAAC,aAAa,CAAC,CAAC,SAAS,EAAE,CAAC;AACnD,CAAC,CAAA;AAED;;;;;GAKG;AACH,MAAM,CAAC,SAAS,CAAC,SAAS,GAAG,UAAS,cAAc;IAClD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEvB,IAAG,cAAc,IAAI,CAAC;QAAE,OAAO,GAAG,CAAC,SAAS,CAAC,cAAc,EAAC,CAAC,CAAC,CAAC;;QAAM,OAAO,EAAE,CAAC;AACjF,CAAC,CAAA;AAED;;;GAGG;AAEH;;;;;GAKG;AACH,MAAM,CAAC,SAAS,CAAC,cAAc,GAAG,UAAS,aAAa;IAEtD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,IAAG,aAAa,GAAG,CAAC,IAAI,aAAa,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE;QACvD,OAAO,IAAI,CAAC;KACb;IACD,OAAO,aAAa,GAAG,CAAC,CAAC;AAC3B,CAAC,CAAA;AAED;;;;;GAKG;AACH,MAAM,CAAC,SAAS,CAAC,cAAc,GAAG,UAAS,aAAa;IAEtD,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEvB,IAAG,aAAa,IAAI,CAAC,IAAI,aAAa,GAAG,GAAG,CAAC,MAAM,EAAE;QACnD,OAAO,IAAI,CAAC;KACb;IACD,OAAO,aAAa,GAAG,CAAC,CAAC;AAC3B,CAAC,CAAA;AAED;;;;;GAKG;AACH,MAAM,CAAC,SAAS,CAAC,yBAAyB,GAAG,UAAS,cAAc;IAElE,OAAO,cAAc,CAAC;AACxB,CAAC,CAAA;AAED;;;;;GAKG;AACH,MAAM,CAAC,SAAS,CAAC,yBAAyB,GAAG,UAAS,aAAa;IAEjE,OAAO,aAAa,CAAC;AACvB,CAAC,CAAA;AAED;;;;GAIG;AACH,MAAM,CAAC,SAAS,CAAC,YAAY,GAAG;IAE9B,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IACvB,OAAO,GAAG,CAAC,MAAM,CAAC;AACpB,CAAC,CAAA;AAGD;;;;;;GAMG;AACH,MAAM,CAAC,SAAS,CAAC,YAAY,GAAG,UAAS,CAAC,EAAC,EAAG;IAE5C,IAAI,GAAG,GAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACrB,IAAG,CAAC,GAAG,CAAC,CAAC;QACP,OAAO,GAAG,CAAC,MAAM,CAAC,CAAC,EAAC,EAAE,CAAC,CAAC;;QAExB,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,GAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC;AACvC,CAAC,CAAA;AAED;;;;GAIG;AACH,MAAM,CAAC,2BAA2B,GAAG,UAAS,OAAO;IAEnD,IAAI,CAAC,GAAC,MAAM,CAAC,SAAS,CAAC;IACvB,MAAM,CAAC,gBAAgB,GAAG,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC;IACjF,CAAC,CAAC,UAAU,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;IAChD,CAAC,CAAC,cAAc,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC;IAC5D,CAAC,CAAC,WAAW,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAA,CAAC,CAAC,OAAO,CAAC;IAClD,CAAC,CAAC,eAAe,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAE;IAChE,CAAC,CAAC,SAAS,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;IAC7C,CAAC,CAAC,aAAa,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;IACzD,CAAC,CAAC,UAAU,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC;IACtD,CAAC,CAAC,UAAU,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC;IACtD,CAAC,CAAC,YAAY,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC;IAC5D,CAAC,CAAC,YAAY,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC;IAC5D,CAAC,CAAC,uBAAuB,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC,CAAC,yBAAyB,CAAC;IAC7F,CAAC,CAAC,uBAAuB,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC,CAAC,yBAAyB,CAAC;AAC/F,CAAC,CAAA;ACpdD,IAAU,GAAG,CA4EZ;AA5ED,WAAU,GAAG;IAAC,IAAA,MAAM,CA4EnB;IA5Ea,WAAA,MAAM;QAAC,IAAA,KAAK,CA4EzB;QA5EoB,WAAA,KAAK;YACxB,IAAY,OAQX;YARD,WAAY,OAAO;gBACjB,4BAAiB,CAAA;gBACjB,wBAAa,CAAA;gBACb,8BAAmB,CAAA;gBACnB,4BAAiB,CAAA;gBACjB,0BAAe,CAAA;gBACf,4BAAiB,CAAA;gBACjB,0BAAe,CAAA;YACjB,CAAC,EARW,OAAO,GAAP,aAAO,KAAP,aAAO,QAQlB;YAED,IAAY,eAOX;YAPD,WAAY,eAAe;gBACzB,sCAAmB,CAAA;gBACnB,mCAAgB,CAAA;gBAChB,kCAAe,CAAA;gBACf,sCAAmB,CAAA;gBACnB,8BAAW,CAAA;gBACX,kCAAe,CAAA;YACjB,CAAC,EAPW,eAAe,GAAf,qBAAe,KAAf,qBAAe,QAO1B;YAED,IAAY,UAIX;YAJD,WAAY,UAAU;gBACpB,iCAAmB,CAAA;gBACnB,6BAAe,CAAA;gBACf,+BAAiB,CAAA;YACnB,CAAC,EAJW,UAAU,GAAV,gBAAU,KAAV,gBAAU,QAIrB;YAED;;;;eAIG;YACH;gBAME,oBAAY,OAAe,EAAE,UAAkB,EAAE,EAAU,EAAE,SAAkB;oBAC7E,QAAO,OAAO,CAAC,WAAW,EAAa,EAAE;wBACvC,KAAK,OAAO,CAAC,MAAM,CAAC;wBACpB,KAAK,OAAO,CAAC,IAAI,CAAC;wBAClB,KAAK,OAAO,CAAC,OAAO,CAAC;wBACrB,KAAK,OAAO,CAAC,MAAM,CAAC;wBACpB,KAAK,OAAO,CAAC,KAAK,CAAC;wBACnB,KAAK,OAAO,CAAC,MAAM;4BACjB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,WAAW,EAAa,CAAC;4BAChD,MAAM;wBACR;4BACE,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC;qBAChC;oBAED,QAAO,UAAU,CAAC,WAAW,EAAgB,EAAE;wBAC7C,KAAK,UAAU,CAAC,OAAO,CAAC;wBACxB,KAAK,UAAU,CAAC,KAAK,CAAC;wBACtB,KAAK,UAAU,CAAC,MAAM;4BACpB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,WAAW,EAAgB,CAAC;4BACzD,MAAM;wBACR;4BACE,MAAM,CAAC,4CAA4C,GAAG,UAAU,CAAC,CAAC;qBACrE;oBAED,QAAO,EAAE,CAAC,WAAW,EAAqB,EAAE;wBAC1C,KAAK,eAAe,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;wBAC3C,KAAK,eAAe,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;wBACzC,KAAK,eAAe,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;wBACzC,KAAK,eAAe,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;wBAC3C,KAAK,eAAe,CAAC,GAAG,CAAC,WAAW,EAAE;4BACpC,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,WAAW,EAAqB,CAAC;4BAC9C,MAAM;wBACR;4BACE,IAAI,CAAC,EAAE,GAAG,eAAe,CAAC,KAAK,CAAC;qBACnC;oBAED,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;gBAC7B,CAAC;gBACH,iBAAC;YAAD,CAAC,AA5CD,IA4CC;YA5CY,gBAAU,aA4CtB,CAAA;QACH,CAAC,EA5EoB,KAAK,GAAL,YAAK,KAAL,YAAK,QA4EzB;IAAD,CAAC,EA5Ea,MAAM,GAAN,UAAM,KAAN,UAAM,QA4EnB;AAAD,CAAC,EA5ES,GAAG,KAAH,GAAG,QA4EZ;AC5ED,mFAAmF;AACnF,mCAAmC;AACnC,uCAAuC;AACvC,kCAAkC;AAClC,oCAAoC;AACpC,qCAAqC;ACLrC,IAAU,GAAG,CA8EZ;AA9ED,WAAU,GAAG;IAAC,IAAA,MAAM,CA8EnB;IA9Ea,WAAA,MAAM;QAAC,IAAA,IAAI,CA8ExB;QA9EoB,WAAA,IAAI;YACZ,UAAK,GAAG;gBACjB,gFAAgF;gBAChF,2GAA2G;gBAC3G,aAAa,EAAE;oBACb,OAAO,EAAC,MAAM;oBACd,OAAO,EAAC,MAAM;oBACd,MAAM,EAAC,MAAM;oBACb,MAAM,EAAC,MAAM;oBACb,OAAO,EAAC,MAAM;oBACd,MAAM,EAAC,MAAM;oBACb,KAAK,EAAC,MAAM;oBACZ,kFAAkF;oBAClF,mFAAmF;oBACnF,MAAM,EAAC,MAAM;oBACb,MAAM,EAAC,MAAM;oBACb,SAAS,EAAC,MAAM;oBAChB,UAAU,EAAC,MAAM;oBACjB,aAAa,EAAC,MAAM;oBACpB,aAAa,EAAC,MAAM;oBACpB,gBAAgB,EAAC,MAAM;oBACvB,aAAa,EAAC,MAAM;oBACpB,kBAAkB,EAAC,MAAM,CAAC,iFAAiF;iBAC5G;gBAED,gBAAgB,EAAE;oBAChB,KAAK,EAAC,MAAM;oBACZ,YAAY,EAAE,CAAC,MAAM,GAAG,MAAM,CAAC;oBAC/B,QAAQ,EAAC,MAAM;oBACf,WAAW,EAAC,MAAM;oBAClB,YAAY,EAAC,MAAM,CAAC,gDAAgD;iBACrE;gBAED,aAAa,EAAE;oBACb,KAAK,EAAC,MAAM;oBACZ,MAAM,EAAC,MAAM;oBACb,UAAU,EAAC,MAAM;oBACjB,aAAa,EAAC,MAAM;iBACrB;gBAED,qEAAqE;gBACrE,QAAQ,EAAE;oBACR,QAAQ,EAAC,CAAC,EAAC,OAAO,EAAC,CAAC,EAAC,SAAS,EAAC,EAAE;oBACjC,SAAS,EAAC,EAAE,EAAC,WAAW,EAAC,EAAE,EAAC,OAAO,EAAC,EAAE,EAAC,SAAS,EAAC,EAAE,EAAC,QAAQ,EAAC,EAAE;oBAC/D,OAAO,EAAC,EAAE,EAAC,SAAS,EAAC,EAAE,EAAC,QAAQ,EAAC,EAAE;oBACnC,QAAQ,EAAC,EAAE,EAAC,OAAO,EAAC,EAAE,EAAC,QAAQ,EAAC,EAAE,EAAC,QAAQ,EAAC,EAAE,EAAC,MAAM,EAAC,EAAE;oBACxD,SAAS,EAAC,EAAE,EAAC,QAAQ,EAAC,EAAE,EAAC,OAAO,EAAC,EAAE,EAAC,SAAS,EAAC,EAAE,EAAC,QAAQ,EAAC,EAAE;oBAC5D,OAAO,EAAC,EAAE,EAAC,OAAO,EAAC,EAAE,EAAC,QAAQ,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE;oBAC1C,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE;oBAC9D,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE;oBAC9D,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE;oBAC9D,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE;oBAC9D,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE,EAAC,KAAK,EAAC,EAAE;oBAC9D,OAAO,EAAC,EAAE,EAAC,OAAO,EAAC,EAAE,EAAC,OAAO,EAAC,EAAE;oBAChC,OAAO,EAAC,EAAE,EAAC,OAAO,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG;oBAC9C,OAAO,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG,EAAC,UAAU,EAAC,GAAG;oBAClD,UAAU,EAAC,GAAG,EAAC,aAAa,EAAC,GAAG,EAAC,WAAW,EAAC,GAAG,EAAC,SAAS,EAAC,GAAG;oBAC9D,WAAW,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG;oBAC3D,MAAM,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG,EAAC,MAAM,EAAC,GAAG;oBACtD,OAAO,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG,EAAC,WAAW,EAAC,GAAG,EAAC,UAAU,EAAC,GAAG;oBAClE,UAAU,EAAC,GAAG,EAAC,UAAU,EAAC,GAAG,EAAC,YAAY,EAAC,GAAG,EAAC,YAAY,EAAC,GAAG;oBAC/D,QAAQ,EAAC,GAAG,EAAC,QAAQ,EAAC,GAAG;oBACzB,SAAS,EAAC,GAAG,EAAC,SAAS,EAAC,GAAG,EAAC,SAAS,EAAC,GAAG,EAAC,UAAU,EAAC,GAAG;oBACxD,UAAU,EAAC,GAAG,EAAC,SAAS,EAAC,GAAG,EAAC,WAAW,EAAC,GAAG;oBAC5C,SAAS,EAAC,GAAG,EAAC,WAAW,EAAC,GAAG,EAAC,SAAS,EAAC,GAAG;oBAC3C,SAAS,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG,EAAC,OAAO,EAAC,GAAG;oBACrC,QAAQ,EAAC,KAAK,EAAC,QAAQ,EAAC,KAAK;oBAC7B,YAAY,EAAC,KAAK,EAAC,WAAW,EAAC,KAAK,EAAC,cAAc,EAAC,KAAK;oBACzD,SAAS,EAAC,KAAK,EAAC,SAAS,EAAC,KAAK,EAAC,SAAS,EAAC,KAAK;oBAC/C,WAAW,EAAC,KAAK,EAAC,SAAS,EAAC,KAAK;oBACjC,WAAW,EAAC,KAAK,EAAC,UAAU,EAAC,KAAK;iBACnC;gBAED,OAAO,EAAE;oBACP,CAAC,YAAY,EAAC,SAAS,EAAE,QAAQ,CAAC;oBAClC,CAAC,YAAY,EAAC,SAAS,EAAE,MAAM,CAAC;iBACjC;aACF,CAAA;QACH,CAAC,EA9EoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QA8ExB;IAAD,CAAC,EA9Ea,MAAM,GAAN,UAAM,KAAN,UAAM,QA8EnB;AAAD,CAAC,EA9ES,GAAG,KAAH,GAAG,QA8EZ;AC9ED,IAAU,GAAG,CA+JZ;AA/JD,WAAU,GAAG;IAAC,IAAA,MAAM,CA+JnB;IA/Ja,WAAA,MAAM;QAAC,IAAA,IAAI,CA+JxB;QA/JoB,WAAA,IAAI;YACvB,4CAA4C;YAE5C;gBAQE,iBAAY,GAAW,EAAE,EAAU;oBACjC,IAAI,CAAC,CAAC,GAAG,GAAG,CAAC;oBACb,IAAI,CAAC,CAAC,GAAG,EAAE,CAAC;oBACZ,IAAI,CAAC,CAAC,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;gBACjC,CAAC;gBAED,uBAAK,GAAL,UAAM,CAAS,EAAE,CAAS;oBACxB,IAAI,MAAM,GAAW,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;oBAElD,OAAO,MAAM,CAAC;gBAChB,CAAC;gBAED,qBAAG,GAAH;oBACE,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;gBACnB,CAAC;gBAED,uBAAK,GAAL;oBACE,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;gBACnB,CAAC;gBAED,wBAAM,GAAN,UAAO,KAAc;oBACnB,OAAO,IAAI,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;gBAC1B,CAAC;gBAED,uBAAK,GAAL;oBACE,IAAI,EAAE,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;oBACrC,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;oBAEd,OAAO,EAAE,CAAC;gBACZ,CAAC;gBA/BM,mBAAW,GAAW,CAAC,CAAC;gBAiC/B;;mBAEG;gBACI,gBAAQ,GAAG,UAAS,CAAU,EAAE,CAAU;oBAC/C,+DAA+D;oBAC/D,IAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;wBACb,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;qBAClB;yBAAM;wBACL,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;qBAClB;gBACH,CAAC,CAAC;gBACJ,cAAC;aAAA,AAlDD,IAkDC;YAlDY,YAAO,UAkDnB,CAAA;YAED,qCAAqC;YACrC;gBAAA;oBACE,QAAG,GAAc,EAAE,CAAC;gBAqGtB,CAAC;gBAnGC,sCAAa,GAAb;oBACE,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;oBAC3C,OAAO,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAC7B,CAAC;gBAED,8BAAK,GAAL;oBACE,IAAI,GAAG,GAAG,IAAI,cAAc,EAAE,CAAC;oBAC/B,IAAI,GAAG,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;oBAE/B,8EAA8E;oBAC9E,GAAG,CAAC,GAAG,GAAG,EAAE,CAAC;oBACb,GAAG,CAAC,OAAO,CAAC,UAAS,KAAc;wBACjC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC;oBAC9B,CAAC,CAAC,CAAC;oBAEH,OAAO,GAAG,CAAC;gBACb,CAAC;gBAED;;;;;;;;mBAQG;gBACH,gCAAO,GAAP,UAAQ,QAAgB,EAAE,CAAS,EAAE,CAAS;oBAC5C,IAAG,IAAI,CAAC,GAAG,CAAC,MAAM,IAAI,CAAC,EAAE;wBACvB,OAAO,KAAK,CAAC,CAAC,QAAQ;qBACvB;oBAED,IAAI,EAAE,GAAC,QAAQ,CAAC;oBAChB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;oBACX,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBACvC,mFAAmF;wBACnF,+CAA+C;wBAC/C,IAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE;4BAClD,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;4BAClB,wEAAwE;4BACxE,gFAAgF;4BAChF,OAAO,IAAI,CAAC,CAAC,QAAQ;yBACtB;qBACF;oBAED,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC,QAAQ;oBAE7B,OAAO,KAAK,CAAC;gBACf,CAAC;gBAED,4BAAG,GAAH,UAAI,EAAW;oBACb,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;gBACjC,CAAC;gBAED,+BAAM,GAAN,UAAO,EAAW;oBAChB,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;oBACjC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC5B,CAAC;gBAED,8BAAK,GAAL;oBACE,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;gBAChB,CAAC;gBAED,qCAAY,GAAZ;oBACE,KAAc,UAAQ,EAAR,KAAA,IAAI,CAAC,GAAG,EAAR,cAAQ,EAAR,IAAQ,EAAE;wBAApB,IAAI,EAAE,SAAA;wBACR,EAAE,CAAC,KAAK,EAAE,CAAC;qBACZ;gBACH,CAAC;gBAED,sCAAa,GAAb;oBACE,KAAI,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE;wBAC1C,IAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE;4BACvB,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,6BAA6B;yBACxD;qBACF;gBACH,CAAC;gBAED;;;;;;mBAMG;gBACH,wCAAe,GAAf,UAAgB,MAAc,EAAE,MAAc;oBAC5C,IAAG,MAAM,IAAI,CAAC,EAAE;wBACd,OAAO;qBACR;oBAED,KAAc,UAAQ,EAAR,KAAA,IAAI,CAAC,GAAG,EAAR,cAAQ,EAAR,IAAQ,EAAE;wBAApB,IAAI,EAAE,SAAA;wBACR,IAAG,EAAE,CAAC,CAAC,GAAG,MAAM,EAAE;4BAChB,EAAE,CAAC,CAAC,IAAI,MAAM,CAAC;yBAChB;qBACF;gBACH,CAAC;gBAED,8BAAK,GAAL;oBACE,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC;gBACzB,CAAC;gBACH,qBAAC;YAAD,CAAC,AAtGD,IAsGC;YAtGY,mBAAc,iBAsG1B,CAAA;QACH,CAAC,EA/JoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QA+JxB;IAAD,CAAC,EA/Ja,MAAM,GAAN,UAAM,KAAN,UAAM,QA+JnB;AAAD,CAAC,EA/JS,GAAG,KAAH,GAAG,QA+JZ;AC/JD,+EAA+E;AAC/E,2CAA2C;AAC3C,6BAA6B;AAC7B,mCAAmC;;;;;;;;;;;;;;AAEnC,sEAAsE;AAEtE,IAAU,GAAG,CA8aZ;AA9aD,WAAU,GAAG;IAAC,IAAA,MAAM,CA8anB;IA9aa,WAAA,MAAM;QAAC,IAAA,IAAI,CA8axB;QA9aoB,WAAA,MAAI;YACvB;gBAKE,uBAAY,MAAc,EAAE,UAAkB,EAAE,WAAoB;oBAClE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;oBACrB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;oBAC7B,IAAI,CAAC,WAAW,GAAG,WAAW,IAAI,CAAC,CAAC;gBACtC,CAAC;gBAEsB,iBAAG,GAAG,IAAI,aAAa,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC3D,oBAAC;aAAA,AAZD,IAYC;YAZY,oBAAa,gBAYzB,CAAA;YAED;gBASE,uBAAY,SAAmB,EAAE,SAAoB,EAAE,QAAc,EAAE,UAAwB,CAAA,mDAAmD;oBAChJ,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,GAAG,aAAa,CAAC,SAAS,EAAE,CAAC;oBAEnD,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;oBAC3B,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;oBAC3B,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;oBAC7B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;oBAEzB,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;oBAE/B,4CAA4C;oBAC5C,IAAG,UAAU,EAAE;wBACb,UAAU,CAAC,OAAO,CAAC,UAAS,GAAG;4BAC7B,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,KAAK,CAAC;wBACxB,CAAC,CAAC,CAAC;qBACJ;gBACH,CAAC;gBAlBc,uBAAS,GAAW,CAAC,CAAC;gBAmBvC,oBAAC;aAAA,AA1BD,IA0BC;YA1BY,oBAAa,gBA0BzB,CAAA;YAID;gBAGE;oBACE,IAAI,CAAC,IAAI,GAAG,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;gBACxC,CAAC;gBAMD,sBAAI,qCAAW;oBAJf;;;uBAGG;yBACH;wBACE,OAAO,IAAI,CAAC;oBACd,CAAC;;;mBAAA;gBAED,mCAAY,GAAZ;oBACE,IAAI,CAAC,QAAQ,EAAE,CAAC,KAAK,EAAE,CAAC;gBAC1B,CAAC;gBAED,+BAAQ,GAAR;oBACE,OAAO,IAAI,CAAC,IAAI,CAAC;gBACnB,CAAC;gBAED,sCAAe,GAAf,UAAgB,CAAS,EAAE,CAAS;oBAClC,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC/D,CAAC;gBAED,+CAAwB,GAAxB,UAAyB,CAAS;oBAChC,IAAI,EAAE,GAAY,IAAI,OAAA,OAAO,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC,CAAC;oBACzD,IAAI,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBAC1B,CAAC;gBAED;;;;;mBAKG;gBACO,qCAAc,GAAxB,UAAyB,KAAa;oBACpC,IAAI,CAAC,QAAQ,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,KAAK,CAAC,CAAC;gBACjE,CAAC;gBAED;;;mBAGG;gBACO,kCAAW,GAArB,UAAsB,GAAwB;oBAC5C,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,KAAK,EAAE,CAAC;gBAC1B,CAAC;gBAED;;;;;;;mBAOG;gBACH,yCAAkB,GAAlB,UAAmB,QAAsB;oBACvC,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;oBACxB,IAAI,IAAI,GAAG,QAAQ,CAAC,OAAO,EAAE,CAAC;oBAE9B,IAAI,SAAS,GAAG,QAAQ,CAAC,eAAe,EAAE,CAAC;oBAC3C,IAAI,OAAO,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;oBAErC,mDAAmD;oBACnD,IAAI,eAAe,GAAG,SAAS,GAAG,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC;oBAEhE,0FAA0F;oBAC1F,iEAAiE;oBACjE,IAAI,YAAY,GAAG,EAAE,CAAC,uBAAuB,CAAC,eAAe,CAAC,CAAC;oBAE/D,6EAA6E;oBAC7E,IAAI,KAAK,GAAG,CAAC,CAAC;oBACd,IAAI,GAAG,GAAG,YAAY,CAAC,CAAE,mDAAmD;oBAE5E,2EAA2E;oBAC3E,OAAM,KAAK,GAAG,GAAG,EAAE;wBACjB,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,GAAC,KAAK,GAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,0BAA0B;wBACnE,IAAI,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,GAAG,GAAC,KAAK,CAAC,CAAC;wBAC7C,IAAI,MAAM,GAAK,EAAE,CAAC,MAAM,CAAC,KAAK,EAAE,GAAG,GAAC,KAAK,CAAC,CAAC;wBAE3C,IAAG,QAAQ,IAAI,MAAM,EAAE;4BACrB,KAAK,GAAG,GAAG,CAAC;yBACb;6BAAM;4BACL,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;yBACf;qBACF;oBAED,0EAA0E;oBAC1E,oDAAoD;oBAEpD,2EAA2E;oBAC3E,qEAAqE;oBAErE,4EAA4E;oBAC5E,+BAA+B;oBAC/B,IAAG,GAAG,GAAG,CAAC,IAAI,GAAG,GAAG,YAAY,EAAE;wBAChC,IAAI,aAAa,GAAM,IAAI,CAAC,UAAU,CAAC,GAAG,GAAC,CAAC,CAAC,CAAC;wBAC9C,IAAI,gBAAgB,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;wBAC5C,IAAI,cAAc,GAAK,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;wBAE1C,mDAAmD;wBACnD,IAAG,aAAa,IAAI,MAAM,IAAI,aAAa,IAAI,MAAM,EAAE;4BACrD,kEAAkE;4BAClE,IAAI,IAAI,GAAG,gBAAgB,IAAI,MAAM,IAAI,gBAAgB,IAAI,MAAM,CAAC;4BACpE,IAAI,GAAG,IAAI,IAAI,CAAC,cAAc,IAAI,MAAM,IAAI,cAAc,IAAI,MAAM,CAAC,CAAC;4BAEtE,qEAAqE;4BACrE,IAAG,IAAI,EAAE;gCACP,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;6BACf;yBACF;qBACF;oBAED,kFAAkF;oBAClF,4FAA4F;oBAC5F,IAAI,QAAQ,GAAG,IAAI,CAAC,uBAAuB,CAAC,GAAG,CAAC,CAAC;oBACjD,IAAI,WAAW,GAAG,SAAS,GAAG,QAAQ,CAAC;oBAEvC,2CAA2C;oBAC3C,oFAAoF;oBACpF,iCAAiC;oBACjC,IAAI,cAAc,GAAG,OAAO,GAAG,QAAQ,CAAC;oBACxC,IAAI,KAAK,GAAG,EAAE,CAAC,UAAU,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;oBAEpD,IAAI,cAAc,GAAG,EAAE,CAAC,UAAU,EAAE,GAAG,OAAO,CAAC;oBAC/C,IAAI,aAAa,GAAG,IAAI,CAAC,UAAU,EAAE,GAAG,SAAS,CAAC;oBAClD,IAAI,YAAY,GAAG,aAAa,GAAG,cAAc,CAAC;oBAElD,wEAAwE;oBACxE,IAAG,YAAY,GAAG,CAAC,EAAE;wBACnB,mCAAmC;wBACnC,KAAK,GAAG,KAAK,GAAG,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,YAAY,CAAC,CAAC;wBACtD,YAAY,GAAG,CAAC,CAAC;qBAClB;oBAED,OAAO,IAAI,aAAa,CAAC,KAAK,EAAE,WAAW,EAAE,YAAY,CAAC,CAAC;gBAC7D,CAAC;gBAED,6CAAsB,GAAtB,UAAuB,QAAsB,EAAE,QAAkB,EAAE,UAAwB;oBACzF,IAAI,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC,CAAC;oBAElD,0EAA0E;oBAE1E,OAAO,IAAI,aAAa,CAAC,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,UAAU,CAAC,CAAC;gBACjF,CAAC;gBAED;;;mBAGG;gBACH,gCAAS,GAAT,UAAU,QAAsB;oBAC9B,EAAE;oBACF,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC,CAAC;oBACvD,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,CAAC;oBAErD,8BAA8B;oBAC9B,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;gBACpC,CAAC;gBAED,4BAAK,GAAL,UAAM,SAAoB;oBACxB,IAAG,SAAS,CAAC,WAAW,EAAE;wBACxB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC;qBACpF;oBAED,IAAG,SAAS,CAAC,UAAU,EAAE;wBACvB,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;qBACnD;oBAED,IAAG,SAAS,CAAC,MAAM,EAAE;wBACnB,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;qBAC9C;oBAED,gFAAgF;oBAChF,gEAAgE;oBAChE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;gBACpB,CAAC;gBAED;;;;mBAIG;gBACO,yCAAkB,GAA5B,UAA6B,CAAS;oBACpC,kEAAkE;oBAClE,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC,UAAU,EAAE,CAAC,CAAC;oBACpE,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;gBAChC,CAAC;gBAuED;;;mBAGG;gBACH,qCAAc,GAAd;oBACE,oDAAoD;gBACtD,CAAC;gBAED;;;mBAGG;gBACH,wCAAiB,GAAjB;oBACE,qDAAqD;gBACvD,CAAC;gBAMH,mBAAC;YAAD,CAAC,AAvRD,IAuRC;YAvRqB,mBAAY,eAuRjC,CAAA;YAED,kEAAkE;YAClE,yDAAyD;YACzD;gBAA0B,wBAAY;gBAIpC,cAAY,IAAa,EAAE,QAAiB;oBAA5C,YACE,iBAAO,SAMR;oBAJC,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;oBAC7B,IAAI,aAAa,GAAG,KAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;oBAC3C,qDAAqD;oBACrD,KAAI,CAAC,UAAU,GAAG,OAAO,QAAQ,IAAI,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,aAAa,CAAC;;gBAC3E,CAAC;gBAED,yFAAyF;gBAClF,SAAI,GAAX,UAAY,YAA0B;oBACpC,IAAI,KAAW,CAAC;oBAEhB,IAAG,YAAY,YAAY,IAAI,EAAE;wBAC/B,iEAAiE;wBACjE,iDAAiD;wBACjD,IAAI,SAAS,GAAG,YAAoB,CAAC;wBACrC,KAAK,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;qBACxD;yBAAM;wBACL,oEAAoE;wBACpE,qEAAqE;wBACrE,6CAA6C;wBAC7C,IAAI,OAAO,GAAG,YAAY,CAAC,kBAAkB,EAAE,CAAC;wBAChD,IAAI,UAAU,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC;wBAEtC,iFAAiF;wBACjF,8EAA8E;wBAC9E,KAAK,GAAG,IAAI,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC,iBAAiB,EAAE,EAAE,UAAU,CAAC,CAAC;qBAC1E;oBAED,8DAA8D;oBAC9D,KAAK,CAAC,WAAW,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC,CAAC;oBAE3C,OAAO,KAAK,CAAC;gBACf,CAAC;gBAED,6BAAc,GAAd;oBACE,OAAO;gBACT,CAAC;gBAED,kCAAmB,GAAnB;oBACE,OAAO;gBACT,CAAC;gBAED,2BAAY,GAAZ;oBACE,OAAO,IAAI,CAAC;gBACd,CAAC;gBAED,8BAAe,GAAf;oBACE,OAAO,IAAI,CAAC,UAAU,CAAC;gBACzB,CAAC;gBAED,8BAAe,GAAf,UAAgB,KAAa;oBAC3B,IAAG,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;wBAC9C,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;qBAC1D;oBACD,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;gBAC1B,CAAC;gBAED,iCAAkB,GAAlB;oBACE,OAAO,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;gBACjD,CAAC;gBAED,gCAAiB,GAAjB;oBACE,OAAO,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC9C,CAAC;gBAED,sBAAO,GAAP;oBACE,OAAO,IAAI,CAAC,IAAI,CAAC;gBACnB,CAAC;gBAED,qCAAsB,GAAtB,UAAuB,EAAU;oBAC/B,IAAG,EAAE,IAAI,CAAC,EAAE;wBACV,IAAG,EAAE,GAAG,IAAI,CAAC,UAAU,EAAE;4BACvB,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;yBACtB;wBACD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;wBACpF,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC;qBACvB;gBACH,CAAC;gBAED,oCAAqB,GAArB,UAAsB,CAAS;oBAC7B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,kBAAkB,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACrE,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,SAAS,EAAE,CAAC;gBACnC,CAAC;gBAED,mCAAoB,GAApB;oBACE,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,CAAC;gBACnC,CAAC;gBAES,gCAAiB,GAA3B,UAA4B,CAAS;oBACnC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC;gBAC5C,CAAC;gBAED,2BAAY,GAAZ;oBACE,yEAAyE;gBAC3E,CAAC;gBACH,WAAC;YAAD,CAAC,AArGD,CAA0B,YAAY,GAqGrC;YArGY,WAAI,OAqGhB,CAAA;QACH,CAAC,EA9aoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QA8axB;IAAD,CAAC,EA9aa,MAAM,GAAN,UAAM,KAAN,UAAM,QA8anB;AAAD,CAAC,EA9aS,GAAG,KAAH,GAAG,QA8aZ;ACrbD,wCAAwC;AAExC,IAAU,GAAG,CAoCZ;AApCD,WAAU,GAAG;IAAC,IAAA,MAAM,CAoCnB;IApCa,WAAA,MAAM;QAAC,IAAA,IAAI,CAoCxB;QApCoB,WAAA,IAAI;YAKvB;;;eAGG;YACH;gBAAA;oBAsBE;;uBAEG;oBACH,gBAAW,GAAY,IAAI,CAAC;gBAC9B,CAAC;gBAAD,eAAC;YAAD,CAAC,AA1BD,IA0BC;YA1BY,aAAQ,WA0BpB,CAAA;YAAA,CAAC;QACJ,CAAC,EApCoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QAoCxB;IAAD,CAAC,EApCa,MAAM,GAAN,UAAM,KAAN,UAAM,QAoCnB;AAAD,CAAC,EApCS,GAAG,KAAH,GAAG,QAoCZ;ACtCD,IAAU,GAAG,CAoIZ;AApID,WAAU,GAAG;IAAC,IAAA,MAAM,CAoInB;IApIa,WAAA,MAAM;QAAC,IAAA,IAAI,CAoIxB;QApIoB,WAAA,IAAI;YACvB;;eAEG;YACH;gBAAA;oBACE;;;uBAGG;oBACH,kBAAa,GAAkB,IAAI,CAAC;oBAOpC;;uBAEG;oBACH,aAAQ,GAA2B,EAAE,CAAC;oBAEtC;;uBAEG;oBACH,cAAS,GAAoC,EAAE,CAAC;oBAEhD;;uBAEG;oBACF,mBAAc,GAAsC,EAAE,CAAC;oBAExD;;uBAEG;oBACH,2BAAsB,GAAY,KAAK,CAAC;gBAiG1C,CAAC;gBAtEC,+BAAQ,GAAR,UAAS,SAA4B,EAAE,YAA0B;oBAC/D,IAAG,CAAC,IAAI,CAAC,aAAa,EAAE;wBACtB,MAAM,uDAAuD,CAAC;qBAC/D;oBAED,IAAG,SAAS,CAAC,WAAW,IAAI,IAAI,CAAC,IAAI,EAAE;wBACrC,SAAS,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;qBACrC;oBAED,KAAI,IAAI,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE;wBAChC,IAAI,QAAQ,GAAG,SAAS,CAAC,iBAAiB,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;wBACjE,IAAG,QAAQ,EAAE;4BACX,IAAI;gCACF,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;6BACtC;4BAAC,OAAO,KAAK,EAAE;gCACd,IAAG,SAAS,CAAC,WAAW,EAAE;oCACxB,SAAS,CAAC,WAAW,CAAC,8EAA8E,CAAC,CAAC;iCACvG;6BACF;yBACF;6BAAM,IAAG,SAAS,CAAC,aAAa,EAAE;4BACjC,SAAS,CAAC,aAAa,CAAC,2CAA2C,GAAG,OAAO,CAAC,CAAC;yBAChF;qBACF;oBAED,SAAS,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;oBAErE,IAAG,SAAS,CAAC,iBAAiB,CAAC,uBAAuB,EAAE;wBACtD,KAAI,IAAI,OAAO,IAAI,IAAI,CAAC,SAAS,EAAE;4BACjC,SAAS,CAAC,iBAAiB,CAAC,uBAAuB,CAAC,SAAS,CAAC,SAAS,CAAC,cAAc,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;yBAC9H;qBACF;oBAED,IAAG,IAAI,CAAC,sBAAsB,EAAE;wBAC9B,IAAI,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC;wBAC5C,KAAA,aAAa,CAAC,YAAY,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;qBACpD;oBAED,IAAG,SAAS,CAAC,aAAa,IAAI,IAAI,CAAC,UAAU,EAAE;wBAC7C,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;qBAC1C;yBAAM,IAAG,SAAS,CAAC,WAAW,IAAI,IAAI,CAAC,QAAQ,EAAE;wBAChD,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;qBACtC;gBACH,CAAC;gBAED;;;;;;;;;;mBAUG;gBACH,sCAAe,GAAf,UAAgB,KAAmB;oBACjC,IAAI,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC;oBAC7C,IAAI,YAAY,GAAG,KAAK,CAAC,aAAa,CAAC,SAAS,CAAC;oBACjD,IAAG,SAAS,CAAC,KAAK,IAAI,YAAY,CAAC,KAAK,IAAI,SAAS,CAAC,UAAU,IAAI,YAAY,CAAC,UAAU,EAAE;wBAC3F,MAAM,2EAA2E,CAAC;qBACnF;oBAED,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,sBAAsB,IAAI,KAAK,CAAC,sBAAsB,CAAC;oBAE1F,IAAI,WAAW,GAAG,KAAA,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;oBACzD,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;oBAChD,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;oBAEjD,IAAI,CAAC,aAAa,GAAG,WAAW,CAAC,sBAAsB,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gBACjI,CAAC;gBACH,mBAAC;YAAD,CAAC,AA/HD,IA+HC;YA/HY,iBAAY,eA+HxB,CAAA;QACH,CAAC,EApIoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QAoIxB;IAAD,CAAC,EApIa,MAAM,GAAN,UAAM,KAAN,UAAM,QAoInB;AAAD,CAAC,EApIS,GAAG,KAAH,GAAG,QAoIZ;ACpID,oCAAoC;AACpC,iCAAiC;AACjC,4CAA4C;AAC5C,oCAAoC;AAEpC,IAAU,GAAG,CA+MZ;AA/MD,WAAU,GAAG;IAAC,IAAA,MAAM,CA+MnB;IA/Ma,WAAA,MAAM;QAAC,IAAA,IAAI,CA+MxB;QA/MoB,WAAA,IAAI;YACvB,IAAY,mBAGX;YAHD,WAAY,mBAAmB;gBAC7B,mCAAY,CAAA;gBACZ,uCAAgB,CAAA;YAClB,CAAC,EAHW,mBAAmB,GAAnB,wBAAmB,KAAnB,wBAAmB,QAG9B;YAED;;eAEG;YACH;gBACE;gBACA,CAAC;gBAEM,0BAAY,GAAnB,UAAoB,GAAa;oBAC/B,OAAO,KAAA,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC;oBAAA,CAAC;gBACjD,CAAC;gBAED;;;mBAGG;gBACW,oBAAM,GAApB,UAAqB,GAAa,EAAE,UAAmB,EAAE,YAA2B;oBAClF,IAAI,IAAI,GAAG,EAAE,CAAC;oBAEd,iGAAiG;oBACjG,IAAG,CAAC,IAAI,GAAG,aAAa,CAAC,mBAAmB,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC,IAAI,IAAI,EAAE;wBACxE,OAAO,IAAI,CAAC;qBACb;yBAAM,IAAG,CAAC,UAAU,IAAI,CAAC,CAAC,IAAI,GAAG,aAAa,CAAC,aAAa,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC,IAAI,IAAI,CAAC,EAAE;wBAC1F,OAAO,IAAI,CAAC;qBACb;yBAAM,IAAG,CAAC,IAAI,GAAG,aAAa,CAAC,kBAAkB,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC,IAAI,IAAI,EAAE;wBAC9E,OAAO,IAAI,CAAC;qBACb;yBAAM,IAAG,CAAC,IAAI,GAAG,aAAa,CAAC,WAAW,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC,IAAI,IAAI,EAAE;wBACvE,OAAO,IAAI,CAAC;qBACb;yBAAM;wBACL,6FAA6F;wBAC7F,qEAAqE;wBACrE,iGAAiG;wBACjG,gDAAgD;wBAChD,IAAI,IAAI,GAAG,aAAa,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;wBAC3C,QAAO,IAAI,EAAE;4BACb,kCAAkC;4BAClC,sCAAsC;4BACtC,qCAAqC;4BACrC,mBAAmB;4BACjB;gCACC,OAAO,IAAI,CAAC;yBACd;qBACF;gBACH,CAAC;gBAED;;mBAEG;gBACW,uBAAS,GAAvB,UAAwB,GAAa;oBACnC,IAAI,IAAI,GAAG,aAAa,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;oBAE3C,QAAO,IAAI,EAAE;wBACX,iCAAiC;wBACjC,iHAAiH;wBACjH,kCAAkC;wBAClC,iBAAiB;wBACjB;4BACE,OAAO,KAAK,CAAC;qBAChB;gBACH,CAAC;gBAED;;;;;;mBAMG;gBACW,0BAAY,GAA1B,UAA2B,GAAa,EAAE,YAA0B;oBAClE,mDAAmD;oBACnD,EAAE;oBACF,iBAAiB;oBACf,+CAA+C;oBAC/C,mGAAmG;oBACnG,qFAAqF;oBACrF,EAAE;oBACF,iCAAiC;oBACjC,qBAAqB;oBACrB,oDAAoD;oBACpD,2EAA2E;oBAC3E,MAAM;oBACN,WAAW;oBACX,kCAAkC;oBAClC,qBAAqB;oBACrB,oDAAoD;oBACpD,mDAAmD;oBACnD,MAAM;oBACN,qDAAqD;oBACrD,aAAa;oBACb,MAAM;oBACR,IAAI;oBACJ,EAAE;oBACF,iEAAiE;gBACnE,CAAC;gBAED;;;mBAGG;gBACW,iCAAmB,GAAjC,UAAkC,GAAa,EAAE,YAA2B;oBAC1E,IAAI,IAAI,GAAG,aAAa,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;oBAE3C,QAAO,IAAI,EAAE;wBACX,KAAK,KAAA,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC;4BAC3B,OAAO,mBAAmB,CAAC,SAAS,CAAC;wBACvC,KAAK,KAAA,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC;4BAC5B,OAAO,mBAAmB,CAAC,KAAK,CAAC;wBACnC,gCAAgC;wBAChC,mEAAmE;wBACnE;4BACE,OAAO,IAAI,CAAC;qBACf;gBACH,CAAC;gBAED,0FAA0F;gBAC5E,2BAAa,GAA3B,UAA4B,GAAa,EAAE,YAA2B;oBACpE,gEAAgE;oBAChE,IAAG,GAAG,CAAC,KAAK,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAM,GAAG,CAAC,KAAK,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE;wBACrF,yBAAyB;wBACzB,IAAG,GAAG,CAAC,KAAK,GAAG,GAAG,EAAE;4BAClB,IAAI,GAAG,GAAG,GAAG,CAAC,KAAK,GAAC,EAAE,CAAC;yBACxB;6BAAM;4BACL,GAAG,GAAG,GAAG,CAAC,KAAK,GAAC,EAAE,CAAC;yBACpB;wBACD,IAAI,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO;wBAC9C,OAAO,EAAE,CAAC;qBACX;yBAAM;wBACL,OAAO,IAAI,CAAC;qBACb;gBACH,CAAC;gBAED,wCAAwC;gBACxC,iEAAiE;gBACnD,gCAAkB,GAAhC,UAAiC,GAAa,EAAE,YAA2B;oBACzE,IAAM,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC;oBAE1B,wCAAwC;oBACxC,iEAAiE;oBACjE,IAAG,CAAC,OAAO,IAAI,OAAO,CAAC,MAAM,CAAC,CAAC,EAAC,CAAC,CAAC,IAAI,IAAI,EAAE;wBAC1C,OAAO,IAAI,CAAC;qBACb;oBAED,IAAI,MAAM,GAAG,EAAE,CAAC;oBAChB,IAAM,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAChD,KAAqB,UAAU,EAAV,yBAAU,EAAV,wBAAU,EAAV,IAAU,EAAE;wBAA7B,IAAI,SAAS,mBAAA;wBACf,IAAM,cAAc,GAAG,QAAQ,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;wBAC/C,IAAI,CAAC,CAAC,GAAG,IAAI,cAAc,CAAC,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,cAAc,CAAC,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,CAAC,EAAE;4BACnH,gGAAgG;4BAChG,4FAA4F;4BAC5F,IAAG,YAAY,EAAE;gCACf,YAAY,CAAC,QAAQ,GAAG,CAAC,sCAAsC,GAAG,OAAO,CAAC,CAAC;6BAC5E;4BACD,mCAAmC;4BACnC,SAAS;yBACV;6BAAM;4BACL,4EAA4E;4BAC5E,oEAAoE;4BACpE,MAAM,IAAI,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;yBAClD;qBACF;oBACD,OAAO,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC;gBAChC,CAAC;gBAED,gFAAgF;gBAChF,sHAAsH;gBACxG,yBAAW,GAAzB,UAA0B,GAAa,EAAE,YAA2B;oBAClE,IAAI,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC;oBAClB,IAAI,aAAa,GAAG,GAAG,CAAC,UAAU,CAAC;oBAEnC,gHAAgH;oBAChH,kEAAkE;oBAClE,IAAG,aAAa,IAAI,KAAA,KAAK,CAAC,aAAa,CAAC,OAAO,CAAC,EAAE;wBAChD,aAAa,GAAG,CAAC,CAAC;qBACnB;yBAAM,IAAG,aAAa,IAAI,CAAC,EAAE;wBAC5B,IAAG,YAAY,EAAE;4BACf,YAAY,CAAC,UAAU,GAAG,2EAA2E,CAAC;yBACvG;wBACD,OAAO,IAAI,CAAC;qBACb;oBAED,+GAA+G;oBAC/G,IAAI;wBACF,IAAG,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE;4BACjC,OAAO,GAAG,CAAC;yBACZ;6BAAM,IAAG,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,EAAE,mBAAmB;4BACvF,OAAO,KAAA,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAC,KAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;yBACjE;6BAAM,IAAG,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,EAAE,uBAAuB;4BAC3F,OAAO,MAAM,CAAC,YAAY,CAAC,CAAC,GAAC,CAAC,aAAa,CAAA,CAAC,CAAA,CAAC,CAAA,CAAC,CAAA,EAAE,CAAC,CAAC,CAAC,CAAE,gDAAgD;yBACtG;6BAAM,IAAG,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE;4BAC5E,OAAO,KAAA,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAC,KAAA,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;yBACrE;6BAAM,IAAG,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,KAAA,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE;4BAC1E,OAAO,KAAA,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAC,KAAA,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;yBACrE;qBACF;oBAAC,OAAO,CAAC,EAAE;wBACV,IAAG,YAAY,EAAE;4BACf,YAAY,CAAC,QAAQ,GAAG,uDAAuD,GAAG,CAAC,GAAG,kBAAkB,GAAG,CAAC,aAAa,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;yBACvJ;qBACF;oBAED,OAAO,IAAI,CAAC;gBACd,CAAC;gBACH,oBAAC;YAAD,CAAC,AArMD,IAqMC;YArMY,kBAAa,gBAqMzB,CAAA;QACH,CAAC,EA/MoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QA+MxB;IAAD,CAAC,EA/Ma,MAAM,GAAN,UAAM,KAAN,UAAM,QA+MnB;AAAD,CAAC,EA/MS,GAAG,KAAH,GAAG,QA+MZ;ACpND;;;IAGI;AAEJ,+DAA+D;AAE/D,IAAU,GAAG,CAk0BZ;AAl0BD,WAAU,GAAG;IAAC,IAAA,MAAM,CAk0BnB;IAl0Ba,WAAA,MAAM;QAAC,IAAA,SAAS,CAk0B7B;QAl0BoB,WAAA,SAAS;YAC5B,IAAI,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;YAgDlC,qGAAqG;YACrG;gBAAA;gBA+wBA,CAAC;gBA7tBC;;;;;;;kBAOE;gBACK,0BAAkB,GAAzB,UAA0B,GAAG,EAAE,QAAkB,EAAE,UAAkB;oBACnE,kDAAkD;oBAClD,IAAI,UAAU,GAAC,UAAU,CAAC;oBAE1B,IAAG,OAAO,OAAO,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,QAAQ,EAAE;wBACpD,UAAU,GAAG,SAAS,CAAC;qBACxB;oBAED,IAAI,UAAU,GAAG,KAAK,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;oBACtD,gGAAgG;oBAChG,IAAI,aAAa,GAAG,OAAA,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC;oBAC1C,IAAG,QAAQ,EAAE;wBACX,UAAU,GAAG,QAAQ,CAAC,eAAe,CAAC;wBACtC,aAAa,GAAG,QAAQ,CAAC,eAAe,CAAC;qBAC1C;oBAED,IAAG,CAAC,GAAG,EAAE;wBACP,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC;qBAC7B;oBAED,kDAAkD;oBAClD,IAAI,MAAM,GAAqB,OAAA,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC;oBAE9E,IAAI,CAAC,EAAC,MAAM,GAAC,MAAM,CAAC,OAAO,CAAC,EAAE,SAAS,GAAM,GAAG,CAAC,KAAK,CAAC,EAAE,MAAM,GAAC,GAAG,CAAC,MAAM,CAAC,CAAC;oBAC5E,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,IAAiB,EAAE,GAAc,EAAE,IAAiB,CAAC;oBAC1E,IAAI,MAAM,GAAY,CAAC,UAAU,GAAG,KAAK,CAAC,gBAAgB,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;oBAE3E,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,SAAS,IAAI,WAAW,IAAI,CAAC,SAAS,CAAC,CAAC;oBACjE,IAAG,CAAC,SAAS,EAAE;wBACb,2EAA2E;wBAC3E,gFAAgF;wBAChF,SAAS,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;qBACtE;oBAED,uEAAuE;oBACvE,IAAI,YAAY,GAAC,SAAS,CAAC;oBAE3B,kDAAkD;oBAElD,oGAAoG;oBACpG,IAAI,WAAW,GAAG,MAAM,CAAC,mBAAmB,CAAC,SAAS,CAAC,EAAE,aAAa,GAAG,EAAE,CAAC;oBAC5E,WAAW,CAAC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,CAAC;oBACtD,WAAW,GAAG,CAAE,SAAS,CAAE,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;oBAEhD,oFAAoF;oBACpF,IAAG,QAAQ,IAAI,QAAQ,CAAC,aAAa,EAAE;wBACrC,sDAAsD;wBACtD,IAAG,CAAC,WAAW,CAAC,OAAO,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,EAAE;4BAC3F,WAAW,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;4BACrC,SAAS,CAAC,kBAAkB,CAAC,GAAG,SAAS,CAAC,UAAU,CAAC,CAAC;yBACvD;wBAED,IAAG,CAAC,WAAW,CAAC,OAAO,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,EAAE;4BACvG,WAAW,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;4BAC3C,SAAS,CAAC,wBAAwB,CAAC,GAAG,SAAS,CAAC,gBAAgB,CAAC,CAAC;yBACnE;qBACF;oBAED,iFAAiF;oBACjF,kFAAkF;oBAClF,0EAA0E;oBAC1E,MAAM,CAAC,mBAAmB,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;oBAEhF,mEAAmE;oBACnE,IAAG,UAAU,IAAI,SAAS,EAAE;wBAC1B,aAAa,GAAG,OAAO,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;wBAEjD,iGAAiG;wBACjG,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,aAAa,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BACpC,IAAG,WAAW,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE;gCAC9C,aAAa,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;6BAC9B;yBACF;qBACF;oBAED,0GAA0G;oBAC1G,8EAA8E;oBAC9E,IAAI,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;oBAE/C,IAAG,SAAS,IAAI,UAAU,IAAI,SAAS,EAAE,EAAE,8CAA8C;wBACvF,wBAAwB;wBACxB,IAAI,QAAQ,GAAc,IAAI,CAAC;wBAE/B,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;wBACxB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BACjC,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;4BACtB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gCACjC,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;gCACd,IAAG,GAAG,CAAC,IAAI,CAAC,IAAI,SAAS,EAAE;oCACzB,QAAQ,GAAG,GAAG,CAAC;iCAChB;6BACF;yBACF;wBAED,IAAG,QAAQ,EAAE;4BACX,yCAAyC;4BACzC,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;4BAEpB,KAAI,IAAI,OAAO,IAAI,SAAS,EAAE;gCAC5B,IAAG,OAAO,IAAI,SAAS,IAAI,OAAO,IAAI,OAAO,EAAE;oCAC7C,2DAA2D;oCAC3D,SAAS;iCACV;gCAED,qFAAqF;gCACrF,IAAI,WAAW,GAAG,OAAO,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;gCACpD,IAAI,MAAM,GAAc;oCACtB,EAAE,EAAE,IAAI,GAAG,WAAW;oCACtB,IAAI,EAAE,WAAW;oCACjB,EAAE,EAAE,GAAG;oCACP,SAAS,EAAE,OAAO;iCACnB,CAAA;gCACD,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;6BAC7B;yBACF;6BAAM;4BACL,8EAA8E;4BAC9E,OAAO,CAAC,IAAI,CAAC,0DAA0D,CAAC,CAAC;yBAC1E;qBACF;oBAED,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBAC7B,2CAA2C;wBAC3C,IAAG,CAAC,GAAG,CAAC,EAAE;4BACR,MAAM,CAAC,CAAC,CAAC,GAAC,OAAA,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;yBACrC;wBACD,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAC,MAAM,CAAC,CAAC,CAAC,CAAC;wBAC1B,MAAM,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,GAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,sDAAsD;wBAExF,wDAAwD;wBACxD,OAAO,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;qBACrE;oBAED,4GAA4G;oBAC5G,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBAC7B,IAAI,KAAK,GAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,QAAQ,GAAc,IAAI,EAAE,OAAO,GAAC,IAAI,EAAE,OAAO,GAAC,EAAE,CAAC;wBAC9E,IAAI,OAAO,GAAc,IAAI,EAAE,MAAM,GAAc,IAAI,EAAE,SAAS,GAAc,IAAI,CAAC,CAAE,iCAAiC;wBACxH,IAAI,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;wBACvC,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBAC7C,IAAI,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,SAAS,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBAE5D,IAAI,GAAC,KAAK,CAAC,KAAK,CAAC,CAAC;wBAClB,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BAC3B,IAAI,GAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;4BACpB,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gCAC3B,GAAG,GAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gCACZ,EAAE,GAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;gCAExC,oFAAoF;gCACpF,IAAG,SAAS,IAAI,SAAS,EAAE;oCACzB,qEAAqE;oCACrE,IAAG,SAAS,EAAE;wCACZ,IAAG,EAAE,IAAI,CAAC,IAAI,EAAE,GAAG,SAAS,CAAC,MAAM;4CAAE,GAAG,CAAC,MAAM,CAAC,GAAC,SAAS,CAAC,EAAE,CAAC,CAAC;qCAChE;oCAED,sGAAsG;oCACtG,oGAAoG;oCACpG,IAAG,SAAS,IAAI,aAAa,CAAC,QAAQ,CAAC,OAAA,KAAK,CAAC,OAAO,CAAC,kBAAkB,CAAC,EAAE;wCACxE,IAAG,GAAG,CAAC,IAAI,CAAC,IAAI,SAAS,IAAI,EAAE,GAAC,EAAE,GAAG,OAAO,GAAG,OAAO,CAAC,QAAQ,CAAC,MAAM,IAAI,GAAG,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE;4CAC9F,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,GAAC,EAAE,GAAC,OAAO,CAAC,CAAC;yCAC9D;qCACF;iCACF;gCAED,8CAA8C;gCAC9C,IAAG,GAAG,CAAC,MAAM,CAAC,KAAK,IAAI,EAAE;oCACvB,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;iCACjC;gCAED,kCAAkC;gCAClC,QAAO,GAAG,CAAC,IAAI,CAAC,EAAE;oCAChB,KAAK,SAAS;wCACZ,QAAQ,GAAC,GAAG,CAAC;wCACb,MAAM;oCACR,KAAK,OAAO;wCACV,OAAO,GAAC,GAAG,CAAC;wCACZ,MAAM;oCACR,KAAK,QAAQ;wCACX,OAAO,GAAC,GAAG,CAAC;wCACZ,MAAM;oCACR,KAAK,WAAW;wCACd,MAAM,GAAC,GAAG,CAAC;wCACX,MAAM;oCACR,KAAK,UAAU;wCACb,SAAS,GAAC,GAAG,CAAC;wCACd,MAAM;iCACT;gCAED,kEAAkE;gCAClE,IAAG,GAAG,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;oCACpB,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,GAAG,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wCAChC,IAAG,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE;4CACvD,GAAG,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;yCAC1B;qCACF;oCAED,IAAG,GAAG,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,EAAE;wCACxB,GAAG,CAAC,IAAI,CAAC,GAAC,IAAI,CAAC;qCAChB;iCACF;6BACF;yBACF;wBAED,kHAAkH;wBAClH,KAAK,CAAC,QAAQ,GAAC,QAAQ,CAAC;wBACxB,KAAK,CAAC,OAAO,GAAC,OAAO,CAAC;wBACtB,KAAK,CAAC,MAAM,GAAC,MAAM,CAAC;wBACpB,KAAK,CAAC,SAAS,GAAC,SAAS,CAAC;wBAE1B,6FAA6F;wBAC7F,IAAG,UAAU,IAAI,SAAS,EAAE;4BAC1B,IAAG,CAAC,GAAG,CAAC,IAAI,QAAQ,IAAI,IAAI,EAAE;gCAC5B,QAAQ,CAAC,IAAI,CAAC,GAAC,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;gCACjD,QAAQ,CAAC,IAAI,CAAC,GAAC,IAAI,CAAC;gCACpB,QAAQ,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;6BAChH;yBACF;qBACF;oBAED,OAAO,MAAM,CAAC;gBAChB,CAAC;gBAEG;;;;;;eAMD;gBACI,kBAAU,GAAjB,UAAkB,CAAS;oBACzB,IAAI,aAAa,GAAG,KAAK,CAAC,aAAa,CAAC;oBAExC,IAAI,CAAC,GAAC,EAAE,CAAC;oBACT,IAAG,CAAC,IAAI,CAAC,EAAE;wBACT,OAAO,SAAS,CAAC;qBAClB;yBAAM;wBACL,IAAG,CAAC,GAAG,aAAa,CAAC,OAAO,CAAC,EAAE;4BAC7B,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC;yBAChD;wBACD,IAAG,CAAC,GAAG,aAAa,CAAC,OAAO,CAAC,EAAE;4BAC7B,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC;yBACjD;wBACD,IAAG,CAAC,GAAG,aAAa,CAAC,MAAM,CAAC,EAAE;4BAC5B,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC;yBAC/C;wBACD,IAAG,CAAC,GAAG,aAAa,CAAC,MAAM,CAAC,EAAE;4BAC5B,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC;yBAChD;wBACD,IAAG,CAAC,GAAG,aAAa,CAAC,OAAO,CAAC,EAAE;4BAC7B,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC;yBAC7C;wBACD,IAAG,CAAC,GAAG,aAAa,CAAC,MAAM,CAAC,EAAE;4BAC5B,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC;yBAC5C;wBACD,IAAG,CAAC,GAAG,aAAa,CAAC,KAAK,CAAC,EAAE;4BAC3B,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC;yBAC3C;wBACD,OAAO,CAAC,CAAC;qBACV;gBACH,CAAC;gBAED;;;;mBAIG;gBACI,wBAAgB,GAAvB,UAAwB,MAAe;oBACrC,IAAI,QAAQ,EAAE,MAAM,CAAC;oBAErB,IAAG,MAAM,EAAE;wBACT,QAAQ,GAAC,EAAE,CAAC;wBACZ,MAAM,GAAC,IAAI,CAAC;qBACb;yBAAM;wBACL,QAAQ,GAAC,CAAC,CAAC;wBACX,MAAM,GAAC,IAAI,CAAC;qBACb;oBAED,IAAI,QAAQ,GAAG,EAAE,CAAC;oBAElB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,QAAQ,EAAE,CAAC,EAAE,EAAE;wBAC9B,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;qBAC/C;oBAED,OAAO,QAAQ,CAAC;gBAClB,CAAC;gBAED;;;;;;;mBAOG;gBACI,0BAAkB,GAAzB,UAA0B,KAAkB,EAAE,MAAe,EAAE,UAAkB,EAAE,MAAe;oBAChG,IAAI,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC1B,IAAI,aAAa,GAAG,OAAO,CAAC,aAAa,CAAC;oBAE1C,yEAAyE;oBACzE,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,KAAK,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBACvC,IAAI,GAAG,GAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;wBACxB,IAAI,IAAI,GAAC,GAAG,CAAC,KAAK,CAAC,CAAC;wBACpB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BAC/B,IAAI,GAAG,GAAC,IAAI,CAAC,CAAC,CAAC,CAAC;4BAChB,QAAO,GAAG,CAAC,IAAI,CAAC,EAAE;gCAChB,KAAK,SAAS,CAAC;gCACf,KAAK,UAAU,CAAC;gCAChB,KAAK,UAAU;oCACb,IAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE;wCACjC,GAAG,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;qCACvC;oCACD,IAAG,UAAU,IAAI,SAAS,EAAE;wCAC1B,IAAG,OAAO,IAAI,SAAS,EAAE;4CACvB,GAAG,CAAC,WAAW,CAAC,GAAC,SAAS,CAAC;yCAC5B;6CAAM;4CACL,GAAG,CAAC,WAAW,CAAC,GAAC,OAAO,CAAC;yCAC1B;qCACF;oCACD,MAAM;gCACR,KAAK,SAAS,CAAC;gCACf,KAAK,YAAY;oCACf,IAAG,MAAM,EAAE;wCACT,IAAG,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,EAAE;4CACpC,GAAG,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;yCACvC;wCACD,MAAM;qCACP;gCACH,KAAK,SAAS,CAAC;gCACf,KAAK,YAAY;oCACf,IAAG,MAAM,EAAE;wCACT,IAAG,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,EAAE;4CACrC,GAAG,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;yCACvC;wCACD,MAAM;qCACP;gCACH,KAAK,WAAW;oCACd,IAAG,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE;wCAChC,IAAG,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;4CACvF,GAAG,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;yCACvC;qCACF;oCACD,MAAM;gCACR,KAAK,QAAQ;oCACX,IAAG,MAAM,EAAE;wCACT,IAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,EAAE;4CACnC,GAAG,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;yCACvC;wCACD,MAAM;qCACP;gCACH,KAAK,QAAQ;oCACX,IAAG,MAAM,EAAE;wCACT,IAAG,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,EAAE;4CACpC,GAAG,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;yCACvC;wCACD,MAAM;qCACP;gCACH,KAAK,OAAO;oCACV,IAAG,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE;wCAC/B,IAAG,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;4CACrF,GAAG,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;yCACvC;qCACF;oCACD,MAAM;gCACR,KAAK,OAAO;oCACV,IAAG,OAAO,MAAM,IAAI,WAAW,IAAI,CAAC,MAAM,EAAE;wCAC1C,IAAG,UAAU,IAAI,SAAS,EAAE;4CAC1B,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;4CACpB,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAC,KAAK,CAAC;yCACxB;6CAAM;4CACL,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;yCACvC;qCACF;oCACD,MAAM;6BACT;yBACF;qBACF;gBACH,CAAC;gBAED;;;;;;mBAMG;gBACI,gCAAwB,GAA/B,UAAgC,EAAY;oBAC1C,mFAAmF;oBACnF,IAAI,MAAM,GAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC,cAAc;oBAE1D,IAAI,GAAG,GAAQ,EAAE,CAAC;oBAElB,iDAAiD;oBACjD,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBACjC,IAAI,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,EAAE,EAAE,KAAK,GAAG,KAAK,CAAC;wBAE5C,6CAA6C;wBAC7C,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;4BACxB,IAAI,KAAK,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;4BACvB,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC;4BAEpB,gFAAgF;4BAChF,+EAA+E;4BAC/E,IAAG,KAAK,GAAG,EAAE,CAAC,MAAM,IAAI,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;gCACpF,KAAK,GAAG,IAAI,CAAC;6BACd;yBACF;wBAED,IAAG,KAAK,EAAE;4BACR,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;yBACf;qBACF;oBAED,4HAA4H;oBAC5H,uHAAuH;oBACvH,IAAG,OAAO,GAAG,CAAC,SAAS,CAAC,IAAI,WAAW,IAAI,CAAE,GAAG,CAAC,SAAS,CAAC,EAAE;wBAC3D,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;qBACvB;oBAED,uDAAuD;oBACvD,IAAG,OAAO,GAAG,CAAC,OAAO,CAAC,IAAI,WAAW,IAAI,CAAE,GAAG,CAAC,OAAO,CAAC,EAAE;wBACvD,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;qBACrB;oBAED,OAAO,GAAG,CAAC;gBACb,CAAC;gBAheM,iBAAS,GAAC;oBACf,WAAW,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK;oBACvE,UAAU,EAAC,SAAS,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK;oBACpE,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,SAAS,EAAC,SAAS,EAAC,WAAW,EAAC,KAAK;oBACnE,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK;oBACjE,SAAS,EAAC,SAAS,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,OAAO;oBACzD,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,SAAS,EAAC,UAAU;oBAC9D,SAAS,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,KAAK,EAAC,SAAS;iBAClD,CAAC;gBAEK,gBAAQ,GAAC,wEAAwE;sBACrF,uEAAuE,CAAC;gBAE3D,wBAAgB,GAAG,EAAC,GAAG,EAAC,QAAQ,EAAE,IAAI,EAAE,OAAO,CAAC,QAAQ,EAAC,CAAC;gBAE1E,sDAAsD;gBAC/C,qBAAa,GAAkC;oBACpD,SAAS,EAAC,GAAG;oBACb,OAAO,EAAC,GAAG;oBACX,UAAU,EAAC,GAAG;oBACd,SAAS,EAAC,GAAG;oBACb,YAAY,EAAC,GAAG;oBAChB,SAAS,EAAC,GAAG;oBACb,OAAO,EAAC,GAAG;oBACX,QAAQ,EAAC,IAAI;iBACd,CAAC;gBAEK,wBAAgB,GAAG;oBACxB,SAAS,EAAE,QAAQ;oBACnB,UAAU,EAAE,QAAQ;oBACpB,KAAK,EAAE,OAAO;oBACd,UAAU,EAAE,SAAS;oBACrB,WAAW,EAAE,SAAS;oBACtB,MAAM,EAAE,QAAQ;oBAChB,UAAU,EAAE,SAAS;oBACrB,kBAAkB,EAAE,YAAY;oBAChC,oBAAoB,EAAE,YAAY;oBAClC,wBAAwB,EAAE,iBAAiB;oBAC3C,0BAA0B,EAAE,iBAAiB;oBAC7C,OAAO,EAAE,SAAS;oBAClB,WAAW,EAAE,YAAY;oBACzB,YAAY,EAAE,aAAa;oBAC3B,gBAAgB,EAAE,gBAAgB;oBAClC,eAAe,EAAE,aAAa;oBAC9B,gBAAgB,EAAE,aAAa;oBAC/B,gBAAgB,EAAE,cAAc;oBAChC,iBAAiB,EAAE,cAAc;iBAClC,CAAC;gBAmbF,oDAAoD;gBAC7C,kBAAU,GAAe;oBAC5B,SAAS,EACT;wBACI,MAAM,EAAE,kBAAkB;wBAC1B,OAAO,EAAE;4BACL;gCACI,IAAI,EAAE,SAAS;gCACf,KAAK,EAAE;oCACH;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,WAAW,EAAE;4CACrB,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,UAAU,EAAE;4CACpB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;yCAClE;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC7D,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,WAAW,EAAE;yCACxB;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC/D,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;yCACpE;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CACjE,EAAE,IAAI,EAAE,OAAO,EAAE;4CACjB,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,UAAU,EAAE;4CACpB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,UAAU,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;yCACrE;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CACnE,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC9D,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC/C,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC9D,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;yCACtE;qCACJ;iCACJ;6BACJ;yBACJ;qBACJ;oBACD,QAAQ,EACR;wBACI,MAAM,EAAE,kBAAkB;wBAC1B,OAAO,EAAE;4BACL;gCACI,IAAI,EAAE,SAAS;gCACf,KAAK,EAAE;oCACH;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,UAAU,EAAE;4CACpB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;yCAC/B;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;4CAC5B,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;yCAC/B;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;4CAC5B,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,IAAI,EAAE;yCACvC;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE;4CAChC,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,UAAU,EAAE;4CACpB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,WAAW,EAAE;4CACrB,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;yCAC/B;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH;gDACI,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE;oDACjE,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,MAAM,EAAE;oDACvF,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,UAAU,EAAE;oDAC5F,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,WAAW,EAAE;oDAC7F,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;oDACjF,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,SAAS,EAAE;oDACtF,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,UAAU,EAAE;oDACvF,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,UAAU,EAAE;iDAAC;6CACjG;4CACD,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC/D,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC/C,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;4CAC/D,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE;yCACpE;qCACJ;iCACJ;6BACJ;yBACJ;qBACJ;oBACD,OAAO,EACP;wBACI,MAAM,EAAE,kBAAkB;wBAC1B,OAAO,EAAE;4BACL;gCACI,IAAI,EAAE,SAAS;gCACf,KAAK,EAAE;oCACH;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,UAAU,EAAE;4CACpB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;yCAC/B;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;4CAC5B,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;yCAC/B;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE;4CAC5B,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,IAAI,EAAE;yCACvC;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE;4CAChC,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,KAAK,EAAE;4CACf,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,UAAU,EAAE;4CACpB,EAAE,IAAI,EAAE,SAAS,EAAE;4CACnB,EAAE,IAAI,EAAE,WAAW,EAAE;4CACrB,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE;yCAC/B;qCACJ;oCACD;wCACI,IAAI,EAAE,GAAG;wCACT,KAAK,EAAE;4CACH;gDACI,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE;oDACjE,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,MAAM,EAAE;oDACvF,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,UAAU,EAAE;oDAC5F,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,WAAW,EAAE;oDAC7F,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE;oDACjF,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,SAAS,EAAE;oDACtF,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,UAAU,EAAE;oDACvF,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,UAAU,EAAE;iDAAC;6CACjG;4CACD,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,EAAE;4CAC/D,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE,EAAE;4CAC/C,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,EAAE;4CAC/D,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,EAAE;yCACpE;qCACJ;iCACJ;6BACJ;yBACJ;qBACJ;iBACJ,CAAC;gBACJ,cAAC;aAAA,AA/wBD,IA+wBC;YA/wBY,iBAAO,UA+wBnB,CAAA;QACH,CAAC,EAl0BoB,SAAS,GAAT,gBAAS,KAAT,gBAAS,QAk0B7B;IAAD,CAAC,EAl0Ba,MAAM,GAAN,UAAM,KAAN,UAAM,QAk0BnB;AAAD,CAAC,EAl0BS,GAAG,KAAH,GAAG,QAk0BZ;ACz0BD,IAAU,GAAG,CA6rBZ;AA7rBD,WAAU,GAAG;IAAC,IAAA,MAAM,CA6rBnB;IA7rBa,WAAA,MAAM;QAAC,IAAA,SAAS,CA6rB7B;QA7rBoB,WAAA,SAAS;YAI5B;gBAAA;oBAyBE,eAAU,GAAY,KAAK,CAAC;gBA2N9B,CAAC;gBAlMC,sBAAW,gCAAS;oBAjBpB,mEAAmE;oBACnE,oEAAoE;oBACpE,wCAAwC;oBACxC,cAAc;oBACd,kBAAkB;oBAClB,SAAS;oBAET,uDAAuD;oBACvD,iIAAiI;oBAEjI;;;;;;uBAMG;yBACH;wBACE,IAAG,OAAO,IAAI,CAAC,EAAE,KAAK,WAAW,EAAE;4BACjC,OAAO,SAAS,CAAC;yBAClB;wBAED,OAAO,IAAI,CAAC,EAAE,CAAC;oBACjB,CAAC;;;mBAAA;gBAoBD,sBAAW,6BAAM;oBAlBjB;;;;;;;;;;;;;;;;;uBAiBG;yBACH;wBACE,IAAG,OAAO,IAAI,CAAC,EAAE,KAAK,WAAW,EAAE;4BACjC,OAAO,SAAS,CAAC;yBAClB;wBAED,IAAI,MAAM,GAAG,IAAI,CAAC,EAAE,IAAI,EAAE,CAAC;wBAE3B,IAAG,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,KAAK,EAAE;4BAClC,MAAM,GAAG,MAAM,GAAG,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC;yBACpC;wBAED,OAAO,MAAM,CAAC;oBAChB,CAAC;;;mBAAA;gBAoBD,sBAAW,gCAAS;oBAlBpB;;;;;;;;;;;;;;;;;uBAiBG;yBACH;wBACE,IAAG,OAAO,IAAI,CAAC,EAAE,KAAK,WAAW,EAAE;4BACjC,OAAO,SAAS,CAAC;yBAClB;wBAED,OAAO,IAAI,CAAC,YAAY,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC;oBAC/C,CAAC;;;mBAAA;gBAEM,kBAAQ,GAAf,UAAgB,GAAc,EAAE,MAAoB,EAAE,YAAoB;oBACxE,4FAA4F;oBAC5F,IAAI,KAAK,GAAG,IAAI,SAAS,EAAE,CAAC;oBAC5B,IAAI,KAAK,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;oBAEzC,KAAI,IAAI,IAAI,IAAI,KAAK,EAAE;wBACrB,IAAG,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;4BAC5B,IAAI,UAAU,GAAG,MAAM,CAAC,wBAAwB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;4BAC9D,IAAG,UAAU,EAAE;gCACb,wEAAwE;gCACxE,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;6BAC9C;iCAAM;gCACL,GAAG,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;6BACzB;yBACF;qBACF;oBAED,6CAA6C;oBAC7C,IAAG,GAAG,CAAC,EAAE,EAAE;wBACT,KAAkB,UAAM,EAAN,KAAA,GAAG,CAAC,EAAE,EAAN,cAAM,EAAN,IAAM,EAAE;4BAAtB,IAAI,MAAM,SAAA;4BACZ,SAAS,CAAC,QAAQ,CAAC,MAAM,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;yBAClD;qBACF;oBAED,IAAI,IAAI,GAAG,GAAgB,CAAC;oBAC5B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;oBACjC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,YAAY,CAAC;oBAExC,gFAAgF;oBAChF,IAAI,CAAC,qBAAqB,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;gBACnD,CAAC;gBAEO,yCAAqB,GAA7B,UAA8B,MAAoB,EAAE,YAAoB;oBACtE,yGAAyG;oBACzG,wFAAwF;oBACxF,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,YAAY,IAAI,EAAE,CAAC;oBAC7C,IAAI,OAAO,GAAE,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;oBAEpD,yCAAyC;oBAEzC,6FAA6F;oBAC7F,IAAI,aAAa,GAAG,OAAA,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;oBAEnE,gFAAgF;oBAChF,IAAI,GAAG,GAAkB;wBACvB,UAAU,EAAE,aAAa;wBACzB,OAAO,EAAE,CAAC;wBACV,KAAK,EAAE,OAAO,CAAC,CAAC,CAAC,OAAA,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;wBACjD,aAAa,EAAE,IAAI;wBACnB,MAAM,EAAE,CAAC;wBACT,KAAK,EAAE,OAAO;wBACd,MAAM,EAAE,KAAK;wBACb,QAAQ,EAAE,YAAY;wBACtB,UAAU,EAAE,IAAI,CAAC,SAAS;wBAC1B,MAAM,EAAE,IAAI;wBACZ,WAAW,EAAE,IAAI;qBAClB,CAAC;oBAEF,IAAG,MAAM,CAAC,QAAQ,EAAE;wBAClB,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;wBAE/B,+DAA+D;wBAC/D,wHAAwH;wBACxH,IAAG,QAAQ,CAAC,UAAU,IAAI,CAAC,CAAC,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,UAAU,IAAI,SAAS,CAAC,EAAE;4BAC/E,IAAG,GAAG,CAAC,KAAK,IAAI,OAAA,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,EAAE,iCAAiC;gCACjF,6EAA6E;gCAC7E,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC;gCACvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;6BACxB;yBACF;6BAAM;4BACL,GAAG,CAAC,MAAM,GAAC,GAAG,CAAC,KAAK,CAAC;yBACtB;wBAED,oFAAoF;wBACpF,IAAG,CAAC,QAAQ,CAAC,2BAA2B,EAAE;4BACxC,2FAA2F;4BAC3F,2EAA2E;4BAC3E,GAAG,CAAC,KAAK,GAAG,OAAA,UAAU,CAAC,oBAAoB,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;4BAChF,GAAG,CAAC,aAAa,GAAC,KAAK,CAAC;yBACzB;qBACF;oBAED,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC;gBAC1B,CAAC;gBAED,qCAAiB,GAAjB,UAAkB,iBAAyC,EAAE,MAAwB;oBACnF,+EAA+E;oBAC/E,IAAI,GAAG,GAAG,OAAA,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;oBAC5C,GAAG,CAAC,MAAM,GAAG,MAAM,CAAC;oBAEpB,IAAG,IAAI,CAAC,UAAU,EAAE;wBAClB,OAAA,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE,iBAAiB,CAAC,CAAC,CAAC,iBAAiB,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;qBACnJ;oBAED,+FAA+F;oBAC/F,8DAA8D;oBAC9D,IAAG,iBAAiB,EAAE;wBACpB,iBAAiB,CAAC,yBAAyB,CAAC,GAAG,CAAC,CAAC;wBAEjD,mEAAmE;wBACnE,aAAa;wBACb,IAAM,MAAM,GAAG;4BACb,QAAQ,EAAE,OAAA,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI;4BACvC,WAAW,EAAE,OAAA,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,QAAQ;4BAC9C,UAAU,EAAE,OAAA,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,WAAW;yBACjD,CAAC;wBACF,IAAM,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;wBAElC,IAAG,OAAO,EAAE;4BACV,GAAG,CAAC,OAAO,IAAI,OAAO,CAAC;4BACvB,GAAG,CAAC,eAAe,GAAG,IAAI,CAAC;yBAC5B;qBACF;oBAED,OAAO,GAAG,CAAC;gBACb,CAAC;gBAEM,6BAAS,GAAhB,UAAiB,MAAc;oBAC7B,IAAG,IAAI,CAAC,EAAE,EAAE;wBACV,KAAe,UAAO,EAAP,KAAA,IAAI,CAAC,EAAE,EAAP,cAAO,EAAP,IAAO,EAAE;4BAApB,IAAI,GAAG,SAAA;4BACT,IAAG,GAAG,CAAC,MAAM,IAAI,MAAM,EAAE;gCACvB,OAAO,GAAG,CAAC;6BACZ;yBACF;qBACF;oBAED,OAAO,IAAI,CAAC;gBACd,CAAC;gBAjPe,qBAAW,GAAC,EAAE,CAAC,CAAU,2CAA2C;gBACpE,8BAAoB,GAAC,EAAE,CAAC,CAAC,uDAAuD;gBAChF,2BAAiB,GAAC,GAAG,CAAC,CAAG,qDAAqD;gBAE9F,uBAAuB;gBACP,qBAAW,GAAG;oBAC5B,IAAI,EAAE,EAAE;oBACR,KAAK,EAAE,SAAS,CAAC,iBAAiB,CAAC,QAAQ,EAAE;oBAC7C,EAAE,EAAE,GAAG;oBACP,GAAG,EAAE,SAAS,CAAC,WAAW,CAAC,QAAQ,EAAE;iBACtC,CAAC;gBAwOJ,gBAAC;aAAA,AApPD,IAoPC;YApPY,mBAAS,YAoPrB,CAAA;YAED;gBAYE;gBAEA,CAAC;gBAEM,kBAAQ,GAAf,UAAgB,GAAc,EAAE,MAAoB,EAAE,YAAoB,EAAE,UAAkB,EAAE,aAAqB;oBACnH,gFAAgF;oBAChF,IAAI,IAAI,GAAC,GAAG,CAAC,KAAK,CAAC,CAAC;oBACpB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBAC/B,IAAI,GAAG,GAAC,IAAI,CAAC,CAAC,CAAC,CAAC;wBAChB,KAAI,IAAI,EAAE,IAAI,SAAS,CAAC,WAAW,EAAE;4BACnC,IAAG,OAAO,GAAG,CAAC,EAAE,CAAC,IAAI,QAAQ,EAAE;gCAC7B,GAAG,CAAC,EAAE,CAAC,GAAC,SAAS,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;6BACnC;yBACF;wBAED,gEAAgE;wBAChE,8DAA8D;wBAC9D,4EAA4E;wBAC5E,QAAO,GAAG,CAAC,IAAI,CAAC,EAAE;4BAChB,KAAK,GAAG;gCACN,IAAG,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE;oCAClE,GAAG,CAAC,IAAI,CAAC,GAAC,GAAG,CAAC;iCACf;gCACD,MAAM;4BACR,KAAK,GAAG;gCACN,IAAG,CAAC,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE;oCAClE,GAAG,CAAC,IAAI,CAAC,GAAC,GAAG,CAAC;iCACf;gCACD,MAAM;yBACT;wBAED,SAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;qBAC/C;oBAED;;;;;uBAKG;oBAEH,IAAI,cAAc,GAAG,UAAS,GAAc,EAAE,KAAa,EAAE,KAAa,EAAE,OAAe;wBACzF,GAAG,CAAC,eAAe,GAAK,KAAK,CAAC;wBAC9B,GAAG,CAAC,iBAAiB,GAAG,KAAK,CAAC;wBAC9B,GAAG,CAAC,aAAa,GAAO,CAAC,OAAO,GAAG,KAAK,GAAG,CAAC,KAAK,GAAC,CAAC,CAAC,CAAC,CAAC;oBACxD,CAAC,CAAA;oBAED,2FAA2F;oBAC3F,mGAAmG;oBACnG,IAAI,UAAkB,EAAE,UAAkB,EAAE,YAAY,GAAC,CAAC,CAAC;oBAC3D,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,IAAI,CAAC,MAAM,GAAC,CAAC,EAAE,CAAC,EAAE,EAAE;wBACjC,UAAU,GAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,EAAC,EAAE,CAAC,GAAC,UAAU,CAAC;wBACpD,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,GAAC,UAAU,CAAC;wBAC9B,UAAU,GAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EAAC,EAAE,CAAC,GAAC,UAAU,CAAC;wBAClD,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAC,UAAU,CAAC;wBAE5B,4DAA4D;wBAC5D,cAAc,CAAC,IAAI,CAAC,CAAC,CAAc,EAAE,UAAU,EAAE,UAAU,EAAE,YAAY,CAAC,CAAC;wBAC3E,YAAY,IAAI,UAAU,GAAC,UAAU,CAAC;qBACvC;oBAED,+CAA+C;oBAC/C,IAAI,WAAW,GAAG,SAAS,CAAC,oBAAoB,GAAC,UAAU,CAAC;oBAC5D,YAAY,IAAI,WAAW,CAAC;oBAE5B,+EAA+E;oBAC/E,IAAG,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EAAC,EAAE,CAAC,GAAG,CAAC,EAAE;wBACtD,UAAU,GAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,EAAC,EAAE,CAAC,GAAC,UAAU,CAAC;wBACpD,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,GAAC,UAAU,CAAC;wBAC9B,YAAY,IAAI,UAAU,CAAC;wBAC3B,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAC,CAAC,GAAC,YAAY,CAAC;wBAEhC,4DAA4D;wBAC5D,cAAc,CAAC,IAAI,CAAC,CAAC,CAAc,EAAE,UAAU,EAAE,UAAU,EAAE,YAAY,CAAC,CAAC;qBAC5E;yBAAM,IAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;wBACzB,IAAI,CAAC,GAAC,IAAI,CAAC,MAAM,GAAC,CAAC,CAAC;wBACpB,UAAU,GAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EAAC,EAAE,CAAC,GAAC,UAAU,CAAC;wBAClD,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAC,UAAU,CAAC;wBAC5B,YAAY,IAAI,UAAU,CAAC;wBAC3B,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,UAAU,GAAG,CAAC,GAAC,YAAY,CAAC;wBAEjD,4DAA4D;wBAC5D,cAAc,CAAC,IAAI,CAAC,CAAC,CAAc,EAAE,UAAU,EAAE,UAAU,EAAE,YAAY,CAAC,CAAC;qBAC5E;oBAED,4FAA4F;oBAC5F,IAAI,KAAK,GAAG,IAAI,SAAS,EAAE,CAAC;oBAC5B,KAAI,IAAI,GAAG,IAAI,KAAK,EAAE;wBACpB,IAAG,CAAC,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;4BAC3B,GAAG,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;yBACvB;qBACF;oBAED,IAAI,IAAI,GAAG,GAAgB,CAAC;oBAC5B,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;gBACrC,CAAC;gBAED,kCAAc,GAAd,UAAe,GAAiC;oBAC9C,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,UAAS,GAAc;wBACtC,IAAG,GAAG,CAAC,MAAM,EAAE;4BACb,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;yBACvB;oBACH,CAAC,CAAC,CAAC;gBACL,CAAC;gBAlHD,uEAAuE;gBACvD,uBAAa,GAAC,SAAS,CAAC;gBAkH1C,gBAAC;aAAA,AApHD,IAoHC;YApHY,mBAAS,YAoHrB,CAAA;YAED;gBAoBE;gBAEA,CAAC;gBAEM,oBAAQ,GAAf,UAAgB,KAAkB,EAAE,MAAoB;oBACtD,KAAK,CAAC,OAAO,GAAC,KAAK,CAAC;oBAEpB,yCAAyC;oBACzC,IAAI,IAAI,GAAC,KAAK,CAAC,KAAK,CAAC,CAAC;oBAEtB,oDAAoD;oBACpD,IAAI,UAAU,GAAC,CAAC,CAAC;oBACjB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,KAAK,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBACvC,IAAI,KAAK,GAAC,CAAC,CAAC;wBACZ,IAAI,GAAG,GAAC,IAAI,CAAC,CAAC,CAAC,CAAC;wBAChB,IAAI,IAAI,GAAC,GAAG,CAAC,KAAK,CAAC,CAAC;wBACpB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BAC/B,IAAI,GAAG,GAAC,IAAI,CAAC,CAAC,CAAC,CAAC;4BAEhB,yEAAyE;4BACzE,IAAG,GAAG,IAAI,IAAI,EAAE;gCACd,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,GAAC,CAAC,CAAC;6BAC7B;iCAAM;gCACL,IAAI,EAAE,EAAE,EAAE,CAAC;gCACX,EAAE,GAAG,CAAC,OAAO,GAAG,CAAC,OAAO,CAAC,IAAI,QAAQ,IAAI,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,EAAC,EAAE,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,iBAAiB,CAAC;gCACvH,IAAG,KAAK,CAAC,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC;oCAAE,EAAE,GAAG,SAAS,CAAC,iBAAiB,CAAC;gCAC1D,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;gCAC7B,EAAE,GAAG,CAAC,OAAO,GAAG,CAAC,KAAK,CAAC,IAAI,QAAQ,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,EAAC,EAAE,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC;gCAC3G,IAAG,KAAK,CAAC,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC;oCAAE,EAAE,GAAG,SAAS,CAAC,WAAW,CAAC,CAAE,WAAW;gCACjE,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,QAAQ,EAAE,CAAC;gCAC3B,KAAK,IAAI,EAAE,GAAG,EAAE,CAAC;gCACjB,gIAAgI;gCAChI,0GAA0G;6BAC3G;yBACF;wBACD,IAAG,KAAK,GAAG,UAAU,EAAE;4BACrB,UAAU,GAAG,KAAK,CAAC;yBACpB;qBACF;oBAED,2BAA2B;oBAC3B,IAAG,MAAM,CAAC,UAAU,IAAI,SAAS,EAAE;wBACjC,UAAU,IAAI,CAAC,CAAC,CAAC,uGAAuG;qBACzH;yBAAM;wBACL,UAAU,IAAI,SAAS,CAAC,oBAAoB,CAAC;qBAC9C;oBAED,IAAI,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC;oBAChC,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,QAAQ,EAAE,CAAC,EAAE,EAAE;wBAC5B,4EAA4E;wBAC5E,IAAI,gBAAgB,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;wBAC5C,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,MAAM,EAAE,KAAK,CAAC,EAAE,EAAE,UAAU,EAAE,gBAAgB,CAAC,CAAC;qBAClF;oBAED,2GAA2G;oBAC3G,IAAI,KAAK,GAAG,IAAI,WAAW,EAAE,CAAC;oBAC9B,KAAI,IAAI,GAAG,IAAI,KAAK,EAAE;wBACpB,IAAG,CAAC,KAAK,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;4BAC7B,KAAK,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;yBACzB;qBACF;oBAED,IAAI,MAAM,GAAG,KAAoB,CAAC;oBAClC,MAAM,CAAC,UAAU,GAAG,UAAU,CAAC;oBAC/B,MAAM,CAAC,2BAA2B,GAAG,QAAQ,CAAC,SAAS,CAAC,WAAW,CAAC,KAAK,EAAE,EAAE,CAAC,GAAG,UAAU,CAAC;oBAC5F,MAAM,CAAC,qBAAqB,GAAG,GAAG,GAAG,QAAQ,CAAC;oBAC9C,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,eAAe,EAAE,CAAC;gBAC3C,CAAC;gBAEO,qCAAe,GAAvB;oBACE,IAAI,GAAG,GAAiC,EAAE,CAAC;oBAC3C,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,UAAS,GAAc;wBACtC,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;oBAC1B,CAAC,CAAC,CAAC;oBAEH,OAAO,GAAG,CAAC;gBACb,CAAC;gBAED;;;;;;mBAMG;gBACH,2CAAqB,GAArB,UAAsB,WAAmC,EAAE,aAAqB;oBAC9E,IAAI,YAAY,GAAG,IAAI,CAAC,uBAAuB,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;oBAC5E,IAAI,IAAI,GAAiC,EAAE,CAAC;oBAE5C,KAAI,IAAI,GAAG,IAAI,YAAY,EAAE;wBAC3B,IAAI,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,GAAG,EAAE,CAAC,EAAE,YAAY,CAAC,GAAG,CAAC,EAAC,CAAC,CAAC;qBAC/C;oBAED,OAAO,IAAI,CAAC,IAAI,CAAC,UAAS,CAAC,EAAE,CAAC;wBAC5B,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,mDAAmD;oBACvE,CAAC,CAAC,CAAA;gBACJ,CAAC;gBAED;;;;;;;mBAOG;gBACH,6CAAuB,GAAvB,UAAwB,WAAmC,EAAE,aAAqB;oBAChF,IAAI,QAAQ,GAAG,IAAI,CAAC,iBAAiB,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;oBAClE,IAAI,QAAQ,GAA8B,EAAE,CAAC;oBAE7C,IAAI,SAAS,GAAG,CAAC,CAAC;oBAElB,uHAAuH;oBACvH,oCAAoC;oBACpC,KAAI,IAAI,GAAG,IAAI,QAAQ,EAAE;wBACvB,SAAS,IAAI,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,2BAA2B;qBACrF;oBAED,KAAI,IAAI,GAAG,IAAI,QAAQ,EAAE;wBACvB,QAAQ,CAAC,GAAG,CAAC,IAAI,SAAS,CAAC;qBAC5B;oBAED,OAAO,QAAQ,CAAC;gBAClB,CAAC;gBAED;;;;;;;mBAOG;gBACK,uCAAiB,GAAzB,UAA0B,WAAmC,EAAE,aAAqB;oBAClF,IAAI,KAAK,GAAG,IAAI,CAAC;oBAEjB,IAAI,QAAQ,GAA8B,EAAE,CAAC;oBAE7C,oGAAoG;oBACpG,yCAAyC;oBACzC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,UAAS,GAAc;wBACtC,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,UAAS,GAAc;4BACrC,qEAAqE;4BACrE,IAAG,CAAC,GAAG,CAAC,SAAS,EAAE;gCACjB,OAAO;6BACR;iCAAM;gCACL,+CAA+C;gCAC/C,4CAA4C;gCAC5C,QAAO,GAAG,CAAC,SAAS,EAAE;oCACpB,KAAK,SAAS,CAAC;oCACf,KAAK,QAAQ,CAAC;oCACd,KAAK,QAAQ,CAAC;oCACd,KAAK,WAAW,CAAC,CAAC,iCAAiC;oCACnD,KAAK,QAAQ;wCACX,8EAA8E;wCAC9E,OAAO;oCACT;wCACE,uEAAuE;wCACvE,mEAAmE;wCACnE,8DAA8D;wCAC9D,IAAI,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;wCAChD,IAAG,IAAI,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,EAAE;4CAC/B,OAAO;yCACR;iCACJ;6BACF;4BACD,8EAA8E;4BAC9E,2CAA2C;4BAC3C,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,GAAG,GAAG,CAAC,aAAa,CAAC,CAAC;4BACrD,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,GAAG,GAAG,CAAC,aAAa,CAAC,CAAC;4BAErD,yEAAyE;4BACzE,mDAAmD;4BACnD,IAAI,KAAa,EAAE,KAAa,CAAC;4BAEjC,IAAG,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC,iBAAiB,EAAE;gCACnC,KAAK,GAAG,CAAC,EAAE,GAAG,GAAG,GAAG,GAAG,CAAC,iBAAiB,CAAC,CAAC;gCAC3C,EAAE,GAAG,GAAG,CAAC;6BACV;iCAAM;gCACL,KAAK,GAAG,CAAC,CAAC;gCACV,EAAE,IAAI,GAAG,CAAC,iBAAiB,CAAC;6BAC7B;4BAED,IAAG,EAAE,GAAG,GAAG,GAAG,KAAK,CAAC,qBAAqB,EAAE;gCACzC,KAAK,GAAG,CAAC,EAAE,GAAG,GAAG,GAAG,KAAK,CAAC,qBAAqB,CAAC,CAAC;gCACjD,EAAE,GAAG,GAAG,CAAC;6BACV;iCAAM;gCACL,KAAK,GAAG,CAAC,CAAC;gCACV,EAAE,IAAI,KAAK,CAAC,qBAAqB,CAAC;6BACnC;4BAED,6EAA6E;4BAC7E,EAAE;4BACF,mFAAmF;4BACnF,kEAAkE;4BAClE,KAAK,IAAI,aAAa,CAAC;4BAEvB,4EAA4E;4BAC5E,wEAAwE;4BACxE,EAAE;4BACF,8DAA8D;4BAC9D,KAAK,IAAI,EAAE,GAAG,KAAK,CAAC,qBAAqB,CAAC;4BAC1C,KAAK,IAAI,EAAE,GAAG,KAAK,CAAC,qBAAqB,CAAC;4BAE1C,IAAI,QAAQ,GAAG,KAAK,GAAG,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;4BAC7C,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,QAAQ,CAAC;wBAClC,CAAC,CAAC,CAAC;oBACL,CAAC,CAAC,CAAC;oBAEH,OAAO,QAAQ,CAAC;gBAClB,CAAC;gBAED,4BAAM,GAAN,UAAO,KAAa;oBAClB,8EAA8E;oBAC9E,IAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC,EAAE;wBACpC,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,EAAE,EAAE,CAAC,CAAC;qBAC1C;oBAED,IAAI,YAAY,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;oBACrC,IAAG,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;wBAC1B,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;wBAC3C,OAAO,OAAO,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;qBAC3C;yBAAM;wBACL,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;qBAC3B;gBACH,CAAC;gBACH,kBAAC;YAAD,CAAC,AAtPD,IAsPC;YAtPY,qBAAW,cAsPvB,CAAA;YAED;gBAaE;gBAEA,CAAC;gBAED,+BAAQ,GAAR,UAAS,OAAe;oBACtB,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;gBAChC,CAAC;gBAED;;;;;;;;;;;mBAWG;gBACI,oCAAuB,GAA9B,UAA+B,MAAqB;oBAClD,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBACjC,IAAI,KAAK,GAAC,MAAM,CAAC,CAAC,CAAC,CAAC;wBACpB,IAAI,IAAI,GAAC,KAAK,CAAC,KAAK,CAAC,CAAC;wBACtB,IAAI,CAAC,SAAQ,CAAC;wBACd,KAAI,CAAC,GAAC,IAAI,CAAC,MAAM,GAAC,CAAC,EAAE,CAAC,IAAE,CAAC,EAAE,CAAC,EAAE,EAAE;4BAC9B,IAAG,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,IAAI,CAAC,EAAE;gCAC/D,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;6BAClB;yBACF;qBACF;gBACH,CAAC;gBAED;;;;mBAIG;gBACI,qBAAQ,GAAf,UAAgB,MAAwB,EAAE,QAAkB,EAAE,UAA4B;oBACxF,IAAG,MAAM,IAAI,IAAI,EAAE;wBACjB,MAAM,IAAI,KAAK,CAAC,wDAAwD,CAAC,CAAC;qBAC3E;oBAED,uFAAuF;oBACvF,IAAI,CAAS,CAAC;oBACd,IAAI,QAAQ,GAAqC,EAAE,CAAC;oBAEpD,IAAI,MAAM,GAAC,MAAM,CAAC,OAAO,CAAC,CAAC;oBAC3B,YAAY,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC;oBAE7C,4FAA4F;oBAC5F,IAAI,KAAK,GAAG,IAAI,YAAY,EAAE,CAAC;oBAC/B,KAAI,IAAI,GAAG,IAAI,KAAK,EAAE;wBACpB,IAAG,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;4BAC9B,MAAM,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;yBAC1B;qBACF;oBAED,IAAI,OAAO,GAAG,MAAsB,CAAC;oBACrC,OAAO,CAAC,QAAQ,GAAG,QAAQ,CAAC;oBAC5B,OAAO,CAAC,UAAU,GAAG,UAAU,CAAC;oBAEhC,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBAC7B,WAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;wBACzC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,CAAC,CAAgB,CAAC;qBACnD;oBAED,OAAO,CAAC,QAAQ,GAAG,QAAQ,CAAC;oBAE5B,OAAO,OAAO,CAAC;gBACjB,CAAC;gBACH,mBAAC;YAAD,CAAC,AApFD,IAoFC;YApFY,sBAAY,eAoFxB,CAAA;QACH,CAAC,EA7rBoB,SAAS,GAAT,gBAAS,KAAT,gBAAS,QA6rB7B;IAAD,CAAC,EA7rBa,MAAM,GAAN,UAAM,KAAN,UAAM,QA6rBnB;AAAD,CAAC,EA7rBS,GAAG,KAAH,GAAG,QA6rBZ;AC7rBD,IAAU,GAAG,CAkIZ;AAlID,WAAU,GAAG;IAAC,IAAA,MAAM,CAkInB;IAlIa,WAAA,MAAM;QAAC,IAAA,IAAI,CAkIxB;QAlIoB,WAAA,IAAI;YACvB;;eAEG;YACH;gBAGE,qBAAY,EAAU;oBACpB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;gBACf,CAAC;gBAID,yBAAG,GAAH,UAAI,KAAa;oBACf,MAAM,IAAI,KAAK,CAAC,uBAAuB,GAAG,IAAI,CAAC,EAAE,GAAG,2BAA2B,CAAC,CAAC;gBACnF,CAAC;gBACH,kBAAC;YAAD,CAAC,AAZD,IAYC;YAZqB,gBAAW,cAYhC,CAAA;YAUD;gBAAwC,sCAAW;gBAIjD,4BAAY,EAAU,EAAE,YAAoB;oBAA5C,YACE,kBAAM,EAAE,CAAC,SAEV;oBALD,aAAO,GAAgC,IAAI,CAAC;oBAI1C,KAAI,CAAC,MAAM,GAAG,YAAY,CAAC;;gBAC7B,CAAC;gBAED,sBAAI,qCAAK;yBAAT;wBACE,OAAO,IAAI,CAAC,MAAM,CAAC;oBACrB,CAAC;;;mBAAA;gBAED,oCAAO,GAAP,UAAQ,KAAa;oBACnB,OAAO,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC;gBAC9B,CAAC;gBAED,gCAAG,GAAH,UAAI,KAAa;oBACf,IAAG,IAAI,CAAC,OAAO,EAAE;wBACf,IAAG,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE;4BAC5B,OAAO;yBACR;qBACF;oBAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;gBACtB,CAAC;gBACH,yBAAC;YAAD,CAAC,AA1BD,CAAwC,WAAW,GA0BlD;YA1BY,uBAAkB,qBA0B9B,CAAA;YAED;;eAEG;YACH;gBAAyC,uCAAW;gBAGlD,6BAAY,iBAAoC;oBAAhD,YACE,kBAAM,KAAA,iBAAiB,CAAC,YAAY,CAAC,SAGtC;oBADC,KAAI,CAAC,YAAY,GAAG,iBAAiB,CAAC;;gBACxC,CAAC;gBAED,qCAAO,GAAP,UAAQ,KAAa;oBACnB,IAAI,CAAC,EAAC,UAAU,EAAC,WAAW,GAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC9C,IAAI,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC;oBAE5C,KAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBAClC,UAAU,GAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;wBACxC,QAAO,UAAU,EAAE;4BACjB,KAAK,OAAO,CAAC;4BACb,KAAK,UAAU;gCACb,IAAG,MAAM,CAAC,SAAS,IAAI,CAAC,UAAU,IAAI,OAAO,CAAC,EAAE;oCAC9C,OAAO,KAAK,CAAC;iCACd;gCACD,MAAM;4BAER,KAAK,OAAO,CAAC;4BACb,KAAK,KAAK;gCACR,UAAU,GAAG,QAAQ,CAAC;4BACtB,eAAe;4BACjB,KAAK,QAAQ,CAAC;4BACd,KAAK,SAAS,CAAC;4BACf,KAAK,SAAS,CAAC;4BACf,KAAK,KAAK,CAAC;4BACX,KAAK,OAAO;gCACV,IAAG,MAAM,CAAC,EAAE,IAAI,UAAU,EAAE;oCAC1B,OAAO,KAAK,CAAC;iCACd;gCACD,MAAM;4BAER,KAAK,QAAQ,CAAC;4BACd,KAAK,OAAO,CAAC;4BACb,KAAK,SAAS;gCACZ,IAAG,MAAM,CAAC,UAAU,IAAI,UAAU,EAAE;oCAClC,OAAO,KAAK,CAAC;iCACd;gCACD,MAAM;4BAER,KAAK,KAAK;gCACR,IAAG,MAAM,CAAC,OAAO,IAAI,QAAQ,EAAE;oCAC7B,OAAO,KAAK,CAAC,CAAC,2CAA2C;iCAC1D;gCACD,MAAM;4BAER,KAAK,QAAQ,CAAC;4BACZ,+CAA+C;4BACjD,KAAK,IAAI,CAAC;4BACV,KAAK,QAAQ,CAAC;4BACd,KAAK,SAAS,CAAC;4BACf,KAAK,QAAQ,CAAC;4BACd,KAAK,MAAM,CAAC;4BACZ,KAAK,OAAO;gCACV,IAAG,MAAM,CAAC,OAAO,IAAI,UAAU,EAAE;oCAC/B,OAAO,KAAK,CAAC;iCACd;gCACD,MAAM;4BAER;gCACE,OAAO,KAAK,CAAC;yBAChB;qBACF;oBAED,0EAA0E;oBAC1E,OAAO,IAAI,CAAC;gBACd,CAAC;gBACH,0BAAC;YAAD,CAAC,AAxED,CAAyC,WAAW,GAwEnD;YAxEY,wBAAmB,sBAwE/B,CAAA;QACH,CAAC,EAlIoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QAkIxB;IAAD,CAAC,EAlIa,MAAM,GAAN,UAAM,KAAN,UAAM,QAkInB;AAAD,CAAC,EAlIS,GAAG,KAAH,GAAG,QAkIZ;AClID,oCAAoC;AACpC,wCAAwC;AAExC,6CAA6C;AAC7C,wCAAwC;AAExC;;;IAGI;AAEJ,IAAU,GAAG,CAsiCZ;AAtiCD,WAAU,GAAG;IAAC,IAAA,MAAM,CAsiCnB;IAtiCa,WAAA,MAAM;QAAC,IAAA,IAAI,CAsiCxB;QAtiCoB,WAAA,IAAI;YACvB,iCAAiC;YAEjC;gBAAA;gBAIA,CAAC;gBAAD,qBAAC;YAAD,CAAC,AAJD,IAIC;YAJY,mBAAc,iBAI1B,CAAA;YAkBD;gBAAA;gBASA,CAAC;gBAAD,kBAAC;YAAD,CAAC,AATD,IASC;YAED;gBAAA;gBAcA,CAAC;gBAAD,iBAAC;YAAD,CAAC,AAdD,IAcC;YAED;gBAAA;gBAcA,CAAC;gBAAD,gBAAC;YAAD,CAAC,AAdD,IAcC;YAED;gBAAA;gBASA,CAAC;gBAAD,gBAAC;YAAD,CAAC,AATD,IASC;YAED;gBAAA;gBAIA,CAAC;gBAAD,iBAAC;YAAD,CAAC,AAJD,IAIC;YAED;gBAAA;gBAIA,CAAC;gBAAD,gBAAC;YAAD,CAAC,AAJD,IAIC;YAOD;;;;gBAII;YACJ;gBAAA;gBAuBA,CAAC;gBApBC,6BAAK,GAAL;oBACE,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;gBACnB,CAAC;gBAED,2BAAG,GAAH,UAAI,CAAS,EAAE,EAAU;oBACvB,iEAAiE;oBACjE,IAAG,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,WAAW,EAAE;wBACvC,OAAO,IAAI,CAAC;qBACb;yBAAM,IAAG,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,WAAW,EAAE;wBAClD,OAAO,IAAI,CAAC;qBACb;oBACD,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;gBAC5B,CAAC;gBAED,2BAAG,GAAH,UAAI,CAAS,EAAE,EAAU,EAAE,GAAW;oBACpC,IAAG,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,WAAW,EAAE;wBACvC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;qBACrB;oBACD,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;gBAC3B,CAAC;gBACH,oBAAC;YAAD,CAAC,AAvBD,IAuBC;YAAA,CAAC;YAGF;;;eAGG;YACH;gBAAA;gBA6BA,CAAC;gBA1BC,+BAAK,GAAL;oBACE,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;gBACnB,CAAC;gBAED,6BAAG,GAAH,UAAI,CAAS,EAAE,EAAU;oBACvB,iEAAiE;oBACjE,IAAG,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,WAAW,EAAE;wBACvC,OAAO,IAAI,CAAC;qBACb;yBAAM,IAAG,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,WAAW,EAAE;wBAClD,OAAO,IAAI,CAAC;qBACb;oBACD,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;gBAC5B,CAAC;gBAED,6BAAG,GAAH,UAAI,CAAS,EAAE,EAAU,EAAE,GAAkB;oBAC3C,IAAG,OAAO,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,WAAW,EAAE;wBACvC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;qBACrB;oBACD,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;gBAC3B,CAAC;gBAED,+BAAK,GAAL;oBACE,IAAI,CAAC,GAAG,IAAI,eAAe,EAAE,CAAC;oBAC9B,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;oBACvB,OAAO,CAAC,CAAC;gBACX,CAAC;gBACH,sBAAC;YAAD,CAAC,AA7BD,IA6BC;YAAA,CAAC;YAEF,YAAY;YAEZ;gBAuBE,2BAAY,uBAAuD;oBAAvD,wCAAA,EAAA,8BAAuD;oBApBnE,kBAAa,GAAkB,IAAI,aAAa,EAAE,CAAC;oBACnD,oBAAe,GAAoB,IAAI,eAAe,EAAE,CAAC;oBAWzD,gBAAW,GAAc,EAAE,CAAC,CAAI,8CAA8C;oBAS5E,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;oBAEvB,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,YAAY,CAAC,GAAG,IAAI,KAAA,mBAAmB,CAAC,IAAI,CAAC,CAAC;oBAClF,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,SAAS,CAAC,GAAG,IAAI,KAAA,kBAAkB,CAAC,iBAAiB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;oBAEhH,IAAI,CAAC,uBAAuB,GAAG,uBAAuB,CAAC;gBACzD,CAAC;gBAED;;;;;mBAKG;gBACH,qCAAS,GAAT,cAAoB,CAAC;gBAUrB;;;;;;;;mBAQG;gBACH,4CAAgB,GAAhB,UAAiB,EAAE;oBACjB,6FAA6F;oBAC7F,4BAA4B;oBAC5B,IAAI,QAAQ,GAAG,IAAI,OAAA,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;oBAC1C,IAAI,CAAC,cAAc,GAAG,QAAQ,CAAC;gBACjC,CAAC;gBAQD;;;;;;;;;;;;mBAYG;gBAEH,mCAAO,GAAP,UAAQ,CAAS,EAAE,EAAU,EAAE,YAA0B;oBACvD,IAAI,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;oBACtC,IAAG,CAAC,KAAK,IAAI,EAAE;wBACb,OAAO,CAAC,CAAC;qBACV;oBAED,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,YAAY,CAAC,CAAC;oBACtC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;oBACjC,OAAO,CAAC,CAAC;gBACX,CAAC;gBAED;;;;;;;;;;;;mBAYG;gBACK,+BAAG,GAAX,UAAY,CAAS,EAAE,EAAU,EAAE,YAA0B;oBAC3D,IAAI,WAAW,GAAG,EAAE,CAAC;oBAErB,WAAW,GAAG,YAAY,CAAC,kBAAkB,EAAE,CAAC;oBAEhD,IAAG,WAAW,CAAC,UAAU,EAAE,GAAG,CAAC,EAAE;wBAC/B,WAAW,GAAG,KAAK,CAAC,CAAC,GAAC,WAAW,CAAC,UAAU,EAAE,GAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC;qBAChF;oBAED,OAAO,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,EAAC,EAAE,CAAC,CAAC;gBACrD,CAAC;gBAED;;;;;;;;;;;;mBAYG;gBACH,+BAAG,GAAH,UAAI,CAAS,EAAE,YAA0B;oBACvC,IAAI,EAAE,GAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAC,CAAC,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;oBAE1C,4EAA4E;oBAC5E,OAAO,EAAE,KAAK,QAAQ,CAAC;gBACzB,CAAC;gBAED;;;;;;;;;mBASG;gBACH,wCAAY,GAAZ,UAAa,CAAS,EAAE,YAA0B,EAAE,GAAW,EAAE,EAAU;oBACzE,IAAI,EAAE,GAAC,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,YAAY,CAAC,CAAC;oBACzC,IAAG,EAAE,KAAK,GAAG,EAAE;wBACb,OAAO,IAAI,CAAC,CAAC,QAAQ;qBACtB;oBACD,YAAY,CAAC,QAAQ,EAAE,CAAC,YAAY,EAAE,CAAC,CAAC,QAAQ;oBAChD,OAAO,KAAK,CAAC;gBACf,CAAC;gBAED;;;;;;;mBAOG;gBACK,iDAAqB,GAA7B,UAA8B,CAAS,EAAE,EAAU,EAAE,YAA0B;oBAC7E,IAAI,KAAK,GAAkB,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;oBAC3D,IAAG,KAAK,KAAK,IAAI,EAAE;wBACjB,OAAO,KAAK,CAAC;qBACd;yBAAM;wBACL,8GAA8G;wBAC9G,4DAA4D;wBAC5D,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;wBACvC,IAAG,KAAK,KAAK,IAAI,EAAE;4BACjB,6EAA6E;4BAC7E,IAAI,iBAAiB,GAAG,YAAY,CAAC,QAAQ,EAAE,CAAC,aAAa,EAAE,CAAC,CAAC,0CAA0C;4BAE3G,8BAA8B;4BAC9B,IAAI,KAAK,GAAG,CAAC,CAAC;4BACd,KAAK,GAAG,EAAE,UAAU,EAAE,EAAE,EAAE,WAAW,EAAE,EAAE,EAAC,CAAC;4BAC3C,OAAM,KAAK,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;gCACjC,kCAAkC;gCAClC,IAAI,EAAE,GAAG,YAAY,CAAC,eAAe,EAAE,CAAC;gCACxC,IAAI,OAAO,GAAG,EAAE,GAAG,KAAK,CAAC;gCACzB,IAAG,iBAAiB,CAAC,MAAM,GAAG,CAAC,IAAI,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,OAAO,EAAE;oCACnE,2GAA2G;oCAC3G,iBAAiB,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oCAC/B,SAAS;iCACV;qCAAM,IAAG,iBAAiB,CAAC,MAAM,GAAG,CAAC,IAAI,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,OAAO,EAAE;oCAC3E,oBAAoB;oCACpB,KAAK,CAAC,WAAW,CAAC,CAAC,GAAC,KAAK,CAAC,UAAU,CAAC,MAAM,GAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,CAAC,CAAC,CAAC;oCACtE,KAAK,CAAC,UAAU,GAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAuB,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;oCAC5F,iBAAiB,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;iCAChC;qCAAM;oCACL,4DAA4D;oCAC5D,IAAI,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,YAAY,CAAC,CAAC;oCAChD,KAAK,CAAC,UAAU,GAAI,CAAC,EAAE,CAAuB,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;iCACzE;6BACF;4BACD,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC;yBACvC;wBAED,gCAAgC;wBAChC,IAAI,QAAQ,GAAG,KAAK,CAAC;wBACrB,QAAQ,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;wBACvD,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BAChD,IAAG,QAAQ,CAAC,CAAC,CAAC,IAAI,QAAQ,EAAE;gCAC1B,QAAQ,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gCACjC,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;6BACnC;yBACF;wBAED,IAAG,QAAQ,CAAC,UAAU,CAAC,MAAM,IAAI,CAAC,EAAE;4BAClC,QAAQ,CAAC,UAAU,GAAG,CAAC,QAAQ,CAAC,CAAC;4BACjC,QAAQ,CAAC,WAAW,GAAG,EAAE,CAAC;yBAC3B;wBAED,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,QAAQ,CAAC,CAAC;wBAE1C,OAAO,QAAQ,CAAC;qBACjB;gBACH,CAAC;gBAED;;;;;;;;;;mBAUG;gBACH,4CAAgB,GAAhB,UAAiB,CAAS,EAAE,YAA0B,EAAE,IAAoB;oBAC1E,2CAA2C;oBAC3C,IAAI,WAAW,GAAG,IAAI,CAAC,qBAAqB,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;oBAC3E,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;oBAClD,IAAI,OAAO,GAAG,WAAW,CAAC,UAAU,CAAC;oBACrC,IAAI,WAAW,GAAG,WAAW,CAAC,WAAW,CAAC;oBAE1C,IAAI,QAAQ,GAAG,KAAK,CAAC;oBAErB,6EAA6E;oBAC7E,IAAM,WAAW,GAAG,QAAQ,CAAC;oBAE7B,IAAI,WAAW,GAAG,UAAS,CAAQ;wBACjC,2EAA2E;wBAC3E,MAAM,IAAI,KAAK,CAAC,uDAAuD,GAAG,CAAC,CAAC,CAAC;oBAC/E,CAAC,CAAA;oBAED,wDAAwD;oBACxD,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBACjC,IAAG,OAAO,IAAI,CAAC,CAAC,CAAC,IAAI,QAAQ,EAAE;4BAC7B,IAAI,GAAG,GAAG,IAAI,CAAC,CAAC,CAAW,CAAC;4BAC5B,IAAG,GAAG,KAAK,OAAO,CAAC,CAAC,CAAC,EAAE;gCACrB,QAAQ,GAAG,IAAI,CAAC;gCAChB,MAAM;6BACP;yBACF;6BAAM;4BACL,yFAAyF;4BACzF,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,CAAwB,CAAC;4BACvC,QAAO,CAAC,CAAC,CAAC,EAAE;gCACV,KAAK,GAAG;oCACN,oCAAoC;oCACpC,IAAG,CAAC,CAAC,GAAG,CAAC,KAAK,OAAO,CAAC,CAAC,CAAC,EAAE;wCACxB,QAAQ,GAAG,IAAI,CAAC;qCACjB;yCAAM;wCACL,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;qCACtB;oCACD,MAAM;gCACR,KAAK,GAAG;oCACN,IAAI,MAA4B,CAAC;oCAEjC,IAAG,OAAO,OAAO,CAAC,CAAC,CAAC,IAAI,QAAQ,EAAE;wCAChC,MAAM,GAAG,OAAO,CAAC,CAAC,CAAW,CAAC;qCAC/B;yCAAM;wCACL,MAAM,GAAG,EAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,OAAO,CAAC,CAAC,CAAW,EAAC,CAAC;qCAChD;oCAED,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;oCAEtC,IAAG,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,8BAA8B;wCACvC,IAAG,CAAC,MAAM,EAAE;4CACV,QAAQ,GAAG,IAAI,CAAC;yCACjB;6CAAM,IAAG,WAAW,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE;4CACtC,0CAA0C;4CAC1C,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;yCACtB;wCACD,oBAAoB;wCACpB,qEAAqE;wCACrE,gEAAgE;qCACjE;yCAAM,IAAG,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,OAAO,CAAC,CAAC,CAAC,KAAK,WAAW,CAAC,EAAE;wCACvD,QAAQ,GAAG,IAAI,CAAC;qCACjB;oCACD,MAAM;gCACR,KAAK,GAAG;oCACN,wCAAwC;oCACxC,IAAI,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAyB,CAAC;oCAEvD,IAAG,EAAE,KAAK,SAAS,IAAI,CAAC,OAAM,CAAC,EAAE,CAAC,IAAI,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,OAAO,CAAC,CAAC,CAAC,EAAE;wCAC1E,QAAQ,GAAG,IAAI,CAAC;qCACjB;yCAAM,IAAG,WAAW,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE;wCACtC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;qCACtB;oCACD,MAAM;gCACR,KAAK,GAAG;oCACN,IAAG,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,OAAO,CAAC,CAAC,CAAC,EAAE;wCAClC,QAAQ,GAAG,IAAI,CAAC;qCACjB;yCAAM,IAAG,WAAW,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE;wCACtC,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;qCACtB;oCACD,MAAM;gCACR,KAAK,GAAG;oCACN,qDAAqD;oCACrD,IAAG,OAAO,CAAC,CAAC,CAAC,IAAI,WAAW,EAAE;wCAC5B,QAAQ,GAAG,IAAI,CAAC;qCACjB;oCACD,MAAM;gCACR;oCACE,WAAW,CAAC,CAAC,CAAC,CAAC;6BAClB;yBACF;qBACF;oBAED,IAAG,QAAQ,EAAE;wBACX,2CAA2C;wBAC3C,YAAY,CAAC,QAAQ,EAAE,CAAC,YAAY,EAAE,CAAC;wBACvC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;qBACvB;oBAED,OAAO,CAAC,QAAQ,CAAC;gBACnB,CAAC;gBAED;;;;;;mBAMG;gBACH,sCAAU,GAAV,UAAW,CAAW;oBACpB,IAAG,IAAI,CAAC,cAAc,CAAC,UAAU,EAAE,EAAI,6CAA6C;wBAClF,OAAO,CAAC,CAAC,CAAC,aAAa,CAAC,CAAa,gEAAgE;qBACtG;yBAAM;wBACL,OAAO,OAAA,UAAU,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,6CAA6C;qBACxG;gBACH,CAAC;gBAED;;;;;;;;mBAQG;gBACH,oCAAQ,GAAR,UAAS,CAAW,EAAE,UAAiB,EAAE,QAAe;oBACtD,IAAI,MAAM,GAAG,KAAK,CAAC,CAAC,QAAQ;oBAC5B,IAAI,OAAO,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAE,8BAA8B;oBAE/E,IAAI,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC;oBAClD,IAAI,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;oBAClC,IAAI,eAAe,GAAG,OAAO,GAAG,KAAK,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;oBAC9D,IAAI,YAAY,GAAG,OAAO,GAAG,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;oBAExD,IAAG,CAAC,CAAC,MAAM,GAAG,GAAG,EAAE;wBACjB,OAAO,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,mEAAmE;qBACxF;oBAED,IAAG,CAAC,CAAC,aAAa,IAAI,OAAO,GAAG,GAAG,EAAE;wBACnC,IAAG,CAAC,UAAU,GAAG,MAAM,CAAC,IAAI,MAAM,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC,EAAE,EAAE,8CAA8C;4BACrG,MAAM,GAAG,CAAC,CAAC,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC,UAAU,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,cAAc;4BACpG,MAAM,GAAG,MAAM,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,UAAU,GAAG,YAAY,CAAC,CAAC;yBAClE;qBACF;yBAAM,IAAG,CAAC,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,EAAE;wBACpC,MAAM,GAAG,CAAC,OAAO,IAAI,QAAQ,CAAC,CAAC,CAAC,eAAe;qBAChD;oBACD,IAAG,CAAC,MAAM,EAAE;wBACV,IAAI,CAAC,kBAAkB,CAAC,QAAQ,EAAE,CAAC,YAAY,EAAE,CAAC,CAAE,QAAQ;qBAC7D;oBACD,OAAO,MAAM,CAAC,CAAC,QAAQ;gBACzB,CAAC;gBAAA,CAAC;gBAEF;;;;;;mBAMG;gBACH,sCAAU,GAAV,UAAW,CAAW,EAAE,MAAc;oBACpC,OAAO,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,CAAC;gBAC1C,CAAC;gBAED;;;;;;mBAMG;gBACH,0CAAc,GAAd,UAAe,CAAW;oBACxB,IAAI,EAAE,GAAG,IAAI,cAAc,EAAE,CAAC;oBAC9B,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,aAAa,CAAC;oBAC3B,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC;oBACrB,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC;oBAC/B,OAAO,EAAE,CAAC;gBACZ,CAAC;gBAAA,CAAC;gBAEF;;;;;;;;mBAQG;gBACH,wCAAY,GAAZ,UAAa,CAAS,EAAE,YAA0B,EAAE,CAAS;oBAC3D,OAAO,YAAY,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC5C,CAAC;gBAED;;;;;mBAKG;gBACH,gCAAI,GAAJ,UAAK,YAA0B;oBAC7B,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBAEzB,iDAAiD;oBACjD,IAAI,CAAC,YAAY,CAAC,IAAI,GAAG,IAAI,CAAC;gBAChC,CAAC;gBAED,yCAAa,GAAb,UAAc,KAAoB;oBAChC,IAAG,OAAM,CAAC,KAAK,CAAC,IAAI,QAAQ,EAAE;wBAC5B,IAAI,YAAY,GAAG,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC;wBAEtD,wBAAwB;wBACxB,IAAG,YAAY,CAAC,KAAK,CAAC,EAAE;4BACtB,OAAO,YAAY,CAAC,KAAK,CAAC,CAAC;yBAC5B;wBAED,kCAAkC;wBAClC,IAAI,MAAM,GAAyB,EAAE,CAAC;wBACtC,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,EAAE,EAAE;4BACxC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;yBAClC;wBAED,8BAA8B;wBAC9B,YAAY,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC;wBAC7B,OAAO,MAAM,CAAC;qBACf;yBAAM;wBACL,OAAO,KAAK,CAAC;qBACd;gBACH,CAAC;gBAED;;;;;;;;mBAQG;gBACH,+BAAG,GAAH,UAAI,CAAS,EAAE,EAAwB,EAAE,CAAgB;oBACvD,IAAG,EAAE,IAAI,EAAE,EAAE;wBACX,OAAO,KAAK,CAAC;qBACd;oBAED,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;oBAC1B,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC;oBACb,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBAC9B,IAAG,OAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,QAAQ,EAAE;4BAC3B,IAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE;gCACb,GAAG,GAAG,CAAC,CAAC;gCACR,MAAM;6BACP;yBACF;6BAAM,IAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,EAAE;4BAC/B,GAAG,GAAG,CAAC,CAAC;4BACR,MAAM;yBACP;qBACF;oBACD,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;oBAC1B,OAAO,GAAG,IAAI,CAAC,CAAC;gBAClB,CAAC;gBAED;;;;;;mBAMG;gBACH,kCAAM,GAAN,UAAO,EAAiB,EAAE,EAAU;oBAClC,EAAE,GAAG,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;oBAE5B,IAAG,IAAI,CAAC,WAAW,CAAC,EAAE,GAAC,CAAC,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE,EAAI,OAAO;wBAChD,OAAO,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,GAAC,CAAC,CAAC,CAAC,CAAC;qBACnC;yBAAM;wBACL;;0BAEE;wBACF,OAAO,CAAC,IAAI,CAAC,qEAAqE,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC;wBAC/F,OAAO,EAAE,CAAC;qBACX;gBACH,CAAC;gBAED;;;;;;;;mBAQG;gBACH,uCAAW,GAAX,UAAY,GAAW,EAAE,EAAiB,EAAE,EAAU,EAAE,YAA0B;oBAChF,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBAEzB,IAAI,WAAW,GAAG,UAAS,CAAQ;wBACjC,2EAA2E;wBAC3E,MAAM,IAAI,KAAK,CAAC,uDAAuD,GAAG,CAAC,CAAC,CAAC;oBAC/E,CAAC,CAAA;oBAED,IAAI,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;oBACpC,IAAG,SAAS,KAAK,EAAE,EAAE;wBACnB,IAAG,OAAO,SAAS,IAAI,QAAQ,EAAG;4BAChC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,YAAY,EAAE,SAAS,CAAC,CAAC,CAAE,OAAO;yBACpD;6BAAM,IAAG,SAAS,CAAC,GAAG,CAAC,EAAE;4BACxB,IAAI,UAAU,GAAG,SAA8B,CAAC;4BAEhD,QAAO,UAAU,CAAC,CAAC,EAAE;gCACnB,KAAK,GAAG,EAAE,0CAA0C;oCAClD,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;oCACxB,MAAM;gCACR,KAAK,GAAG;oCACN,IAAI,CAAC,aAAa,CAAC,GAAG,EAAE,YAAY,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;oCACtD,MAAM;gCACR;oCACE,WAAW,CAAC,UAAU,CAAC,CAAC;6BAC3B;yBACF;6BAAM,EAAE,yEAAyE;4BAChF,IAAI,CAAC,aAAa,CAAC,GAAG,EAAE,YAAY,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;yBACvD;qBACF;gBACH,CAAC;gBAGD;;;;;;;mBAOG;gBACH,yCAAa,GAAb,UAAc,EAAU,EAAE,YAA0B;oBAClD,IAAI,OAAsB,CAAC;oBAE3B,yDAAyD;oBACzD,IAAG,EAAE,GAAG,CAAC,EAAE;wBACT,OAAO,GAAG,IAAI,CAAC,qBAAqB,CAAC,EAAE,EAAE,EAAE,EAAE,YAAY,CAAC,CAAC;wBAC3D,IAAI,QAAQ,GAAG,CAAC,CAAC;wBAEjB,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BAC/C,IAAI,EAAE,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;4BAEhC,IAAG,EAAE,EAAE;gCACL,6BAA6B;gCAC7B,YAAY,CAAC,QAAQ,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;gCAEnC,oCAAoC;gCACpC,EAAE,EAAE,CAAC;6BACN;iCAAM,IAAG,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,QAAQ,EAAE;gCAC3C,yEAAyE;gCACzE,QAAQ,EAAE,CAAC;6BACZ;yBACF;wBAED,uFAAuF;wBACvF,wFAAwF;wBACxF,IAAI,aAAa,GAAG,OAAO,CAAC,UAAU,CAAC,MAAM,GAAG,QAAQ,CAAC;wBACzD,IAAG,EAAE,GAAG,aAAa,EAAE;4BACrB,EAAE,GAAG,aAAa,CAAC;yBACpB;qBACF;oBAED,wEAAwE;oBACxE,YAAY,CAAC,QAAQ,EAAE,CAAC,YAAY,EAAE,CAAC;oBAEvC,0FAA0F;oBAC1F,IAAI,CAAC,MAAM,CAAC,EAAE,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;gBACpC,CAAC;gBAED;;;;;;;mBAOG;gBACH,kCAAM,GAAN,UAAO,EAAU,EAAE,YAA0B,EAAE,CAAQ;oBACrD,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBAEzB,YAAY,CAAC,cAAc,EAAE,CAAC;oBAC9B,YAAY,CAAC,cAAc,EAAE,CAAC;oBAC9B,YAAY,CAAC,QAAQ,EAAE,CAAC,aAAa,EAAE,CAAC,CAAC,QAAQ;oBACjD,IAAG,EAAE,IAAI,CAAC,EAAE;wBACV,2GAA2G;wBAC3G,YAAY,CAAC,sBAAsB,CAAC,EAAE,CAAC,CAAC;qBACzC;oBACD,oDAAoD;oBACpD,YAAY,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;oBACtC,YAAY,CAAC,iBAAiB,EAAE,CAAC;gBACnC,CAAC;gBAED;;;;;;;;;;;mBAWG;gBACH,2CAAe,GAAf,UAAgB,GAAW,EAAE,YAA0B,EAAE,aAAqB,EAAE,aAAqB;oBACnG,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBAEzB,IAAG,GAAG,IAAI,CAAC,EAAE;wBACX,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;qBACpC;oBAED,IAAM,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;oBACrE,IAAM,EAAE,GAAG,OAAO,CAAC,WAAW,CAAC,aAAa,GAAC,CAAC,CAAC,EAAE,EAAE,GAAG,OAAO,CAAC,UAAU,CAAC,aAAa,GAAC,CAAC,CAAC,CAAC;oBAC1F,IAAG,EAAE,EAAE;wBACL,YAAY,CAAC,wBAAwB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;qBAC7C;yBAAM,IAAG,OAAO,EAAE,IAAI,QAAQ,EAAE;wBAC/B,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;qBACnC;yBAAM;wBACL,MAAM,IAAI,KAAK,CAAC,yFAAyF,CAAC,CAAC;qBAC5G;gBACH,CAAC;gBAED;;;;;;;mBAOG;gBACH,yCAAa,GAAb,UAAc,GAAW,EAAE,YAA0B,EAAE,EAAU;oBAC/D,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBAEzB,IAAG,GAAG,IAAI,CAAC,EAAE;wBACX,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,YAAY,EAAC,EAAE,CAAC,CAAC,CAAE,uBAAuB;qBAC5D;oBAED,YAAY,CAAC,wBAAwB,CAAC,EAAE,CAAC,CAAC;oBAC1C,uEAAuE;gBACzE,CAAC;gBAED;;;;;;;mBAOG;gBACH,mCAAO,GAAP,UAAQ,QAAgB,EAAE,QAAgB,EAAE,YAA0B;oBACpE,IAAI,MAAM,GAAC,IAAI,CAAC;oBAChB,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;oBACxC,IAAG,KAAK,EAAE;wBACR,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;qBAClC;oBACD,OAAO,MAAM,CAAC,CAAC,mEAAmE;gBACpF,CAAC;gBAED;;;;;;;;;;;mBAWG;gBACH,oCAAQ,GAAR,UAAS,QAAgB,EAAE,QAAgB,EAAE,YAA0B;oBACrE,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACzB,IAAG,QAAQ,IAAI,iBAAiB,CAAC,SAAS,EAAE;wBAC1C,mEAAmE;wBACnE,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,QAAQ,CAAC;qBACjD;yBAAM;wBACL,OAAO,KAAK,CAAC;qBACd;gBACH,CAAC;gBAED;;;;;;;;;;mBAUG;gBACH,qCAAS,GAAT,UAAU,OAAe,EAAE,SAAgB,EAAE,SAAgB;oBAC3D,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACzB,IAAG,IAAI,CAAC,uBAAuB,EAAE;wBAC/B,IAAI,MAAM,GAAG,IAAI,CAAC,uBAAuB,CAAC,SAAS,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;wBACxE,OAAO,MAAM,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC;qBACvC;yBAAM;wBACL,OAAO,SAAS,CAAC;qBAClB;gBACH,CAAC;gBAED;;;;;;;;;;mBAUG;gBACH,qCAAS,GAAT,UAAU,SAAgB,EAAE,QAAe;oBACzC,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACzB,IAAI,GAAG,GAAC,IAAI,CAAC,cAAc,CAAC;oBAC5B,IAAG,CAAC,GAAG,IAAI,OAAO,GAAG,CAAC,EAAE,IAAI,WAAW,IAAI,GAAG,CAAC,EAAE,IAAI,EAAE,EAAE;wBACvD,OAAO,KAAK,CAAC;qBACd;oBAED,mFAAmF;oBACnF,IAAI,QAAQ,GAAkB,EAAE,CAAC;oBACjC,QAAQ,CAAC,SAAS,CAAC,GAAG,QAAQ,CAAC;oBAE/B,oDAAoD;oBACpD,IAAG,IAAI,CAAC,YAAY,EAAE;wBACpB,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,QAAQ,CAAC;qBACnD;yBAAM;wBACL,8FAA8F;wBAC9F,yDAAyD;wBACzD,IAAI,CAAC,uBAAuB,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC;qBACrF;oBACD,OAAO,IAAI,CAAC;gBACd,CAAC;gBAED,6CAAiB,GAAjB;oBACE,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;oBAC3B,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;gBAC/B,CAAC;gBAED,4CAAgB,GAAhB,UAAiB,YAA0B;oBACzC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,YAAY,EAAE,EAAE,CAAC,CAAC;gBACnC,CAAC;gBAED;;;;;;;mBAOG;gBACH,4CAAgB,GAAhB,UAAiB,YAA0B,EAAE,SAAmB;oBAC9D,4DAA4D;oBAC5D,IAAG,CAAC,YAAY,EAAE;wBAChB,MAAM,0CAA0C,CAAC;qBAClD;yBAAM,IAAG,CAAC,IAAI,CAAC,cAAc,EAAE;wBAC9B,MAAM,8CAA8C,CAAC;qBACtD;oBAED,YAAY,CAAC,mBAAmB,EAAE,CAAC;oBAEnC,YAAY,CAAC,QAAQ,EAAE,CAAC,YAAY,EAAE,CAAC,CAAO,QAAQ;oBACtD,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBAEzB,8EAA8E;oBAC9E,IAAI,QAAQ,GAAG,KAAA,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;oBAEvC,mDAAmD;oBACnD,IAAM,oBAAoB,GAAG,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC;oBAEhE,qGAAqG;oBACrG,IAAI,CAAC,YAAY,GAAG,IAAI,KAAA,YAAY,EAAE,CAAC;oBAEvC,kFAAkF;oBAClF,kDAAkD;oBAClD,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC,MAAM,CAAC;oBAErC,gDAAgD;oBAChD,IAAI,CAAC,kBAAkB,GAAG,YAAY,CAAC;oBACvC,IAAI,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;oBACnE,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;oBAE/B,+BAA+B;oBAC/B,IAAI,CAAC,YAAY,CAAC,aAAa,GAAG,YAAY,CAAC,sBAAsB,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;oBAE3F,0EAA0E;oBAC1E,0EAA0E;oBAC1E,2DAA2D;oBAC3D,IAAI,CAAC,YAAY,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC;oBACtE,IAAI,CAAC,cAAc,CAAC,cAAc,GAAG,oBAAoB,CAAC;oBAE1D,0FAA0F;oBAC1F,0FAA0F;oBAC1F,qCAAqC;oBACrC,EAAE;oBACF,2EAA2E;oBAC3E,IAAI,CAAC,YAAY,CAAC,iBAAiB,GAAG,CAAC,OAAO,CAAC;oBAE/C,8FAA8F;oBAC9F,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC;oBACjC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;oBAEzB,OAAO,QAAQ,CAAC;gBAClB,CAAC;gBAED;;;;;;;;mBAQG;gBACH,+CAAmB,GAAnB,UAAoB,MAAoD;oBACtE,IAAI,CAAC,cAAc,CAAC,cAAc,GAAG,MAAM,CAAC;gBAC9C,CAAC;gBAED;;;;;;;mBAOG;gBACI,uCAAqB,GAA5B;oBACE,qBAAqB;oBACrB,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;oBAE/B,IAAI,gBAAgB,GAAG,UAAS,QAAgB,EAAE,QAAgB;wBAChE,SAAS,CAAC,QAAQ,CAAC,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC;oBAC5C,CAAC,CAAA;oBAED,gBAAgB,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC;oBACrC,gBAAgB,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC;oBACrC,gBAAgB,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC;oBACrC,gBAAgB,CAAC,IAAI,EAAE,kBAAkB,CAAC,CAAC;oBAC3C,gBAAgB,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC;oBACxC,gBAAgB,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;oBAClC,gBAAgB,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;oBAC9B,gBAAgB,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC;oBACxC,gBAAgB,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;oBAC7C,gBAAgB,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;oBACtC,gBAAgB,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;oBACpC,gBAAgB,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;oBACtC,gBAAgB,CAAC,KAAK,EAAE,gBAAgB,CAAC,CAAC;oBAC1C,gBAAgB,CAAC,KAAK,EAAE,cAAc,CAAC,CAAC;oBACxC,gBAAgB,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;oBAC/B,gBAAgB,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;oBAC9B,gBAAgB,CAAC,KAAK,EAAE,eAAe,CAAC,CAAC;oBACzC,gBAAgB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;oBACjC,gBAAgB,CAAC,KAAK,EAAE,eAAe,CAAC,CAAC;oBACzC,gBAAgB,CAAC,MAAM,EAAE,iBAAiB,CAAC,CAAC;oBAC5C,gBAAgB,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC;oBACvC,gBAAgB,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;oBACpC,gBAAgB,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;oBACtC,gBAAgB,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;oBACvC,gBAAgB,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;gBACzC,CAAC;gBA13Be,6BAAW,GAAG,WAAW,CAAC;gBAS1B,2BAAS,GAAc,EAAE,CAAC;gBAC1B,8BAAY,GAAW,EAAE,CAAC;gBAi3B5C,wBAAC;aAAA,AA53BD,IA43BC;YA53BY,sBAAiB,oBA43B7B,CAAA;YAED,CAAC;gBACC,mEAAmE;gBACnE,iBAAiB,CAAC,qBAAqB,EAAE,CAAC;YAC5C,CAAC,EAAE,CAAC,CAAC;QACP,CAAC,EAtiCoB,IAAI,GAAJ,WAAI,KAAJ,WAAI,QAsiCxB;IAAD,CAAC,EAtiCa,MAAM,GAAN,UAAM,KAAN,UAAM,QAsiCnB;AAAD,CAAC,EAtiCS,GAAG,KAAH,GAAG,QAsiCZ;ACjjCD,0CAA0C;AAC1C,wCAAwC;AACxC,gDAAgD;AAEhD,IAAU,GAAG,CA6aZ;AA7aD,WAAU,GAAG;IAAC,IAAA,MAAM,CA6anB;IA7aa,WAAA,MAAM;QAAC,IAAA,SAAS,CA6a7B;QA7aoB,WAAA,SAAS;YAC5B;;eAEG;YACH;gBAGE;oBACE,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;gBACnB,CAAC;gBACH,eAAC;YAAD,CAAC,AAND,IAMC;YAED,IAAY,WAIX;YAJD,WAAY,WAAW;gBACrB,wCAAa,SAAS,gBAAA,CAAA;gBACtB,yDAAc,CAAA;gBACd,yDAAc,CAAA;YAChB,CAAC,EAJW,WAAW,GAAX,qBAAW,KAAX,qBAAW,QAItB;YAIA,CAAC;YAGF;;;;eAIG;YACH;gBAkBE,kBAAY,cAAmB;oBAC7B,IAAG,cAAc,EAAE;wBACjB,IAAI,CAAC,YAAY,GAAG,cAAc,CAAC;qBACpC;yBAAM;wBACL,IAAI,CAAC,YAAY,GAAG,QAAQ,CAAC,qBAAqB,CAAC;qBACpD;oBACD,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;gBACzB,CAAC;gBAED;;mBAEG;gBACH,0BAAO,GAAP,UAAQ,YAA+B,EAAE,SAAwB;oBAC/D,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;gBAC1D,CAAC;gBAED,sBAAI,8BAAQ;yBAAZ;wBACE,OAAO,IAAI,CAAC,YAAY,IAAI,QAAQ,CAAC,qBAAqB,CAAC;oBAC7D,CAAC;;;mBAAA;gBAED,sBAAI,wBAAE;yBAAN;wBACE,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;oBACjC,CAAC;;;mBAAA;gBAED,sBAAI,0BAAI;yBAAR;wBACE,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;oBACjC,CAAC;;;mBAAA;gBAaD,sBAAI,oCAAc;oBAXlB;;;;;;;;;;uBAUG;yBACH;wBACE,IAAM,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;wBAC5C,IAAI,MAAM,GAAG,EAAE,CAAC;wBAChB,IAAG,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;4BAC5B,KAAiB,UAAU,EAAV,yBAAU,EAAV,wBAAU,EAAV,IAAU,EAAE;gCAAzB,IAAI,KAAK,mBAAA;gCACX,MAAM,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;6BAC1C;yBACF;wBACD,OAAO,MAAM,CAAC;oBAChB,CAAC;oBAED;;;;;;;uBAOG;yBACH,UAAmB,MAA+B;wBAChD,IAAM,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;wBAC5C,IAAG,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;4BAC5B,KAAiB,UAAU,EAAV,yBAAU,EAAV,wBAAU,EAAV,IAAU,EAAE;gCAAzB,IAAI,KAAK,mBAAA;gCACX,gEAAgE;gCAChE,iEAAiE;gCACjE,mEAAmE;gCACnE,mBAAmB;gCACnB,IAAG,OAAO,MAAM,CAAC,KAAK,CAAC,IAAI,QAAQ,EAAE;oCACnC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;iCAC1C;6BACF;yBACF;oBACH,CAAC;;;mBAvBA;gBA0BD,sBAAY,uCAAiB;oBAD7B,wBAAwB;yBACxB;wBACE,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAE,uEAAuE;oBAC1G,CAAC;;;mBAAA;gBAGD,sBAAY,8BAAQ;oBADpB,gEAAgE;yBAChE;wBACE,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAE,qEAAqE;oBAC1G,CAAC;yBAED,UAAqB,KAAK;wBACxB,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC;oBACpC,CAAC;;;mBAJA;gBAMD,sBAAI,qCAAe;yBAAnB;wBACE,OAAO,IAAI,OAAA,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC;oBACtD,CAAC;;;mBAAA;gBAED,sBAAI,gCAAU;yBAAd;wBACE,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;oBACnC,CAAC;;;mBAAA;gBAED,sBAAI,iDAA2B;yBAA/B;wBACE,OAAO,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,WAAW,CAAC;oBACvD,CAAC;;;mBAAA;gBAQD,sBAAI,8BAAQ;oBANZ;;;;;uBAKG;yBACH;wBACE,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;oBACjC,CAAC;;;mBAAA;gBAQD,sBAAI,+BAAS;oBANb;;;;;uBAKG;yBACH;wBACE,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;oBACpC,CAAC;;;mBAAA;gBAED;;;;;;mBAMG;gBACH,8BAAW,GAAX,UAAY,CAAM;oBAChB,uFAAuF;oBACvF,yBAAyB;oBACzB,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC9B,CAAC;gBAED,sBAAI,gCAAU;yBAAd;wBACE,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;oBACnC,CAAC;;;mBAAA;gBAQD,sBAAI,2BAAK;oBANT;;;;;uBAKG;yBACH;wBACE,IAAI,EAAU,CAAC;wBACf,IAAG,OAAM,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,IAAI,WAAW,EAAE;4BAClD,EAAE,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;yBAC/B;6BAAM,IAAG,OAAM,CAAC,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC,IAAI,WAAW,EAAE;4BAClE,EAAE,GAAG,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;yBACxC;wBAED,wGAAwG;wBACxG,8FAA8F;wBAC9F,OAAO,CAAC,CAAC,EAAE,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,KAAK,CAAC,CAAC,CAAC;oBAC3D,CAAC;;;mBAAA;gBAED,sBAAI,2BAAK;yBAAT;wBACE,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;oBACrC,CAAC;;;mBAAA;gBAKD,sBAAI,qCAAe;oBAHnB;;uBAEG;yBACH;wBACE,4DAA4D;wBAC5D,sEAAsE;wBACtE,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,OAAA,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;oBAChF,CAAC;;;mBAAA;gBAED,sBAAI,8BAAQ;yBAAZ;wBACE,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,GAAG,OAAA,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC,CAAC;oBAC7E,CAAC;;;mBAAA;gBAED,sBAAI,iCAAW;yBAAf;wBACE,IAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;4BAC1B,OAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;yBACrC;6BAAM;4BACL,OAAO,IAAI,CAAC;yBACb;oBACH,CAAC;;;mBAAA;gBAED,sBAAY,8BAAQ;yBAApB;wBACE,IAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBAEpC,IAAG,CAAC,GAAG,EAAE;4BACP,GAAG,GAAG,IAAI,QAAQ,EAAE,CAAC;4BACrB,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;yBACjC;wBAED,OAAO,GAAG,CAAC;oBACb,CAAC;;;mBAAA;gBAED,sBAAI,oCAAc;yBAAlB;wBACE,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;oBAC9B,CAAC;;;mBAAA;gBAOD,sBAAI,mCAAa;oBALjB;;;;uBAIG;yBACH;wBACE,IAAI,aAAa,GAAG,OAAA,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC;wBAE7C,4CAA4C;wBAC5C,IAAG,CAAC,IAAI,CAAC,QAAQ,EAAE;4BACjB,OAAO,KAAK,CAAC;yBACd;wBAED,IAAG,IAAI,CAAC,iBAAiB,IAAI,IAAI,EAAE;4BACjC,OAAO,KAAK,CAAC;yBACd;wBAED,8FAA8F;wBAC9F,IAAI,MAAM,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;wBAC3C,IAAG,CAAC,MAAM,EAAE;4BACV,OAAO,KAAK,CAAC;yBACd;wBAED,IAAI,aAAa,GAAG,aAAa,CAAC,OAAO,CAAC,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC;wBACnE,IAAI,uBAAuB,GAAG,MAAM,CAAC,UAAA,OAAO,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;wBACxE,IAAI,qBAAqB,GAAG,MAAM,CAAC,UAAA,OAAO,CAAC,UAAU,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,aAAa,CAAC,CAAC,CAAC;wBAE/F,iGAAiG;wBACjG,4DAA4D;wBAC5D,EAAE;wBACF,iGAAiG;wBACjG,8EAA8E;wBAC9E,IAAG,uBAAuB,IAAI,IAAI;4BAC9B,uBAAuB,IAAI,MAAM,CAAC,UAAA,OAAO,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE;4BAChF,OAAO,KAAK,CAAC;yBACd;wBAED,IAAG,qBAAqB,IAAI,IAAI;4BAC5B,qBAAqB,IAAI,MAAM,CAAC,UAAA,OAAO,CAAC,UAAU,CAAC,aAAa,CAAC,MAAM,CAAC,GAAG,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;4BACvG,OAAO,KAAK,CAAC;yBACd;wBAED,kHAAkH;wBAClH,IAAI,OAAO,GAAG,IAAI,CAAC,eAAe,CAAC;wBACnC,IAAG,CAAC,OAAO,GAAG,aAAa,CAAC,IAAI,aAAa,EAAE;4BAC7C,4GAA4G;4BAC5G,OAAO,IAAI,CAAC;yBACb;wBAED,IAAG,uBAAuB,IAAI,IAAI,IAAI,qBAAqB,IAAI,IAAI,EAAE;4BACnE,kGAAkG;4BAClG,4BAA4B;4BAC5B,0BAA0B;4BAC1B,qGAAqG;4BACrG,6EAA6E;4BAC7E,6BAA6B;4BAC7B,IAAI;4BACJ,OAAO,IAAI,CAAC;yBACb;wBACD,OAAO,IAAI,CAAC;oBACd,CAAC;;;mBAAA;gBAED,sBAAI,iDAA2B;yBAA/B;wBACE,IAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC;wBAC5B,2CAA2C;wBAC3C,OAAO,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,cAAc,CAAC,CAAC;oBAC/E,CAAC;;;mBAAA;gBAED,4CAAyB,GAAzB,UAA0B,MAAwB;oBAChD,IAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE;wBAC5B,4DAA4D;wBAC5D,OAAO,MAAM,CAAC,UAAU,IAAI,OAAA,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC;qBACtD;yBAAM;wBACL,OAAO,IAAI,CAAC;qBACb;gBACH,CAAC;gBAED;;;;;mBAKG;gBACH,yBAAM,GAAN,UAAO,SAAiB,EAAE,QAA2B,EAAE,MAAc;oBACnE,2DAA2D;oBAC3D,IAAG,OAAM,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,IAAI,UAAU,EAAE;wBACjD,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,SAAS,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;qBACvD;gBACH,CAAC;gBAEO,wCAAqB,GAA7B,UAA8B,UAA4B;oBACxD,IAAG,IAAI,CAAC,QAAQ,EAAE;wBAChB,sGAAsG;wBACtG,8CAA8C;wBAC9C,IAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,SAAS,EAAE;4BAC1C,OAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;yBAClC;6BAAM,IAAG,UAAU,IAAI,OAAA,KAAK,CAAC,UAAU,CAAC,KAAK,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAA,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;4BACxF,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAA,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAA,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;yBACvF;6BAAM,IAAG,UAAU,IAAI,OAAA,KAAK,CAAC,UAAU,CAAC,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAA,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE;4BACxF,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAA,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAA,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;yBACvF;qBACF;oBAED,6EAA6E;oBAC7E,8EAA8E;oBAC9E,iDAAiD;oBACjD,IAAI,iBAAiB,GAAQ,IAAI,CAAC,CAAE,6DAA6D;oBACjG,IAAG,IAAI,CAAC,iBAAiB,IAAI,IAAI,IAAI,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAAE,EAAE,6DAA6D;wBACjI,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC;qBAC5C;yBAAM,IAAG,IAAI,CAAC,iBAAiB,IAAI,IAAI,IAAI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;wBAChF,IAAI,OAAO,GAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;wBACzC,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BAClC,IAAG,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;gCACxB,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC;gCAC3C,MAAM;6BACP;yBACF;qBACF;oBAED,4GAA4G;oBAC5G,8EAA8E;oBAC9E,IAAG,CAAC,iBAAiB,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,EAAE,IAAI,UAAU,IAAI,OAAA,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;wBACxF,iBAAiB,GAAG,EAAC,GAAG,EAAC,QAAQ,EAAE,IAAI,EAAE,UAAA,OAAO,CAAC,QAAQ,EAAC,CAAC;qBAC5D;oBAED,qFAAqF;oBACrF,0FAA0F;oBAC1F,IAAG,CAAC,IAAI,CAAC,QAAQ,EAAE;wBACjB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;qBACpB;oBAED,8GAA8G;oBAC9G,IAAG,iBAAiB,EAAE;wBACpB,wDAAwD;wBACxD,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,UAAA,OAAO,CAAC,kBAAkB,CAAC,iBAAiB,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;wBACzG,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;wBACxB,OAAO,MAAM,CAAC;qBACf;yBAAM;wBACL,+FAA+F;wBAC/F,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC,CAAC,mEAAmE;wBACrG,OAAO,IAAI,CAAC;qBACb;gBACH,CAAC;gBAED;;;;;mBAKG;gBACI,yBAAM,GAAb,UAAc,UAA4B;oBACxC,IAAI,SAAS,GAAG,IAAI,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC;oBAEvD,IAAG,SAAS,EAAE;wBACZ,0EAA0E;wBAC1E,IAAG,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,WAAW,CAAC,UAAU,EAAE;4BAC1D,SAAS,GAAG,UAAA,YAAY,CAAC,QAAQ,CAAC,SAAS,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;4BAC/D,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,GAAG,WAAW,CAAC,UAAU,CAAC;yBACxD;wBAED,OAAO,SAAyB,CAAC;qBAClC;yBAAM;wBACL,OAAO,IAAI,CAAC;qBACb;gBACH,CAAC;gBAEM,iCAAc,GAArB;oBACE,IAAI,WAAW,GAAG,CAAE,OAAA,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,OAAA,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,OAAA,KAAK,CAAC,UAAU,CAAC,MAAM,CAAE,CAAC;oBAEhG,IAAI,KAAK,GAAG,IAAI,CAAC;oBAEjB,WAAW,CAAC,OAAO,CAAC,UAAS,IAAI;wBAC/B,uFAAuF;wBACvF,mBAAmB;wBACnB,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,WAAW,CAAC,UAAU,CAAC;oBACpD,CAAC,CAAC,CAAC;gBACL,CAAC;gBAEM,uCAAoB,GAA3B,UAA4B,UAA4B;oBACtD,IAAG,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,WAAW,CAAC,UAAU,EAAE;wBAC1D,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,GAAG,WAAW,CAAC,UAAU,CAAC;qBACxD;gBACH,CAAC;gBAEM,iCAAc,GAArB,UAAsB,UAA4B;oBAChD,OAAO,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;gBACvC,CAAC;gBA9Ya,8BAAqB,GAAG;oBACpC,IAAI,EAAE,UAAS,YAAY,EAAE,SAAS,IAAI,OAAO,KAAK,CAAC,CAAC,CAAC;oBACzD,IAAI,EAAE,EAAE;oBACR,IAAI,EAAE,EAAE;oBACR,IAAI,EAAE,UAAA,OAAO,CAAC,gBAAgB;oBAC9B,IAAI,EAAE,CAAC,CAAC,kGAAkG;iBAC3G,CAAA;gBAyYH,eAAC;aAAA,AAhZD,IAgZC;YAhZY,kBAAQ,WAgZpB,CAAA;QACH,CAAC,EA7aoB,SAAS,GAAT,gBAAS,KAAT,gBAAS,QA6a7B;IAAD,CAAC,EA7aa,MAAM,GAAN,UAAM,KAAN,UAAM,QA6anB;AAAD,CAAC,EA7aS,GAAG,KAAH,GAAG,QA6aZ;ACjbD;;;IAGI;AACJ,IAAU,GAAG,CAqLZ;AArLD,WAAU,GAAG;IAAC,IAAA,MAAM,CAqLnB;IArLa,WAAA,MAAM;QAElB;YAAA;YAEA,CAAC;YAAD,aAAC;QAAD,CAAC,AAFD,IAEC;QAED;YAKE;gBAJA,OAAE,GAAe,IAAI,MAAM,EAAE,CAAC;gBAC9B,WAAM,GAAW,IAAI,MAAM,EAAE,CAAC;gBAC9B,UAAK,GAAY,IAAI,MAAM,EAAE,CAAC;gBAG5B,8DAA8D;gBAC9D,gFAAgF;gBAChF,0FAA0F;gBAC1F,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,CAAE,gBAAgB;gBACvC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,CAAE,IAAI;gBAC3B,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,MAAM;YAC/B,CAAC;YACH,qBAAC;QAAD,CAAC,AAbD,IAaC;QAED;YAGE,iGAAiG;YACjG,uDAAuD;YACvD,qHAAqH;YACrH,sFAAsF;YAEtF;gBACE,wFAAwF;gBACxF,kBAAkB;gBAClB,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,MAAM,EAAE,CAAC;gBAC1B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAC/B,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,IAAI;gBAE/B,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,MAAM,EAAE,CAAC,CAAE,QAAQ;gBACpC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,oCAAoC;gBAC/D,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,eAAe;gBAC1C,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,sDAAsD;gBACjF,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAI,GAAG,CAAC,CAAC,sDAAsD;YACnF,CAAC;YACH,sBAAC;QAAD,CAAC,AA3BD,IA2BC;QAED;YAME;gBACE,+BAA+B;YACjC,CAAC;YAEc,sBAAW,GAA1B;gBACE,IAAI,EAAE,GAAC,IAAI,MAAM,EAAE,EAAC,EAAE,GAAC,IAAI,MAAM,EAAE,CAAC;gBAEpC,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAEhB,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC;gBACjB,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;gBACf,EAAE,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;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","sourcesContent":["//Autogenerated file - do not modify!\nnamespace com.keyman.environment {\n  export var VERSION = \"15.0\";\n  export var BUILD = 163;\n  export var ENVIRONMENT = \"local\";\n  export var SENTRY_RELEASE = \"release-15.0.163-alpha-local\";\n}\n\n","namespace com.keyman.utils {\r\n  /**\r\n   * Function     deepCopy\r\n   * Scope        Private\r\n   * @param       {Object}      p           object to copy\r\n   * @param       {Array=}      c0          array member being copied\r\n   * @return      {Object}                  clone ('deep copy') of object\r\n   * Description  Makes an actual copy (not a reference) of an object, copying simple members,\r\n   *              arrays and member objects but not functions, so use with care!\r\n   */\r\n  export function deepCopy<T>(p:T, c0?): T {\r\n    var c = c0 || {};\r\n    for (var i in p) {\r\n      if(typeof p[i] === 'object' && p[i] != null) {\r\n        c[i] = (p[i].constructor === Array ) ? [] : {};\r\n        deepCopy(p[i],c[i]);\r\n      }\r\n      else {\r\n        c[i] = p[i];\r\n      }\r\n    }\r\n\r\n    return c;\r\n  }\r\n}","namespace com.keyman.utils {\r\n  /**\r\n   * Returns the base global object available to the current JS platform.\r\n   * - In browsers, returns `window`.\r\n   * - In WebWorkers, returns `self`.\r\n   * - In Node, returns `global`.\r\n   */\r\n  export function getGlobalObject(): typeof globalThis {\r\n    // Evergreen browsers have started defining 'globalThis'.  \r\n    // Refer to https://devblogs.microsoft.com/typescript/announcing-typescript-3-4/#type-checking-for-globalthis\r\n    // and its referenced polyfill.  Said polyfill is very complex, so we opt for this far leaner variant.\r\n    if(typeof globalThis != 'undefined') {\r\n      return globalThis;  // Not available in IE or older Edge versions\r\n      // @ts-ignore (TS will throw errors for whatever platform we're not compiling for.)\r\n    } else if(typeof window != 'undefined') {\r\n      // @ts-ignore\r\n      return window; // The browser-based classic\r\n      // @ts-ignore\r\n    } else if(typeof self != 'undefined') {\r\n      // @ts-ignore\r\n      return self; // WebWorker global\r\n    } else {\r\n      // Assumption - if neither of the above exist, we're in Node, for unit-testing.\r\n      // Node doesn't have as many methods and properties as the other two, but what \r\n      // matters for us is that it's the base global.\r\n      //\r\n      // Some other headless JS solutions use 'this' instead, but Node's enough for our needs.\r\n      // @ts-ignore\r\n      return (global as any) as typeof globalThis;\r\n    }\r\n  }\r\n}","// Ensure that this class contains no reference into core KMW code - it is referenced\r\n// by components intended to be modular and possible to separate from core KMW.\r\n\r\nnamespace com.keyman.utils {\r\n  // Dotted-decimal version\r\n  export class Version {\r\n    public static readonly CURRENT = new Version(com.keyman.environment.VERSION);\r\n\r\n    // Represents a default version value for keyboards compiled before this was compiled into keyboards.\r\n    // The exact version is unknown at this point, but the value is \"good enough\" for what we need.\r\n    public static readonly DEVELOPER_VERSION_FALLBACK = new Version([9, 0, 0]);\r\n\r\n    // For 12.0, the old default behavior of adding missing keycaps to the default layers was removed,\r\n    // as it results in unexpected, bug-like behavior for keyboard designers when it is unwanted.\r\n    public static readonly NO_DEFAULT_KEYCAPS = new Version([12, 0]);\r\n\r\n    public static readonly MAC_POSSIBLE_IPAD_ALIAS = new Version([10, 15]);\r\n\r\n    private readonly components: number[]\r\n\r\n    /**\r\n     * Parses version information, preparing it for use in comparisons.\r\n     * @param text Either a string representing a version number (ex: \"9.0.0\") or an array representing\r\n     *             its components (ex: [9, 0, 0]).\r\n     */\r\n    constructor(text: String | number[]) {\r\n      // If a keyboard doesn't specify a version, use the DEVELOPER_VERSION_FALLBACK values.\r\n      if(text === undefined || text === null) {\r\n        this.components = [].concat(Version.DEVELOPER_VERSION_FALLBACK.components);\r\n        return;\r\n      }\r\n\r\n      if(Array.isArray(text)) {\r\n        let components = text as number[];\r\n        if(components.length < 2) {\r\n          throw new Error(\"Version string must have at least a major and minor component!\");\r\n        } else {\r\n          this.components = [].concat(components);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // else, standard constructor path.\r\n      let parts = text.split('.');\r\n      let componentArray: number[] = [];\r\n\r\n      if(parts.length < 2) {\r\n        throw new Error(\"Version string must have at least a major and minor component!\");\r\n      }\r\n\r\n      for(let i=0; i < parts.length; i++) {\r\n        let value = parseInt(parts[i], 10);\r\n        if(isNaN(value)) {\r\n          throw new Error(\"Version string components must be numerical!\");\r\n        }\r\n\r\n        componentArray.push(value);\r\n      }\r\n\r\n      this.components = componentArray;\r\n    }\r\n\r\n    get major(): number {\r\n      return this.components[0];\r\n    }\r\n\r\n    get minor(): number {\r\n      return this.components[1];\r\n    }\r\n\r\n    toString(): string {\r\n      return this.components.join('.');\r\n    }\r\n\r\n    toJSON(): string {\r\n      return this.toString();\r\n    }\r\n\r\n    equals(other: Version): boolean {\r\n      return this.compareTo(other) == 0;\r\n    }\r\n\r\n    precedes(other: Version): boolean {\r\n      return this.compareTo(other) < 0;\r\n    }\r\n\r\n    compareTo(other: Version): number {\r\n      // If the version info depth differs, we need a flag to indicate which instance is shorter.\r\n      var isShorter: boolean = this.components.length < other.components.length;\r\n      var maxDepth: number = (this.components.length < other.components.length) ? this.components.length : other.components.length;\r\n\r\n      var i: number;\r\n      for(i = 0; i < maxDepth; i++) {\r\n        let delta = this.components[i] - other.components[i];\r\n        if(delta != 0) {\r\n          return delta;\r\n        }\r\n      }\r\n\r\n      var longList = isShorter ? other.components : this.components;\r\n      do {\r\n        if(longList[i] > 0) {\r\n          return isShorter ? -1 : 1;\r\n        }\r\n        i++;\r\n      } while (i < longList.length);\r\n\r\n      // Equal.\r\n      return 0;\r\n    }\r\n  }\r\n}","/***\r\n   KeymanWeb 14.0\r\n   Copyright 2020 SIL International\r\n***/\r\n\r\n/*\r\n * TODO:  Remove this file as part of addressing https://github.com/keymanapp/keyman/issues/2492.\r\n */\r\n\r\ninterface StringConstructor {\r\n  kmwFromCharCode(cp0: number): string,\r\n  _kmwFromCharCode(cp0: number): string,\r\n  kmwEnableSupplementaryPlane(bEnable: boolean)\r\n}\r\n\r\ninterface String {\r\n  kmwCharCodeAt(codePointIndex: number): number,\r\n  kmwCharAt(codePointIndex: number) : string,\r\n  kmwIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  kmwLastIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  kmwSlice(beginSlice: number, endSlice: number) : string,\r\n  kmwSubstring(start: number, length: number) : string,\r\n  kmwSubstr(start: number, length?: number) : string,\r\n  kmwBMPSubstr(start: number, length?: number) : string,\r\n  kmwLength(): number,\r\n  kmwBMPLength(): number,\r\n  kmwNextChar(codeUnitIndex: number): number,\r\n  kmwBMPNextChar(codeUnitIndex: number): number,\r\n  kmwPrevChar(codeUnitIndex: number): number,\r\n  kmwBMPPrevChar(codeUnitIndex: number): number,\r\n  kmwCodePointToCodeUnit(codePointIndex: number) : number,\r\n  kmwBMPCodePointToCodeUnit(codePointIndex: number) : number,\r\n  kmwCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n  kmwBMPCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n  _kmwCharCodeAt(codePointIndex: number): number,\r\n  _kmwCharAt(codePointIndex: number) : string,\r\n  _kmwIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  _kmwLastIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  _kmwSlice(beginSlice: number, endSlice: number) : string,\r\n  _kmwSubstring(start: number, length?: number) : string,\r\n  _kmwSubstr(start: number, length?: number) : string,\r\n  _kmwLength(): number,\r\n  _kmwNextChar(codeUnitIndex: number): number,\r\n  _kmwPrevChar(codeUnitIndex: number): number,\r\n  _kmwCodePointToCodeUnit(codePointIndex: number) : number,\r\n  _kmwCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n}\r\n\r\n/**\r\n * Constructs a string from one or more Unicode character codepoint values \r\n * passed as integer parameters.\r\n * \r\n * @param  {number} cp0,...   1 or more Unicode codepoints, e.g. 0x0065, 0x10000\r\n * @return {string|null}      The new String object.\r\n */\r\nString.kmwFromCharCode = function(cp0) {\r\n  var chars = [], i;\r\n  for (i = 0; i < arguments.length; i++) {\r\n    var c = Number(arguments[i]);\r\n    if (!isFinite(c) || c < 0 || c > 0x10FFFF || Math.floor(c) !== c) {\r\n      throw new RangeError(\"Invalid code point \" + c);\r\n    }\r\n    if (c < 0x10000) {\r\n      chars.push(c);\r\n    } else {\r\n      c -= 0x10000;\r\n      chars.push((c >> 10) + 0xD800);\r\n      chars.push((c % 0x400) + 0xDC00);\r\n    }\r\n  }\r\n  return String.fromCharCode.apply(undefined, chars);\r\n}\r\n\r\n/**\r\n * Returns a number indicating the Unicode value of the character at the given \r\n * code point index, with support for supplementary plane characters.\r\n * \r\n * @param  {number}  codePointIndex  The code point index into the string (not \r\n                                     the code unit index) to return\r\n * @return {number}                  The Unicode character value\r\n */\r\nString.prototype.kmwCharCodeAt = function(codePointIndex) {\r\n  var str = String(this);\r\n  var codeUnitIndex = 0;\r\n  \r\n  if (codePointIndex < 0 || codePointIndex  >= str.length) {\r\n    return NaN;\r\n  }\r\n\r\n  for(var i = 0; i < codePointIndex; i++) {\r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n    if(codeUnitIndex === null) return NaN;\r\n  }\r\n  \r\n  var first = str.charCodeAt(codeUnitIndex);\r\n  if (first >= 0xD800 && first <= 0xDBFF && str.length > codeUnitIndex + 1) {\r\n    var second = str.charCodeAt(codeUnitIndex + 1);\r\n    if (second >= 0xDC00 && second <= 0xDFFF) {\r\n      return ((first - 0xD800) << 10) + (second - 0xDC00) + 0x10000;\r\n    }\r\n  }\r\n  return first;  \r\n}\r\n\r\n/**\r\n * Returns the code point index within the calling String object of the first occurrence\r\n * of the specified value, or -1 if not found.\r\n * \r\n * @param  {string}  searchValue    The value to search for\r\n * @param  {number}  [fromIndex]    Optional code point index to start searching from\r\n * @return {number}                 The code point index of the specified search value\r\n */\r\nString.prototype.kmwIndexOf = function(searchValue, fromIndex) {\r\n  var str = String(this);\r\n  var codeUnitIndex = str.indexOf(searchValue, fromIndex);\r\n  \r\n  if(codeUnitIndex < 0) {\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  var codePointIndex = 0;\r\n  for(var i = 0; i !== null && i < codeUnitIndex; i = str.kmwNextChar(i)) codePointIndex++;\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the code point index within the calling String object of the last occurrence \r\n * of the specified value, or -1 if not found.\r\n * \r\n * @param  {string}  searchValue    The value to search for\r\n * @param  {number}  fromIndex      Optional code point index to start searching from\r\n * @return {number}                 The code point index of the specified search value\r\n */\r\nString.prototype.kmwLastIndexOf = function(searchValue, fromIndex)\r\n{\r\n  var str = String(this);\r\n  var codeUnitIndex = str.lastIndexOf(searchValue, fromIndex);\r\n  \r\n  if(codeUnitIndex < 0) {\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  var codePointIndex = 0;\r\n  for(var i = 0; i !== null && i < codeUnitIndex; i = str.kmwNextChar(i)) codePointIndex++;\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the length of the string in code points, as opposed to code units.\r\n * \r\n * @return {number}                 The length of the string in code points\r\n */\r\nString.prototype.kmwLength = function() {\r\n  var str = String(this);\r\n  \r\n  if(str.length == 0) return 0;\r\n  \r\n  for(var i = 0, codeUnitIndex = 0; codeUnitIndex !== null; i++) \r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n  return i;\r\n}\r\n\r\n/**\r\n * Extracts a section of a string and returns a new string.\r\n * \r\n * @param  {number}  beginSlice    The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number}  endSlice      Optional end code point index in the string\r\n *                                 to extract to\r\n * @return {string}                The substring as selected by beginSlice and\r\n *                                 endSlice\r\n */\r\nString.prototype.kmwSlice = function(beginSlice, endSlice) {\r\n  var str = String(this);\r\n  var beginSliceCodeUnit = str.kmwCodePointToCodeUnit(beginSlice);\r\n  var endSliceCodeUnit = str.kmwCodePointToCodeUnit(endSlice);\r\n  if(beginSliceCodeUnit === null || endSliceCodeUnit === null) \r\n    return '';\r\n  else\r\n    return str.slice(beginSliceCodeUnit, endSliceCodeUnit);\r\n}\r\n\r\n/**\r\n * Returns the characters in a string beginning at the specified location through\r\n * the specified number of characters.\r\n * \r\n * @param  {number}  start         The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number=}  length        Optional length to extract\r\n * @return {string}                The substring as selected by start and length\r\n */\r\nString.prototype.kmwSubstr = function(start, length?)\r\n{\r\n  var str = String(this);\r\n  if(start < 0) \r\n  {\r\n    start = str.kmwLength() + start;\r\n  }\r\n\tif(start < 0) start = 0;\r\n  var startCodeUnit = str.kmwCodePointToCodeUnit(start);\r\n  var endCodeUnit = startCodeUnit;\r\n  \r\n  if(startCodeUnit === null) return '';\r\n  \r\n  if(arguments.length < 2) {\r\n    endCodeUnit = str.length;\r\n  } else {\r\n    for(var i = 0; i < length; i++) endCodeUnit = str.kmwNextChar(endCodeUnit);\r\n  }\r\n  if(endCodeUnit === null)\r\n    return str.substring(startCodeUnit);\r\n  else\r\n    return str.substring(startCodeUnit, endCodeUnit);\r\n}\r\n\r\n/**\r\n * Returns the characters in a string between two indexes into the string.\r\n * \r\n * @param  {number}  indexA        The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number}  indexB        The end code point index in the string to \r\n *                                 extract to\r\n * @return {string}                The substring as selected by indexA and indexB\r\n */\r\nString.prototype.kmwSubstring = function(indexA, indexB)\r\n{\r\n  var str = String(this),indexACodeUnit,indexBCodeUnit;\r\n  \r\n  if(typeof(indexB) == 'undefined') \r\n  {\r\n    indexACodeUnit = str.kmwCodePointToCodeUnit(indexA);\r\n    indexBCodeUnit =  str.length;    \r\n  } \r\n  else\r\n  {\r\n    if(indexA > indexB) { var c = indexA; indexA = indexB; indexB = c; }\r\n  \r\n    indexACodeUnit = str.kmwCodePointToCodeUnit(indexA);\r\n    indexBCodeUnit = str.kmwCodePointToCodeUnit(indexB);\r\n  }\r\n  if(isNaN(indexACodeUnit) || indexACodeUnit === null) indexACodeUnit = 0;\r\n  if(isNaN(indexBCodeUnit) || indexBCodeUnit === null) indexBCodeUnit = str.length;\r\n\r\n  return str.substring(indexACodeUnit, indexBCodeUnit);\r\n}\r\n\r\n/*\r\n  Helper functions\r\n*/\r\n\r\n/**\r\n * Returns the code unit index for the next code point in the string, accounting for\r\n * supplementary pairs \r\n *\r\n * @param  {number|null}  codeUnitIndex  The code unit position to increment\r\n * @return {number|null}                 The index of the next code point in the string,\r\n *                                       in code units\r\n */\r\nString.prototype.kmwNextChar = function(codeUnitIndex) {\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex === null || codeUnitIndex < 0 || codeUnitIndex >= str.length - 1) {\r\n    return null;\r\n  }\r\n  \r\n  var first = str.charCodeAt(codeUnitIndex);\r\n  if (first >= 0xD800 && first <= 0xDBFF && str.length > codeUnitIndex + 1) {\r\n    var second = str.charCodeAt(codeUnitIndex + 1);\r\n    if (second >= 0xDC00 && second <= 0xDFFF) {\r\n      if(codeUnitIndex == str.length - 2) {\r\n        return null;\r\n      }\r\n      return codeUnitIndex + 2;\r\n    }\r\n  }\r\n  return codeUnitIndex + 1;\r\n}\r\n\r\n/**\r\n * Returns the code unit index for the previous code point in the string, accounting\r\n * for supplementary pairs \r\n *\r\n * @param  {number|null}  codeUnitIndex  The code unit position to decrement\r\n * @return {number|null}                 The index of the previous code point in the\r\n *                                       string, in code units\r\n*/\r\nString.prototype.kmwPrevChar = function(codeUnitIndex) {\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex == null || codeUnitIndex <= 0 || codeUnitIndex > str.length) {\r\n    return null;\r\n  }\r\n  \r\n  var second = str.charCodeAt(codeUnitIndex - 1);\r\n  if (second >= 0xDC00 && second <= 0xDFFF && codeUnitIndex > 1) {\r\n    var first = str.charCodeAt(codeUnitIndex - 2);\r\n    if(first >= 0xD800 && first <= 0xDBFF) {\r\n      return codeUnitIndex - 2;\r\n    }\r\n  }\r\n  return codeUnitIndex - 1;\r\n}\r\n\r\n/**\r\n * Returns the corresponding code unit index to the code point index passed\r\n *\r\n * @param  {number|null} codePointIndex  A code point index in the string\r\n * @return {number|null}                 The corresponding code unit index\r\n */\r\nString.prototype.kmwCodePointToCodeUnit = function(codePointIndex) {\r\n  \r\n  if(codePointIndex === null) return null;\r\n  \r\n  var str = String(this);\r\n  var codeUnitIndex = 0;\r\n  \r\n  if(codePointIndex < 0) {\r\n    codeUnitIndex = str.length;\r\n    for(var i = 0; i > codePointIndex; i--) \r\n      codeUnitIndex = str.kmwPrevChar(codeUnitIndex);\t\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  if(codePointIndex == str.kmwLength()) return str.length;\r\n  \r\n  for(var i = 0; i < codePointIndex; i++)\r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n  return codeUnitIndex;\r\n}\r\n\r\n/**\r\n * Returns the corresponding code point index to the code unit index passed\r\n *\r\n * @param  {number|null}  codeUnitIndex  A code unit index in the string\r\n * @return {number|null}                 The corresponding code point index\r\n */\r\nString.prototype.kmwCodeUnitToCodePoint = function(codeUnitIndex) {\r\n  var str = String(this);\r\n  \r\n  if(codeUnitIndex === null)\r\n    return null;\r\n  else if(codeUnitIndex == 0)\r\n    return 0;\r\n  else if(codeUnitIndex < 0)     \r\n    return str.substr(codeUnitIndex).kmwLength();\r\n  else\r\n    return str.substr(0,codeUnitIndex).kmwLength();\r\n}\r\n\r\n/**\r\n * Returns the character at a the code point index passed\r\n *\r\n * @param  {number}  codePointIndex  A code point index in the string\r\n * @return {string}                  The corresponding character\r\n */\r\nString.prototype.kmwCharAt = function(codePointIndex) {\r\n  var str = String(this);\r\n  \r\n  if(codePointIndex >= 0) return str.kmwSubstr(codePointIndex,1); else return '';\r\n}\r\n\r\n/**\r\n * String prototype library extensions for basic plane characters, \r\n * to simplify enabling or disabling supplementary plane functionality (I3319)\r\n */\r\n \r\n/**\r\n * Returns the code unit index for the next code point in the string\r\n *\r\n * @param  {number}  codeUnitIndex    A code point index in the string\r\n * @return {number|null}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPNextChar = function(codeUnitIndex)\r\n{\r\n  var str = String(this);\r\n  if(codeUnitIndex < 0 || codeUnitIndex >= str.length - 1) {\r\n    return null;\r\n  }\r\n  return codeUnitIndex + 1;\r\n}  \r\n\r\n/**\r\n * Returns the code unit index for the previous code point in the string\r\n *\r\n * @param  {number}  codeUnitIndex    A code unit index in the string\r\n * @return {number|null}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPPrevChar = function(codeUnitIndex)\r\n{\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex <= 0 || codeUnitIndex > str.length) {\r\n    return null;\r\n  }\r\n  return codeUnitIndex - 1;\r\n}  \r\n\r\n/**\r\n * Returns the code unit index for a code point index\r\n *\r\n * @param  {number}  codePointIndex   A code point index in the string\r\n * @return {number}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPCodePointToCodeUnit = function(codePointIndex)\r\n{\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the code point index for a code unit index\r\n *\r\n * @param  {number}  codeUnitIndex    A code point index in the string\r\n * @return {number}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPCodeUnitToCodePoint = function(codeUnitIndex)\r\n{\r\n  return codeUnitIndex;\r\n}\r\n\r\n/**\r\n * Returns the length of a BMP string\r\n *\r\n * @return {number}                   The length in code points\r\n */ \r\nString.prototype.kmwBMPLength = function()\r\n{\r\n  var str = String(this);\r\n  return str.length;\r\n}\r\n\r\n\r\n/**\r\n * Returns a substring \r\n *\r\n * @param  {number}  n\r\n * @param  {number=}  ln\r\n * @return {string}                   \r\n */ \r\nString.prototype.kmwBMPSubstr = function(n,ln?)\r\n{\r\n  var str=String(this);\r\n  if(n > -1) \r\n    return str.substr(n,ln);\r\n  else\r\n    return str.substr(str.length+n,-n);  \r\n}\r\n\r\n/**\r\n * Enable or disable supplementary plane string handling\r\n *\r\n * @param  {boolean}  bEnable\r\n */ \r\nString.kmwEnableSupplementaryPlane = function(bEnable)\r\n{\r\n  var p=String.prototype;\r\n  String._kmwFromCharCode = bEnable ? String.kmwFromCharCode : String.fromCharCode;\r\n  p._kmwCharAt = bEnable ? p.kmwCharAt : p.charAt;\r\n  p._kmwCharCodeAt = bEnable ? p.kmwCharCodeAt : p.charCodeAt;\r\n  p._kmwIndexOf = bEnable ? p.kmwIndexOf :p.indexOf;\r\n  p._kmwLastIndexOf = bEnable ? p.kmwLastIndexOf : p.lastIndexOf ;\r\n  p._kmwSlice = bEnable ? p.kmwSlice : p.slice;\r\n  p._kmwSubstring = bEnable ? p.kmwSubstring : p.substring;\r\n  p._kmwSubstr = bEnable ? p.kmwSubstr : p.kmwBMPSubstr;\r\n  p._kmwLength = bEnable ? p.kmwLength : p.kmwBMPLength;\r\n  p._kmwNextChar = bEnable ? p.kmwNextChar : p.kmwBMPNextChar;\r\n  p._kmwPrevChar = bEnable ? p.kmwPrevChar : p.kmwBMPPrevChar;\r\n  p._kmwCodePointToCodeUnit = bEnable ? p.kmwCodePointToCodeUnit : p.kmwBMPCodePointToCodeUnit;\r\n  p._kmwCodeUnitToCodePoint = bEnable ? p.kmwCodeUnitToCodePoint : p.kmwBMPCodeUnitToCodePoint;\r\n}\r\n\r\n","namespace com.keyman.utils {\r\n  export enum Browser {\r\n    Chrome = 'chrome',\r\n    Edge = 'edge',\r\n    Firefox = 'firefox',\r\n    Native = 'native', // Used by embedded mode\r\n    Opera = 'opera',\r\n    Safari = 'safari',\r\n    Other = 'other'\r\n  }\r\n\r\n  export enum OperatingSystem {\r\n    Windows = 'windows',\r\n    macOS = 'macosx',\r\n    Linux = 'linux',\r\n    Android = 'android',\r\n    iOS = 'ios',\r\n    Other = 'other'\r\n  }\r\n\r\n  export enum FormFactor {\r\n    Desktop = 'desktop',\r\n    Phone = 'phone',\r\n    Tablet = 'tablet'\r\n  }\r\n\r\n  /**\r\n   * This class provides an abstract version of com.keyman.Device that is core-friendly, \r\n   * containing only the information needed by web-core for text processing use, devoid\r\n   * of any direct references to the DOM.\r\n   */\r\n  export class DeviceSpec {\r\n    readonly browser: Browser;\r\n    readonly formFactor: FormFactor;\r\n    readonly OS: OperatingSystem;\r\n    readonly touchable: boolean;\r\n\r\n    constructor(browser: string, formFactor: string, OS: string, touchable: boolean) {\r\n      switch(browser.toLowerCase() as Browser) {\r\n        case Browser.Chrome:\r\n        case Browser.Edge:\r\n        case Browser.Firefox:\r\n        case Browser.Native:\r\n        case Browser.Opera:\r\n        case Browser.Safari:\r\n          this.browser = browser.toLowerCase() as Browser;\r\n          break;\r\n        default:\r\n          this.browser = Browser.Other;\r\n      }\r\n\r\n      switch(formFactor.toLowerCase() as FormFactor) {\r\n        case FormFactor.Desktop:\r\n        case FormFactor.Phone:\r\n        case FormFactor.Tablet:\r\n          this.formFactor = formFactor.toLowerCase() as FormFactor;\r\n          break;\r\n        default:\r\n          throw (\"Invalid form factor specified for device: \" + formFactor);\r\n      }\r\n\r\n      switch(OS.toLowerCase() as OperatingSystem) {\r\n        case OperatingSystem.Windows.toLowerCase():\r\n        case OperatingSystem.macOS.toLowerCase():\r\n        case OperatingSystem.Linux.toLowerCase():\r\n        case OperatingSystem.Android.toLowerCase():\r\n        case OperatingSystem.iOS.toLowerCase():\r\n          this.OS = OS.toLowerCase() as OperatingSystem;\r\n          break;\r\n        default:\r\n          this.OS = OperatingSystem.Other;\r\n      }\r\n      \r\n      this.touchable = touchable;\r\n    }\r\n  }\r\n}","// References all utility includes from a single file, making import/export simple.\r\n///<reference path=\"deepCopy.ts\" />\r\n///<reference path=\"globalObject.ts\" />\r\n///<reference path=\"version.ts\" />\r\n///<reference path=\"kmwstring.ts\" />\r\n///<reference path=\"deviceSpec.ts\" />","namespace com.keyman.text {\r\n  export var Codes = {\r\n    // Define Keyman Developer modifier bit-flags (exposed for use by other modules)\r\n    // Compare against /common/core/desktop/src/kmx/kmx_file.h.  CTRL+F \"#define LCTRLFLAG\" to find the secton.\r\n    modifierCodes: {\r\n      \"LCTRL\":0x0001,           // LCTRLFLAG\r\n      \"RCTRL\":0x0002,           // RCTRLFLAG\r\n      \"LALT\":0x0004,            // LALTFLAG\r\n      \"RALT\":0x0008,            // RALTFLAG\r\n      \"SHIFT\":0x0010,           // K_SHIFTFLAG\r\n      \"CTRL\":0x0020,            // K_CTRLFLAG\r\n      \"ALT\":0x0040,             // K_ALTFLAG\r\n      // TENTATIVE:  Represents command keys, which some OSes use for shortcuts we don't\r\n      // want to block.  No rule will ever target a modifier set with this bit set to 1. \r\n      \"META\":0x0080,            // K_METAFLAG\r\n      \"CAPS\":0x0100,            // CAPITALFLAG\r\n      \"NO_CAPS\":0x0200,         // NOTCAPITALFLAG\r\n      \"NUM_LOCK\":0x0400,        // NUMLOCKFLAG\r\n      \"NO_NUM_LOCK\":0x0800,     // NOTNUMLOCKFLAG\r\n      \"SCROLL_LOCK\":0x1000,     // SCROLLFLAG\r\n      \"NO_SCROLL_LOCK\":0x2000,  // NOTSCROLLFLAG\r\n      \"VIRTUAL_KEY\":0x4000,     // ISVIRTUALKEY\r\n      \"VIRTUAL_CHAR_KEY\":0x8000 // VIRTUALCHARKEY // Unused by KMW, but reserved for use by other Keyman engines.\r\n    },\r\n\r\n    modifierBitmasks: {\r\n      \"ALL\":0x007F,\r\n      \"ALT_GR_SIM\": (0x0001 | 0x0004),\r\n      \"CHIRAL\":0x001F,    // The base bitmask for chiral keyboards.  Includes SHIFT, which is non-chiral.\r\n      \"IS_CHIRAL\":0x000F, // Used to test if a bitmask uses a chiral modifier.\r\n      \"NON_CHIRAL\":0x0070 // The default bitmask, for non-chiral keyboards\r\n    },\r\n\r\n    stateBitmasks: {\r\n      \"ALL\":0x3F00,\r\n      \"CAPS\":0x0300,\r\n      \"NUM_LOCK\":0x0C00,\r\n      \"SCROLL_LOCK\":0x3000\r\n    },\r\n\r\n    // Define standard keycode numbers (exposed for use by other modules)\r\n    keyCodes: {\r\n      \"K_BKSP\":8,\"K_TAB\":9,\"K_ENTER\":13,\r\n      \"K_SHIFT\":16,\"K_CONTROL\":17,\"K_ALT\":18,\"K_PAUSE\":19,\"K_CAPS\":20,\r\n      \"K_ESC\":27,\"K_SPACE\":32,\"K_PGUP\":33,\r\n      \"K_PGDN\":34,\"K_END\":35,\"K_HOME\":36,\"K_LEFT\":37,\"K_UP\":38,\r\n      \"K_RIGHT\":39,\"K_DOWN\":40,\"K_SEL\":41,\"K_PRINT\":42,\"K_EXEC\":43,\r\n      \"K_INS\":45,\"K_DEL\":46,\"K_HELP\":47,\"K_0\":48,\r\n      \"K_1\":49,\"K_2\":50,\"K_3\":51,\"K_4\":52,\"K_5\":53,\"K_6\":54,\"K_7\":55,\r\n      \"K_8\":56,\"K_9\":57,\"K_A\":65,\"K_B\":66,\"K_C\":67,\"K_D\":68,\"K_E\":69,\r\n      \"K_F\":70,\"K_G\":71,\"K_H\":72,\"K_I\":73,\"K_J\":74,\"K_K\":75,\"K_L\":76,\r\n      \"K_M\":77,\"K_N\":78,\"K_O\":79,\"K_P\":80,\"K_Q\":81,\"K_R\":82,\"K_S\":83,\r\n      \"K_T\":84,\"K_U\":85,\"K_V\":86,\"K_W\":87,\"K_X\":88,\"K_Y\":89,\"K_Z\":90,\r\n      \"K_NP0\":96,\"K_NP1\":97,\"K_NP2\":98,\r\n      \"K_NP3\":99,\"K_NP4\":100,\"K_NP5\":101,\"K_NP6\":102,\r\n      \"K_NP7\":103,\"K_NP8\":104,\"K_NP9\":105,\"K_NPSTAR\":106,\r\n      \"K_NPPLUS\":107,\"K_SEPARATOR\":108,\"K_NPMINUS\":109,\"K_NPDOT\":110,\r\n      \"K_NPSLASH\":111,\"K_F1\":112,\"K_F2\":113,\"K_F3\":114,\"K_F4\":115,\r\n      \"K_F5\":116,\"K_F6\":117,\"K_F7\":118,\"K_F8\":119,\"K_F9\":120,\r\n      \"K_F10\":121,\"K_F11\":122,\"K_F12\":123,\"K_NUMLOCK\":144,\"K_SCROLL\":145,\r\n      \"K_LSHIFT\":160,\"K_RSHIFT\":161,\"K_LCONTROL\":162,\"K_RCONTROL\":163,\r\n      \"K_LALT\":164,\"K_RALT\":165,\r\n      \"K_COLON\":186,\"K_EQUAL\":187,\"K_COMMA\":188,\"K_HYPHEN\":189,\r\n      \"K_PERIOD\":190,\"K_SLASH\":191,\"K_BKQUOTE\":192,\r\n      \"K_LBRKT\":219,\"K_BKSLASH\":220,\"K_RBRKT\":221,\r\n      \"K_QUOTE\":222,\"K_oE2\":226,\"K_OE2\":226,\r\n      \"K_LOPT\":50001,\"K_ROPT\":50002,\r\n      \"K_NUMERALS\":50003,\"K_SYMBOLS\":50004,\"K_CURRENCIES\":50005,\r\n      \"K_UPPER\":50006,\"K_LOWER\":50007,\"K_ALPHA\":50008,\r\n      \"K_SHIFTED\":50009,\"K_ALTGR\":50010,\r\n      \"K_TABBACK\":50011,\"K_TABFWD\":50012\r\n    },\r\n\r\n    codesUS: [\r\n      ['0123456789',';=,-./`', '[\\\\]\\''],\r\n      [')!@#$%^&*(',':+<_>?~', '{|}\"']\r\n    ]\r\n  }\r\n}","namespace com.keyman.text {\r\n  // Defines the base Deadkey-tracking object.\r\n  \r\n  export class Deadkey {\r\n    p: number;  // Position of deadkey\r\n    d: number;  // Numerical id of the deadkey\r\n    o: number;  // Ordinal value of the deadkey (resolves same-place conflicts)\r\n    matched: number;\r\n\r\n    static ordinalSeed: number = 0;\r\n\r\n    constructor(pos: number, id: number) {\r\n      this.p = pos;\r\n      this.d = id;\r\n      this.o = Deadkey.ordinalSeed++;\r\n    }\r\n\r\n    match(p: number, d: number): boolean {\r\n      var result:boolean = (this.p == p && this.d == d);\r\n\r\n      return result;\r\n    }\r\n\r\n    set(): void {\r\n      this.matched = 1;\r\n    }\r\n\r\n    reset(): void {\r\n      this.matched = 0;\r\n    }\r\n\r\n    before(other: Deadkey): boolean {\r\n      return this.o < other.o;\r\n    }\r\n\r\n    clone(): Deadkey {\r\n      let dk = new Deadkey(this.p, this.d);\r\n      dk.o = this.o;\r\n\r\n      return dk;\r\n    }\r\n\r\n    /**\r\n     * Sorts the deadkeys in reverse order.\r\n     */\r\n    static sortFunc = function(a: Deadkey, b: Deadkey) {\r\n      // We want descending order, so we want 'later' deadkeys first.\r\n      if(a.p != b.p) {\r\n        return b.p - a.p;\r\n      } else {\r\n        return b.o - a.o;\r\n      }\r\n    };\r\n  }\r\n\r\n  // Object-orients deadkey management.\r\n  export class DeadkeyTracker {\r\n    dks: Deadkey[] = [];\r\n\r\n    toSortedArray(): Deadkey[] {\r\n      this.dks = this.dks.sort(Deadkey.sortFunc);\r\n      return [].concat(this.dks);\r\n    }\r\n\r\n    clone(): DeadkeyTracker {\r\n      let dkt = new DeadkeyTracker();\r\n      let dks = this.toSortedArray();\r\n\r\n      // Make sure to clone the deadkeys themselves - the Deadkey object is mutable.\r\n      dkt.dks = [];\r\n      dks.forEach(function(value: Deadkey) {\r\n        dkt.dks.push(value.clone());\r\n      });\r\n\r\n      return dkt;\r\n    }\r\n  \r\n    /**\r\n     * Function     isMatch      \r\n     * Scope        Public\r\n     * @param       {number}      caretPos  current cursor position\r\n     * @param       {number}      n         expected offset of deadkey from cursor\r\n     * @param       {number}      d         deadkey\r\n     * @return      {boolean}               True if deadkey found selected context matches val\r\n     * Description  Match deadkey at current cursor position\r\n     */\r\n    isMatch(caretPos: number, n: number, d: number): boolean {\r\n      if(this.dks.length == 0) {\r\n        return false; // I3318\r\n      }\r\n\r\n      var sp=caretPos;\r\n      n = sp - n;\r\n      for(var i = 0; i < this.dks.length; i++) {\r\n        // Don't re-match an already-matched deadkey.  It's possible to have two identical \r\n        // entries, and they should be kept separately.\r\n        if(this.dks[i].match(n, d) && !this.dks[i].matched) {\r\n          this.dks[i].set();\r\n          // Assumption:  since we match the first possible entry in the array, we\r\n          // match the entry with the lower ordinal - the 'first' deadkey in the position.\r\n          return true; // I3318\r\n        }\r\n      }\r\n\r\n      this.resetMatched(); // I3318\r\n\r\n      return false;\r\n    }\r\n\r\n    add(dk: Deadkey) {\r\n      this.dks = this.dks.concat(dk);\r\n    }\r\n\r\n    remove(dk: Deadkey) {\r\n      var index = this.dks.indexOf(dk);\r\n      this.dks.splice(index, 1);\r\n    }\r\n\r\n    clear() {\r\n      this.dks = [];\r\n    }\r\n\r\n    resetMatched() {\r\n      for(let dk of this.dks) {\r\n        dk.reset();\r\n      }\r\n    }\r\n    \r\n    deleteMatched(): void {\r\n      for(var Li = 0; Li < this.dks.length; Li++) {\r\n        if(this.dks[Li].matched) {\r\n          this.dks.splice(Li--, 1); // Don't forget to decrement!\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     adjustPositions (formerly _DeadkeyAdjustPos)\r\n     * Scope        Private\r\n     * @param       {number}      Lstart      start position in context\r\n     * @param       {number}      Ldelta      characters to adjust by   \r\n     * Description  Adjust saved positions of deadkeys in context\r\n     */\r\n    adjustPositions(Lstart: number, Ldelta: number): void {\r\n      if(Ldelta == 0) {\r\n        return;\r\n      }\r\n      \r\n      for(let dk of this.dks) {\r\n        if(dk.p > Lstart) {\r\n          dk.p += Ldelta;\r\n        }\r\n      }\r\n    }\r\n\r\n    count(): number {\r\n      return this.dks.length;\r\n    }\r\n  }\r\n}","// Defines deadkey management in a manner attachable to each element interface.\r\n///<reference path=\"../text/deadkeys.ts\" />\r\n// Defines the KeyEvent type.\r\n///<reference path=\"keyEvent.ts\" />\r\n\r\n// Also relies on string-extensions provided by the web-utils package.\r\n\r\nnamespace com.keyman.text {\r\n  export class TextTransform implements Transform {\r\n    readonly insert: string;\r\n    readonly deleteLeft: number;\r\n    readonly deleteRight?: number;\r\n\r\n    constructor(insert: string, deleteLeft: number, deleteRight?: number) {\r\n      this.insert = insert;\r\n      this.deleteLeft = deleteLeft;\r\n      this.deleteRight = deleteRight || 0;\r\n    }\r\n\r\n    public static readonly nil = new TextTransform('', 0, 0);\r\n  }\r\n\r\n  export class Transcription {\r\n    readonly token: number;\r\n    readonly keystroke: KeyEvent;\r\n    readonly transform: Transform;\r\n    alternates: Alternate[]; // constructed after the rest of the transcription.\r\n    readonly preInput: Mock;\r\n\r\n    private static tokenSeed: number = 0;\r\n\r\n    constructor(keystroke: KeyEvent, transform: Transform, preInput: Mock, alternates?: Alternate[]/*, removedDks: Deadkey[], insertedDks: Deadkey[]*/) {\r\n      let token = this.token = Transcription.tokenSeed++;\r\n\r\n      this.keystroke = keystroke;\r\n      this.transform = transform;\r\n      this.alternates = alternates;\r\n      this.preInput = preInput;\r\n\r\n      this.transform.id = this.token;\r\n\r\n      // Assign the ID to each alternate, as well.\r\n      if(alternates) {\r\n        alternates.forEach(function(alt) {\r\n          alt.sample.id = token;\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  export type Alternate = ProbabilityMass<Transform>;\r\n\r\n  export abstract class OutputTarget {\r\n    private _dks: text.DeadkeyTracker;\r\n\r\n    constructor() {\r\n      this._dks = new text.DeadkeyTracker();\r\n    }\r\n\r\n    /**\r\n     * Signifies that this OutputTarget has no default key processing behaviors.  This should be false\r\n     * for OutputTargets backed by web elements like HTMLInputElement or HTMLTextAreaElement.\r\n     */\r\n    get isSynthetic(): boolean {\r\n      return true;\r\n    }\r\n\r\n    resetContext(): void {\r\n      this.deadkeys().clear();\r\n    }\r\n\r\n    deadkeys(): text.DeadkeyTracker {\r\n      return this._dks;\r\n    }\r\n\r\n    hasDeadkeyMatch(n: number, d: number): boolean {\r\n      return this.deadkeys().isMatch(this.getDeadkeyCaret(), n, d);\r\n    }\r\n\r\n    insertDeadkeyBeforeCaret(d: number) {\r\n      var dk: Deadkey = new Deadkey(this.getDeadkeyCaret(), d);\r\n      this.deadkeys().add(dk);\r\n    }\r\n\r\n    /**\r\n     * Should be called by each output target immediately before text mutation operations occur.\r\n     * \r\n     * Maintains solutions to old issues:  I3318,I3319\r\n     * @param {number} delta  Use negative values if characters were deleted, positive if characters were added.\r\n     */\r\n    protected adjustDeadkeys(delta: number) {\r\n      this.deadkeys().adjustPositions(this.getDeadkeyCaret(), delta); \r\n    }\r\n\r\n    /**\r\n     * Needed to properly clone deadkeys for use with Mock element interfaces toward predictive text purposes.\r\n     * @param {object}  dks   An existing set of deadkeys to deep-copy for use by this element interface.\r\n     */\r\n    protected setDeadkeys(dks: text.DeadkeyTracker) {\r\n      this._dks = dks.clone();\r\n    }\r\n\r\n    /**\r\n     * Determines the basic operations needed to reconstruct the current OutputTarget's text from the prior state specified\r\n     * by another OutputTarget based on their text and caret positions.\r\n     * \r\n     * This is designed for use as a \"before and after\" comparison to determine the effect of a single keyboard rule at a time.\r\n     * As such, it assumes that the caret is immediately after any inserted text.\r\n     * @param from An output target (preferably a Mock) representing the prior state of the input/output system.\r\n     */\r\n    buildTransformFrom(original: OutputTarget): Transform {\r\n      let to = this.getText();\r\n      let from = original.getText();\r\n\r\n      let fromCaret = original.getDeadkeyCaret();\r\n      let toCaret = this.getDeadkeyCaret();\r\n\r\n      // Step 1:  Determine the number of left-deletions.\r\n      let maxSMPLeftMatch = fromCaret < toCaret ? fromCaret : toCaret;\r\n\r\n      // We need the corresponding non-SMP caret location in order to binary-search efficiently.\r\n      // (Examining code units is much more computationally efficient.)\r\n      let maxLeftMatch = to._kmwCodePointToCodeUnit(maxSMPLeftMatch);\r\n\r\n      // 1.1:  use a non-SMP-aware binary search to determine the divergence point.\r\n      let start = 0;\r\n      let end = maxLeftMatch;  // the index AFTER the last possible matching char.\r\n\r\n      // This search is O(maxLeftMatch).  1/2 + 1/4 + 1/8 + ... converges to = 1.\r\n      while(start < end) {\r\n        let mid = Math.floor((end+start+1) / 2); // round up (compare more)\r\n        let fromLeft = from.substr(start, mid-start);\r\n        let toLeft   = to.substr(start, mid-start);\r\n\r\n        if(fromLeft == toLeft) {\r\n          start = mid;\r\n        } else {\r\n          end = mid - 1;\r\n        }\r\n      }\r\n\r\n      // At the loop's end:  `end` now holds the non-SMP-aware divergence point.\r\n      // The 'caret' is after the last matching code unit.\r\n\r\n      // 1.2:  detect a possible surrogate-pair split scenario, correcting for it\r\n      //       (by moving the split before the high-surrogate) if detected.\r\n\r\n      // If the split location is precisely on either end of the context, we can't\r\n      // have split a surrogate pair.\r\n      if(end > 0 && end < maxLeftMatch) {\r\n        let potentialHigh    = from.charCodeAt(end-1);\r\n        let potentialFromLow = from.charCodeAt(end);\r\n        let potentialToLow   = to.charCodeAt(end);\r\n\r\n        // if potentialHigh is a possible high surrogate...\r\n        if(potentialHigh >= 0xD800 && potentialHigh <= 0xDBFF) {\r\n          // and at least one potential 'low' is a possible low surrogate...\r\n          let flag = potentialFromLow >= 0xDC00 && potentialFromLow <= 0xDFFF;\r\n          flag = flag || (potentialToLow >= 0XDC00 && potentialToLow <= 0xDFFF);\r\n\r\n          // Correct the split location, moving it 'before' the high surrogate.\r\n          if(flag) {\r\n            end = end - 1;\r\n          }\r\n        }\r\n      }\r\n\r\n      // 1.3:  take substring from start to the split point; determine SMP-aware length.\r\n      //       This yields the SMP-aware divergence index, which gives the number of left-deletes.\r\n      let newCaret = from._kmwCodeUnitToCodePoint(end);\r\n      let deletedLeft = fromCaret - newCaret;\r\n\r\n      // Step 2:  Determine the other properties.\r\n      // Since the 'after' OutputTarget's caret indicates the end of any inserted text, we\r\n      // can easily calculate the rest.\r\n      let insertedLength = toCaret - newCaret;\r\n      let delta = to._kmwSubstr(newCaret, insertedLength);\r\n\r\n      let undeletedRight = to._kmwLength() - toCaret;\r\n      let originalRight = from._kmwLength() - fromCaret;\r\n      let deletedRight = originalRight - undeletedRight;\r\n\r\n      // May occur when reverting a suggestion that had been applied mid-word.\r\n      if(deletedRight < 0) {\r\n        // Restores deleteRight characters.\r\n        delta = delta + to._kmwSubstr(toCaret, -deletedRight);\r\n        deletedRight = 0;\r\n      }\r\n\r\n      return new TextTransform(delta, deletedLeft, deletedRight);\r\n    }\r\n\r\n    buildTranscriptionFrom(original: OutputTarget, keyEvent: KeyEvent, alternates?: Alternate[]): Transcription {\r\n      let transform = this.buildTransformFrom(original);\r\n\r\n      // If we ever decide to re-add deadkey tracking, this is the place for it.\r\n\r\n      return new Transcription(keyEvent, transform, Mock.from(original), alternates);\r\n    }\r\n\r\n    /**\r\n     * Restores the `OutputTarget` to the indicated state.  Designed for use with `Transcription.preInput`.\r\n     * @param original An `OutputTarget` (usually a `Mock`).\r\n     */\r\n    restoreTo(original: OutputTarget) {\r\n      //\r\n      this.setTextBeforeCaret(original.getTextBeforeCaret());\r\n      this.setTextAfterCaret(original.getTextAfterCaret());\r\n\r\n      // Also, restore the deadkeys!\r\n      this._dks = original._dks.clone();\r\n    }\r\n\r\n    apply(transform: Transform) {\r\n      if(transform.deleteRight) {\r\n        this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(transform.deleteRight));\r\n      }\r\n\r\n      if(transform.deleteLeft) {\r\n        this.deleteCharsBeforeCaret(transform.deleteLeft);\r\n      }\r\n\r\n      if(transform.insert) {\r\n        this.insertTextBeforeCaret(transform.insert);\r\n      }\r\n\r\n      // We assume that all deadkeys are invalidated after applying a Transform, since\r\n      // prediction implies we'll be completing a word, post-deadkeys.\r\n      this._dks.clear();\r\n    }\r\n\r\n    /**\r\n     * Helper to `restoreTo` - allows directly setting the 'before' context to that of another\r\n     * `OutputTarget`.\r\n     * @param s \r\n     */\r\n    protected setTextBeforeCaret(s: string): void {\r\n      // This one's easy enough to provide a default implementation for.\r\n      this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength());\r\n      this.insertTextBeforeCaret(s);\r\n    }\r\n\r\n    /**\r\n     * Helper to `restoreTo` - allows directly setting the 'after' context to that of another\r\n     * `OutputTarget`.\r\n     * @param s \r\n     */\r\n    protected abstract setTextAfterCaret(s: string): void;\r\n\r\n    /**\r\n     * Clears any selected text within the wrapper's element(s).\r\n     * Silently does nothing if no such text exists.\r\n     */\r\n    abstract clearSelection(): void;\r\n\r\n    /**\r\n     * Clears any cached selection-related state values.\r\n     */\r\n    abstract invalidateSelection(): void;\r\n    \r\n    /**\r\n     * Indicates whether or not the underlying element has its own selection (input, textarea)\r\n     * or is part of (or possesses) the DOM's active selection.\r\n     */\r\n    abstract hasSelection(): boolean;\r\n\r\n    /**\r\n     * Returns an index corresponding to the caret's position for use with deadkeys.\r\n     */\r\n    abstract getDeadkeyCaret(): number;\r\n    \r\n    /**\r\n     * Relative to the caret, gets the current context within the wrapper's element.\r\n     */\r\n    abstract getTextBeforeCaret(): string;\r\n\r\n    /**\r\n     * Relative to the caret (and/or active selection), gets the element's text after the caret,\r\n     * excluding any actively selected text that would be immediately replaced upon text entry.\r\n     */\r\n    abstract getTextAfterCaret(): string;\r\n\r\n    /**\r\n     * Gets the element's full text, including any text that is actively selected.\r\n     */\r\n    abstract getText(): string;\r\n\r\n    /**\r\n     * Performs context deletions (from the left of the caret) as needed by the KeymanWeb engine and\r\n     * corrects the location of any affected deadkeys.\r\n     * \r\n     * Does not delete deadkeys (b/c KMW 1 & 2 behavior maintenance).\r\n     * @param dn The number of characters to delete.  If negative, context will be left unchanged.\r\n     */\r\n    abstract deleteCharsBeforeCaret(dn: number): void;\r\n\r\n    /**\r\n     * Inserts text immediately before the caret's current position, moving the caret after the\r\n     * newly inserted text in the process along with any affected deadkeys.\r\n     * \r\n     * @param s Text to insert before the caret's current position.\r\n     */\r\n    abstract insertTextBeforeCaret(s: string): void;\r\n\r\n    /**\r\n     * Allows element-specific handling for ENTER key inputs.  Conceptually, this should usually\r\n     * correspond to `insertTextBeforeCaret('\\n'), but actual implementation will vary greatly among\r\n     * elements.\r\n     */\r\n    abstract handleNewlineAtCaret(): void;\r\n\r\n    /**\r\n     * Saves element-specific state properties prone to mutation, enabling restoration after\r\n     * text-output operations.\r\n     */\r\n    saveProperties() {\r\n      // Most element interfaces won't need anything here.\r\n    }\r\n\r\n    /**\r\n     * Restores previously-saved element-specific state properties.  Designed for use after text-output\r\n     * ops to facilitate more-seamless web-dev and user interactions.\r\n     */\r\n    restoreProperties(){\r\n      // Most element interfaces won't need anything here. \r\n    }\r\n\r\n    /**\r\n     * Generates a synthetic event on the underlying element, signalling that its value has changed.\r\n     */\r\n    abstract doInputEvent(): void;\r\n  }\r\n\r\n  // Due to some interesting requirements on compile ordering in TS,\r\n  // this needs to be in the same file as OutputTarget now.\r\n  export class Mock extends OutputTarget {\r\n    text: string;\r\n    caretIndex: number;\r\n\r\n    constructor(text?: string, caretPos?: number) {\r\n      super();\r\n\r\n      this.text = text ? text : \"\";\r\n      var defaultLength = this.text._kmwLength();\r\n      // Ensures that `caretPos == 0` is handled correctly.\r\n      this.caretIndex = typeof caretPos == \"number\" ? caretPos : defaultLength;\r\n    }\r\n\r\n    // Clones the state of an existing EditableElement, creating a Mock version of its state.\r\n    static from(outputTarget: OutputTarget) {\r\n      let clone: Mock;\r\n\r\n      if(outputTarget instanceof Mock) {\r\n        // Avoids the need to run expensive kmwstring.ts / `_kmwLength()`\r\n        // calculations when deep-copying Mock instances.\r\n        let priorMock = outputTarget as Mock;\r\n        clone = new Mock(priorMock.text, priorMock.caretIndex);\r\n      } else {\r\n        // If we're 'cloning' a different OutputTarget type, we don't have a\r\n        // guaranteed way to more efficiently get these values; these are the\r\n        // best methods specified by the abstraction.\r\n        let preText = outputTarget.getTextBeforeCaret();\r\n        let caretIndex = preText._kmwLength();\r\n\r\n        // We choose to ignore (rather, pre-emptively remove) any actively-selected text,\r\n        // as since it's always removed instantly during any text mutation operations.\r\n        clone = new Mock(preText + outputTarget.getTextAfterCaret(), caretIndex);\r\n      }\r\n\r\n      // Also duplicate deadkey state!  (Needed for fat-finger ops.)\r\n      clone.setDeadkeys(outputTarget.deadkeys());\r\n\r\n      return clone;\r\n    }\r\n    \r\n    clearSelection(): void {\r\n      return;\r\n    }\r\n\r\n    invalidateSelection(): void {\r\n      return;\r\n    }\r\n\r\n    hasSelection(): boolean {\r\n      return true;\r\n    }\r\n\r\n    getDeadkeyCaret(): number {\r\n      return this.caretIndex;\r\n    }\r\n\r\n    setDeadkeyCaret(index: number) {\r\n      if(index < 0 || index > this.text._kmwLength()) {\r\n        throw new Error(\"Provided caret index is out of range.\");\r\n      }\r\n      this.caretIndex = index;\r\n    }\r\n\r\n    getTextBeforeCaret(): string {\r\n      return this.text.kmwSubstr(0, this.caretIndex);\r\n    }\r\n\r\n    getTextAfterCaret(): string {\r\n      return this.text.kmwSubstr(this.caretIndex);\r\n    }\r\n\r\n    getText(): string {\r\n      return this.text;\r\n    }\r\n\r\n    deleteCharsBeforeCaret(dn: number): void {\r\n      if(dn >= 0) {\r\n        if(dn > this.caretIndex) {\r\n          dn = this.caretIndex;\r\n        }\r\n        this.text = this.text.kmwSubstr(0, this.caretIndex - dn) + this.getTextAfterCaret();\r\n        this.caretIndex -= dn;\r\n      }\r\n    }\r\n\r\n    insertTextBeforeCaret(s: string): void {\r\n      this.text = this.getTextBeforeCaret() + s + this.getTextAfterCaret();\r\n      this.caretIndex += s.kmwLength();\r\n    }\r\n\r\n    handleNewlineAtCaret(): void {\r\n      this.insertTextBeforeCaret('\\n');\r\n    }\r\n\r\n    protected setTextAfterCaret(s: string): void {\r\n      this.text = this.getTextBeforeCaret() + s;\r\n    }\r\n\r\n    doInputEvent() {\r\n      // Mock isn't backed by an element, so it won't have any event listeners.\r\n    }\r\n  }\r\n}","/// <reference path=\"outputTarget.ts\" />\r\n\r\nnamespace com.keyman.text {\r\n  // Represents a probability distribution over a keyboard's keys.\r\n  // Defined here to avoid compilation issues.\r\n  export type KeyDistribution = {keyId: string, p: number}[];\r\n\r\n  /**\r\n   * This class is defined within its own file so that it can be loaded by code outside of KMW without\r\n   * having to actually load the entirety of KMW.\r\n   */\r\n  export class KeyEvent {\r\n    Lcode: number;\r\n    Lstates: number;\r\n    LmodifierChange?: boolean;\r\n    Lmodifiers: number;\r\n    LisVirtualKey: boolean;\r\n    vkCode: number;\r\n    kName: string;\r\n    kLayer?: string;   // The key's layer property\r\n    kbdLayer?: string; // The virtual keyboard's active layer\r\n    kNextLayer?: string;\r\n    \r\n    // Holds relevant event properties leading to construction of this KeyEvent.\r\n    source?: any; // Technically, KeyEvent|MouseEvent|Touch - but those are DOM types that must be kept out of headless mode.\r\n    // Holds a generated fat-finger distribution (when appropriate)\r\n    keyDistribution?: KeyDistribution;\r\n    \r\n    /**\r\n     * The device model for web-core to follow when processing the keystroke.\r\n     */\r\n    device: utils.DeviceSpec;\r\n\r\n    /**\r\n     * `true` if this event was produced by sources other than a DOM-based KeyboardEvent.\r\n     */\r\n    isSynthetic: boolean = true;\r\n  };\r\n}","namespace com.keyman.text {\r\n  /**\r\n   * Represents the commands and state changes that result from a matched keyboard rule.\r\n   */\r\n  export class RuleBehavior {\r\n    /**\r\n     * The before-and-after Transform from matching a keyboard rule.  May be `null`\r\n     * if no keyboard rules were matched for the keystroke.\r\n     */\r\n    transcription: Transcription = null;\r\n\r\n    /**\r\n     * Indicates whether or not a BEEP command was issued by the matched keyboard rule.\r\n     */\r\n    beep?: boolean;\r\n\r\n    /**\r\n     * A set of changed store values triggered by the matched keyboard rule.\r\n     */\r\n    setStore: {[id: number]: string} = {};\r\n\r\n    /**\r\n     * A set of variable stores with save requests triggered by the matched keyboard rule\r\n     */\r\n    saveStore: {[name: string]: VariableStore} = {};\r\n\r\n    /**\r\n     * A set of variable stores with possible changes to be applied during finalization.\r\n     */\r\n     variableStores: keyboards.VariableStoreDictionary = {};\r\n\r\n    /**\r\n     * Denotes a non-output default behavior; this should be evaluated later, against the true keystroke.\r\n     */\r\n    triggersDefaultCommand: boolean = false;\r\n\r\n    /**\r\n     * Denotes error log messages generated when attempting to generate this behavior.\r\n     */\r\n    errorLog?: string;\r\n\r\n    /**\r\n     * Denotes warning log messages generated when attempting to generate this behavior.\r\n     */\r\n    warningLog?: string;\r\n\r\n    /**\r\n     * If predictive text is active, contains a Promise returning predictive Suggestions.\r\n     */\r\n    predictionPromise?: Promise<Suggestion[]>;\r\n\r\n    /**\r\n     * In reference to https://github.com/keymanapp/keyman/pull/4350#issuecomment-768753852:\r\n     *\r\n     * If the final group processed is a context and keystroke group (using keys),\r\n     * and there is no nomatch rule, and the keystroke is not matched in the group,\r\n     * the keystroke's default behavior should trigger, regardless of whether or not any\r\n     * rules in prior groups matched.\r\n     */\r\n    triggerKeyDefault?: boolean;\r\n\r\n    finalize(processor: KeyboardProcessor, outputTarget: OutputTarget) {\r\n      if(!this.transcription) {\r\n        throw \"Cannot finalize a RuleBehavior with no transcription.\";\r\n      }\r\n\r\n      if(processor.beepHandler && this.beep) {\r\n        processor.beepHandler(outputTarget);\r\n      }\r\n\r\n      for(let storeID in this.setStore) {\r\n        let sysStore = processor.keyboardInterface.systemStores[storeID];\r\n        if(sysStore) {\r\n          try {\r\n            sysStore.set(this.setStore[storeID]);\r\n          } catch (error) {\r\n            if(processor.errorLogger) {\r\n              processor.errorLogger(\"Rule attempted to perform illegal operation - 'platform' may not be changed.\");\r\n            }\r\n          }\r\n        } else if(processor.warningLogger) {\r\n          processor.warningLogger(\"Unknown store affected by keyboard rule: \" + storeID);\r\n        }\r\n      }\r\n\r\n      processor.keyboardInterface.applyVariableStores(this.variableStores);\r\n\r\n      if(processor.keyboardInterface.variableStoreSerializer) {\r\n        for(let storeID in this.saveStore) {\r\n          processor.keyboardInterface.variableStoreSerializer.saveStore(processor.activeKeyboard.id, storeID, this.saveStore[storeID]);\r\n        }\r\n      }\r\n\r\n      if(this.triggersDefaultCommand) {\r\n        let keyEvent = this.transcription.keystroke;\r\n        DefaultOutput.applyCommand(keyEvent, outputTarget);\r\n      }\r\n\r\n      if(processor.warningLogger && this.warningLog) {\r\n        processor.warningLogger(this.warningLog);\r\n      } else if(processor.errorLogger && this.errorLog) {\r\n        processor.errorLogger(this.errorLog);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Merges default-related behaviors from another RuleBehavior into this one.  Assumes that the current instance\r\n     * \"came first\" chronologically.  Both RuleBehaviors must be sourced from the same keystroke.\r\n     *\r\n     * Intended use:  merging rule-based behavior with default key behavior during scenarios like those described\r\n     * at https://github.com/keymanapp/keyman/pull/4350#issuecomment-768753852.\r\n     *\r\n     * This function does not attempt a \"complete\" merge for two fully-constructed RuleBehaviors!  Things\r\n     * WILL break for unintended uses.\r\n     * @param other\r\n     */\r\n    mergeInDefaults(other: RuleBehavior) {\r\n      let keystroke = this.transcription.keystroke;\r\n      let keyFromOther = other.transcription.keystroke;\r\n      if(keystroke.Lcode != keyFromOther.Lcode || keystroke.Lmodifiers != keyFromOther.Lmodifiers) {\r\n        throw \"RuleBehavior default-merge not supported unless keystrokes are identical!\";\r\n      }\r\n\r\n      this.triggersDefaultCommand = this.triggersDefaultCommand || other.triggersDefaultCommand;\r\n\r\n      let mergingMock = Mock.from(this.transcription.preInput);\r\n      mergingMock.apply(this.transcription.transform);\r\n      mergingMock.apply(other.transcription.transform);\r\n\r\n      this.transcription = mergingMock.buildTranscriptionFrom(this.transcription.preInput, keystroke, this.transcription.alternates);\r\n    }\r\n  }\r\n}","// Establishes key-code definitions.\r\n/// <reference path=\"codes.ts\" />\r\n// Defines our generalized \"KeyEvent\" class.\r\n/// <reference path=\"keyEvent.ts\" />\r\n\r\nnamespace com.keyman.text {\r\n  export enum EmulationKeystrokes {\r\n    Enter = '\\n',\r\n    Backspace = '\\b'\r\n  }\r\n\r\n  /**\r\n   * Defines a collection of static library functions that define KeymanWeb's default (implied) keyboard rule behaviors.\r\n   */\r\n  export class DefaultOutput {\r\n    private constructor() {\r\n    }\r\n\r\n    static codeForEvent(Lkc: KeyEvent) {\r\n      return Codes.keyCodes[Lkc.kName] || Lkc.Lcode;;\r\n    }\r\n\r\n    /**\r\n     * Serves as a default keycode lookup table.  This may be referenced safely by mnemonic handling without fear of side-effects.\r\n     * Also used by Processor.defaultRuleBehavior to generate output after filtering for special cases.\r\n     */\r\n    public static forAny(Lkc: KeyEvent, isMnemonic: boolean, ruleBehavior?: RuleBehavior) {\r\n      var char = '';\r\n\r\n      // A pretty simple table of lookups, corresponding VERY closely to the original defaultKeyOutput.\r\n      if((char = DefaultOutput.forSpecialEmulation(Lkc, ruleBehavior)) != null) {\r\n        return char;\r\n      } else if(!isMnemonic && ((char = DefaultOutput.forNumpadKeys(Lkc, ruleBehavior)) != null)) {\r\n        return char;\r\n      } else if((char = DefaultOutput.forUnicodeKeynames(Lkc, ruleBehavior)) != null) {\r\n        return char;\r\n      } else if((char = DefaultOutput.forBaseKeys(Lkc, ruleBehavior)) != null) {\r\n        return char;\r\n      } else {\r\n        // // For headless and embeddded, we may well allow '\\t'.  It's DOM mode that has other uses.\r\n        // // Not originally defined for text output within defaultKeyOutput.\r\n        // // We can't enable it yet, as it'll cause hardware keystrokes in the DOM to output '\\t' rather\r\n        // // than rely on the browser-default handling.\r\n        let code = DefaultOutput.codeForEvent(Lkc);\r\n        switch(code) {\r\n        //   case Codes.keyCodes['K_TAB']:\r\n        //   case Codes.keyCodes['K_TABBACK']:\r\n        //   case Codes.keyCodes['K_TABFWD']:\r\n        //     return '\\t';\r\n          default:\r\n           return null;\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * isCommand - returns a boolean indicating if a non-text event should be triggered by the keystroke.\r\n     */\r\n    public static isCommand(Lkc: KeyEvent): boolean {\r\n      let code = DefaultOutput.codeForEvent(Lkc);\r\n\r\n      switch(code) {\r\n        // Should we ever implement them:\r\n        // case Codes.keyCodes['K_LEFT']:  // would not output text, but would alter the caret's position in the context.\r\n        // case Codes.keyCodes['K_RIGHT']:\r\n        //   return true;\r\n        default:\r\n          return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Used when a RuleBehavior represents a non-text \"command\" within the Engine.  This will generally\r\n     * trigger events that require context reset - often by moving the caret or by moving what OutputTarget\r\n     * the caret is in.  However, we let those events perform the actual context reset.\r\n     *\r\n     * Note:  is extended by DOM-aware KeymanWeb code.\r\n     */\r\n    public static applyCommand(Lkc: KeyEvent, outputTarget: OutputTarget): void {\r\n      // Notes for potential default-handling extensions:\r\n      //\r\n      // switch(code) {\r\n        // // Problem:  clusters, and doing them right.\r\n        // // The commented-out code below should be a decent starting point, but clusters make it complex.\r\n        // // Mostly based on pre-12.0 code, but the general idea should be relatively clear.\r\n        //\r\n        // case Codes.keyCodes['K_LEFT']:\r\n        //   if(touchAlias) {\r\n        //     var caretPos = keymanweb.getTextCaret(Lelem);\r\n        //     keymanweb.setTextCaret(Lelem, caretPos - 1 >= 0 ? caretPos - 1 : 0);\r\n        //   }\r\n        //   break;\r\n        // case Codes.keyCodes['K_RIGHT']:\r\n        //   if(touchAlias) {\r\n        //     var caretPos = keymanweb.getTextCaret(Lelem);\r\n        //     keymanweb.setTextCaret(Lelem, caretPos + 1);\r\n        //   }\r\n        //   if(code == VisualKeyboard.keyCodes['K_RIGHT']) {\r\n        //     break;\r\n        //   }\r\n      // }\r\n      //\r\n      // Note that these would be useful even outside of a DOM context.\r\n    }\r\n\r\n    /**\r\n     * Codes matched here generally have default implementations when in a browser but require emulation\r\n     * for 'synthetic' `OutputTarget`s like `Mock`s, which have no default text handling.\r\n     */\r\n    public static forSpecialEmulation(Lkc: KeyEvent, ruleBehavior?: RuleBehavior): EmulationKeystrokes {\r\n      let code = DefaultOutput.codeForEvent(Lkc);\r\n\r\n      switch(code) {\r\n        case Codes.keyCodes['K_BKSP']:\r\n          return EmulationKeystrokes.Backspace;\r\n        case Codes.keyCodes['K_ENTER']:\r\n          return EmulationKeystrokes.Enter;\r\n        // case Codes.keyCodes['K_DEL']:\r\n        //   return '\\u007f'; // 127, ASCII / Unicode control code for DEL.\r\n        default:\r\n          return null;\r\n      }\r\n    }\r\n\r\n    // Should not be used for mnenomic keyboards.  forAny()'s use of this method checks first.\r\n    public static forNumpadKeys(Lkc: KeyEvent, ruleBehavior?: RuleBehavior) {\r\n      // Translate numpad keystrokes into their non-numpad equivalents\r\n      if(Lkc.Lcode >= Codes.keyCodes[\"K_NP0\"]  &&  Lkc.Lcode <= Codes.keyCodes[\"K_NPSLASH\"]) {\r\n        // Number pad, numlock on\r\n        if(Lkc.Lcode < 106) {\r\n          var Lch = Lkc.Lcode-48;\r\n        } else {\r\n          Lch = Lkc.Lcode-64;\r\n        }\r\n        let ch = String._kmwFromCharCode(Lch); //I3319\r\n        return ch;\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    // Test for fall back to U_xxxxxx key id\r\n    // For this first test, we ignore the keyCode and use the keyName\r\n    public static forUnicodeKeynames(Lkc: KeyEvent, ruleBehavior?: RuleBehavior) {\r\n      const keyName = Lkc.kName;\r\n\r\n      // Test for fall back to U_xxxxxx key id\r\n      // For this first test, we ignore the keyCode and use the keyName\r\n      if(!keyName || keyName.substr(0,2) != 'U_') {\r\n        return null;\r\n      }\r\n\r\n      let result = '';\r\n      const codePoints = keyName.substr(2).split('_');\r\n      for(let codePoint of codePoints) {\r\n        const codePointValue = parseInt(codePoint, 16);\r\n        if (((0x0 <= codePointValue) && (codePointValue <= 0x1F)) || ((0x80 <= codePointValue) && (codePointValue <= 0x9F))) {\r\n          // Code points [U_0000 - U_001F] and [U_0080 - U_009F] refer to Unicode C0 and C1 control codes.\r\n          // Check the codePoint number and do not allow output of these codes via U_xxxxxx shortcuts.\r\n          if(ruleBehavior) {\r\n            ruleBehavior.errorLog = (\"Suppressing Unicode control code in \" + keyName);\r\n          }\r\n          // We'll attempt to add valid chars\r\n          continue;\r\n        } else {\r\n          // String.fromCharCode() is inadequate to handle the entire range of Unicode\r\n          // Someday after upgrading to ES2015, can use String.fromCodePoint()\r\n          result += String.kmwFromCharCode(codePointValue);\r\n        }\r\n      }\r\n      return result ? result : null;\r\n    }\r\n\r\n    // Test for otherwise unimplemented keys on the the base default & shift layers.\r\n    // Those keys must be blocked by keyboard rules if intentionally unimplemented; otherwise, this function will trigger.\r\n    public static forBaseKeys(Lkc: KeyEvent, ruleBehavior?: RuleBehavior) {\r\n      let n = Lkc.Lcode;\r\n      let keyShiftState = Lkc.Lmodifiers;\r\n\r\n      // check if exact match to SHIFT's code.  Only the 'default' and 'shift' layers should have default key outputs.\r\n      // TODO:  Extend to allow AltGr as well - better mnemonic support.\r\n      if(keyShiftState == Codes.modifierCodes['SHIFT']) {\r\n        keyShiftState = 1;\r\n      } else if(keyShiftState != 0) {\r\n        if(ruleBehavior) {\r\n          ruleBehavior.warningLog = \"KMW only defines default key output for the 'default' and 'shift' layers!\";\r\n        }\r\n        return null;\r\n      }\r\n\r\n      // Now that keyShiftState is either 0 or 1, we can use the following structure to determine the default output.\r\n      try {\r\n        if(n == Codes.keyCodes['K_SPACE']) {\r\n          return ' ';\r\n        } else if(n >= Codes.keyCodes['K_0'] && n <= Codes.keyCodes['K_9']) { // The number keys.\r\n          return Codes.codesUS[keyShiftState][0][n-Codes.keyCodes['K_0']];\r\n        } else if(n >= Codes.keyCodes['K_A'] && n <= Codes.keyCodes['K_Z']) { // The base letter keys\r\n          return String.fromCharCode(n+(keyShiftState?0:32));  // 32 is the offset from uppercase to lowercase.\r\n        } else if(n >= Codes.keyCodes['K_COLON'] && n <= Codes.keyCodes['K_BKQUOTE']) {\r\n          return Codes.codesUS[keyShiftState][1][n-Codes.keyCodes['K_COLON']];\r\n        } else if(n >= Codes.keyCodes['K_LBRKT'] && n <= Codes.keyCodes['K_QUOTE']) {\r\n          return Codes.codesUS[keyShiftState][2][n-Codes.keyCodes['K_LBRKT']];\r\n        }\r\n      } catch (e) {\r\n        if(ruleBehavior) {\r\n          ruleBehavior.errorLog = \"Error detected with default mapping for key:  code = \" + n + \", shift state = \" + (keyShiftState == 1 ? 'shift' : 'default');\r\n        }\r\n      }\r\n\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","/***\r\n   KeymanWeb 10.0\r\n   Copyright 2017 SIL International\r\n***/\r\n\r\n// Relies on web-utils for version and deep-copy functionality.\r\n\r\nnamespace com.keyman.keyboards {\r\n  let Codes = com.keyman.text.Codes;\r\n\r\n  export type KLS = {[layerName: string]: string[]};\r\n\r\n  // The following types provide type definitions for the full JSON format we use for visual keyboard definitions.\r\n  export type ButtonClass = number|\"0\"|\"1\"|\"2\"|\"3\"|\"4\"|\"5\"|\"6\"|\"7\"|\"8\"|\"9\"|\"10\"\r\n\r\n  export type LayoutKey = {\r\n    \"id\"?: string,\r\n    \"text\"?: string,\r\n    \"sp\"?: ButtonClass,\r\n    \"width\"?: string,\r\n    \"layer\"?: string, // Key derives any modifiers from the value set here if specified, not the actual display layer.\r\n    \"nextlayer\"?: string,\r\n    \"pad\"?: string,\r\n    \"sk\"?: LayoutKey[]\r\n  }\r\n\r\n  export type LayoutRow = {\r\n    \"id\": string, // represents a number, though...\r\n    \"key\": LayoutKey[]\r\n  };\r\n\r\n  export type LayoutLayer = {\r\n    \"id\": string,\r\n    \"row\": LayoutRow[],\r\n\r\n    // Post-processing elements.\r\n    shiftKey?: LayoutKey,\r\n    capsKey?: LayoutKey,\r\n    numKey?: LayoutKey,\r\n    scrollKey?: LayoutKey,\r\n    aligned?: boolean\r\n  }\r\n\r\n  export type LayoutFormFactor = {\r\n    \"displayUnderlying\"?: boolean,\r\n    \"font\": string,\r\n    \"layer\": LayoutLayer[],\r\n    isDefault?: boolean\r\n  }\r\n\r\n  export type LayoutSpec = {\r\n    \"desktop\"?: LayoutFormFactor,\r\n    \"phone\"?: LayoutFormFactor,\r\n    \"tablet\"?: LayoutFormFactor\r\n  }\r\n\r\n  // This class manages default layout construction for consumption by OSKs without a specified layout.\r\n  export class Layouts {\r\n    static dfltCodes=[\r\n      \"K_BKQUOTE\",\"K_1\",\"K_2\",\"K_3\",\"K_4\",\"K_5\",\"K_6\",\"K_7\",\"K_8\",\"K_9\",\"K_0\",\r\n      \"K_HYPHEN\",\"K_EQUAL\",\"K_*\",\"K_*\",\"K_*\",\"K_Q\",\"K_W\",\"K_E\",\"K_R\",\"K_T\",\r\n      \"K_Y\",\"K_U\",\"K_I\",\"K_O\",\"K_P\",\"K_LBRKT\",\"K_RBRKT\",\"K_BKSLASH\",\"K_*\",\r\n      \"K_*\",\"K_*\",\"K_A\",\"K_S\",\"K_D\",\"K_F\",\"K_G\",\"K_H\",\"K_J\",\"K_K\",\"K_L\",\r\n      \"K_COLON\",\"K_QUOTE\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_oE2\",\r\n      \"K_Z\",\"K_X\",\"K_C\",\"K_V\",\"K_B\",\"K_N\",\"K_M\",\"K_COMMA\",\"K_PERIOD\",\r\n      \"K_SLASH\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_*\",\"K_SPACE\"\r\n    ];\r\n\r\n    static dfltText='`1234567890-=\\xA7~~qwertyuiop[]\\\\~~~asdfghjkl;\\'~~~~~?zxcvbnm,./~~~~~ '\r\n      +'~!@#$%^&*()_+\\xA7~~QWERTYUIOP{}\\\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ';\r\n\r\n    static readonly DEFAULT_RAW_SPEC = {'F':'Tahoma', 'BK': Layouts.dfltText};\r\n\r\n    // Cross-reference with the ids in osk.setButtonClass.\r\n    static buttonClasses: {[name: string]: ButtonClass} = {\r\n      'DEFAULT':'0',\r\n      'SHIFT':'1',\r\n      'SHIFT-ON':'2',\r\n      'SPECIAL':'3',\r\n      'SPECIAL-ON':'4',\r\n      'DEADKEY':'8',\r\n      'BLANK':'9',\r\n      'HIDDEN':'10'\r\n    };\r\n\r\n    static modifierSpecials = {\r\n      'leftalt': '*LAlt*',\r\n      'rightalt': '*RAlt*',\r\n      'alt': '*Alt*',\r\n      'leftctrl': '*LCtrl*',\r\n      'rightctrl': '*RCtrl*',\r\n      'ctrl': '*Ctrl*',\r\n      'ctrl-alt': '*AltGr*',\r\n      'leftctrl-leftalt': '*LAltCtrl*',\r\n      'rightctrl-rightalt': '*RAltCtrl*',\r\n      'leftctrl-leftalt-shift': '*LAltCtrlShift*',\r\n      'rightctrl-rightalt-shift': '*RAltCtrlShift*',\r\n      'shift': '*Shift*',\r\n      'shift-alt': '*AltShift*',\r\n      'shift-ctrl': '*CtrlShift*',\r\n      'shift-ctrl-alt': '*AltCtrlShift*',\r\n      'leftalt-shift': '*LAltShift*',\r\n      'rightalt-shift': '*RAltShift*',\r\n      'leftctrl-shift': '*LCtrlShift*',\r\n      'rightctrl-shift': '*RCtrlShift*'\r\n    };\r\n\r\n    /**\r\n    * Build a default layout for keyboards with no explicit layout\r\n    *\r\n    * @param   {Object}  PVK         raw specifications\r\n    * @param   {Keyboard} keyboard   keyboard object (as loaded)\r\n    * @param   {string} formFactor   (really utils.FormFactor)\r\n    * @return  {LayoutFormFactor}\r\n    */\r\n    static buildDefaultLayout(PVK, keyboard: Keyboard, formFactor: string): LayoutFormFactor {\r\n      // Build a layout using the default for the device\r\n      var layoutType=formFactor;\r\n\r\n      if(typeof Layouts.dfltLayout[layoutType] != 'object') {\r\n        layoutType = 'desktop';\r\n      }\r\n\r\n      let kbdBitmask = Codes.modifierBitmasks['NON_CHIRAL'];\r\n      // An unfortunate dependency there.  Should probably also set a version within web-core for use.\r\n      let kbdDevVersion = utils.Version.CURRENT;\r\n      if(keyboard) {\r\n        kbdBitmask = keyboard.modifierBitmask;\r\n        kbdDevVersion = keyboard.compilerVersion;\r\n      }\r\n\r\n      if(!PVK) {\r\n        PVK = this.DEFAULT_RAW_SPEC;\r\n      }\r\n\r\n      // Clone the default layout object for this device\r\n      var layout: LayoutFormFactor = utils.deepCopy(Layouts.dfltLayout[layoutType]);\r\n\r\n      var n,layers=layout['layer'], keyLabels: KLS=PVK['KLS'], key102=PVK['K102'];\r\n      var i, j, k, m, row, rows: LayoutRow[], key: LayoutKey, keys: LayoutKey[];\r\n      var chiral: boolean = (kbdBitmask & Codes.modifierBitmasks.IS_CHIRAL) != 0;\r\n\r\n      var kmw10Plus = !(typeof keyLabels == 'undefined' || !keyLabels);\r\n      if(!kmw10Plus) {\r\n        // Save the processed key label information to the keyboard's general data.\r\n        // Makes things more efficient elsewhere and for reloading after keyboard swaps.\r\n        keyLabels = PVK['KLS'] = Layouts.processLegacyDefinitions(PVK['BK']);\r\n      }\r\n\r\n      // Identify key labels (e.g. *Shift*) that require the special OSK font\r\n      var specialLabel=/\\*\\w+\\*/;\r\n\r\n      // *** Step 1:  instantiate the layer objects. ***\r\n\r\n      // Get the list of valid layers, enforcing that the 'default' layer must be the first one processed.\r\n      var validIdList = Object.getOwnPropertyNames(keyLabels), invalidIdList = [];\r\n      validIdList.splice(validIdList.indexOf('default'), 1);\r\n      validIdList = [ 'default' ].concat(validIdList);\r\n\r\n      // Automatic AltGr emulation if the 'leftctrl-leftalt' layer is otherwise undefined.\r\n      if(keyboard && keyboard.emulatesAltGr) {\r\n        // We insert only the layers that need to be emulated.\r\n        if((validIdList.indexOf('leftctrl-leftalt') == -1) && validIdList.indexOf('rightalt') != -1) {\r\n          validIdList.push('leftctrl-leftalt');\r\n          keyLabels['leftctrl-leftalt'] = keyLabels['rightalt'];\r\n        }\r\n\r\n        if((validIdList.indexOf('leftctrl-leftalt-shift') == -1) && validIdList.indexOf('rightalt-shift') != -1) {\r\n          validIdList.push('leftctrl-leftalt-shift');\r\n          keyLabels['leftctrl-leftalt-shift'] = keyLabels['rightalt-shift'];\r\n        }\r\n      }\r\n\r\n      // If there is no predefined layout, even touch layouts will follow the desktop's\r\n      // setting for the displayUnderlying flag.  As the desktop layout uses a different\r\n      // format for its layout spec, that's found at the field referenced below.\r\n      layout[\"displayUnderlying\"] = keyboard ? !!keyboard.scriptObject['KDU'] : false;\r\n\r\n      // For desktop devices, we must create all layers, even if invalid.\r\n      if(formFactor == 'desktop') {\r\n        invalidIdList = Layouts.generateLayerIds(chiral);\r\n\r\n        // Filter out all ids considered valid.  (We also don't want duplicates in the following list...)\r\n        for(n=0; n<invalidIdList.length; n++) {\r\n          if(validIdList.indexOf(invalidIdList[n]) != -1) {\r\n            invalidIdList.splice(n--, 1);\r\n          }\r\n        }\r\n      }\r\n\r\n      // This ensures all 'valid' layers are at the front of the layer array and managed by the main loop below.\r\n      // 'invalid' layers aren't handled by the loop and thus remain blank after it.\r\n      var idList = validIdList.concat(invalidIdList);\r\n\r\n      if(kmw10Plus && formFactor != 'desktop') { // KLS exists, so we know the exact layer set.\r\n        // Find the SHIFT key...\r\n        var shiftKey: LayoutKey = null;\r\n\r\n        rows = layers[0]['row'];\r\n        for(var r=0; r < rows.length; r++) {\r\n          keys = rows[r]['key'];\r\n          for(var c=0; c < keys.length; c++) {\r\n            key = keys[c];\r\n            if(key['id'] == 'K_SHIFT') {\r\n              shiftKey = key;\r\n            }\r\n          }\r\n        }\r\n\r\n        if(shiftKey) {\r\n          // Erase the legacy shifted subkey array.\r\n          shiftKey['sk'] = [];\r\n\r\n          for(var layerID in keyLabels) {\r\n            if(layerID == 'default' || layerID == 'shift') {\r\n              // These two are accessible from the layer without subkeys.\r\n              continue;\r\n            }\r\n\r\n            // Create a new subkey for the specified layer so that it will be accessible via OSK.\r\n            var specialChar = Layouts.modifierSpecials[layerID];\r\n            let subkey: LayoutKey = {\r\n              id: \"K_\" + specialChar,\r\n              text: specialChar,\r\n              sp: \"1\",\r\n              nextlayer: layerID\r\n            }\r\n            shiftKey['sk'].push(subkey);\r\n          }\r\n        } else {\r\n          // Seriously, this should never happen.  It's here for the debugging log only.\r\n          console.warn(\"Error in default layout - cannot find default Shift key!\");\r\n        }\r\n      }\r\n\r\n      for(n=0; n<idList.length; n++) {\r\n        // Populate non-default (shifted) keygroups\r\n        if(n > 0) {\r\n          layers[n]=utils.deepCopy(layers[0]);\r\n        }\r\n        layers[n]['id']=idList[n];\r\n        layers[n]['nextlayer']=idList[n]; // This would only be different for a dynamic keyboard\r\n\r\n        // Extraced into a helper method to improve readability.\r\n        Layouts.formatDefaultLayer(layers[n], chiral, formFactor, !!key102);\r\n      }\r\n\r\n      // *** Step 2: Layer objects now exist; time to fill them with the appropriate key labels and key styles ***\r\n      for(n=0; n<layers.length; n++) {\r\n        var layer=layers[n], kx, shiftKey: LayoutKey = null, nextKey=null, allText='';\r\n        var capsKey: LayoutKey = null, numKey: LayoutKey = null, scrollKey: LayoutKey = null;  // null if not in the OSK layout.\r\n        var layerSpec = keyLabels[layer['id']];\r\n        var isShift = layer['id'] == 'shift' ? 1 : 0;\r\n        var isDefault = layer['id'] == 'default' || isShift ? 1 : 0;\r\n\r\n        rows=layer['row'];\r\n        for(i=0; i<rows.length; i++) {\r\n          keys=rows[i]['key'];\r\n          for(j=0; j<keys.length; j++) {\r\n            key=keys[j];\r\n            kx=Layouts.dfltCodes.indexOf(key['id']);\r\n\r\n            // Only create keys for defined layers.  ('default' and 'shift' are always defined.)\r\n            if(layerSpec || isDefault) {\r\n              // Get keycap text from visual keyboard array, if defined in keyboard\r\n              if(layerSpec) {\r\n                if(kx >= 0 && kx < layerSpec.length) key['text']=layerSpec[kx];\r\n              }\r\n\r\n              // Legacy (pre 12.0) behavior:  fall back to US English keycap text as default for the base two layers\r\n              // if a key cap is not otherwise defined. (Any intentional 'ghost' keys must be explicitly defined.)\r\n              if(isDefault && kbdDevVersion.precedes(utils.Version.NO_DEFAULT_KEYCAPS)) {\r\n                if(key['id'] != 'K_SPACE' && kx+65 * isShift < Layouts.dfltText.length && key['text'] !== null) {\r\n                  key['text'] = key['text'] || Layouts.dfltText[kx+65*isShift];\r\n                }\r\n              }\r\n            }\r\n\r\n            // Leave any unmarked key caps as null strings\r\n            if(key['text'] !== null) {\r\n              key['text'] = key['text'] || '';\r\n            }\r\n\r\n            // Detect important tracking keys.\r\n            switch(key['id']) {\r\n              case \"K_SHIFT\":\r\n                shiftKey=key;\r\n                break;\r\n              case \"K_TAB\":\r\n                nextKey=key;\r\n                break;\r\n              case \"K_CAPS\":\r\n                capsKey=key;\r\n                break;\r\n              case \"K_NUMLOCK\":\r\n                numKey=key;\r\n                break;\r\n              case \"K_SCROLL\":\r\n                scrollKey=key;\r\n                break;\r\n            }\r\n\r\n            // Remove pop-up shift keys referencing invalid layers (Build 349)\r\n            if(key['sk'] != null) {\r\n              for(k=0; k<key['sk'].length; k++) {\r\n                if(validIdList.indexOf(key['sk'][k]['nextlayer']) == -1) {\r\n                  key['sk'].splice(k--, 1);\r\n                }\r\n              }\r\n\r\n              if(key['sk'].length == 0) {\r\n                key['sk']=null;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // We're done with the layer keys initialization pass.  Time to do post-analysis layer-level init where necessary.\r\n        layer.shiftKey=shiftKey;\r\n        layer.capsKey=capsKey;\r\n        layer.numKey=numKey;\r\n        layer.scrollKey=scrollKey;\r\n\r\n        // Set modifier key appearance and behaviour for non-desktop devices using the default layout\r\n        if(formFactor != 'desktop') {\r\n          if(n > 0 && shiftKey != null) {\r\n            shiftKey['sp']=Layouts.buttonClasses['SHIFT-ON'];\r\n            shiftKey['sk']=null;\r\n            shiftKey['text'] = Layouts.modifierSpecials[layers[n].id] ? Layouts.modifierSpecials[layers[n].id] : \"*Shift*\";\r\n          }\r\n        }\r\n      }\r\n\r\n      return layout;\r\n    }\r\n\r\n        /**\r\n     * Function     getLayerId\r\n     * Scope        Private\r\n     * @param       {number}      m     shift modifier code\r\n     * @return      {string}            layer string from shift modifier code (desktop keyboards)\r\n     * Description  Get name of layer from code, where the modifer order is determined by ascending bit-flag value.\r\n     */\r\n    static getLayerId(m: number): string {\r\n      let modifierCodes = Codes.modifierCodes;\r\n\r\n      var s='';\r\n      if(m == 0) {\r\n        return 'default';\r\n      } else {\r\n        if(m & modifierCodes['LCTRL']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'leftctrl';\r\n        }\r\n        if(m & modifierCodes['RCTRL']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'rightctrl';\r\n        }\r\n        if(m & modifierCodes['LALT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'leftalt';\r\n        }\r\n        if(m & modifierCodes['RALT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'rightalt';\r\n        }\r\n        if(m & modifierCodes['SHIFT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'shift';\r\n        }\r\n        if(m & modifierCodes['CTRL']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'ctrl';\r\n        }\r\n        if(m & modifierCodes['ALT']) {\r\n          s = (s.length > 0 ? s + '-' : '') + 'alt';\r\n        }\r\n        return s;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Generates a list of potential layer ids for the specified chirality mode.\r\n     *\r\n     * @param   {boolean}   chiral    // Does the keyboard use chiral modifiers or not?\r\n     */\r\n    static generateLayerIds(chiral: boolean): string[] {\r\n      var layerCnt, offset;\r\n\r\n      if(chiral) {\r\n        layerCnt=32;\r\n        offset=0x01;\r\n      } else {\r\n        layerCnt=8;\r\n        offset=0x10;\r\n      }\r\n\r\n      var layerIds = [];\r\n\r\n      for(var i=0; i < layerCnt; i++) {\r\n        layerIds.push(Layouts.getLayerId(i * offset));\r\n      }\r\n\r\n      return layerIds;\r\n    }\r\n\r\n    /**\r\n     * Sets a formatting property for the modifier keys when constructing a default layout for a keyboard.\r\n     *\r\n     * @param   {Object}    layer   // One layer specification\r\n     * @param   {boolean}   chiral  // Whether or not the keyboard uses chiral modifier information.\r\n     * @param   {string}    formFactor  // The form factor of the device the layout is being constructed for.\r\n     * @param   {boolean}   key102      // Whether or not the extended key 102 should be hidden.\r\n     */\r\n    static formatDefaultLayer(layer: LayoutLayer, chiral: boolean, formFactor: string, key102: boolean) {\r\n      var layerId = layer['id'];\r\n      let buttonClasses = Layouts.buttonClasses;\r\n\r\n      // Correct appearance of state-dependent modifier keys according to group\r\n      for(var i=0; i<layer['row'].length; i++) {\r\n        var row=layer['row'][i];\r\n        var keys=row['key'];\r\n        for(var j=0; j<keys.length; j++) {\r\n          var key=keys[j];\r\n          switch(key['id']) {\r\n            case 'K_SHIFT':\r\n            case 'K_LSHIFT':\r\n            case 'K_RSHIFT':\r\n              if(layerId.indexOf('shift') != -1) {\r\n                key['sp'] = buttonClasses['SHIFT-ON'];\r\n              }\r\n              if(formFactor != 'desktop') {\r\n                if(layerId != 'default') {\r\n                  key['nextlayer']='default';\r\n                } else {\r\n                  key['nextlayer']='shift';\r\n                }\r\n              }\r\n              break;\r\n            case 'K_LCTRL':\r\n            case 'K_LCONTROL':\r\n              if(chiral) {\r\n                if(layerId.indexOf('leftctrl') != -1) {\r\n                  key['sp'] = buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              }\r\n            case 'K_RCTRL':\r\n            case 'K_RCONTROL':\r\n              if(chiral) {\r\n                if(layerId.indexOf('rightctrl') != -1) {\r\n                  key['sp'] = buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              }\r\n            case 'K_CONTROL':\r\n              if(layerId.indexOf('ctrl') != -1) {\r\n                if(!chiral || (layerId.indexOf('leftctrl') != -1 && layerId.indexOf('rightctrl') != -1)) {\r\n                  key['sp'] = buttonClasses['SHIFT-ON'];\r\n                }\r\n              }\r\n              break;\r\n            case 'K_LALT':\r\n              if(chiral) {\r\n                if(layerId.indexOf('leftalt') != -1) {\r\n                  key['sp'] = buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              }\r\n            case 'K_RALT':\r\n              if(chiral) {\r\n                if(layerId.indexOf('rightalt') != -1) {\r\n                  key['sp'] = buttonClasses['SHIFT-ON'];\r\n                }\r\n                break;\r\n              }\r\n            case 'K_ALT':\r\n              if(layerId.indexOf('alt') != -1) {\r\n                if(!chiral || (layerId.indexOf('leftalt') != -1 && layerId.indexOf('rightalt') != -1)) {\r\n                  key['sp'] = buttonClasses['SHIFT-ON'];\r\n                }\r\n              }\r\n              break;\r\n            case 'K_oE2':\r\n              if(typeof key102 == 'undefined' || !key102) {\r\n                if(formFactor == 'desktop') {\r\n                  keys.splice(j--, 1);\r\n                  keys[0]['width']='200';\r\n                } else {\r\n                  keys[j]['sp']=buttonClasses['HIDDEN'];\r\n                }\r\n              }\r\n              break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Converts the legacy BK property from pre 10.0 into the KLS keyboard layer spec format,\r\n     * sparsifying it as possible to pre-emptively check invalid layers.\r\n     *\r\n     * @param   {Array}   BK      keyboard object (as loaded)\r\n     * @return  {Object}\r\n     */\r\n    static processLegacyDefinitions(BK: string[]): KLS {\r\n      //['default','shift','ctrl','shiftctrl','alt','shiftalt','ctrlalt','shiftctrlalt'];\r\n      var idList=Layouts.generateLayerIds(false); // Non-chiral.\r\n\r\n      var KLS: KLS = {};\r\n\r\n      // The old default:  eight auto-managed layers...\r\n      for(var n=0; n<idList.length; n++) {\r\n        var id = idList[n], arr = [], valid = false;\r\n\r\n        // ... with keycode mappings in blocks of 65.\r\n        for(var k=0; k < 65; k++) {\r\n          var index = k + 65 * n;\r\n          arr.push(BK[index]);\r\n\r\n          // The entry for K_SPACE's keycode tends to hold ' ' instead of '', which causes\r\n          // the whole layer to be treated as 'valid' if not included in the conditional.\r\n          if(index < BK.length && BK[index] != '' && k != Layouts.dfltCodes.indexOf('K_SPACE')) {\r\n            valid = true;\r\n          }\r\n        }\r\n\r\n        if(valid) {\r\n          KLS[id] = arr;\r\n        }\r\n      }\r\n\r\n      // There must always be at least a plain 'default' layer.  Array(65).fill('') would be preferable but isn't supported on IE,\r\n      // but buildDefaultLayer will set the defaults for these layers if no entry exists for them in the array due to length.\r\n      if(typeof KLS['default'] == 'undefined' || ! KLS['default']) {\r\n        KLS['default'] = [''];\r\n      }\r\n\r\n      // There must always be at least a plain 'shift' layer.\r\n      if(typeof KLS['shift'] == 'undefined' || ! KLS['shift']) {\r\n        KLS['shift'] = [''];\r\n      }\r\n\r\n      return KLS;\r\n    }\r\n\r\n    // Defines the default visual layout for a keyboard.\r\n    static dfltLayout: LayoutSpec = {\r\n        \"desktop\":\r\n        {\r\n            \"font\": \"Tahoma,Helvetica\",\r\n            \"layer\": [\r\n                {\r\n                    \"id\": \"default\",\r\n                    \"row\": [\r\n                        {\r\n                            \"id\": \"1\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_BKQUOTE\" },\r\n                                { \"id\": \"K_1\" },\r\n                                { \"id\": \"K_2\" },\r\n                                { \"id\": \"K_3\" },\r\n                                { \"id\": \"K_4\" },\r\n                                { \"id\": \"K_5\" },\r\n                                { \"id\": \"K_6\" },\r\n                                { \"id\": \"K_7\" },\r\n                                { \"id\": \"K_8\" },\r\n                                { \"id\": \"K_9\" },\r\n                                { \"id\": \"K_0\" },\r\n                                { \"id\": \"K_HYPHEN\" },\r\n                                { \"id\": \"K_EQUAL\" },\r\n                                { \"id\": \"K_BKSP\", \"text\": \"*BkSp*\", \"sp\": \"1\", \"width\": \"130\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"2\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_TAB\", \"text\": \"*Tab*\", \"sp\": \"1\", \"width\": \"130\" },\r\n                                { \"id\": \"K_Q\" },\r\n                                { \"id\": \"K_W\" },\r\n                                { \"id\": \"K_E\" },\r\n                                { \"id\": \"K_R\" },\r\n                                { \"id\": \"K_T\" },\r\n                                { \"id\": \"K_Y\" },\r\n                                { \"id\": \"K_U\" },\r\n                                { \"id\": \"K_I\" },\r\n                                { \"id\": \"K_O\" },\r\n                                { \"id\": \"K_P\" },\r\n                                { \"id\": \"K_LBRKT\" },\r\n                                { \"id\": \"K_RBRKT\" },\r\n                                { \"id\": \"K_BKSLASH\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"3\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_CAPS\", \"text\": \"*Caps*\", \"sp\": \"1\", \"width\": \"165\" },\r\n                                { \"id\": \"K_A\" },\r\n                                { \"id\": \"K_S\" },\r\n                                { \"id\": \"K_D\" },\r\n                                { \"id\": \"K_F\" },\r\n                                { \"id\": \"K_G\" },\r\n                                { \"id\": \"K_H\" },\r\n                                { \"id\": \"K_J\" },\r\n                                { \"id\": \"K_K\" },\r\n                                { \"id\": \"K_L\" },\r\n                                { \"id\": \"K_COLON\" },\r\n                                { \"id\": \"K_QUOTE\" },\r\n                                { \"id\": \"K_ENTER\", \"text\": \"*Enter*\", \"sp\": \"1\", \"width\": \"165\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"4\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_SHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"130\" },\r\n                                { \"id\": \"K_oE2\" },\r\n                                { \"id\": \"K_Z\" },\r\n                                { \"id\": \"K_X\" },\r\n                                { \"id\": \"K_C\" },\r\n                                { \"id\": \"K_V\" },\r\n                                { \"id\": \"K_B\" },\r\n                                { \"id\": \"K_N\" },\r\n                                { \"id\": \"K_M\" },\r\n                                { \"id\": \"K_COMMA\" },\r\n                                { \"id\": \"K_PERIOD\" },\r\n                                { \"id\": \"K_SLASH\" },\r\n                                { \"id\": \"K_RSHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"130\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"5\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_LCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"170\" },\r\n                                { \"id\": \"K_LALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"160\" },\r\n                                { \"id\": \"K_SPACE\", \"text\": \"\", \"width\": \"770\" },\r\n                                { \"id\": \"K_RALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"160\" },\r\n                                { \"id\": \"K_RCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"170\" }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        },\r\n        \"tablet\":\r\n        {\r\n            \"font\": \"Tahoma,Helvetica\",\r\n            \"layer\": [\r\n                {\r\n                    \"id\": \"default\",\r\n                    \"row\": [\r\n                        {\r\n                            \"id\": \"0\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_1\" },\r\n                                { \"id\": \"K_2\" },\r\n                                { \"id\": \"K_3\" },\r\n                                { \"id\": \"K_4\" },\r\n                                { \"id\": \"K_5\" },\r\n                                { \"id\": \"K_6\" },\r\n                                { \"id\": \"K_7\" },\r\n                                { \"id\": \"K_8\" },\r\n                                { \"id\": \"K_9\" },\r\n                                { \"id\": \"K_0\" },\r\n                                { \"id\": \"K_HYPHEN\" },\r\n                                { \"id\": \"K_EQUAL\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"1\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_Q\", \"pad\": \"25\" },\r\n                                { \"id\": \"K_W\" },\r\n                                { \"id\": \"K_E\" },\r\n                                { \"id\": \"K_R\" },\r\n                                { \"id\": \"K_T\" },\r\n                                { \"id\": \"K_Y\" },\r\n                                { \"id\": \"K_U\" },\r\n                                { \"id\": \"K_I\" },\r\n                                { \"id\": \"K_O\" },\r\n                                { \"id\": \"K_P\" },\r\n                                { \"id\": \"K_LBRKT\" },\r\n                                { \"id\": \"K_RBRKT\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"2\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_A\", \"pad\": \"50\" },\r\n                                { \"id\": \"K_S\" },\r\n                                { \"id\": \"K_D\" },\r\n                                { \"id\": \"K_F\" },\r\n                                { \"id\": \"K_G\" },\r\n                                { \"id\": \"K_H\" },\r\n                                { \"id\": \"K_J\" },\r\n                                { \"id\": \"K_K\" },\r\n                                { \"id\": \"K_L\" },\r\n                                { \"id\": \"K_COLON\" },\r\n                                { \"id\": \"K_QUOTE\" },\r\n                                { \"id\": \"K_BKSLASH\", \"width\": \"90\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"3\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_oE2\", \"width\": \"90\" },\r\n                                { \"id\": \"K_Z\" },\r\n                                { \"id\": \"K_X\" },\r\n                                { \"id\": \"K_C\" },\r\n                                { \"id\": \"K_V\" },\r\n                                { \"id\": \"K_B\" },\r\n                                { \"id\": \"K_N\" },\r\n                                { \"id\": \"K_M\" },\r\n                                { \"id\": \"K_COMMA\" },\r\n                                { \"id\": \"K_PERIOD\" },\r\n                                { \"id\": \"K_SLASH\" },\r\n                                { \"id\": \"K_BKQUOTE\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"4\",\r\n                            \"key\": [\r\n                                {\r\n                                    \"id\": \"K_SHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"200\", \"sk\": [\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl\" },\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*LCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftctrl\" },\r\n                                        { \"id\": \"K_RCONTROL\", \"text\": \"*RCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightctrl\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"alt\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*LAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftalt\" },\r\n                                        { \"id\": \"K_RALT\", \"text\": \"*RAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightalt\" },\r\n                                        { \"id\": \"K_ALTGR\", \"text\": \"*AltGr*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl-alt\" }]\r\n                                },\r\n                                { \"id\": \"K_LOPT\", \"text\": \"*Menu*\", \"sp\": \"1\", \"width\": \"150\" },\r\n                                { \"id\": \"K_SPACE\", \"text\": \"\", \"width\": \"570\" },\r\n                                { \"id\": \"K_BKSP\", \"text\": \"*BkSp*\", \"sp\": \"1\", \"width\": \"150\" },\r\n                                { \"id\": \"K_ENTER\", \"text\": \"*Enter*\", \"sp\": \"1\", \"width\": \"200\" }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        },\r\n        \"phone\":\r\n        {\r\n            \"font\": \"Tahoma,Helvetica\",\r\n            \"layer\": [\r\n                {\r\n                    \"id\": \"default\",\r\n                    \"row\": [\r\n                        {\r\n                            \"id\": \"0\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_1\" },\r\n                                { \"id\": \"K_2\" },\r\n                                { \"id\": \"K_3\" },\r\n                                { \"id\": \"K_4\" },\r\n                                { \"id\": \"K_5\" },\r\n                                { \"id\": \"K_6\" },\r\n                                { \"id\": \"K_7\" },\r\n                                { \"id\": \"K_8\" },\r\n                                { \"id\": \"K_9\" },\r\n                                { \"id\": \"K_0\" },\r\n                                { \"id\": \"K_HYPHEN\" },\r\n                                { \"id\": \"K_EQUAL\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"1\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_Q\", \"pad\": \"25\" },\r\n                                { \"id\": \"K_W\" },\r\n                                { \"id\": \"K_E\" },\r\n                                { \"id\": \"K_R\" },\r\n                                { \"id\": \"K_T\" },\r\n                                { \"id\": \"K_Y\" },\r\n                                { \"id\": \"K_U\" },\r\n                                { \"id\": \"K_I\" },\r\n                                { \"id\": \"K_O\" },\r\n                                { \"id\": \"K_P\" },\r\n                                { \"id\": \"K_LBRKT\" },\r\n                                { \"id\": \"K_RBRKT\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"2\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_A\", \"pad\": \"50\" },\r\n                                { \"id\": \"K_S\" },\r\n                                { \"id\": \"K_D\" },\r\n                                { \"id\": \"K_F\" },\r\n                                { \"id\": \"K_G\" },\r\n                                { \"id\": \"K_H\" },\r\n                                { \"id\": \"K_J\" },\r\n                                { \"id\": \"K_K\" },\r\n                                { \"id\": \"K_L\" },\r\n                                { \"id\": \"K_COLON\" },\r\n                                { \"id\": \"K_QUOTE\" },\r\n                                { \"id\": \"K_BKSLASH\", \"width\": \"90\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"3\",\r\n                            \"key\": [\r\n                                { \"id\": \"K_oE2\", \"width\": \"90\" },\r\n                                { \"id\": \"K_Z\" },\r\n                                { \"id\": \"K_X\" },\r\n                                { \"id\": \"K_C\" },\r\n                                { \"id\": \"K_V\" },\r\n                                { \"id\": \"K_B\" },\r\n                                { \"id\": \"K_N\" },\r\n                                { \"id\": \"K_M\" },\r\n                                { \"id\": \"K_COMMA\" },\r\n                                { \"id\": \"K_PERIOD\" },\r\n                                { \"id\": \"K_SLASH\" },\r\n                                { \"id\": \"K_BKQUOTE\" },\r\n                                { \"sp\": \"10\", \"width\": \"1\" }\r\n                            ]\r\n                        },\r\n                        {\r\n                            \"id\": \"4\",\r\n                            \"key\": [\r\n                                {\r\n                                    \"id\": \"K_SHIFT\", \"text\": \"*Shift*\", \"sp\": \"1\", \"width\": \"200\", \"sk\": [\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*Ctrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl\" },\r\n                                        { \"id\": \"K_LCONTROL\", \"text\": \"*LCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftctrl\" },\r\n                                        { \"id\": \"K_RCONTROL\", \"text\": \"*RCtrl*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightctrl\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*Alt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"alt\" },\r\n                                        { \"id\": \"K_LALT\", \"text\": \"*LAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"leftalt\" },\r\n                                        { \"id\": \"K_RALT\", \"text\": \"*RAlt*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"rightalt\" },\r\n                                        { \"id\": \"K_ALTGR\", \"text\": \"*AltGr*\", \"sp\": \"1\", \"width\": \"50\", \"nextlayer\": \"ctrl-alt\" }]\r\n                                },\r\n                                { \"id\": \"K_LOPT\", \"text\": \"*Menu*\", \"width\": \"150\", \"sp\": \"1\" },\r\n                                { \"id\": \"K_SPACE\", \"width\": \"570\", \"text\": \"\" },\r\n                                { \"id\": \"K_BKSP\", \"text\": \"*BkSp*\", \"width\": \"150\", \"sp\": \"1\" },\r\n                                { \"id\": \"K_ENTER\", \"text\": \"*Enter*\", \"width\": \"200\", \"sp\": \"1\" }\r\n                            ]\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        }\r\n    };\r\n  }\r\n}\r\n","namespace com.keyman.keyboards {\r\n  type KeyDistribution = text.KeyDistribution;\r\n\r\n\r\n  export class ActiveKey implements LayoutKey {\r\n\r\n    static readonly DEFAULT_PAD=15;          // Padding to left of key, in virtual units\r\n    static readonly DEFAULT_RIGHT_MARGIN=15; // Padding to right of right-most key, in virtual units\r\n    static readonly DEFAULT_KEY_WIDTH=100;   // Width of a key, if not specified, in virtual units\r\n\r\n    // Defines key defaults\r\n    static readonly DEFAULT_KEY = {\r\n      text: '',\r\n      width: ActiveKey.DEFAULT_KEY_WIDTH.toString(),\r\n      sp: '0',\r\n      pad: ActiveKey.DEFAULT_PAD.toString()\r\n    };\r\n\r\n    /** WARNING - DO NOT USE DIRECTLY outside of @keymanapp/keyboard-processor! */\r\n    id?: string;\r\n\r\n    // These are fine.\r\n    width?: string;\r\n    pad?: string;\r\n    layer: string;\r\n    displayLayer: string;\r\n    nextlayer: string;\r\n\r\n    private baseKeyEvent: text.KeyEvent;\r\n    isMnemonic: boolean = false;\r\n\r\n    proportionalPad: number;\r\n    proportionalX: number;\r\n    proportionalWidth: number;\r\n\r\n    sk?: ActiveKey[];\r\n\r\n    // Keeping things simple here, as this was added LATE in 14.0 beta.\r\n    // Could definitely extend in the future to instead return an object\r\n    // that denotes the 'nature' of the key.\r\n    // - isUnicode\r\n    // - isHardwareKey\r\n    // - etc.\r\n\r\n    // Reference for the terminology in the comments below:\r\n    // https://help.keyman.com/developer/current-version/guides/develop/creating-a-touch-keyboard-layout-for-amharic-the-nitty-gritty\r\n\r\n    /**\r\n     * Matches the key code as set within Keyman Developer for the layout.\r\n     * For example, K_R or U_0020.  Denotes either physical keys or virtual keys with custom output,\r\n     * with no additional metadata like layer or active modifiers.\r\n     *\r\n     * Is used to determine the keycode for input events, rule-matching, and keystroke processing.\r\n     */\r\n    public get baseKeyID(): string {\r\n      if(typeof this.id === 'undefined') {\r\n        return undefined;\r\n      }\r\n\r\n      return this.id;\r\n    }\r\n\r\n    /**\r\n     * A unique identifier based on both the key ID & the 'desktop layer' to be used for the key.\r\n     *\r\n     * Allows diambiguation of scenarios where the same key ID is used twice within a layer, but\r\n     * with different innate modifiers.  (Refer to https://github.com/keymanapp/keyman/issues/4617)\r\n     * The 'desktop layer' may be omitted if it matches the key's display layer.\r\n     *\r\n     * Examples, given a 'default' display layer, matching keys to Keyman keyboard language:\r\n     *\r\n     * ```\r\n     * \"K_Q\"\r\n     * + [K_Q]\r\n     * \"K_Q+shift\"\r\n     * + [K_Q SHIFT]\r\n     * ```\r\n     *\r\n     * Useful when the active layer of an input-event is already known.\r\n     */\r\n    public get coreID(): string {\r\n      if(typeof this.id === 'undefined') {\r\n        return undefined;\r\n      }\r\n\r\n      let baseID = this.id || '';\r\n\r\n      if(this.displayLayer != this.layer) {\r\n        baseID = baseID + '+' + this.layer;\r\n      }\r\n\r\n      return baseID;\r\n    }\r\n\r\n    /**\r\n     * A keyboard-unique identifier to be used for any display elements representing this key\r\n     * in user interfaces and/or on-screen keyboards.\r\n     *\r\n     * Distinguishes between otherwise-identical keys on different layers of an OSK.\r\n     * Includes identifying information about the key's display layer.\r\n     *\r\n     * Examples, given a 'default' display layer, matching keys to Keyman keyboard language:\r\n     *\r\n     * ```\r\n     * \"default-K_Q\"\r\n     * + [K_Q]\r\n     * \"default-K_Q+shift\"\r\n     * + [K_Q SHIFT]\r\n     * ```\r\n     *\r\n     * Useful when only the active keyboard is known about an input event.\r\n     */\r\n    public get elementID(): string {\r\n      if(typeof this.id === 'undefined') {\r\n        return undefined;\r\n      }\r\n\r\n      return this.displayLayer + '-' + this.coreID;\r\n    }\r\n\r\n    static polyfill(key: LayoutKey, layout: ActiveLayout, displayLayer: string) {\r\n      // Add class functions to the existing layout object, allowing it to act as an ActiveLayout.\r\n      let dummy = new ActiveKey();\r\n      let proto = Object.getPrototypeOf(dummy);\r\n\r\n      for(let prop in dummy) {\r\n        if(!key.hasOwnProperty(prop)) {\r\n          let descriptor = Object.getOwnPropertyDescriptor(proto, prop);\r\n          if(descriptor) {\r\n            // It's a computed property!  Copy the descriptor onto the key's object.\r\n            Object.defineProperty(key, prop, descriptor);\r\n          } else {\r\n            key[prop] = dummy[prop];\r\n          }\r\n        }\r\n      }\r\n\r\n      // Ensure subkeys are also properly extended.\r\n      if(key.sk) {\r\n        for(let subkey of key.sk) {\r\n          ActiveKey.polyfill(subkey, layout, displayLayer);\r\n        }\r\n      }\r\n\r\n      let aKey = key as ActiveKey;\r\n      aKey.displayLayer = displayLayer;\r\n      aKey.layer = aKey.layer || displayLayer;\r\n\r\n      // Compute the key's base KeyEvent properties for use in future event generation\r\n      aKey.constructBaseKeyEvent(layout, displayLayer);\r\n    }\r\n\r\n    private constructBaseKeyEvent(layout: ActiveLayout, displayLayer: string) {\r\n      // Get key name and keyboard shift state (needed only for default layouts and physical keyboard handling)\r\n      // Note - virtual keys should be treated case-insensitive, so we force uppercasing here.\r\n      let layer = this.layer || displayLayer || '';\r\n      let keyName= this.id ? this.id.toUpperCase() : null;\r\n\r\n      // Start:  mirrors _GetKeyEventProperties\r\n\r\n      // Override key shift state if specified for key in layout (corrected for popup keys KMEW-93)\r\n      let keyShiftState = text.KeyboardProcessor.getModifierState(layer);\r\n\r\n      // First check the virtual key, and process shift, control, alt or function keys\r\n      var Lkc: text.KeyEvent = {\r\n        Lmodifiers: keyShiftState,\r\n        Lstates: 0,\r\n        Lcode: keyName ? text.Codes.keyCodes[keyName] : 0,\r\n        LisVirtualKey: true,\r\n        vkCode: 0,\r\n        kName: keyName,\r\n        kLayer: layer,\r\n        kbdLayer: displayLayer,\r\n        kNextLayer: this.nextlayer,\r\n        device: null,\r\n        isSynthetic: true\r\n      };\r\n\r\n      if(layout.keyboard) {\r\n        let keyboard = layout.keyboard;\r\n\r\n        // Include *limited* support for mnemonic keyboards (Sept 2012)\r\n        // If a touch layout has been defined for a mnemonic keyout, do not perform mnemonic mapping for rules on touch devices.\r\n        if(keyboard.isMnemonic && !(layout.isDefault && layout.formFactor != 'desktop')) {\r\n          if(Lkc.Lcode != text.Codes.keyCodes['K_SPACE']) { // exception required, March 2013\r\n            // Jan 2019 - interesting that 'K_SPACE' also affects the caps-state check...\r\n            Lkc.vkCode = Lkc.Lcode;\r\n            this.isMnemonic = true;\r\n          }\r\n        } else {\r\n          Lkc.vkCode=Lkc.Lcode;\r\n        }\r\n\r\n        // Support version 1.0 KeymanWeb keyboards that do not define positional vs mnemonic\r\n        if(!keyboard.definesPositionalOrMnemonic) {\r\n          // Not the best pattern, but currently safe - we don't look up any properties of any of the\r\n          // arguments in this use case, and the object's scope is extremely limited.\r\n          Lkc.Lcode = KeyMapping._USKeyCodeToCharCode(this.constructKeyEvent(null, null));\r\n          Lkc.LisVirtualKey=false;\r\n        }\r\n      }\r\n\r\n      this.baseKeyEvent = Lkc;\r\n    }\r\n\r\n    constructKeyEvent(keyboardProcessor: text.KeyboardProcessor, device: utils.DeviceSpec): text.KeyEvent {\r\n      // Make a deep copy of our preconstructed key event, filling it out from there.\r\n      let Lkc = utils.deepCopy(this.baseKeyEvent);\r\n      Lkc.device = device;\r\n\r\n      if(this.isMnemonic) {\r\n        text.KeyboardProcessor.setMnemonicCode(Lkc, this.layer.indexOf('shift') != -1, keyboardProcessor ? keyboardProcessor.stateKeys['K_CAPS'] : false);\r\n      }\r\n\r\n      // Performs common pre-analysis for both 'native' and 'embedded' OSK key & subkey input events.\r\n      // This part depends on the keyboard processor's active state.\r\n      if(keyboardProcessor) {\r\n        keyboardProcessor.setSyntheticEventDefaults(Lkc);\r\n\r\n        // If it's a state key modifier, trigger its effects as part of the\r\n        // keystroke.\r\n        const bitmap = {\r\n          'K_CAPS': text.Codes.stateBitmasks.CAPS,\r\n          'K_NUMLOCK': text.Codes.stateBitmasks.NUM_LOCK,\r\n          'K_SCROLL': text.Codes.stateBitmasks.SCROLL_LOCK\r\n        };\r\n        const bitmask = bitmap[Lkc.kName];\r\n\r\n        if(bitmask) {\r\n          Lkc.Lstates ^= bitmask;\r\n          Lkc.LmodifierChange = true;\r\n        }\r\n      }\r\n\r\n      return Lkc;\r\n    }\r\n\r\n    public getSubkey(coreID: string): ActiveKey {\r\n      if(this.sk) {\r\n        for(let key of this.sk) {\r\n          if(key.coreID == coreID) {\r\n            return key;\r\n          }\r\n        }\r\n      }\r\n\r\n      return null;\r\n    }\r\n  }\r\n\r\n  export class ActiveRow implements LayoutRow {\r\n    // Identify key labels (e.g. *Shift*) that require the special OSK font\r\n    static readonly SPECIAL_LABEL=/\\*\\w+\\*/;\r\n\r\n    id: string;\r\n    key: ActiveKey[];\r\n\r\n    /**\r\n     * Used for calculating fat-fingering offsets.\r\n     */\r\n    proportionalY: number;\r\n\r\n    private constructor() {\r\n\r\n    }\r\n\r\n    static polyfill(row: LayoutRow, layout: ActiveLayout, displayLayer: string, totalWidth: number, proportionalY: number) {\r\n      // Apply defaults, setting the width and other undefined properties for each key\r\n      let keys=row['key'];\r\n      for(let j=0; j<keys.length; j++) {\r\n        let key=keys[j];\r\n        for(var tp in ActiveKey.DEFAULT_KEY) {\r\n          if(typeof key[tp] != 'string') {\r\n            key[tp]=ActiveKey.DEFAULT_KEY[tp];\r\n          }\r\n        }\r\n\r\n        // Modify the key type for special keys with non-standard labels\r\n        // to allow the keyboard font to ovveride the SpecialOSK font.\r\n        // Blank keys are no longer reclassed - can use before/after CSS to add text\r\n        switch(key['sp']) {\r\n          case '1':\r\n            if(!ActiveRow.SPECIAL_LABEL.test(key['text']) && key['text'] != '') {\r\n              key['sp']='3';\r\n            }\r\n            break;\r\n          case '2':\r\n            if(!ActiveRow.SPECIAL_LABEL.test(key['text']) && key['text'] != '') {\r\n              key['sp']='4';\r\n            }\r\n            break;\r\n        }\r\n\r\n        ActiveKey.polyfill(key, layout, displayLayer);\r\n      }\r\n\r\n      /* The calculations here are effectively 'virtualized'.  When used with the OSK, the VisualKeyboard\r\n       * will overwrite these values with their true runtime geometry.\r\n       *\r\n       * These calculations approximate those of the actual OSK (without fitting to a specific resolution)\r\n       * and are intended for use with layout testing (while headless) in the future.\r\n       */\r\n\r\n      let setProportions = function(key: ActiveKey, padPc: number, keyPc: number, totalPc: number) {\r\n        key.proportionalPad   = padPc;\r\n        key.proportionalWidth = keyPc;\r\n        key.proportionalX     = (totalPc + padPc + (keyPc/2));\r\n      }\r\n\r\n      // Calculate percentage-based scalings by summing defined widths and scaling each key to %.\r\n      // Save each percentage key width as a separate member (do *not* overwrite layout specified width!)\r\n      var keyPercent: number, padPercent: number, totalPercent=0;\r\n      for(let j=0; j<keys.length-1; j++) {\r\n        keyPercent=parseInt(keys[j]['width'],10)/totalWidth;\r\n        keys[j]['widthpc']=keyPercent;\r\n        padPercent=parseInt(keys[j]['pad'],10)/totalWidth;\r\n        keys[j]['padpc']=padPercent;\r\n\r\n        // compute center's default x-coord (used in headless modes)\r\n        setProportions(keys[j] as ActiveKey, padPercent, keyPercent, totalPercent);\r\n        totalPercent += padPercent+keyPercent;\r\n      }\r\n\r\n      // Allow for right OSK margin (15 layout units)\r\n      let rightMargin = ActiveKey.DEFAULT_RIGHT_MARGIN/totalWidth;\r\n      totalPercent += rightMargin;\r\n\r\n      // If a single key, and padding is negative, add padding to right align the key\r\n      if(keys.length == 1 && parseInt(keys[0]['pad'],10) < 0) {\r\n        keyPercent=parseInt(keys[0]['width'],10)/totalWidth;\r\n        keys[0]['widthpc']=keyPercent;\r\n        totalPercent += keyPercent;\r\n        keys[0]['padpc']=1-totalPercent;\r\n\r\n        // compute center's default x-coord (used in headless modes)\r\n        setProportions(keys[0] as ActiveKey, padPercent, keyPercent, totalPercent);\r\n      } else if(keys.length > 0) {\r\n        let j=keys.length-1;\r\n        padPercent=parseInt(keys[j]['pad'],10)/totalWidth;\r\n        keys[j]['padpc']=padPercent;\r\n        totalPercent += padPercent;\r\n        keys[j]['widthpc'] = keyPercent = 1-totalPercent;\r\n\r\n        // compute center's default x-coord (used in headless modes)\r\n        setProportions(keys[j] as ActiveKey, padPercent, keyPercent, totalPercent);\r\n      }\r\n\r\n      // Add class functions to the existing layout object, allowing it to act as an ActiveLayout.\r\n      let dummy = new ActiveRow();\r\n      for(let key in dummy) {\r\n        if(!row.hasOwnProperty(key)) {\r\n          row[key] = dummy[key];\r\n        }\r\n      }\r\n\r\n      let aRow = row as ActiveRow;\r\n      aRow.proportionalY = proportionalY;\r\n    }\r\n\r\n    populateKeyMap(map: {[keyId: string]: ActiveKey}) {\r\n      this.key.forEach(function(key: ActiveKey) {\r\n        if(key.coreID) {\r\n          map[key.coreID] = key;\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  export class ActiveLayer implements LayoutLayer {\r\n    row: ActiveRow[];\r\n    id: string;\r\n\r\n    // These already exist on the objects, pre-polyfill...\r\n    // but they still need to be proactively declared on this type.\r\n    capsKey?: ActiveKey;\r\n    numKey?: ActiveKey;\r\n    scrollKey?: ActiveKey;\r\n\r\n    totalWidth: number;\r\n\r\n    defaultKeyProportionalWidth: number;\r\n    rowProportionalHeight: number;\r\n\r\n    /**\r\n     * Facilitates mapping key id strings to their specification objects.\r\n     */\r\n    keyMap: {[keyId: string]: ActiveKey};\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    static polyfill(layer: LayoutLayer, layout: ActiveLayout) {\r\n      layer.aligned=false;\r\n\r\n      // Create a DIV for each row of the group\r\n      let rows=layer['row'];\r\n\r\n      // Calculate the maximum row width (in layout units)\r\n      var totalWidth=0;\r\n      for(let i=0; i<layer['row'].length; i++) {\r\n        var width=0;\r\n        let row=rows[i];\r\n        let keys=row['key'];\r\n        for(let j=0; j<keys.length; j++) {\r\n          let key=keys[j];\r\n\r\n          // Test for a trailing comma included in spec, added as null object by IE\r\n          if(key == null) {\r\n            keys.length = keys.length-1;\r\n          } else {\r\n            var kw, kp;\r\n            kw = (typeof key['width'] == 'string' && key['width'] != '') ? parseInt(key['width'],10) : ActiveKey.DEFAULT_KEY_WIDTH;\r\n            if(isNaN(kw) || kw == 0) kw = ActiveKey.DEFAULT_KEY_WIDTH;\r\n            key['width'] = kw.toString();\r\n            kp = (typeof key['pad'] == 'string' && key['pad'] != '') ? parseInt(key['pad'],10) : ActiveKey.DEFAULT_PAD;\r\n            if(isNaN(kp) || kp == 0) kp = ActiveKey.DEFAULT_PAD;  // KMEW-119\r\n            key['pad'] = kp.toString();\r\n            width += kw + kp;\r\n            //if(typeof key['width'] == 'string' && key['width'] != '') width += parseInt(key['width'],10); else width += DEFAULT_KEY_WIDTH;\r\n            //if(typeof key['pad'] == 'string' && key['pad'] != '') width += parseInt(key['pad'],10); else width += 5;\r\n          }\r\n        }\r\n        if(width > totalWidth) {\r\n          totalWidth = width;\r\n        }\r\n      }\r\n\r\n      // Add default right margin\r\n      if(layout.formFactor == 'desktop') {\r\n        totalWidth += 5; // TODO: resolve difference between touch and desktop; why don't we use ActiveKey.DEFAULT_RIGHT_MARGIN?\r\n      } else {\r\n        totalWidth += ActiveKey.DEFAULT_RIGHT_MARGIN;\r\n      }\r\n\r\n      let rowCount = layer.row.length;\r\n      for(let i=0; i<rowCount; i++) {\r\n        // Calculate proportional y-coord of row.  0 is at top with highest y-coord.\r\n        let rowProportionalY = (i + 0.5) / rowCount;\r\n        ActiveRow.polyfill(layer.row[i], layout, layer.id, totalWidth, rowProportionalY);\r\n      }\r\n\r\n      // Add class functions and properties to the existing layout object, allowing it to act as an ActiveLayout.\r\n      let dummy = new ActiveLayer();\r\n      for(let key in dummy) {\r\n        if(!layer.hasOwnProperty(key)) {\r\n          layer[key] = dummy[key];\r\n        }\r\n      }\r\n\r\n      let aLayer = layer as ActiveLayer;\r\n      aLayer.totalWidth = totalWidth;\r\n      aLayer.defaultKeyProportionalWidth = parseInt(ActiveKey.DEFAULT_KEY.width, 10) / totalWidth;\r\n      aLayer.rowProportionalHeight = 1.0 / rowCount;\r\n      aLayer.keyMap = aLayer.constructKeyMap();\r\n    }\r\n\r\n    private constructKeyMap(): {[keyId: string]: ActiveKey} {\r\n      let map: {[keyId: string]: ActiveKey} = {};\r\n      this.row.forEach(function(row: ActiveRow) {\r\n        row.populateKeyMap(map);\r\n      });\r\n\r\n      return map;\r\n    }\r\n\r\n    /**\r\n     * Builds a sorted-order array of most likely keys to be intended for a given touch.\r\n     * @param touchCoords A proportional (x, y) coordinate of the touch within the keyboard's geometry.\r\n     *                           Should be within [0, 0] to [1, 1].\r\n     * @param kbdScaleRatio The ratio of the keyboard's horizontal scale to its vertical scale.\r\n     *                           For a 400 x 200 keyboard, should be 2.\r\n     */\r\n    getTouchProbabilities(touchCoords: {x: number, y: number}, kbdScaleRatio: number): KeyDistribution {\r\n      let distribution = this.simpleTouchDistribution(touchCoords, kbdScaleRatio);\r\n      let list: {keyId: string, p: number}[] = [];\r\n\r\n      for(let key in distribution) {\r\n        list.push({keyId: key, p: distribution[key]});\r\n      }\r\n\r\n      return list.sort(function(a, b) {\r\n        return b.p - a.p; // Largest probability keys should be listed first.\r\n      })\r\n    }\r\n\r\n    /**\r\n     * Computes a probability distribution regarding the likelihood of a touch command being intended\r\n     * for each of the layout's keys.\r\n     * @param touchCoords A proportional (x, y) coordinate of the touch within the keyboard's geometry.\r\n     *                           Should be within [0, 0] to [1, 1].\r\n     * @param kbdScaleRatio The ratio of the keyboard's horizontal scale to its vertical scale.\r\n     *                           For a 400 x 200 keyboard, should be 2.\r\n     */\r\n    simpleTouchDistribution(touchCoords: {x: number, y: number}, kbdScaleRatio: number): {[keyId: string]: number} {\r\n      let keyDists = this.keyTouchDistances(touchCoords, kbdScaleRatio);\r\n      let keyProbs: {[keyId: string]: number} = {};\r\n\r\n      let totalMass = 0;\r\n\r\n      // Should we wish to allow multiple different transforms for distance -> probability, use a function parameter in place\r\n      // of the formula in the loop below.\r\n      for(let key in keyDists) {\r\n        totalMass += keyProbs[key] = 1 / (keyDists[key] + 1e-6); // Prevent div-by-0 errors.\r\n      }\r\n\r\n      for(let key in keyProbs) {\r\n        keyProbs[key] /= totalMass;\r\n      }\r\n\r\n      return keyProbs;\r\n    }\r\n\r\n    /**\r\n     * Computes a squared 'pseudo-distance' for the touch from each key.  (Not a proper metric.)\r\n     * Intended for use in generating a probability distribution over the keys based on the touch input.\r\n     * @param touchCoords A proportional (x, y) coordinate of the touch within the keyboard's geometry.\r\n     *                           Should be within [0, 0] to [1, 1].\r\n     * @param kbdScaleRatio The ratio of the keyboard's horizontal scale to its vertical scale.\r\n     *                           For a 400 x 200 keyboard, should be 2.\r\n     */\r\n    private keyTouchDistances(touchCoords: {x: number, y: number}, kbdScaleRatio: number): {[keyId: string]: number} {\r\n      let layer = this;\r\n\r\n      let keyDists: {[keyId: string]: number} = {};\r\n\r\n      // This double-nested loop computes a pseudo-distance for the touch from each key.  Quite useful for\r\n      // generating a probability distribution.\r\n      this.row.forEach(function(row: ActiveRow): void {\r\n        row.key.forEach(function(key: ActiveKey): void {\r\n          // If the key lacks an ID, just skip it.  Sometimes used for padding.\r\n          if(!key.baseKeyID) {\r\n            return;\r\n          } else {\r\n            // Attempt to filter out known non-output keys.\r\n            // Results in a more optimized distribution.\r\n            switch(key.baseKeyID) {\r\n              case 'K_SHIFT':\r\n              case 'K_LOPT':\r\n              case 'K_ROPT':\r\n              case 'K_NUMLOCK': // Often used for numeric layers.\r\n              case 'K_CAPS':\r\n                // As these aren't output keys, they shouldn't be possible fat-finger targets.\r\n                return;\r\n              default:\r\n                // Refer to text/codes.ts - these are Keyman-custom \"keycodes\" used for\r\n                // layer shifting keys.  To be safe, we currently let K_TABBACK and\r\n                // K_TABFWD through, though we might be able to drop them too.\r\n                let code = com.keyman.text.Codes[key.baseKeyID];\r\n                if(code > 50000 && code < 50011) {\r\n                  return;\r\n                }\r\n            }\r\n          }\r\n          // These represent the within-key distance of the touch from the key's center.\r\n          // Both should be on the interval [0, 0.5].\r\n          let dx = Math.abs(touchCoords.x - key.proportionalX);\r\n          let dy = Math.abs(touchCoords.y - row.proportionalY);\r\n\r\n          // If the touch isn't within the key, these store the out-of-key distance\r\n          // from the closest point on the key being checked.\r\n          let distX: number, distY: number;\r\n\r\n          if(dx > 0.5 * key.proportionalWidth) {\r\n            distX = (dx - 0.5 * key.proportionalWidth);\r\n            dx = 0.5;\r\n          } else {\r\n            distX = 0;\r\n            dx /= key.proportionalWidth;\r\n          }\r\n\r\n          if(dy > 0.5 * layer.rowProportionalHeight) {\r\n            distY = (dy - 0.5 * layer.rowProportionalHeight);\r\n            dy = 0.5;\r\n          } else {\r\n            distY = 0;\r\n            dy /= layer.rowProportionalHeight;\r\n          }\r\n\r\n          // Now that the differentials are computed, it's time to do distance scaling.\r\n          //\r\n          // For out-of-key distance, we scale the X component by the keyboard's aspect ratio\r\n          // to get the actual out-of-key distance rather than proportional.\r\n          distX *= kbdScaleRatio;\r\n\r\n          // While the keys are rarely perfect squares, we map all within-key distance\r\n          // to a square shape.  (ALT/CMD should seem as close to SPACE as a 'B'.)\r\n          //\r\n          // For that square, we take the rowHeight as its edge lengths.\r\n          distX += dx * layer.rowProportionalHeight;\r\n          distY += dy * layer.rowProportionalHeight;\r\n\r\n          let distance = distX * distX + distY * distY;\r\n          keyDists[key.coreID] = distance;\r\n        });\r\n      });\r\n\r\n      return keyDists;\r\n    }\r\n\r\n    getKey(keyId: string) {\r\n      // Keys usually are specified in a \"long form\" prefixed with their layer's ID.\r\n      if(keyId.indexOf(this.id + '-') == 0) {\r\n        keyId = keyId.replace(this.id + '-', '');\r\n      }\r\n\r\n      let idComponents = keyId.split('::');\r\n      if(idComponents.length > 1) {\r\n        let baseKey = this.keyMap[idComponents[0]];\r\n        return baseKey.getSubkey(idComponents[1]);\r\n      } else {\r\n        return this.keyMap[keyId];\r\n      }\r\n    }\r\n  }\r\n\r\n  export class ActiveLayout implements LayoutFormFactor{\r\n    layer: ActiveLayer[];\r\n    font: string;\r\n    keyLabels: boolean;\r\n    isDefault?: boolean;\r\n    keyboard: Keyboard;\r\n    formFactor: utils.FormFactor;\r\n\r\n    /**\r\n     * Facilitates mapping layer id strings to their specification objects.\r\n     */\r\n    layerMap: {[layerId: string]: ActiveLayer};\r\n\r\n    private constructor() {\r\n\r\n    }\r\n\r\n    getLayer(layerId: string): ActiveLayer {\r\n      return this.layerMap[layerId];\r\n    }\r\n\r\n    /**\r\n     * Refer to https://github.com/keymanapp/keyman/issues/254, which mentions\r\n     * KD-11 from a prior issue-tracking system from the closed-source days that\r\n     * resulted in an unintended extra empty row.\r\n     *\r\n     * It'll be pretty rare to see a keyboard affected by the bug, but we don't\r\n     * 100% control all keyboards out there, so it's best we make sure the edge\r\n     * case is covered.\r\n     *\r\n     * @param layers The layer group to be loaded for the form factor.  Will be\r\n     *               mutated by this operation.\r\n     */\r\n    static correctLayerEmptyRowBug(layers: LayoutLayer[]) {\r\n      for(let n=0; n<layers.length; n++) {\r\n        let layer=layers[n];\r\n        let rows=layer['row'];\r\n        let i: number;\r\n        for(i=rows.length-1; i>=0; i--) {\r\n          if(!Array.isArray(rows[i]['key']) || rows[i]['key'].length == 0) {\r\n            rows.splice(i, 1)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param layout\r\n     * @param formFactor\r\n     */\r\n    static polyfill(layout: LayoutFormFactor, keyboard: Keyboard, formFactor: utils.FormFactor): ActiveLayout {\r\n      if(layout == null) {\r\n        throw new Error(\"Cannot build an ActiveLayout for a null specification.\");\r\n      }\r\n\r\n      // Create a separate OSK div for each OSK layer, only one of which will ever be visible\r\n      var n: number;\r\n      let layerMap: {[layerId: string]: ActiveLayer} = {};\r\n\r\n      let layers=layout['layer'];\r\n      ActiveLayout.correctLayerEmptyRowBug(layers);\r\n\r\n      // Add class functions to the existing layout object, allowing it to act as an ActiveLayout.\r\n      let dummy = new ActiveLayout();\r\n      for(let key in dummy) {\r\n        if(!layout.hasOwnProperty(key)) {\r\n          layout[key] = dummy[key];\r\n        }\r\n      }\r\n\r\n      let aLayout = layout as ActiveLayout;\r\n      aLayout.keyboard = keyboard;\r\n      aLayout.formFactor = formFactor;\r\n\r\n      for(n=0; n<layers.length; n++) {\r\n        ActiveLayer.polyfill(layers[n], aLayout);\r\n        layerMap[layers[n].id] = layers[n] as ActiveLayer;\r\n      }\r\n\r\n      aLayout.layerMap = layerMap;\r\n\r\n      return aLayout;\r\n    }\r\n  }\r\n}\r\n","namespace com.keyman.text {\r\n  /**\r\n   * Defines common behaviors associated with system stores.\r\n   */\r\n  export abstract class SystemStore {\r\n    public readonly id: number;\r\n\r\n    constructor(id: number) {\r\n      this.id = id;\r\n    }\r\n\r\n    abstract matches(value: string): boolean;\r\n\r\n    set(value: string): void {\r\n      throw new Error(\"System store with ID \" + this.id + \" may not be directly set.\");\r\n    }\r\n  }\r\n\r\n  /**\r\n   * A handler designed to receive feedback whenever a system store's value is changed.\r\n   * @param source    The system store being mutated, before the value change occurs.\r\n   * @param newValue  The new value being set\r\n   * @returns         `false` / `undefined` to allow the change, `true` to block the change.\r\n   */\r\n  export type SystemStoreMutationHandler = (source: MutableSystemStore, newValue: string) => boolean;\r\n\r\n  export class MutableSystemStore extends SystemStore {\r\n    private _value: string;\r\n    handler?: SystemStoreMutationHandler = null;\r\n\r\n    constructor(id: number, defaultValue: string) {\r\n      super(id);\r\n      this._value = defaultValue;\r\n    }\r\n\r\n    get value() {\r\n      return this._value;\r\n    }\r\n\r\n    matches(value: string) {\r\n      return this._value == value;\r\n    }\r\n\r\n    set(value: string) {\r\n      if(this.handler) {\r\n        if(this.handler(this, value)) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      this._value = value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles checks against the current platform.\r\n   */\r\n  export class PlatformSystemStore extends SystemStore {\r\n    private readonly kbdInterface: KeyboardInterface;\r\n\r\n    constructor(keyboardInterface: KeyboardInterface) {\r\n      super(KeyboardInterface.TSS_PLATFORM);\r\n\r\n      this.kbdInterface = keyboardInterface;\r\n    }\r\n\r\n    matches(value: string) {\r\n      var i,constraint,constraints=value.split(' ');\r\n      let device = this.kbdInterface.activeDevice;\r\n\r\n      for(i=0; i<constraints.length; i++) {\r\n        constraint=constraints[i].toLowerCase();\r\n        switch(constraint) {\r\n          case 'touch':\r\n          case 'hardware':\r\n            if(device.touchable != (constraint == 'touch')) {\r\n              return false;\r\n            }\r\n            break;\r\n\r\n          case 'macos':\r\n          case 'mac':\r\n            constraint = 'macosx';\r\n            // fall through\r\n          case 'macosx':\r\n          case 'windows':\r\n          case 'android':\r\n          case 'ios':\r\n          case 'linux':\r\n            if(device.OS != constraint) {\r\n              return false;\r\n            }\r\n            break;\r\n\r\n          case 'tablet':\r\n          case 'phone':\r\n          case 'desktop':\r\n            if(device.formFactor != constraint) {\r\n              return false;\r\n            }\r\n            break;\r\n\r\n          case 'web':\r\n            if(device.browser == 'native') {\r\n              return false; // web matches anything other than 'native'\r\n            }\r\n            break;\r\n            \r\n          case 'native':\r\n            // This will return true for embedded KeymanWeb\r\n          case 'ie':\r\n          case 'chrome':\r\n          case 'firefox':\r\n          case 'safari':\r\n          case 'edge':\r\n          case 'opera':\r\n            if(device.browser != constraint) {\r\n              return false;\r\n            }\r\n            break;\r\n            \r\n          default:\r\n            return false;\r\n        }\r\n      }\r\n\r\n      // Everything we checked against was valid and had matches - it's a match!\r\n      return true;\r\n    }\r\n  }\r\n}","/// <reference path=\"deadkeys.ts\" />\r\n/// <reference path=\"ruleBehavior.ts\" />\r\n\r\n// Defines classes for handling system stores\r\n/// <reference path=\"systemStores.ts\" />\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\nnamespace com.keyman.text {\r\n  //#region Helper type definitions\r\n\r\n  export class KeyInformation {\r\n    vk: boolean;\r\n    code: number;\r\n    modifiers: number;\r\n  }\r\n\r\n  /*\r\n  * Type alias definitions to reflect the parameters of the fullContextMatch() callback (KMW 10+).\r\n  * No constructors or methods since keyboards will not utilize the same backing prototype, and\r\n  * property names are shorthanded to promote minification.\r\n  */\r\n  type PlainKeyboardStore = string;\r\n\r\n  export type KeyboardStoreElement = (string|StoreNonCharEntry);\r\n  export type ComplexKeyboardStore = KeyboardStoreElement[];\r\n\r\n  type KeyboardStore = PlainKeyboardStore | ComplexKeyboardStore;\r\n\r\n  export type VariableStore = {[name: string]: string};\r\n\r\n  type RuleChar = string;\r\n\r\n  class RuleDeadkey {\r\n    /** Discriminant field - 'd' for Deadkey.\r\n     */\r\n    ['t']: 'd';\r\n\r\n    /**\r\n     * Value:  the deadkey's ID.\r\n     */\r\n    ['d']: number; // For 'd'eadkey; also reflects the Deadkey class's 'd' property.\r\n  }\r\n\r\n  class ContextAny {\r\n    /** Discriminant field - 'a' for `any()`.\r\n     */\r\n    ['t']: 'a';\r\n\r\n    /**\r\n     * Value:  the store to search.\r\n     */\r\n    ['a']: KeyboardStore; // For 'a'ny statement.\r\n\r\n    /**\r\n     * If set to true, negates the 'any'.\r\n     */\r\n    ['n']: boolean|0|1;\r\n  }\r\n\r\n  class RuleIndex {\r\n    /** Discriminant field - 'i' for `index()`.\r\n     */\r\n    ['t']: 'i';\r\n\r\n    /**\r\n     * Value: the Store from which to output\r\n     */\r\n    ['i']: KeyboardStore;\r\n\r\n    /**\r\n     * Offset: the offset in context for the corresponding `any()`.\r\n     */\r\n    ['o']: number;\r\n  }\r\n\r\n  class ContextEx {\r\n    /** Discriminant field - 'c' for `context()`.\r\n     */\r\n    ['t']: 'c';\r\n\r\n    /**\r\n     * Value:  The offset into the current rule's context to be matched.\r\n     */\r\n    ['c']: number; // For 'c'ontext statement.\r\n  }\r\n\r\n  class ContextNul {\r\n    /** Discriminant field - 'n' for `nul`\r\n     */\r\n    ['t']: 'n';\r\n  }\r\n\r\n  class StoreBeep {\r\n    /** Discriminant field - 'b' for `beep`\r\n     */\r\n    ['t']: 'b';\r\n  }\r\n\r\n  type ContextNonCharEntry = RuleDeadkey | ContextAny | RuleIndex | ContextEx | ContextNul;\r\n  type ContextEntry = RuleChar | ContextNonCharEntry;\r\n\r\n  type StoreNonCharEntry = RuleDeadkey | StoreBeep;\r\n\r\n  /**\r\n   * Cache of context storing and retrieving return values from KC\r\n   * Must be reset prior to each keystroke and after any text changes\r\n   * MCD 3/1/14\r\n   **/\r\n  class CachedContext {\r\n    _cache: string[][];\r\n\r\n    reset(): void {\r\n      this._cache = [];\r\n    }\r\n\r\n    get(n: number, ln: number): string {\r\n      // return null; // uncomment this line to disable context caching\r\n      if(typeof this._cache[n] == 'undefined') {\r\n        return null;\r\n      } else if(typeof this._cache[n][ln] == 'undefined') {\r\n        return null;\r\n      }\r\n      return this._cache[n][ln];\r\n    }\r\n\r\n    set(n: number, ln: number, val: string): void {\r\n      if(typeof this._cache[n] == 'undefined') {\r\n        this._cache[n] = [];\r\n      }\r\n      this._cache[n][ln] = val;\r\n    }\r\n  };\r\n\r\n  type CachedExEntry = {valContext: (string|number)[], deadContext: text.Deadkey[]};\r\n  /**\r\n   * An extended version of cached context storing designed to work with\r\n   * `fullContextMatch` and its helper functions.\r\n   */\r\n  class CachedContextEx {\r\n    _cache: CachedExEntry[][];\r\n\r\n    reset(): void {\r\n      this._cache = [];\r\n    }\r\n\r\n    get(n: number, ln: number): CachedExEntry {\r\n      // return null; // uncomment this line to disable context caching\r\n      if(typeof this._cache[n] == 'undefined') {\r\n        return null;\r\n      } else if(typeof this._cache[n][ln] == 'undefined') {\r\n        return null;\r\n      }\r\n      return this._cache[n][ln];\r\n    }\r\n\r\n    set(n: number, ln: number, val: CachedExEntry): void {\r\n      if(typeof this._cache[n] == 'undefined') {\r\n        this._cache[n] = [];\r\n      }\r\n      this._cache[n][ln] = val;\r\n    }\r\n\r\n    clone(): CachedContextEx {\r\n      let r = new CachedContextEx();\r\n      r._cache = this._cache;\r\n      return r;\r\n    }\r\n  };\r\n\r\n  //#endregion\r\n\r\n  export class KeyboardInterface {\r\n    static readonly GLOBAL_NAME = 'KeymanWeb';\r\n\r\n    cachedContext: CachedContext = new CachedContext();\r\n    cachedContextEx: CachedContextEx = new CachedContextEx();\r\n    ruleContextEx: CachedContextEx;\r\n\r\n    activeTargetOutput: OutputTarget;\r\n    ruleBehavior: RuleBehavior;\r\n\r\n    static readonly TSS_LAYER:    number = 33;\r\n    static readonly TSS_PLATFORM: number = 31;\r\n\r\n    systemStores: {[storeID: number]: SystemStore};\r\n\r\n    _AnyIndices:  number[] = [];    // AnyIndex - array of any/index match indices\r\n\r\n    // Must be accessible to some of the keyboard API methods.\r\n    activeKeyboard: keyboards.Keyboard;\r\n    activeDevice: utils.DeviceSpec;\r\n\r\n    variableStoreSerializer?: VariableStoreSerializer;\r\n\r\n    constructor(variableStoreSerializer: VariableStoreSerializer = null) {\r\n      this.systemStores = {};\r\n\r\n      this.systemStores[KeyboardInterface.TSS_PLATFORM] = new PlatformSystemStore(this);\r\n      this.systemStores[KeyboardInterface.TSS_LAYER] = new MutableSystemStore(KeyboardInterface.TSS_LAYER, 'default');\r\n\r\n      this.variableStoreSerializer = variableStoreSerializer;\r\n    }\r\n\r\n    /**\r\n     * Function     KSF\r\n     * Scope        Public\r\n     *\r\n     * Saves the document's current focus settings on behalf of the keyboard.  Often paired with insertText.\r\n     */\r\n    saveFocus(): void { }\r\n\r\n    /**\r\n     * A text-insertion method used by custom OSKs for helpHTML interaction, like with sil_euro_latin.\r\n     *\r\n     * This function currently bypasses web-core's standard text handling control path and all predictive text processing.\r\n     * It also has DOM-dependencies that help ensure KMW's active OutputTarget retains focus during use.\r\n     */\r\n    insertText?: (Ptext: string, PdeadKey: number) => boolean;\r\n\r\n    /**\r\n     * Function     registerKeyboard  KR\r\n     * Scope        Public\r\n     * @param       {Object}      Pk      Keyboard  object\r\n     * Description  Registers a keyboard with KeymanWeb once its script has fully loaded.\r\n     *\r\n     *              In web-core, this also activates the keyboard; in other modules, this method\r\n     *              may be replaced with other implementations.\r\n     */\r\n    registerKeyboard(Pk): void {\r\n      // NOTE:  This implementation is web-core specific and is intentionally replaced, whole-sale,\r\n      //        by DOM-aware code.\r\n      let keyboard = new keyboards.Keyboard(Pk);\r\n      this.activeKeyboard = keyboard;\r\n    }\r\n\r\n    /**\r\n     * Used by DOM-aware KeymanWeb to add keyboard stubs, used by the `KeyboardManager` type\r\n     * to optimize resource use.\r\n     */\r\n    registerStub?: (Pstub) => number;\r\n\r\n    /**\r\n     * Get *cached or uncached* keyboard context for a specified range, relative to caret\r\n     *\r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @param       {Object}      Pelem   Element to work with (must be currently focused element)\r\n     * @return      {string}              Context string\r\n     *\r\n     * Example     [abcdef|ghi] as INPUT, with the caret position marked by |:\r\n     *             KC(2,1,Pelem) == \"e\"\r\n     *             KC(3,3,Pelem) == \"def\"\r\n     *             KC(10,10,Pelem) == \"abcdef\"  i.e. return as much as possible of the requested string\r\n     */\r\n\r\n    context(n: number, ln: number, outputTarget: OutputTarget): string {\r\n      var v = this.cachedContext.get(n, ln);\r\n      if(v !== null) {\r\n        return v;\r\n      }\r\n\r\n      var r = this.KC_(n, ln, outputTarget);\r\n      this.cachedContext.set(n, ln, r);\r\n      return r;\r\n    }\r\n\r\n    /**\r\n     * Get (uncached) keyboard context for a specified range, relative to caret\r\n     *\r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @param       {Object}      Pelem   Element to work with (must be currently focused element)\r\n     * @return      {string}              Context string\r\n     *\r\n     * Example     [abcdef|ghi] as INPUT, with the caret position marked by |:\r\n     *             KC(2,1,Pelem) == \"e\"\r\n     *             KC(3,3,Pelem) == \"def\"\r\n     *             KC(10,10,Pelem) == \"XXXXabcdef\"  i.e. return as much as possible of the requested string, where X = \\uFFFE\r\n     */\r\n    private KC_(n: number, ln: number, outputTarget: OutputTarget): string {\r\n      var tempContext = '';\r\n\r\n      tempContext = outputTarget.getTextBeforeCaret();\r\n\r\n      if(tempContext._kmwLength() < n) {\r\n        tempContext = Array(n-tempContext._kmwLength()+1).join(\"\\uFFFE\") + tempContext;\r\n      }\r\n\r\n      return tempContext._kmwSubstr(-n)._kmwSubstr(0,ln);\r\n    }\r\n\r\n    /**\r\n     * Function     nul           KN\r\n     * Scope        Public\r\n     * @param       {number}      n       Length of context to check\r\n     * @param       {Object}      Ptarg   Element to work with (must be currently focused element)\r\n     * @return      {boolean}             True if length of context is less than or equal to n\r\n     * Description  Test length of context, return true if the length of the context is less than or equal to n\r\n     *\r\n     * Example     [abc|def] as INPUT, with the caret position marked by |:\r\n     *             KN(3,Pelem) == TRUE\r\n     *             KN(2,Pelem) == FALSE\r\n     *             KN(4,Pelem) == TRUE\r\n     */\r\n    nul(n: number, outputTarget: OutputTarget): boolean {\r\n      var cx=this.context(n+1, 1, outputTarget);\r\n\r\n      // With #31, the result will be a replacement character if context is empty.\r\n      return cx === \"\\uFFFE\";\r\n    }\r\n\r\n    /**\r\n     * Function     contextMatch  KCM\r\n     * Scope        Public\r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {Object}      Ptarg   Focused element\r\n     * @param       {string}      val     String to match\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @return      {boolean}             True if selected context matches val\r\n     * Description  Test keyboard context for match\r\n     */\r\n    contextMatch(n: number, outputTarget: OutputTarget, val: string, ln: number): boolean {\r\n      var cx=this.context(n, ln, outputTarget);\r\n      if(cx === val) {\r\n        return true; // I3318\r\n      }\r\n      outputTarget.deadkeys().resetMatched(); // I3318\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Builds the *cached or uncached* keyboard context for a specified range, relative to caret\r\n     *\r\n     * @param       {number}      n       Number of characters to move back from caret\r\n     * @param       {number}      ln      Number of characters to return\r\n     * @param       {Object}      Pelem   Element to work with (must be currently focused element)\r\n     * @return      {Array}               Context array (of strings and numbers)\r\n     */\r\n    private _BuildExtendedContext(n: number, ln: number, outputTarget: OutputTarget): CachedExEntry {\r\n      var cache: CachedExEntry = this.cachedContextEx.get(n, ln);\r\n      if(cache !== null) {\r\n        return cache;\r\n      } else {\r\n        // By far the easiest way to correctly build what we want is to start from the right and work to what we need.\r\n        // We may have done it for a similar cursor position before.\r\n        cache = this.cachedContextEx.get(n, n);\r\n        if(cache === null) {\r\n          // First, let's make sure we have a cloned, sorted copy of the deadkey array.\r\n          let unmatchedDeadkeys = outputTarget.deadkeys().toSortedArray(); // Is reverse-order sorted for us already.\r\n\r\n          // Time to build from scratch!\r\n          var index = 0;\r\n          cache = { valContext: [], deadContext: []};\r\n          while(cache.valContext.length < n) {\r\n            // As adapted from `deadkeyMatch`.\r\n            var sp = outputTarget.getDeadkeyCaret();\r\n            var deadPos = sp - index;\r\n            if(unmatchedDeadkeys.length > 0 && unmatchedDeadkeys[0].p > deadPos) {\r\n              // We have deadkeys at the right-hand side of the caret!  They don't belong in the context, so pop 'em off.\r\n              unmatchedDeadkeys.splice(0, 1);\r\n              continue;\r\n            } else if(unmatchedDeadkeys.length > 0 && unmatchedDeadkeys[0].p == deadPos) {\r\n              // Take the deadkey.\r\n              cache.deadContext[n-cache.valContext.length-1] = unmatchedDeadkeys[0];\r\n              cache.valContext = ([unmatchedDeadkeys[0].d] as (string|number)[]).concat(cache.valContext);\r\n              unmatchedDeadkeys.splice(0, 1);\r\n            } else {\r\n              // Take the character.  We get \"\\ufffe\" if it doesn't exist.\r\n              var kc = this.context(++index, 1, outputTarget);\r\n              cache.valContext = ([kc] as (string|number)[]).concat(cache.valContext);\r\n            }\r\n          }\r\n          this.cachedContextEx.set(n, n, cache);\r\n        }\r\n\r\n        // Now that we have the cache...\r\n        var subCache = cache;\r\n        subCache.valContext = subCache.valContext.slice(0, ln);\r\n        for(var i=0; i < subCache.valContext.length; i++) {\r\n          if(subCache[i] == '\\ufffe') {\r\n            subCache.valContext.splice(0, 1);\r\n            subCache.deadContext.splice(0, 1);\r\n          }\r\n        }\r\n\r\n        if(subCache.valContext.length == 0) {\r\n          subCache.valContext = ['\\ufffe'];\r\n          subCache.deadContext = [];\r\n        }\r\n\r\n        this.cachedContextEx.set(n, ln, subCache);\r\n\r\n        return subCache;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function       fullContextMatch    KFCM\r\n     * Scope          Private\r\n     * @param         {number}    n       Number of characters to move back from caret\r\n     * @param         {Object}    Ptarg   Focused element\r\n     * @param         {Array}     rule    An array of ContextEntries to match.\r\n     * @return        {boolean}           True if the fully-specified rule context matches the current KMW state.\r\n     *\r\n     * A KMW 10+ function designed to bring KMW closer to Keyman Desktop functionality,\r\n     * near-directly modeling (externally) the compiled form of Desktop rules' context section.\r\n     */\r\n    fullContextMatch(n: number, outputTarget: OutputTarget, rule: ContextEntry[]): boolean {\r\n      // Stage one:  build the context index map.\r\n      var fullContext = this._BuildExtendedContext(n, rule.length, outputTarget);\r\n      this.ruleContextEx = this.cachedContextEx.clone();\r\n      var context = fullContext.valContext;\r\n      var deadContext = fullContext.deadContext;\r\n\r\n      var mismatch = false;\r\n\r\n      // This symbol internally indicates lack of context in a position.  (See KC_)\r\n      const NUL_CONTEXT = \"\\uFFFE\";\r\n\r\n      var assertNever = function(x: never): never {\r\n        // Could be accessed by improperly handwritten calls to `fullContextMatch`.\r\n        throw new Error(\"Unexpected object in fullContextMatch specification: \" + x);\r\n      }\r\n\r\n      // Stage two:  time to match against the rule specified.\r\n      for(var i=0; i < rule.length; i++) {\r\n        if(typeof rule[i] == 'string') {\r\n          var str = rule[i] as string;\r\n          if(str !== context[i]) {\r\n            mismatch = true;\r\n            break;\r\n          }\r\n        } else {\r\n          // TypeScript needs a cast to this intermediate type to do its discriminated union magic.\r\n          var r = rule[i] as ContextNonCharEntry;\r\n          switch(r.t) {\r\n            case 'd':\r\n              // We still need to set a flag here;\r\n              if(r['d'] !== context[i]) {\r\n                mismatch = true;\r\n              } else {\r\n                deadContext[i].set();\r\n              }\r\n              break;\r\n            case 'a':\r\n              var lookup: KeyboardStoreElement;\r\n\r\n              if(typeof context[i] == 'string') {\r\n                lookup = context[i] as string;\r\n              } else {\r\n                lookup = {'t': 'd', 'd': context[i] as number};\r\n              }\r\n\r\n              var result = this.any(i, lookup, r.a);\r\n\r\n              if(!r.n) { // If it's a standard 'any'...\r\n                if(!result) {\r\n                  mismatch = true;\r\n                } else if(deadContext[i] !== undefined) {\r\n                  // It's a deadkey match, so indicate that.\r\n                  deadContext[i].set();\r\n                }\r\n                // 'n' for 'notany'.\r\n                // - if `result === true`, `any` would match:  this should thus fail.\r\n                // - if `context[i] === NUL_CONTEXT`, `notany` should not match.\r\n              } else if(r.n && (result || context[i] === NUL_CONTEXT)) {\r\n                mismatch = true;\r\n              }\r\n              break;\r\n            case 'i':\r\n              // The context will never hold a 'beep.'\r\n              var ch = this._Index(r.i, r.o) as string | RuleDeadkey;\r\n\r\n              if(ch !== undefined && (typeof(ch) == 'string' ? ch : ch.d) !== context[i]) {\r\n                mismatch = true;\r\n              } else if(deadContext[i] !== undefined) {\r\n                deadContext[i].set();\r\n              }\r\n              break;\r\n            case 'c':\r\n              if(context[r.c - 1] !== context[i]) {\r\n                mismatch = true;\r\n              } else if(deadContext[i] !== undefined) {\r\n                deadContext[i].set();\r\n              }\r\n              break;\r\n            case 'n':\r\n              // \\uFFFE is the internal 'no context here sentinel'.\r\n              if(context[i] != NUL_CONTEXT) {\r\n                mismatch = true;\r\n              }\r\n              break;\r\n            default:\r\n              assertNever(r);\r\n          }\r\n        }\r\n      }\r\n\r\n      if(mismatch) {\r\n        // Reset the matched 'any' indices, if any.\r\n        outputTarget.deadkeys().resetMatched();\r\n        this._AnyIndices = [];\r\n      }\r\n\r\n      return !mismatch;\r\n    }\r\n\r\n    /**\r\n     * Function     KIK\r\n     * Scope        Public\r\n     * @param       {Object}  e   keystroke event\r\n     * @return      {boolean}     true if keypress event\r\n     * Description  Test if event as a keypress event\r\n     */\r\n    isKeypress(e: KeyEvent): boolean {\r\n      if(this.activeKeyboard.isMnemonic) {   // I1380 - support KIK for positional layouts\r\n        return !e.LisVirtualKey;             // will now return true for U_xxxx keys, but not for T_xxxx keys\r\n      } else {\r\n        return KeyMapping._USKeyCodeToCharCode(e) ? true : false; // I1380 - support KIK for positional layouts\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     keyMatch      KKM\r\n     * Scope        Public\r\n     * @param       {Object}      e           keystroke event\r\n     * @param       {number}      Lruleshift\r\n     * @param       {number}      Lrulekey\r\n     * @return      {boolean}                 True if key matches rule\r\n     * Description  Test keystroke with modifiers against rule\r\n     */\r\n    keyMatch(e: KeyEvent, Lruleshift:number, Lrulekey:number): boolean {\r\n      var retVal = false; // I3318\r\n      var keyCode = (e.Lcode == 173 ? 189 : e.Lcode);  //I3555 (Firefox hyphen issue)\r\n\r\n      let bitmask = this.activeKeyboard.modifierBitmask;\r\n      let Codes = com.keyman.text.Codes;\r\n      var modifierBitmask = bitmask & Codes.modifierBitmasks[\"ALL\"];\r\n      var stateBitmask = bitmask & Codes.stateBitmasks[\"ALL\"];\r\n\r\n      if(e.vkCode > 255) {\r\n        keyCode = e.vkCode; // added to support extended (touch-hold) keys for mnemonic layouts\r\n      }\r\n\r\n      if(e.LisVirtualKey || keyCode > 255) {\r\n        if((Lruleshift & 0x4000) == 0x4000 || (keyCode > 255)) { // added keyCode test to support extended keys\r\n          retVal = ((Lrulekey == keyCode) && ((Lruleshift & modifierBitmask) == e.Lmodifiers)); //I3318, I3555\r\n          retVal = retVal && this.stateMatch(e, Lruleshift & stateBitmask);\r\n        }\r\n      } else if((Lruleshift & 0x4000) == 0) {\r\n        retVal = (keyCode == Lrulekey); // I3318, I3555\r\n      }\r\n      if(!retVal) {\r\n        this.activeTargetOutput.deadkeys().resetMatched();  // I3318\r\n      }\r\n      return retVal; // I3318\r\n    };\r\n\r\n    /**\r\n     * Function     stateMatch    KSM\r\n     * Scope        Public\r\n     * @param       {Object}      e       keystroke event\r\n     * @param       {number}      Lstate\r\n     * Description  Test keystroke against state key rules\r\n     */\r\n    stateMatch(e: KeyEvent, Lstate: number) {\r\n      return ((Lstate & e.Lstates) == Lstate);\r\n    }\r\n\r\n    /**\r\n     * Function     keyInformation  KKI\r\n     * Scope        Public\r\n     * @param       {Object}      e\r\n     * @return      {Object}              Object with event's virtual key flag, key code, and modifiers\r\n     * Description  Get object with extended key event information\r\n     */\r\n    keyInformation(e: KeyEvent): KeyInformation {\r\n      var ei = new KeyInformation();\r\n      ei['vk'] = e.LisVirtualKey;\r\n      ei['code'] = e.Lcode;\r\n      ei['modifiers'] = e.Lmodifiers;\r\n      return ei;\r\n    };\r\n\r\n    /**\r\n     * Function     deadkeyMatch  KDM\r\n     * Scope        Public\r\n     * @param       {number}      n       offset from current cursor position\r\n     * @param       {Object}      Ptarg   target element\r\n     * @param       {number}      d       deadkey\r\n     * @return      {boolean}             True if deadkey found selected context matches val\r\n     * Description  Match deadkey at current cursor position\r\n     */\r\n    deadkeyMatch(n: number, outputTarget: OutputTarget, d: number): boolean {\r\n      return outputTarget.hasDeadkeyMatch(n, d);\r\n    }\r\n\r\n    /**\r\n     * Function     beep          KB\r\n     * Scope        Public\r\n     * @param       {Object}      Pelem     element to flash\r\n     * Description  Flash body as substitute for audible beep; notify embedded device to vibrate\r\n     */\r\n    beep(outputTarget: OutputTarget): void {\r\n      this.resetContextCache();\r\n\r\n      // Denote as part of the matched rule's behavior.\r\n      this.ruleBehavior.beep = true;\r\n    }\r\n\r\n    _ExplodeStore(store: KeyboardStore): ComplexKeyboardStore {\r\n      if(typeof(store) == 'string') {\r\n        let cachedStores = this.activeKeyboard.explodedStores;\r\n\r\n        // Is the result cached?\r\n        if(cachedStores[store]) {\r\n          return cachedStores[store];\r\n        }\r\n\r\n        // Nope, so let's build its cache.\r\n        var result: ComplexKeyboardStore = [];\r\n        for(var i=0; i < store._kmwLength(); i++) {\r\n          result.push(store._kmwCharAt(i));\r\n        }\r\n\r\n        // Cache the result for later!\r\n        cachedStores[store] = result;\r\n        return result;\r\n      } else {\r\n        return store;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     any           KA\r\n     * Scope        Public\r\n     * @param       {number}      n     character position (index)\r\n     * @param       {string}      ch    character to find in string\r\n     * @param       {string}      s     'any' string\r\n     * @return      {boolean}           True if character found in 'any' string, sets index accordingly\r\n     * Description  Test for character matching\r\n     */\r\n    any(n: number, ch: KeyboardStoreElement, s: KeyboardStore): boolean {\r\n      if(ch == '') {\r\n        return false;\r\n      }\r\n\r\n      s = this._ExplodeStore(s);\r\n      var Lix = -1;\r\n      for(var i=0; i < s.length; i++) {\r\n        if(typeof(s[i]) == 'string') {\r\n          if(s[i] == ch) {\r\n            Lix = i;\r\n            break;\r\n          }\r\n        } else if(s[i]['d'] === ch['d']) {\r\n          Lix = i;\r\n          break;\r\n        }\r\n      }\r\n      this._AnyIndices[n] = Lix;\r\n      return Lix >= 0;\r\n    }\r\n\r\n    /**\r\n     * Function     _Index\r\n     * Scope        Public\r\n     * @param       {string}      Ps      string\r\n     * @param       {number}      Pn      index\r\n     * Description  Returns the character from a store string according to the offset in the index array\r\n     */\r\n    _Index(Ps: KeyboardStore, Pn: number): KeyboardStoreElement {\r\n      Ps = this._ExplodeStore(Ps);\r\n\r\n      if(this._AnyIndices[Pn-1] < Ps.length) {   //I3319\r\n        return Ps[this._AnyIndices[Pn-1]];\r\n      } else {\r\n        /* Should not be possible for a compiled keyboard, but may arise\r\n        * during the development of handwritten keyboards.\r\n        */\r\n        console.warn(\"Unmatched contextual index() statement detected in rule with index \" + Pn + \"!\");\r\n        return \"\";\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     indexOutput   KIO\r\n     * Scope        Public\r\n     * @param       {number}      Pdn     no of character to overwrite (delete)\r\n     * @param       {string}      Ps      string\r\n     * @param       {number}      Pn      index\r\n     * @param       {Object}      Pelem   element to output to\r\n     * Description  Output a character selected from the string according to the offset in the index array\r\n     */\r\n    indexOutput(Pdn: number, Ps: KeyboardStore, Pn: number, outputTarget: OutputTarget): void {\r\n      this.resetContextCache();\r\n\r\n      var assertNever = function(x: never): never {\r\n        // Could be accessed by improperly handwritten calls to `fullContextMatch`.\r\n        throw new Error(\"Unexpected object in fullContextMatch specification: \" + x);\r\n      }\r\n\r\n      var indexChar = this._Index(Ps, Pn);\r\n      if(indexChar !== \"\") {\r\n        if(typeof indexChar == 'string' ) {\r\n          this.output(Pdn, outputTarget, indexChar);  //I3319\r\n        } else if(indexChar['t']) {\r\n          var storeEntry = indexChar as StoreNonCharEntry;\r\n\r\n          switch(storeEntry.t) {\r\n            case 'b': // Beep commands may appear within stores.\r\n              this.beep(outputTarget);\r\n              break;\r\n            case 'd':\r\n              this.deadkeyOutput(Pdn, outputTarget, indexChar['d']);\r\n              break;\r\n            default:\r\n              assertNever(storeEntry);\r\n          }\r\n        } else { // For keyboards developed during 10.0's alpha phase - t:'d' was assumed.\r\n          this.deadkeyOutput(Pdn, outputTarget, indexChar['d']);\r\n        }\r\n      }\r\n    }\r\n\r\n\r\n    /**\r\n     * Function     deleteContext KDC\r\n     * Scope        Public\r\n     * @param       {number}      dn      number of context entries to overwrite\r\n     * @param       {Object}      Pelem   element to output to\r\n     * @param       {string}      s       string to output\r\n     * Description  Keyboard output\r\n     */\r\n    deleteContext(dn: number, outputTarget: OutputTarget): void {\r\n      var context: CachedExEntry;\r\n\r\n      // We want to control exactly which deadkeys get removed.\r\n      if(dn > 0) {\r\n        context = this._BuildExtendedContext(dn, dn, outputTarget);\r\n        let nulCount = 0;\r\n\r\n        for(var i=0; i < context.valContext.length; i++) {\r\n          var dk = context.deadContext[i];\r\n\r\n          if(dk) {\r\n            // Remove deadkey in context.\r\n            outputTarget.deadkeys().remove(dk);\r\n\r\n            // Reduce our reported context size.\r\n            dn--;\r\n          } else if(context.valContext[i] == \"\\uFFFE\") {\r\n            // Count any `nul` sentinels that would contribute to our deletion count.\r\n            nulCount++;\r\n          }\r\n        }\r\n\r\n        // Prevent attempts to delete nul sentinels, as they don't exist in the actual context.\r\n        // (Addresses regression from KMW v 12.0 paired with Developer bug through same version)\r\n        let contextLength = context.valContext.length - nulCount;\r\n        if(dn > contextLength) {\r\n          dn = contextLength;\r\n        }\r\n      }\r\n\r\n      // If a matched deadkey hasn't been deleted, we don't WANT to delete it.\r\n      outputTarget.deadkeys().resetMatched();\r\n\r\n      // Why reinvent the wheel?  Delete the remaining characters by 'inserting a blank string'.\r\n      this.output(dn, outputTarget, '');\r\n    }\r\n\r\n    /**\r\n     * Function     output        KO\r\n     * Scope        Public\r\n     * @param       {number}      dn      number of characters to overwrite\r\n     * @param       {Object}      Pelem   element to output to\r\n     * @param       {string}      s       string to output\r\n     * Description  Keyboard output\r\n     */\r\n    output(dn: number, outputTarget: OutputTarget, s:string): void {\r\n      this.resetContextCache();\r\n\r\n      outputTarget.saveProperties();\r\n      outputTarget.clearSelection();\r\n      outputTarget.deadkeys().deleteMatched(); // I3318\r\n      if(dn >= 0) {\r\n        // Automatically manages affected deadkey positions.  Does not delete deadkeys b/c legacy behavior support.\r\n        outputTarget.deleteCharsBeforeCaret(dn);\r\n      }\r\n      // Automatically manages affected deadkey positions.\r\n      outputTarget.insertTextBeforeCaret(s);\r\n      outputTarget.restoreProperties();\r\n    }\r\n\r\n    /**\r\n     * `contextExOutput` function emits the character or object at `contextOffset` from the\r\n     * current matched rule's context. Introduced in Keyman 14.0, in order to resolve a\r\n     * gap between desktop and web core functionality for context(n) matching on notany().\r\n     * See #917 for additional detail.\r\n     * @alias       KCXO\r\n     * @public\r\n     * @param       {number}        Pdn            number of characters to delete left of cursor\r\n     * @param       {OutputTarget}  outputTarget   target to output to\r\n     * @param       {number}        contextLength  length of current rule context to retrieve\r\n     * @param       {number}        contextOffset  offset from start of current rule context, 1-based\r\n     */\r\n    contextExOutput(Pdn: number, outputTarget: OutputTarget, contextLength: number, contextOffset: number): void {\r\n      this.resetContextCache();\r\n\r\n      if(Pdn >= 0) {\r\n        this.output(Pdn, outputTarget, \"\");\r\n      }\r\n\r\n      const context = this.ruleContextEx.get(contextLength, contextLength);\r\n      const dk = context.deadContext[contextOffset-1], vc = context.valContext[contextOffset-1];\r\n      if(dk) {\r\n        outputTarget.insertDeadkeyBeforeCaret(dk.d);\r\n      } else if(typeof vc == 'string') {\r\n        this.output(-1, outputTarget, vc);\r\n      } else {\r\n        throw new Error(\"contextExOutput: should never be a numeric valContext with no corresponding deadContext\");\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     deadkeyOutput KDO\r\n     * Scope        Public\r\n     * @param       {number}      Pdn     no of character to overwrite (delete)\r\n     * @param       {Object}      Pelem   element to output to\r\n     * @param       {number}      Pd      deadkey id\r\n     * Description  Record a deadkey at current cursor position, deleting Pdn characters first\r\n     */\r\n    deadkeyOutput(Pdn: number, outputTarget: OutputTarget, Pd: number): void {\r\n      this.resetContextCache();\r\n\r\n      if(Pdn >= 0) {\r\n        this.output(Pdn, outputTarget,\"\");  //I3318 corrected to >=\r\n      }\r\n\r\n      outputTarget.insertDeadkeyBeforeCaret(Pd);\r\n      //    _DebugDeadKeys(Pelem, 'KDeadKeyOutput: dn='+Pdn+'; deadKey='+Pd);\r\n    }\r\n\r\n    /**\r\n     * KIFS compares the content of a system store with a string value\r\n     *\r\n     * @param       {number}      systemId    ID of the system store to test (only TSS_LAYER currently supported)\r\n     * @param       {string}      strValue    String value to compare to\r\n     * @param       {Object}      Pelem       Currently active element (may be needed by future tests)\r\n     * @return      {boolean}                 True if the test succeeds\r\n     */\r\n    ifStore(systemId: number, strValue: string, outputTarget: OutputTarget): boolean {\r\n      var result=true;\r\n      let store = this.systemStores[systemId];\r\n      if(store) {\r\n        result = store.matches(strValue);\r\n      }\r\n      return result; //Moved from previous line, now supports layer selection, Build 350\r\n    }\r\n\r\n    /**\r\n     * KSETS sets the value of a system store to a string\r\n     *\r\n     * @param       {number}      systemId    ID of the system store to set (only TSS_LAYER currently supported)\r\n     * @param       {string}      strValue    String to set as the system store content\r\n     * @param       {Object}      Pelem       Currently active element (may be needed in future tests)\r\n     * @return      {boolean}                 True if command succeeds\r\n     *                                        (i.e. for TSS_LAYER, if the layer is successfully selected)\r\n     *\r\n     * Note that option/variable stores are instead set within keyboard script code, as they only\r\n     * affect keyboard behavior.\r\n     */\r\n    setStore(systemId: number, strValue: string, outputTarget: OutputTarget): boolean {\r\n      this.resetContextCache();\r\n      if(systemId == KeyboardInterface.TSS_LAYER) {\r\n        // Denote the changed store as part of the matched rule's behavior.\r\n        this.ruleBehavior.setStore[systemId] = strValue;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Load an option store value from a cookie or default value\r\n     *\r\n     * @param       {string}      kbdName     keyboard internal name\r\n     * @param       {string}      storeName   store (option) name, embedded in cookie name\r\n     * @param       {string}      dfltValue   default value\r\n     * @return      {string}                  current or default option value\r\n     *\r\n     * This will only ever be called when the keyboard is loaded, as it is used by keyboards\r\n     * to initialize a store value on the keyboard's script object.\r\n     */\r\n    loadStore(kbdName: string, storeName:string, dfltValue:string): string {\r\n      this.resetContextCache();\r\n      if(this.variableStoreSerializer) {\r\n        let cValue = this.variableStoreSerializer.loadStore(kbdName, storeName);\r\n        return cValue[storeName] || dfltValue;\r\n      } else {\r\n        return dfltValue;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Save an option store value to a cookie\r\n     *\r\n     * @param       {string}      storeName   store (option) name, embedded in cookie name\r\n     * @param       {string}      optValue    option value to save\r\n     * @return      {boolean}                 true if save successful\r\n     *\r\n     * Note that a keyboard will freely manipulate the value of its variable stores on the\r\n     * script object within its own code.  This function's use is merely to _persist_ that\r\n     * value across sessions, providing a custom user default for later uses of the keyboard.\r\n     */\r\n    saveStore(storeName:string, optValue:string): boolean {\r\n      this.resetContextCache();\r\n      var kbd=this.activeKeyboard;\r\n      if(!kbd || typeof kbd.id == 'undefined' || kbd.id == '') {\r\n        return false;\r\n      }\r\n\r\n      // And the lookup under that entry looks for the value under the store name, again.\r\n      let valueObj: VariableStore = {};\r\n      valueObj[storeName] = optValue;\r\n\r\n      // Null-check in case of invocation during unit-test\r\n      if(this.ruleBehavior) {\r\n        this.ruleBehavior.saveStore[storeName] = valueObj;\r\n      } else {\r\n        // We're in a unit-test environment, directly invoking this method from outside of a keyboard.\r\n        // In this case, we should immediately commit the change.\r\n        this.variableStoreSerializer.saveStore(this.activeKeyboard.id, storeName, valueObj);\r\n      }\r\n      return true;\r\n    }\r\n\r\n    resetContextCache(): void {\r\n      this.cachedContext.reset();\r\n      this.cachedContextEx.reset();\r\n    }\r\n\r\n    defaultBackspace(outputTarget: OutputTarget) {\r\n      this.output(1, outputTarget, \"\");\r\n    }\r\n\r\n    /**\r\n     * Function     processKeystroke\r\n     * Scope        Private\r\n     * @param       {Object}        element     The page element receiving input\r\n     * @param       {Object}        keystroke   The input keystroke (with its properties) to be mapped by the keyboard.\r\n     * Description  Encapsulates calls to keyboard input processing.\r\n     * @returns     {number}        0 if no match is made, otherwise 1.\r\n     */\r\n    processKeystroke(outputTarget: OutputTarget, keystroke: KeyEvent): RuleBehavior {\r\n      // Clear internal state tracking data from prior keystrokes.\r\n      if(!outputTarget) {\r\n        throw \"No target specified for keyboard output!\";\r\n      } else if(!this.activeKeyboard) {\r\n        throw \"No active keyboard for keystroke processing!\";\r\n      }\r\n\r\n      outputTarget.invalidateSelection();\r\n\r\n      outputTarget.deadkeys().resetMatched();       // I3318\r\n      this.resetContextCache();\r\n\r\n      // Capture the initial state of the OutputTarget before any rules are matched.\r\n      let preInput = Mock.from(outputTarget);\r\n\r\n      // Capture the initial state of any variable stores\r\n      const cachedVariableStores = this.activeKeyboard.variableStores;\r\n\r\n      // Establishes the results object, allowing corresponding commands to set values here as appropriate.\r\n      this.ruleBehavior = new RuleBehavior();\r\n\r\n      // Ensure the settings are in place so that KIFS/ifState activates and deactivates\r\n      // the appropriate rule(s) for the modeled device.\r\n      this.activeDevice = keystroke.device;\r\n\r\n      // Calls the start-group of the active keyboard.\r\n      this.activeTargetOutput = outputTarget;\r\n      var matched = this.activeKeyboard.process(outputTarget, keystroke);\r\n      this.activeTargetOutput = null;\r\n\r\n      // Finalize the rule's results.\r\n      this.ruleBehavior.transcription = outputTarget.buildTranscriptionFrom(preInput, keystroke);\r\n\r\n      // We always backup the changes to variable stores to the RuleBehavior, to\r\n      // be applied during finalization, then restore them to the cached initial\r\n      // values to avoid side-effects with predictive text mocks.\r\n      this.ruleBehavior.variableStores = this.activeKeyboard.variableStores;\r\n      this.activeKeyboard.variableStores = cachedVariableStores;\r\n\r\n      // `matched` refers to whether or not the FINAL rule (from any group) matched, rather than\r\n      // whether or not ANY rule matched.  If the final rule doesn't match, we trigger the key's\r\n      // default behavior (if appropriate).\r\n      //\r\n      // See https://github.com/keymanapp/keyman/pull/4350#issuecomment-768753852\r\n      this.ruleBehavior.triggerKeyDefault = !matched;\r\n\r\n      // Clear our result-tracking variable to prevent any possible pollution for future processing.\r\n      let behavior = this.ruleBehavior;\r\n      this.ruleBehavior = null;\r\n\r\n      return behavior;\r\n    }\r\n\r\n    /**\r\n     * Applies the dictionary of variable store values to the active keyboard\r\n     *\r\n     * Has no effect on keyboards compiled with 14.0 or earlier; system store\r\n     * names are not exposed unless compiled with Developer 15.0 or later.\r\n     *\r\n     * @param stores A dictionary of stores which should be found in the\r\n     *               keyboard\r\n     */\r\n    applyVariableStores(stores: com.keyman.keyboards.VariableStoreDictionary): void {\r\n      this.activeKeyboard.variableStores = stores;\r\n    }\r\n\r\n    /**\r\n     * Publishes the KeyboardInterface's shorthand API names.  As this assigns the current functions\r\n     * held by the longform versions, note that this should be called after replacing any of them via\r\n     * JS method extension.\r\n     *\r\n     * DOM-aware KeymanWeb should call this after its domKbdInterface.ts code is loaded, as it replaces\r\n     * a few.  (This is currently done within its kmwapi.ts.)\r\n     */\r\n    static __publishShorthandAPI() {\r\n      // Keyboard callbacks\r\n      let prototype = this.prototype;\r\n\r\n      var exportKBCallback = function(miniName: string, longName: string) {\r\n        prototype[miniName] = prototype[longName];\r\n      }\r\n\r\n      exportKBCallback('KSF', 'saveFocus');\r\n      exportKBCallback('KBR', 'beepReset');\r\n      exportKBCallback('KT', 'insertText');\r\n      exportKBCallback('KR', 'registerKeyboard');\r\n      exportKBCallback('KRS', 'registerStub');\r\n      exportKBCallback('KC', 'context');\r\n      exportKBCallback('KN', 'nul');\r\n      exportKBCallback('KCM', 'contextMatch');\r\n      exportKBCallback('KFCM', 'fullContextMatch');\r\n      exportKBCallback('KIK', 'isKeypress');\r\n      exportKBCallback('KKM', 'keyMatch');\r\n      exportKBCallback('KSM', 'stateMatch');\r\n      exportKBCallback('KKI', 'keyInformation');\r\n      exportKBCallback('KDM', 'deadkeyMatch');\r\n      exportKBCallback('KB', 'beep');\r\n      exportKBCallback('KA', 'any');\r\n      exportKBCallback('KDC', 'deleteContext');\r\n      exportKBCallback('KO', 'output');\r\n      exportKBCallback('KDO', 'deadkeyOutput');\r\n      exportKBCallback('KCXO', 'contextExOutput');\r\n      exportKBCallback('KIO', 'indexOutput');\r\n      exportKBCallback('KIFS', 'ifStore');\r\n      exportKBCallback('KSETS', 'setStore');\r\n      exportKBCallback('KLOAD', 'loadStore');\r\n      exportKBCallback('KSAVE', 'saveStore');\r\n    }\r\n  }\r\n\r\n  (function() {\r\n    // This will be the only call within the keyboard-processor module.\r\n    KeyboardInterface.__publishShorthandAPI();\r\n  }());\r\n}","/// <reference path=\"defaultLayouts.ts\" />\r\n/// <reference path=\"activeLayout.ts\" />\r\n/// <reference path=\"../text/kbdInterface.ts\" />\r\n\r\nnamespace com.keyman.keyboards {\r\n  /**\r\n   * Stores preprocessed properties of a keyboard for quick retrieval later.\r\n   */\r\n  class CacheTag {\r\n    stores: {[storeName: string]: text.ComplexKeyboardStore};\r\n\r\n    constructor() {\r\n      this.stores = {};\r\n    }\r\n  }\r\n\r\n  export enum LayoutState {\r\n    NOT_LOADED = undefined,\r\n    POLYFILLED = 1,\r\n    CALIBRATED = 2\r\n  }\r\n\r\n  export interface VariableStoreDictionary {\r\n    [name: string]: string;\r\n  };\r\n\r\n\r\n  /**\r\n   * Acts as a wrapper class for Keyman keyboards compiled to JS, providing type information\r\n   * and keyboard-centered functionality in an object-oriented way without modifying the\r\n   * wrapped keyboard itself.\r\n   */\r\n  export class Keyboard {\r\n    public static DEFAULT_SCRIPT_OBJECT = {\r\n      'gs': function(outputTarget, keystroke) { return false; }, // no matching rules; rely on defaultRuleOutput entirely\r\n      'KI': '', // The currently-existing default keyboard ID; we already have checks that focus against this.\r\n      'KN': '',\r\n      'KV': Layouts.DEFAULT_RAW_SPEC,\r\n      'KM': 0 // May not be the best default, but this matches current behavior when there is no activeKeyboard.\r\n    }\r\n\r\n    /**\r\n     * This is the object provided to KeyboardInterface.registerKeyboard - that is, the keyboard\r\n     * being wrapped.\r\n     *\r\n     * TODO:  Make this private instead.  But there are a LOT of references that must be rooted out first.\r\n     */\r\n    public readonly scriptObject: any;\r\n    private layoutStates: {[layout: string]: LayoutState};\r\n\r\n    constructor(keyboardScript: any) {\r\n      if(keyboardScript) {\r\n        this.scriptObject = keyboardScript;\r\n      } else {\r\n        this.scriptObject = Keyboard.DEFAULT_SCRIPT_OBJECT;\r\n      }\r\n      this.layoutStates = {};\r\n    }\r\n\r\n    /**\r\n     * Calls the keyboard's `gs` function, which represents the keyboard source's group(main).\r\n     */\r\n    process(outputTarget: text.OutputTarget, keystroke: text.KeyEvent): boolean {\r\n      return this.scriptObject['gs'](outputTarget, keystroke);\r\n    }\r\n\r\n    get isHollow(): boolean {\r\n      return this.scriptObject == Keyboard.DEFAULT_SCRIPT_OBJECT;\r\n    }\r\n\r\n    get id(): string {\r\n      return this.scriptObject['KI'];\r\n    }\r\n\r\n    get name(): string {\r\n      return this.scriptObject['KN'];\r\n    }\r\n\r\n    /**\r\n     * Cache variable store values\r\n     *\r\n     * Primarily used for predictive text to prevent variable store\r\n     * values from being changed in 'fat finger' processing.\r\n     *\r\n     * KVS is available in keyboards compiled with Keyman Developer 15\r\n     * and later versions. See #2924.\r\n     *\r\n     * @returns an object with each property referencing a variable store\r\n     */\r\n    get variableStores(): VariableStoreDictionary {\r\n      const storeNames = this.scriptObject['KVS'];\r\n      let values = {};\r\n      if(Array.isArray(storeNames)) {\r\n        for(let store of storeNames) {\r\n          values[store] = this.scriptObject[store];\r\n        }\r\n      }\r\n      return values;\r\n    }\r\n\r\n    /**\r\n     * Restore variable store values from cache\r\n     *\r\n     * KVS is available in keyboards compiled with Keyman Developer 15\r\n     * and later versions. See #2924.\r\n     *\r\n     * @param values  name-value pairs for each store value\r\n     */\r\n    set variableStores(values: VariableStoreDictionary) {\r\n      const storeNames = this.scriptObject['KVS'];\r\n      if(Array.isArray(storeNames)) {\r\n        for(let store of storeNames) {\r\n          // If the value is not present in the cache, don't overwrite it;\r\n          // while this is not used in initial implementation, we could use\r\n          // it in future to update a single variable store value rather than\r\n          // the whole cache.\r\n          if(typeof values[store] == 'string') {\r\n            this.scriptObject[store] = values[store];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // TODO:  Better typing.\r\n    private get _legacyLayoutSpec(): any {\r\n      return this.scriptObject['KV'];  // used with buildDefaultLayout; layout must be constructed at runtime.\r\n    }\r\n\r\n    // May return null if no layouts exist or have been initialized.\r\n    private get _layouts(): {[formFactor: string]: LayoutFormFactor} {\r\n      return this.scriptObject['KVKL'];  // This one is compiled by Developer's visual keyboard layout editor.\r\n    }\r\n\r\n    private set _layouts(value) {\r\n      this.scriptObject['KVKL'] = value;\r\n    }\r\n\r\n    get compilerVersion(): utils.Version {\r\n      return new utils.Version(this.scriptObject['KVER']);\r\n    }\r\n\r\n    get isMnemonic(): boolean {\r\n      return !!this.scriptObject['KM'];\r\n    }\r\n\r\n    get definesPositionalOrMnemonic(): boolean {\r\n      return typeof this.scriptObject['KM'] != 'undefined';\r\n    }\r\n\r\n    /**\r\n     * HTML help text, as specified by either the &kmw_helptext or &kmw_helpfile system stores.\r\n     *\r\n     * Reference: https://help.keyman.com/developer/language/reference/kmw_helptext,\r\n     *            https://help.keyman.com/developer/language/reference/kmw_helpfile\r\n     */\r\n    get helpText(): string {\r\n      return this.scriptObject['KH'];\r\n    }\r\n\r\n    /**\r\n     * Embedded JS script designed for use with a keyboard's HTML help text.  Always defined\r\n     * within the file referenced by &kmw_embedjs in a keyboard's source, though that file\r\n     * may also contain _other_ script definitions as well.  (`KHF` must be explicitly defined\r\n     * within that file.)\r\n     */\r\n    get hasScript(): boolean {\r\n      return !!this.scriptObject['KHF'];\r\n    }\r\n\r\n    /**\r\n     * Embeds a custom script for use by the OSK, which may be interactive (like with sil_euro_latin).\r\n     * Note:  this must be called AFTER any contents of `helpText` have been inserted into the DOM.\r\n     * (See sil_euro_latin's source -> sil_euro_latin_js.txt)\r\n     *\r\n     * Reference: https://help.keyman.com/developer/language/reference/kmw_embedjs\r\n     */\r\n    embedScript(e: any) {\r\n      // e:  Expects the OSKManager's _Box element.  We don't add type info here b/c it would\r\n      //     reference the DOM.\r\n      this.scriptObject['KHF'](e);\r\n    }\r\n\r\n    get oskStyling(): string {\r\n      return this.scriptObject['KCSS'];\r\n    }\r\n\r\n    /**\r\n     * true if this keyboard uses a (legacy) pick list (Chinese, Japanese, Korean, etc.)\r\n     *\r\n     * TODO:  Make a property on keyboards (say, `isPickList` / `KPL`) to signal this when we\r\n     *        get around to better, generalized picker-list support.\r\n     */\r\n    get isCJK(): boolean { // I3363 (Build 301)\r\n      var lg: string;\r\n      if(typeof(this.scriptObject['KLC']) != 'undefined') {\r\n        lg = this.scriptObject['KLC'];\r\n      } else if(typeof(this.scriptObject['LanguageCode']) != 'undefined') {\r\n        lg = this.scriptObject['LanguageCode'];\r\n      }\r\n\r\n      // While some of these aren't proper BCP-47 language codes, the CJK keyboards predate our use of BCP-47.\r\n      // So, we preserve the old ISO 639-3 codes, as that's what the keyboards are matching against.\r\n      return ((lg == 'cmn') || (lg == 'jpn') || (lg == 'kor'));\r\n    }\r\n\r\n    get isRTL(): boolean {\r\n      return !!this.scriptObject['KRTL'];\r\n    }\r\n\r\n    /**\r\n     * Obtains the currently-active modifier bitmask for the active keyboard.\r\n     */\r\n    get modifierBitmask(): number {\r\n      // NON_CHIRAL is the default bitmask if KMBM is not defined.\r\n      // We always need a bitmask to compare against, as seen in `isChiral`.\r\n      return this.scriptObject['KMBM'] || text.Codes.modifierBitmasks['NON_CHIRAL'];\r\n    }\r\n\r\n    get isChiral(): boolean {\r\n      return !!(this.modifierBitmask & text.Codes.modifierBitmasks['IS_CHIRAL']);\r\n    }\r\n\r\n    get desktopFont(): string {\r\n      if(this.scriptObject['KV']) {\r\n        return this.scriptObject['KV']['F'];\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    private get cacheTag(): CacheTag {\r\n      let tag = this.scriptObject['_kmw'];\r\n\r\n      if(!tag) {\r\n        tag = new CacheTag();\r\n        this.scriptObject['_kmw'] = tag;\r\n      }\r\n\r\n      return tag;\r\n    }\r\n\r\n    get explodedStores(): {[storeName: string]: text.ComplexKeyboardStore} {\r\n      return this.cacheTag.stores;\r\n    }\r\n\r\n    /**\r\n     * Signifies whether or not a layout or OSK should include AltGr / Right-alt emulation for this keyboard.\r\n     * @param   {Object=}   keyLabels\r\n     * @return  {boolean}\r\n     */\r\n    get emulatesAltGr(): boolean {\r\n      let modifierCodes = text.Codes.modifierCodes;\r\n\r\n      // If we're not chiral, we're not emulating.\r\n      if(!this.isChiral) {\r\n        return false;\r\n      }\r\n\r\n      if(this._legacyLayoutSpec == null) {\r\n        return false;\r\n      }\r\n\r\n      // Only exists in KMW 10.0+, but before that Web had no chirality support, so... return false.\r\n      let layers = this._legacyLayoutSpec['KLS'];\r\n      if(!layers) {\r\n        return false;\r\n      }\r\n\r\n      var emulationMask = modifierCodes['LCTRL'] | modifierCodes['LALT'];\r\n      var unshiftedEmulationLayer = layers[Layouts.getLayerId(emulationMask)];\r\n      var shiftedEmulationLayer = layers[Layouts.getLayerId(modifierCodes['SHIFT'] | emulationMask)];\r\n\r\n      // buildDefaultLayout ensures that these are aliased to the original modifier set being emulated.\r\n      // As a result, we can directly test for reference equality.\r\n      //\r\n      // This allows us to still return `true` after creating the layers for emulation; during keyboard\r\n      // construction, the two layers should be null for AltGr emulation to succeed.\r\n      if(unshiftedEmulationLayer != null &&\r\n          unshiftedEmulationLayer != layers[Layouts.getLayerId(modifierCodes['RALT'])]) {\r\n        return false;\r\n      }\r\n\r\n      if(shiftedEmulationLayer != null &&\r\n          shiftedEmulationLayer != layers[Layouts.getLayerId(modifierCodes['RALT'] | modifierCodes['SHIFT'])]) {\r\n        return false;\r\n      }\r\n\r\n      // It's technically possible for the OSK to not specify anything while allowing chiral input.  A last-ditch catch:\r\n      var bitmask = this.modifierBitmask;\r\n      if((bitmask & emulationMask) != emulationMask) {\r\n        // At least one of the emulation modifiers is never used by the keyboard!  We can confirm everything's safe.\r\n        return true;\r\n      }\r\n\r\n      if(unshiftedEmulationLayer == null && shiftedEmulationLayer == null) {\r\n        // We've run out of things to go on; we can't detect if chiral AltGr emulation is intended or not.\r\n        // TODO:  handle this again!\r\n        // if(!osk.altGrWarning) {\r\n        //   console.warn(\"Could not detect if AltGr emulation is safe, but defaulting to active emulation!\")\r\n        //   // Avoid spamming the console with warnings on every call of the method.\r\n        //   osk.altGrWarning = true;\r\n        // }\r\n        return true;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    get usesSupplementaryPlaneChars(): boolean {\r\n      let kbd = this.scriptObject;\r\n      // I3319 - SMP extension, I3363 (Build 301)\r\n      return kbd && ((kbd['KS'] && kbd['KS'] == 1) || kbd['KN'] == 'Hieroglyphic');\r\n    }\r\n\r\n    usesDesktopLayoutOnDevice(device: utils.DeviceSpec) {\r\n      if(this.scriptObject['KVKL']) {\r\n        // A custom mobile layout is defined... but are we using it?\r\n        return device.formFactor == utils.FormFactor.Desktop;\r\n      } else {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * @param       {number}    _PCommand     event code (16,17,18) or 0\r\n     * @param       {Object}    _PTarget      target element\r\n     * @param       {number}    _PData        1 or 0\r\n     * Notifies keyboard of keystroke or other event\r\n     */\r\n    notify(_PCommand: number, _PTarget: text.OutputTarget, _PData: number) { // I2187\r\n      // Good example use case - the Japanese CJK-picker keyboard\r\n      if(typeof(this.scriptObject['KNS']) == 'function') {\r\n        this.scriptObject['KNS'](_PCommand, _PTarget, _PData);\r\n      }\r\n    }\r\n\r\n    private findOrConstructLayout(formFactor: utils.FormFactor): LayoutFormFactor {\r\n      if(this._layouts) {\r\n        // Search for viable layouts.  `null` is allowed for desktop form factors when help text is available,\r\n        // so we check explicitly against `undefined`.\r\n        if(this._layouts[formFactor] !== undefined) {\r\n          return this._layouts[formFactor];\r\n        } else if(formFactor == utils.FormFactor.Phone && this._layouts[utils.FormFactor.Tablet]) {\r\n          return this._layouts[utils.FormFactor.Phone] = this._layouts[utils.FormFactor.Tablet];\r\n        } else if(formFactor == utils.FormFactor.Tablet && this._layouts[utils.FormFactor.Phone]) {\r\n          return this._layouts[utils.FormFactor.Tablet] = this._layouts[utils.FormFactor.Phone];\r\n        }\r\n      }\r\n\r\n      // No pre-built layout available; time to start constructing it via defaults.\r\n      // First, if we have non-default keys specified by the ['BK'] array, we've got\r\n      // enough to work with to build a default layout.\r\n      let rawSpecifications: any = null;  // TODO:  better typing, same type as this._legacyLayoutSpec.\r\n      if(this._legacyLayoutSpec != null && this._legacyLayoutSpec['KLS']) { // KLS is only specified whenever there are non-default keys.\r\n        rawSpecifications = this._legacyLayoutSpec;\r\n      } else if(this._legacyLayoutSpec != null && this._legacyLayoutSpec['BK'] != null) {\r\n        var keyCaps=this._legacyLayoutSpec['BK'];\r\n        for(var i=0; i<keyCaps.length; i++) {\r\n          if(keyCaps[i].length > 0) {\r\n            rawSpecifications = this._legacyLayoutSpec;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      // If we don't have key definitions to use for a layout but also lack help text or are a touch-based layout,\r\n      // we make a default layout anyway.  We have to show display something usable.\r\n      if(!rawSpecifications && (this.helpText == '' || formFactor != utils.FormFactor.Desktop)) {\r\n        rawSpecifications = {'F':'Tahoma', 'BK': Layouts.dfltText};\r\n      }\r\n\r\n      // Regardless of success, we'll want to initialize the field that backs the property;\r\n      // may as well cache the default layout we just built, or a 'null' if it shouldn't exist..\r\n      if(!this._layouts) {\r\n        this._layouts = {};\r\n      }\r\n\r\n      // Final check - do we construct a layout, or is this a case where helpText / insertHelpHTML should take over?\r\n      if(rawSpecifications) {\r\n        // Now to generate a layout from our raw specifications.\r\n        let layout = this._layouts[formFactor] = Layouts.buildDefaultLayout(rawSpecifications, this, formFactor);\r\n        layout.isDefault = true;\r\n        return layout;\r\n      } else {\r\n        // The fact that it doesn't exist will indicate that help text/HTML should be inserted instead.\r\n        this._layouts[formFactor] = null; // provides a cached value for the check at the top of this method.\r\n        return null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Returns an ActiveLayout object representing the keyboard's layout for this form factor.  May return null if a custom desktop \"help\" OSK is defined, as with sil_euro_latin.\r\n     *\r\n     * In such cases, please use either `helpText` or `insertHelpHTML` instead.\r\n     * @param formFactor {string} The desired form factor for the layout.\r\n     */\r\n    public layout(formFactor: utils.FormFactor): ActiveLayout {\r\n      let rawLayout = this.findOrConstructLayout(formFactor);\r\n\r\n      if(rawLayout) {\r\n        // Prevents accidentally reprocessing layouts; it's a simple enough check.\r\n        if(this.layoutStates[formFactor] == LayoutState.NOT_LOADED) {\r\n          rawLayout = ActiveLayout.polyfill(rawLayout, this, formFactor);\r\n          this.layoutStates[formFactor] = LayoutState.POLYFILLED;\r\n        }\r\n\r\n        return rawLayout as ActiveLayout;\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    public refreshLayouts() {\r\n      let formFactors = [ utils.FormFactor.Desktop, utils.FormFactor.Phone, utils.FormFactor.Tablet ];\r\n\r\n      let _this = this;\r\n\r\n      formFactors.forEach(function(form) {\r\n        // Currently doesn't work if we reset it to POLYFILLED, likely due to how 'calibration'\r\n        // currently works.\r\n        _this.layoutStates[form] = LayoutState.NOT_LOADED;\r\n      });\r\n    }\r\n\r\n    public markLayoutCalibrated(formFactor: utils.FormFactor) {\r\n      if(this.layoutStates[formFactor] != LayoutState.NOT_LOADED) {\r\n        this.layoutStates[formFactor] = LayoutState.CALIBRATED;\r\n      }\r\n    }\r\n\r\n    public getLayoutState(formFactor: utils.FormFactor) {\r\n      return this.layoutStates[formFactor];\r\n    }\r\n  }\r\n}","/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\nnamespace com.keyman {\r\n\r\n  class KeyMap {\r\n    [keycode: string]: number;\r\n  }\r\n\r\n  class BrowserKeyMaps {\r\n    FF:     KeyMap = new KeyMap();\r\n    Safari: KeyMap = new KeyMap();\r\n    Opera:  KeyMap = new KeyMap();\r\n\r\n    constructor() {\r\n      // All three have been around since at least May 2014 / FF 29.\r\n      // It'd hard to find precise history, but at least that much has been confirmed.\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode, on Feb 26 2021.\r\n      this.FF['k61'] = 187;  // =   // FF 2.0\r\n      this.FF['k59'] = 186;  // ;\r\n      this.FF['k173'] = 189; // -/_\r\n    }\r\n  }\r\n\r\n  class LanguageKeyMaps {\r\n    [languageCode: string]: KeyMap;\r\n\r\n    // // Here are some old legacy definitions that were no longer referenced but are likely related:\r\n    // static _BaseLayoutEuro: {[code: string]: string} = {\r\n    //   'se': '\\u00a71234567890+´~~~QWERTYUIOP\\u00c5\\u00a8\\'~~~ASDFGHJKL\\u00d6\\u00c4~~~~~<ZXCVBNM,.-~~~~~ ',  // Swedish\r\n    //   'uk': '`1234567890-=~~~QWERTYUIOP[]#~~~ASDFGHJKL;\\'~~~~~\\\\ZXCVBNM,./~~~~~ ' // UK\r\n\r\n    constructor() {\r\n      /* I732 START - 13/03/2007 MCD: Swedish: Start mapping of keystroke to US keyboard #2 */\r\n      // Swedish key map\r\n      this['se'] = new KeyMap();\r\n      this['se']['k220'] =  192; // `\r\n      this['se']['k187'] =  189; // -\r\n      this['se']['k219'] =  187; // =\r\n      this['se']['k221'] =  219; // [\r\n      this['se']['k186'] =  221; // ]\r\n      this['se']['k191'] =  220; // \\\r\n      this['se']['k192'] =  186; // ;\r\n      this['se']['k189'] =  191; // /\r\n\r\n      this['uk'] = new KeyMap();  // I1299\r\n      this['uk']['k223'] =  192; // // ` U+00AC (logical not) =>  ` ~\r\n      this['uk']['k192'] =  222; // ' @  =>  ' \"\r\n      this['uk']['k222'] =  226; // # ~  => K_oE2     // I1504 - UK keyboard mixup #, \\\r\n      this['uk']['k220'] =  220; // \\ |  => \\ |       // I1504 - UK keyboard mixup #, \\\r\n    }\r\n  }\r\n\r\n  export class KeyMapping {\r\n    static readonly browserMap: BrowserKeyMaps = new BrowserKeyMaps();\r\n    static readonly languageMap: LanguageKeyMaps = new LanguageKeyMaps();\r\n\r\n    private static _usCharCodes: KeyMap[];\r\n\r\n    private constructor() {\r\n      // Do not construct this class.\r\n    }\r\n\r\n    private static _usCodeInit() {\r\n      var s0=new KeyMap(),s1=new KeyMap();\r\n\r\n      s0['k192'] = 96;\r\n      s0['k49'] = 49;\r\n      s0['k50'] = 50;\r\n      s0['k51'] = 51;\r\n      s0['k52'] = 52;\r\n      s0['k53'] = 53;\r\n      s0['k54'] = 54;\r\n      s0['k55'] = 55;\r\n      s0['k56'] = 56;\r\n      s0['k57'] = 57;\r\n      s0['k48'] = 48;\r\n      s0['k189'] = 45;\r\n      s0['k187'] = 61;\r\n      s0['k81'] = 113;\r\n      s0['k87'] = 119;\r\n      s0['k69'] = 101;\r\n      s0['k82'] = 114;\r\n      s0['k84'] = 116;\r\n      s0['k89'] = 121;\r\n      s0['k85'] = 117;\r\n      s0['k73'] = 105;\r\n      s0['k79'] = 111;\r\n      s0['k80'] = 112;\r\n      s0['k219'] = 91;\r\n      s0['k221'] = 93;\r\n      s0['k220'] = 92;\r\n      s0['k65'] = 97;\r\n      s0['k83'] = 115;\r\n      s0['k68'] = 100;\r\n      s0['k70'] = 102;\r\n      s0['k71'] = 103;\r\n      s0['k72'] = 104;\r\n      s0['k74'] = 106;\r\n      s0['k75'] = 107;\r\n      s0['k76'] = 108;\r\n      s0['k186'] = 59;\r\n      s0['k222'] = 39;\r\n      s0['k90'] = 122;\r\n      s0['k88'] = 120;\r\n      s0['k67'] = 99;\r\n      s0['k86'] = 118;\r\n      s0['k66'] = 98;\r\n      s0['k78'] = 110;\r\n      s0['k77'] = 109;\r\n      s0['k188'] = 44;\r\n      s0['k190'] = 46;\r\n      s0['k191'] = 47;\r\n\r\n      s1['k192'] = 126;\r\n      s1['k49'] = 33;\r\n      s1['k50'] = 64;\r\n      s1['k51'] = 35;\r\n      s1['k52'] = 36;\r\n      s1['k53'] = 37;\r\n      s1['k54'] = 94;\r\n      s1['k55'] = 38;\r\n      s1['k56'] = 42;\r\n      s1['k57'] = 40;\r\n      s1['k48'] = 41;\r\n      s1['k189'] = 95;\r\n      s1['k187'] = 43;\r\n      s1['k81'] = 81;\r\n      s1['k87'] = 87;\r\n      s1['k69'] = 69;\r\n      s1['k82'] = 82;\r\n      s1['k84'] = 84;\r\n      s1['k89'] = 89;\r\n      s1['k85'] = 85;\r\n      s1['k73'] = 73;\r\n      s1['k79'] = 79;\r\n      s1['k80'] = 80;\r\n      s1['k219'] = 123;\r\n      s1['k221'] = 125;\r\n      s1['k220'] = 124;\r\n      s1['k65'] = 65;\r\n      s1['k83'] = 83;\r\n      s1['k68'] = 68;\r\n      s1['k70'] = 70;\r\n      s1['k71'] = 71;\r\n      s1['k72'] = 72;\r\n      s1['k74'] = 74;\r\n      s1['k75'] = 75;\r\n      s1['k76'] = 76;\r\n      s1['k186'] = 58;\r\n      s1['k222'] = 34;\r\n      s1['k90'] = 90;\r\n      s1['k88'] = 88;\r\n      s1['k67'] = 67;\r\n      s1['k86'] = 86;\r\n      s1['k66'] = 66;\r\n      s1['k78'] = 78;\r\n      s1['k77'] = 77;\r\n      s1['k188'] = 60;\r\n      s1['k190'] = 62;\r\n      s1['k191'] = 63;\r\n\r\n      KeyMapping._usCharCodes = [s0,s1];\r\n    }\r\n\r\n    /**\r\n     * Function     _USKeyCodeToCharCode\r\n     * Scope        Private\r\n     * @param       {Event}     Levent      KMW event object\r\n     * @return      {number}                Character code \r\n     * Description Translate keyboard codes to standard US layout codes\r\n     */    \r\n    static _USKeyCodeToCharCode(Levent: com.keyman.text.KeyEvent) {\r\n      return KeyMapping.usCharCodes[Levent.Lmodifiers & 0x10 ? 1 : 0]['k'+Levent.Lcode];\r\n    };\r\n\r\n    public static get usCharCodes() {\r\n      if(!KeyMapping._usCharCodes) {\r\n        KeyMapping._usCodeInit();\r\n      }\r\n\r\n      return KeyMapping._usCharCodes;\r\n    }\r\n  }\r\n}","// Establishes key-code definitions.\r\n/// <reference path=\"codes.ts\" />\r\n// Defines our generalized \"KeyEvent\" class.\r\n/// <reference path=\"keyEvent.ts\" />\r\n// Defines the RuleBehavior keyboard-processing return object.\r\n/// <reference path=\"ruleBehavior.ts\" />\r\n// Defines default key handling behaviors.\r\n/// <reference path=\"defaultOutput.ts\" />\r\n// Defines the keyboard wrapper object.\r\n/// <reference path=\"../keyboards/keyboard.ts\" />\r\n// Defines built-in keymapping.\r\n/// <reference path=\"keyMapping.ts\" />\r\n\r\n// Also relies on @keymanapp/web-utils, which is included via tsconfig.json.\r\n\r\nnamespace com.keyman.text {\r\n  export type BeepHandler = (outputTarget: OutputTarget) => void;\r\n  export type LogMessageHandler = (str: string) => void;\r\n\r\n  export interface VariableStoreSerializer {\r\n    loadStore(keyboardID: string, storeName: string): VariableStore;\r\n    saveStore(keyboardID: string, storeName: string, storeMap: VariableStore);\r\n  }\r\n\r\n  export interface ProcessorInitOptions {\r\n    baseLayout?: string;\r\n    variableStoreSerializer?: VariableStoreSerializer;\r\n  }\r\n\r\n  export class KeyboardProcessor {\r\n    public static readonly DEFAULT_OPTIONS: ProcessorInitOptions = {\r\n      baseLayout: 'us'\r\n    }\r\n\r\n    // Tracks the simulated value for supported state keys, allowing the OSK to mirror a physical keyboard for them.\r\n    // Using the exact keyCode name from the Codes definitions will allow for certain optimizations elsewhere in the code.\r\n    stateKeys = {\r\n      \"K_CAPS\":false,\r\n      \"K_NUMLOCK\":false,\r\n      \"K_SCROLL\":false\r\n    };\r\n\r\n    // Tracks the most recent modifier state information in order to quickly detect changes\r\n    // in keyboard state not otherwise captured by the hosting page in the browser.\r\n    // Needed for AltGr simulation.\r\n    modStateFlags: number = 0;\r\n\r\n    keyboardInterface: KeyboardInterface;\r\n\r\n    baseLayout: string;\r\n\r\n    // Callbacks for various feedback types\r\n    beepHandler?: BeepHandler;\r\n    warningLogger?: LogMessageHandler;\r\n    errorLogger?: LogMessageHandler;\r\n\r\n    constructor(options?: ProcessorInitOptions) {\r\n      if(!options) {\r\n        options = KeyboardProcessor.DEFAULT_OPTIONS;\r\n      }\r\n\r\n      this.baseLayout = options.baseLayout || KeyboardProcessor.DEFAULT_OPTIONS.baseLayout;\r\n      this.keyboardInterface = new KeyboardInterface(options.variableStoreSerializer);\r\n      this.installInterface();\r\n    }\r\n\r\n    private installInterface() {\r\n      // We must ensure that the keyboard can find the API functions at the expected place.\r\n      let globalThis = utils.getGlobalObject();\r\n      globalThis[KeyboardInterface.GLOBAL_NAME] = this.keyboardInterface;\r\n\r\n      // Ensure that the active keyboard is set on the keyboard interface object.\r\n      if(this.activeKeyboard) {\r\n        this.keyboardInterface.activeKeyboard = this.activeKeyboard;\r\n      }\r\n    }\r\n\r\n    public get activeKeyboard(): keyboards.Keyboard {\r\n      return this.keyboardInterface.activeKeyboard;\r\n    }\r\n\r\n    public set activeKeyboard(keyboard: keyboards.Keyboard) {\r\n      this.keyboardInterface.activeKeyboard = keyboard;\r\n\r\n      // All old deadkeys and keyboard-specific cache should immediately be invalidated\r\n      // on a keyboard change.\r\n      this.resetContext();\r\n    }\r\n\r\n    get layerStore(): MutableSystemStore {\r\n      return this.keyboardInterface.systemStores[KeyboardInterface.TSS_LAYER] as MutableSystemStore;\r\n    }\r\n\r\n    public get layerId(): string {\r\n      return this.layerStore.value;\r\n    }\r\n\r\n    // Note:  will trigger an 'event' callback designed to notify the OSK of layer changes.\r\n    public set layerId(value: string) {\r\n      this.layerStore.set(value);\r\n    }\r\n\r\n    /**\r\n     * Get the default RuleBehavior for the specified key, attempting to mimic standard browser defaults\r\n     * where and when appropriate.\r\n     *\r\n     * @param   {object}  Lkc           The pre-analyzed KeyEvent object\r\n     * @param   {boolean} outputTarget  The OutputTarget receiving the KeyEvent\r\n     * @return  {string}\r\n     */\r\n    defaultRuleBehavior(Lkc: KeyEvent, outputTarget: OutputTarget): RuleBehavior {\r\n      let preInput = Mock.from(outputTarget);\r\n      let ruleBehavior = new RuleBehavior();\r\n\r\n      let matched = false;\r\n      var char = '';\r\n      var special: EmulationKeystrokes;\r\n      if(Lkc.isSynthetic || outputTarget.isSynthetic) {\r\n        matched = true;  // All the conditions below result in matches until the final else, which restores the expected default\r\n                         // if no match occurs.\r\n\r\n        if(DefaultOutput.isCommand(Lkc)) {\r\n          // Note this in the rule behavior, return successfully.  We'll consider applying it later.\r\n          ruleBehavior.triggersDefaultCommand = true;\r\n\r\n          // We'd rather let the browser handle these keys, but we're using emulated keystrokes, forcing KMW\r\n          // to emulate default behavior here.\r\n        } else if((special = DefaultOutput.forSpecialEmulation(Lkc)) != null) {\r\n          switch(special) {\r\n            case EmulationKeystrokes.Backspace:\r\n              this.keyboardInterface.defaultBackspace(outputTarget);\r\n              break;\r\n            case EmulationKeystrokes.Enter:\r\n              outputTarget.handleNewlineAtCaret();\r\n              break;\r\n            // case '\\u007f': // K_DEL\r\n              // // For (possible) future implementation.\r\n              // // Would recommend (conceptually) equaling K_RIGHT + K_BKSP, the former of which would technically be a 'command'.\r\n            default:\r\n              // In case we extend the allowed set, but forget to implement its handling case above.\r\n              ruleBehavior.errorLog = \"Unexpected 'special emulation' character (\\\\u\" + (special as String).kmwCharCodeAt(0).toString(16) + \") went unhandled!\";\r\n          }\r\n        } else {\r\n          // Back to the standard default, pending normal matching.\r\n          matched = false;\r\n        }\r\n      }\r\n\r\n      let isMnemonic = this.activeKeyboard && this.activeKeyboard.isMnemonic;\r\n\r\n      if(!matched) {\r\n        if((char = DefaultOutput.forAny(Lkc, isMnemonic)) != null) {\r\n          special = DefaultOutput.forSpecialEmulation(Lkc)\r\n          if(special == EmulationKeystrokes.Backspace) {\r\n            // A browser's default backspace may fail to delete both parts of an SMP character.\r\n            this.keyboardInterface.defaultBackspace(outputTarget);\r\n          } else if(special || DefaultOutput.isCommand(Lkc)) { // Filters out 'commands' like TAB.\r\n            // We only do the \"for special emulation\" cases under the condition above... aside from backspace\r\n            // Let the browser handle those.\r\n            return null;\r\n          } else {\r\n            this.keyboardInterface.output(0, outputTarget, char);\r\n          }\r\n        } else {\r\n          // No match, no default RuleBehavior.\r\n          return null;\r\n        }\r\n      }\r\n\r\n      // Shortcut things immediately if there were issues generating this rule behavior.\r\n      if(ruleBehavior.errorLog) {\r\n        return ruleBehavior;\r\n      }\r\n\r\n      let transcription = outputTarget.buildTranscriptionFrom(preInput, Lkc);\r\n      ruleBehavior.transcription = transcription;\r\n\r\n      return ruleBehavior;\r\n    }\r\n\r\n    setSyntheticEventDefaults(Lkc: text.KeyEvent) {\r\n      // Set the flags for the state keys.\r\n      Lkc.Lstates |= this.stateKeys['K_CAPS']    ? Codes.modifierCodes['CAPS'] : Codes.modifierCodes['NO_CAPS'];\r\n      Lkc.Lstates |= this.stateKeys['K_NUMLOCK'] ? Codes.modifierCodes['NUM_LOCK'] : Codes.modifierCodes['NO_NUM_LOCK'];\r\n      Lkc.Lstates |= this.stateKeys['K_SCROLL']  ? Codes.modifierCodes['SCROLL_LOCK'] : Codes.modifierCodes['NO_SCROLL_LOCK'];\r\n\r\n      // Set LisVirtualKey to false to ensure that nomatch rule does fire for U_xxxx keys\r\n      if(Lkc.kName && Lkc.kName.substr(0,2) == 'U_') {\r\n        Lkc.LisVirtualKey=false;\r\n      }\r\n\r\n      // Get code for non-physical keys (T_KOKAI, U_05AB etc)\r\n      if(typeof Lkc.Lcode == 'undefined') {\r\n        Lkc.Lcode = this.getVKDictionaryCode(Lkc.kName);// Updated for Build 347\r\n        if(!Lkc.Lcode) {\r\n          // Special case for U_xxxx keys. This vk code will never be used\r\n          // in a keyboard, so we use this to ensure that keystroke processing\r\n          // occurs for the key.\r\n          Lkc.Lcode = 1;\r\n        }\r\n      }\r\n\r\n      // Handles modifier states when the OSK is emulating rightalt through the leftctrl-leftalt layer.\r\n      if((Lkc.Lmodifiers & Codes.modifierBitmasks['ALT_GR_SIM']) == Codes.modifierBitmasks['ALT_GR_SIM'] && this.activeKeyboard.emulatesAltGr) {\r\n        Lkc.Lmodifiers &= ~Codes.modifierBitmasks['ALT_GR_SIM'];\r\n        Lkc.Lmodifiers |= Codes.modifierCodes['RALT'];\r\n      }\r\n    }\r\n\r\n    processKeystroke(keyEvent: KeyEvent, outputTarget: OutputTarget): RuleBehavior {\r\n      var matchBehavior: RuleBehavior;\r\n\r\n      // Pass this key code and state to the keyboard program\r\n      if(this.activeKeyboard && keyEvent.Lcode != 0) {\r\n        /*\r\n         * The `this.installInterface()` call is insurance against something I've seen in unit tests when things break a bit.\r\n         *\r\n         * Currently, when a KMW shutdown doesn't go through properly or completely, sometimes we end up with parallel\r\n         * versions of KMW running, and an old, partially-shutdown one will \"snipe\" a command meant for the most-recent\r\n         * one's test. So, installing here ensures that the active Processor has its matching KeyboardInterface ready,\r\n         * even should that occur.\r\n         */\r\n        this.installInterface();\r\n        matchBehavior = this.keyboardInterface.processKeystroke(outputTarget, keyEvent);\r\n      }\r\n\r\n      if(!matchBehavior || matchBehavior.triggerKeyDefault) {\r\n        // Restore the virtual key code if a mnemonic keyboard is being used\r\n        // If no vkCode value was stored, maintain the original Lcode value.\r\n        keyEvent.Lcode=keyEvent.vkCode || keyEvent.Lcode;\r\n\r\n        // Handle unmapped keys, including special keys\r\n        // The following is physical layout dependent, so should be avoided if possible.  All keys should be mapped.\r\n        this.keyboardInterface.activeTargetOutput = outputTarget;\r\n\r\n        // Match against the 'default keyboard' - rules to mimic the default string output when typing in a browser.\r\n        // Many keyboards rely upon these 'implied rules'.\r\n        let defaultBehavior = this.defaultRuleBehavior(keyEvent, outputTarget);\r\n        if(defaultBehavior) {\r\n          if(!matchBehavior) {\r\n            matchBehavior = defaultBehavior;\r\n          } else {\r\n            matchBehavior.mergeInDefaults(defaultBehavior);\r\n          }\r\n          matchBehavior.triggerKeyDefault = false; // We've triggered it successfully.\r\n        } // If null, we must rely on something else (like the browser, in DOM-aware code) to fulfill the default.\r\n\r\n        this.keyboardInterface.activeTargetOutput = null;\r\n      }\r\n\r\n      return matchBehavior;\r\n    }\r\n\r\n    // FIXME:  makes some bad assumptions.\r\n    static setMnemonicCode(Lkc: KeyEvent, shifted: boolean, capsActive: boolean) {\r\n      // K_SPACE is not handled by defaultKeyOutput for physical keystrokes unless using touch-aliased elements.\r\n      // It's also a \"exception required, March 2013\" for clickKey, so at least they both have this requirement.\r\n      if(Lkc.Lcode != Codes.keyCodes['K_SPACE']) {\r\n        // So long as the key name isn't prefixed with 'U_', we'll get a default mapping based on the Lcode value.\r\n        // We need to determine the mnemonic base character - for example, SHIFT + K_PERIOD needs to map to '>'.\r\n        let mappingEvent: KeyEvent = new KeyEvent();\r\n        for(var key in Lkc) {\r\n          mappingEvent[key] = Lkc[key];\r\n        }\r\n\r\n        // To facilitate storing relevant commands, we should probably reverse-lookup\r\n        // the actual keyname instead.\r\n        mappingEvent.kName = 'K_xxxx';\r\n        mappingEvent.Lmodifiers = (shifted ? 0x10 : 0);  // mnemonic lookups only exist for default & shift layers.\r\n        var mappedChar: string = DefaultOutput.forAny(mappingEvent, true);\r\n\r\n        /* First, save a backup of the original code.  This one won't needlessly trigger keyboard\r\n         * rules, but allows us to replicate/emulate commands after rule processing if needed.\r\n         * (Like backspaces)\r\n         */\r\n        Lkc.vkCode = Lkc.Lcode;\r\n        if(mappedChar) {\r\n          // Will return 96 for 'a', which is a keycode corresponding to Codes.keyCodes('K_NP1') - a numpad key.\r\n          // That stated, we're in mnemonic mode - this keyboard's rules are based on the char codes.\r\n          Lkc.Lcode = mappedChar.charCodeAt(0);\r\n        } else {\r\n          // Don't let command-type keys (like K_DEL, which will output '.' otherwise!)\r\n          // trigger keyboard rules.\r\n          //\r\n          // However, DO make sure modifier keys pass through safely.\r\n          // (https://github.com/keymanapp/keyman/issues/3744)\r\n          if(!KeyboardProcessor.isModifier(Lkc)) {\r\n            delete Lkc.Lcode;\r\n          }\r\n        }\r\n      }\r\n\r\n      if(capsActive) {\r\n        // TODO:  Needs fixing - does not properly mirror physical keystrokes, as Lcode range 96-111 corresponds\r\n        // to numpad keys!  (Physical keyboard section has its own issues here.)\r\n        if((Lkc.Lcode >= 65 && Lkc.Lcode <= 90) /* 'A' - 'Z' */ || (Lkc.Lcode >= 97 && Lkc.Lcode <= 122) /* 'a' - 'z' */) {\r\n          Lkc.Lmodifiers ^= 0x10;  // Flip the 'shifted' bit, so it'll act as the opposite key.\r\n          Lkc.Lcode ^= 0x20; // Flips the 'upper' vs 'lower' bit for the base 'a'-'z' ASCII alphabetics.\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Get modifier key state from layer id\r\n     *\r\n     * @param       {string}      layerId       layer id (e.g. ctrlshift)\r\n     * @return      {number}                    modifier key state (desktop keyboards)\r\n     */\r\n    static getModifierState(layerId: string): number {\r\n      var modifier=0;\r\n      if(layerId.indexOf('shift') >= 0) {\r\n        modifier |= Codes.modifierCodes['SHIFT'];\r\n      }\r\n\r\n      // The chiral checks must not be directly exclusive due each other to visual OSK feedback.\r\n      var ctrlMatched=false;\r\n      if(layerId.indexOf('leftctrl') >= 0) {\r\n        modifier |= Codes.modifierCodes['LCTRL'];\r\n        ctrlMatched=true;\r\n      }\r\n      if(layerId.indexOf('rightctrl') >= 0) {\r\n        modifier |= Codes.modifierCodes['RCTRL'];\r\n        ctrlMatched=true;\r\n      }\r\n      if(layerId.indexOf('ctrl')  >= 0 && !ctrlMatched) {\r\n        modifier |= Codes.modifierCodes['CTRL'];\r\n      }\r\n\r\n      var altMatched=false;\r\n      if(layerId.indexOf('leftalt') >= 0) {\r\n        modifier |= Codes.modifierCodes['LALT'];\r\n        altMatched=true;\r\n      }\r\n      if(layerId.indexOf('rightalt') >= 0) {\r\n        modifier |= Codes.modifierCodes['RALT'];\r\n        altMatched=true;\r\n      }\r\n      if(layerId.indexOf('alt')  >= 0 && !altMatched) {\r\n        modifier |= Codes.modifierCodes['ALT'];\r\n      }\r\n\r\n      return modifier;\r\n    }\r\n\r\n    /**\r\n     * @summary Look up a custom virtual key code in the virtual key code dictionary KVKD.  On first run, will build the dictionary.\r\n     *\r\n     * `VKDictionary` is constructed from the keyboard's `KVKD` member. This list is constructed\r\n     * at compile-time and is a list of 'additional' virtual key codes, starting at 256 (i.e.\r\n     * outside the range of standard virtual key codes). These additional codes are both\r\n     * `[T_xxx]` and `[U_xxxx]` custom key codes from the Keyman keyboard language. However,\r\n     * `[U_xxxx]` keys only generate an entry in `KVKD` if there is a corresponding rule that\r\n     * is associated with them in the keyboard rules. If the `[U_xxxx]` key code is only\r\n     * referenced as the id of a key in the touch layout, then it does not get an entry in\r\n     * the `KVKD` property.\r\n     *\r\n     * @private\r\n     * @param       {string}      keyName   custom virtual key code to lookup in the dictionary\r\n     * @return      {number}                key code > 255 on success, or 0 if not found\r\n     */\r\n    getVKDictionaryCode(keyName: string) {\r\n      var activeKeyboard = this.activeKeyboard;\r\n      if(!activeKeyboard.scriptObject['VKDictionary']) {\r\n        var a=[];\r\n        if(typeof activeKeyboard.scriptObject['KVKD'] == 'string') {\r\n          // Build the VK dictionary\r\n          // TODO: Move the dictionary build into the compiler -- so compiler generates code such as following.\r\n          // Makes the VKDictionary member unnecessary.\r\n          //       this.KVKD={\"K_ABC\":256,\"K_DEF\":257,...};\r\n          var s=activeKeyboard.scriptObject['KVKD'].split(' ');\r\n          for(var i=0; i<s.length; i++) {\r\n            a[s[i].toUpperCase()]=i+256; // We force upper-case since virtual keys should be case-insensitive.\r\n          }\r\n        }\r\n        activeKeyboard.scriptObject['VKDictionary']=a;\r\n      }\r\n\r\n      var res=activeKeyboard.scriptObject['VKDictionary'][keyName.toUpperCase()];\r\n      return res ? res : 0;\r\n    }\r\n\r\n    /**\r\n     * Function     _UpdateVKShift\r\n     * Scope        Private\r\n     * @param       {Object}            e     OSK event\r\n     * @param       {number}            v     keyboard shift state\r\n     * @param       {(boolean|number)}  d     set (1) or clear(0) shift state bits\r\n     * @return      {boolean}                 Always true\r\n     * Description  Updates the current shift state within KMW, updating the OSK's visualization thereof.\r\n     */\r\n    _UpdateVKShift(e: KeyEvent, v: number, d: boolean|number): boolean {\r\n      var keyShiftState=0, lockStates=0, i;\r\n\r\n      var lockNames  = ['CAPS', 'NUM_LOCK', 'SCROLL_LOCK'];\r\n      var lockKeys   = ['K_CAPS', 'K_NUMLOCK', 'K_SCROLL'];\r\n\r\n      if(!this.activeKeyboard) {\r\n        return true;\r\n      }\r\n\r\n      if(e) {\r\n        // read shift states from Pevent\r\n        keyShiftState = e.Lmodifiers;\r\n        lockStates = e.Lstates;\r\n\r\n        // Are we simulating AltGr?  If it's a simulation and not real, time to un-simulate for the OSK.\r\n        if(this.activeKeyboard.isChiral && (this.activeKeyboard.emulatesAltGr) &&\r\n            (this.modStateFlags & Codes.modifierBitmasks['ALT_GR_SIM']) == Codes.modifierBitmasks['ALT_GR_SIM']) {\r\n          keyShiftState |= Codes.modifierBitmasks['ALT_GR_SIM'];\r\n          keyShiftState &= ~Codes.modifierCodes['RALT'];\r\n        }\r\n\r\n        for(i=0; i < lockNames.length; i++) {\r\n          if(lockStates & Codes.stateBitmasks[lockNames[i]]) {\r\n            this.stateKeys[lockKeys[i]] = !!(lockStates & Codes.modifierCodes[lockNames[i]]);\r\n          }\r\n        }\r\n      } else if(d) {\r\n        keyShiftState |= v;\r\n\r\n        for(i=0; i < lockNames.length; i++) {\r\n          if(v & Codes.stateBitmasks[lockNames[i]]) {\r\n            this.stateKeys[lockKeys[i]] = true;\r\n          }\r\n        }\r\n      } else {\r\n        keyShiftState &= ~v;\r\n\r\n        for(i=0; i < lockNames.length; i++) {\r\n          if(v & Codes.stateBitmasks[lockNames[i]]) {\r\n            this.stateKeys[lockKeys[i]] = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      this.updateStates();\r\n\r\n      if(this.activeKeyboard.isMnemonic && this.stateKeys['K_CAPS']) {\r\n        // Modifier keypresses doesn't trigger mnemonic manipulation of modifier state.\r\n        // Only an output key does; active use of Caps will also flip the SHIFT flag.\r\n        if(!e || !KeyboardProcessor.isModifier(e)) {\r\n          // Mnemonic keystrokes manipulate the SHIFT property based on CAPS state.\r\n          // We need to unflip them when tracking the OSK layer.\r\n          keyShiftState ^= Codes.modifierCodes['SHIFT'];\r\n        }\r\n      }\r\n\r\n      this.layerId = this.getLayerId(keyShiftState);\r\n      return true;\r\n    }\r\n\r\n    private updateStates(): void {\r\n      var lockNames  = ['CAPS', 'NUM_LOCK', 'SCROLL_LOCK'];\r\n      var lockKeys   = ['K_CAPS', 'K_NUMLOCK', 'K_SCROLL'];\r\n\r\n      for(let i=0; i < lockKeys.length; i++) {\r\n        const key = lockKeys[i];\r\n        const flag = this.stateKeys[key];\r\n        const onBit = lockNames[i];\r\n        const offBit = 'NO_' + lockNames[i];\r\n\r\n        // Ensures that the current mod-state info properly matches the currently-simulated\r\n        // state key states.\r\n        if(flag) {\r\n          this.modStateFlags |= Codes.modifierCodes[onBit];\r\n          this.modStateFlags &= ~Codes.modifierCodes[offBit];\r\n        } else {\r\n          this.modStateFlags &= ~Codes.modifierCodes[onBit];\r\n          this.modStateFlags |= Codes.modifierCodes[offBit];\r\n        }\r\n      }\r\n    }\r\n\r\n    getLayerId(modifier: number): string {\r\n      return keyboards.Layouts.getLayerId(modifier);\r\n    }\r\n\r\n    /**\r\n     * Select the OSK's next keyboard layer based upon layer switching keys as a default\r\n     * The next layer will be determined from the key name unless otherwise specifed\r\n     *\r\n     *  @param  {string}                    keyName     key identifier\r\n     *  @param  {number|string|undefined}   nextLayerIn optional next layer identifier\r\n     *  @return {boolean}                               return true if keyboard layer changed\r\n     */\r\n    selectLayer(keyEvent: KeyEvent, fromNameOnly: boolean = false): boolean {\r\n      let keyName = keyEvent.kName;\r\n      var nextLayer = fromNameOnly ? null : keyEvent.kNextLayer;\r\n      var isChiral = this.activeKeyboard && this.activeKeyboard.isChiral;\r\n\r\n      // Layer must be identified by name, not number (27/08/2015)\r\n      if(typeof nextLayer == 'number') {\r\n        nextLayer = this.getLayerId(nextLayer * 0x10);\r\n      }\r\n\r\n      // Identify next layer, if required by key\r\n      if(!nextLayer) {\r\n        switch(keyName) {\r\n          case 'K_LSHIFT':\r\n          case 'K_RSHIFT':\r\n          case 'K_SHIFT':\r\n            nextLayer = 'shift';\r\n            break;\r\n          case 'K_LCONTROL':\r\n          case 'K_LCTRL':\r\n            if(isChiral) {\r\n              nextLayer = 'leftctrl';\r\n              break;\r\n            }\r\n          case 'K_RCONTROL':\r\n          case 'K_RCTRL':\r\n            if(isChiral) {\r\n              nextLayer = 'rightctrl';\r\n              break;\r\n            }\r\n          case 'K_CTRL':\r\n            nextLayer = 'ctrl';\r\n            break;\r\n          case 'K_LMENU':\r\n          case 'K_LALT':\r\n            if(isChiral) {\r\n              nextLayer = 'leftalt';\r\n              break;\r\n            }\r\n          case 'K_RMENU':\r\n          case 'K_RALT':\r\n            if(isChiral) {\r\n              nextLayer = 'rightalt';\r\n              break;\r\n            }\r\n          case 'K_ALT':\r\n            nextLayer = 'alt';\r\n            break;\r\n          case 'K_ALTGR':\r\n            if(isChiral) {\r\n              nextLayer = 'leftctrl-rightalt';\r\n            } else {\r\n              nextLayer = 'ctrl-alt';\r\n            }\r\n            break;\r\n          case 'K_CURRENCIES':\r\n          case 'K_NUMERALS':\r\n          case 'K_SHIFTED':\r\n          case 'K_UPPER':\r\n          case 'K_LOWER':\r\n          case 'K_SYMBOLS':\r\n            nextLayer = 'default';\r\n            break;\r\n        }\r\n      }\r\n\r\n      // If no key corresponding to a layer transition is pressed, maintain the current layer.\r\n      if(!nextLayer) {\r\n        return false;\r\n      }\r\n\r\n      // Change layer and refresh OSK\r\n      this.updateLayer(keyEvent, nextLayer);\r\n\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Sets the new layer id, allowing for toggling shift/ctrl/alt while preserving the remainder\r\n     * of the modifiers represented by the current layer id (where applicable)\r\n     *\r\n     * @param       {string}      id      layer id (e.g. ctrlshift)\r\n     */\r\n    updateLayer(keyEvent: KeyEvent, id: string) {\r\n      let activeLayer = this.layerId;\r\n      var s = activeLayer;\r\n\r\n      // Do not change layer unless needed (27/08/2015)\r\n      if(id == activeLayer && keyEvent.device.formFactor != utils.FormFactor.Desktop) {\r\n        return false;\r\n      }\r\n\r\n      var idx=id;\r\n      var i;\r\n\r\n      if(keyEvent.device.formFactor == utils.FormFactor.Desktop) {\r\n        // Need to test if target layer is a standard layer (based on the plain 'default')\r\n        var replacements= ['leftctrl', 'rightctrl', 'ctrl', 'leftalt', 'rightalt', 'alt', 'shift'];\r\n\r\n        for(i=0; i < replacements.length; i++) {\r\n          // Don't forget to remove the kebab-case hyphens!\r\n          idx=idx.replace(replacements[i] + '-', '');\r\n          idx=idx.replace(replacements[i],'');\r\n        }\r\n\r\n        // If we are presently on the default layer, drop the 'default' and go straight to the shifted mode.\r\n        // If on a common symbolic layer, drop out of symbolic mode and go straight to the shifted mode.\r\n        if(activeLayer == 'default' || activeLayer == 'numeric' || activeLayer == 'symbol' || activeLayer == 'currency' || idx != '') {\r\n          s = id;\r\n        }\r\n        // Otherwise, we are based upon a layer that accepts modifier variations.\r\n        // Modify the layer according to the current state and key pressed.\r\n        //\r\n        // TODO:  Consider:  should this ever be allowed for a base layer other than 'default'?  If not,\r\n        // if(idx == '') with accompanying if-else structural shift would be a far better test here.\r\n        else {\r\n          // Save our current modifier state.\r\n          var modifier=KeyboardProcessor.getModifierState(s);\r\n\r\n          // Strip down to the base modifiable layer.\r\n          for(i=0; i < replacements.length; i++) {\r\n            // Don't forget to remove the kebab-case hyphens!\r\n            s=s.replace(replacements[i] + '-', '');\r\n            s=s.replace(replacements[i],'');\r\n          }\r\n\r\n          // Toggle the modifier represented by our input argument.\r\n          switch(id) {\r\n            case 'shift':\r\n              modifier ^= Codes.modifierCodes['SHIFT'];\r\n              break;\r\n            case 'leftctrl':\r\n              modifier ^= Codes.modifierCodes['LCTRL'];\r\n              break;\r\n            case 'rightctrl':\r\n              modifier ^= Codes.modifierCodes['RCTRL'];\r\n              break;\r\n            case 'ctrl':\r\n              modifier ^= Codes.modifierCodes['CTRL'];\r\n              break;\r\n            case 'leftalt':\r\n              modifier ^= Codes.modifierCodes['LALT'];\r\n              break;\r\n            case 'rightalt':\r\n              modifier ^= Codes.modifierCodes['RALT'];\r\n              break;\r\n            case 'alt':\r\n              modifier ^= Codes.modifierCodes['ALT'];\r\n              break;\r\n            default:\r\n              s = id;\r\n          }\r\n\r\n          // Combine our base modifiable layer and attach the new modifier variation info to obtain our destination layer.\r\n          if(s != 'default') {\r\n            if(s == '') {\r\n              s = this.getLayerId(modifier);\r\n            } else {\r\n              s = this.getLayerId(modifier) + '-' + s;\r\n            }\r\n          }\r\n        }\r\n\r\n        if(s == '') {\r\n          s = 'default';\r\n        }\r\n      } else {\r\n        // Mobile form-factor.  Either the layout is specified by a keyboard developer with direct layer name references\r\n        // or all layers are accessed via subkey of a single layer-shifting key - no need for modifier-combining logic.\r\n        s = id;\r\n      }\r\n\r\n      let layout = this.activeKeyboard.layout(keyEvent.device.formFactor);\r\n      if(layout.getLayer(s)) {\r\n        this.layerId = s;\r\n      } else {\r\n        this.layerId = 'default';\r\n      }\r\n\r\n      let baseModifierState = text.KeyboardProcessor.getModifierState(this.layerId);\r\n      this.modStateFlags = baseModifierState | keyEvent.Lstates;\r\n    }\r\n\r\n    static isModifier(Levent: KeyEvent): boolean {\r\n      switch(Levent.Lcode) {\r\n        case 16: //\"K_SHIFT\":16,\"K_CONTROL\":17,\"K_ALT\":18\r\n        case 17:\r\n        case 18:\r\n        case 20: //\"K_CAPS\":20, \"K_NUMLOCK\":144,\"K_SCROLL\":145\r\n        case 144:\r\n        case 145:\r\n          return true;\r\n        default:\r\n          return false;\r\n      }\r\n    }\r\n\r\n    // Returns true if the key event is a modifier press, allowing keyPress to return selectively\r\n    // in those cases.\r\n    doModifierPress(Levent: KeyEvent, outputTarget: OutputTarget, isKeyDown: boolean): boolean {\r\n      if(!this.activeKeyboard) {\r\n        return false;\r\n      }\r\n\r\n      if(Levent.Lcode == 8) {\r\n        // I3318 (always clear deadkeys after backspace)\r\n        outputTarget.deadkeys().clear();\r\n      } else if(KeyboardProcessor.isModifier(Levent)) {\r\n        // For eventual integration - we bypass an OSK update for physical keystrokes when in touch mode.\r\n        this.activeKeyboard.notify(Levent.Lcode, outputTarget, isKeyDown ? 1 : 0);\r\n        if(!Levent.device.touchable) {\r\n          return this._UpdateVKShift(Levent, Levent.Lcode-15, 1); // I2187\r\n        } else {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      if(Levent.LmodifierChange) {\r\n        this.activeKeyboard.notify(0, outputTarget, 1);\r\n        this._UpdateVKShift(Levent, 0, 1);\r\n      }\r\n\r\n      // No modifier keypresses detected.\r\n      return false;\r\n    }\r\n\r\n    resetContext() {\r\n      this.layerId = 'default';\r\n\r\n      this.keyboardInterface.resetContextCache();\r\n      this._UpdateVKShift(null, 15, 0);\r\n    };\r\n\r\n    setNumericLayer(device: utils.DeviceSpec) {\r\n      if (this.activeKeyboard) {\r\n        let layout = this.activeKeyboard.layout(device.formFactor);\r\n        if(layout.getLayer('numeric')) {\r\n          this.layerId = 'numeric';\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n(function () {\r\n  let ns = com.keyman.text;\r\n\r\n  // Let the Keyboard Processor be available both in the browser and in Node.\r\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\r\n    module.exports = ns.KeyboardProcessor;\r\n    //@ts-ignore\r\n    ns.KeyboardProcessor.com = com; // Export the root namespace so that all KeyboardProcessor classes are accessible by unit tests.\r\n  }\r\n}());\r\n"]}