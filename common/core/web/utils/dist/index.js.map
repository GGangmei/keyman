{"version":3,"file":"index.js","sourceRoot":"","sources":["../node_modules/@keymanapp/web-environment/environment.inc.ts","../src/deepCopy.ts","../src/deviceSpec.ts","../src/globalObject.ts","../src/version.ts","../src/kmwstring.ts","../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["//Autogenerated file - do not modify!\nnamespace com.keyman.environment {\n  export var VERSION = \"15.0\";\n  export var BUILD = 163;\n  export var ENVIRONMENT = \"local\";\n  export var SENTRY_RELEASE = \"release-15.0.163-alpha-local\";\n}\n\n","namespace com.keyman.utils {\r\n  /**\r\n   * Function     deepCopy\r\n   * Scope        Private\r\n   * @param       {Object}      p           object to copy\r\n   * @param       {Array=}      c0          array member being copied\r\n   * @return      {Object}                  clone ('deep copy') of object\r\n   * Description  Makes an actual copy (not a reference) of an object, copying simple members,\r\n   *              arrays and member objects but not functions, so use with care!\r\n   */\r\n  export function deepCopy<T>(p:T, c0?): T {\r\n    var c = c0 || {};\r\n    for (var i in p) {\r\n      if(typeof p[i] === 'object' && p[i] != null) {\r\n        c[i] = (p[i].constructor === Array ) ? [] : {};\r\n        deepCopy(p[i],c[i]);\r\n      }\r\n      else {\r\n        c[i] = p[i];\r\n      }\r\n    }\r\n\r\n    return c;\r\n  }\r\n}","namespace com.keyman.utils {\r\n  export enum Browser {\r\n    Chrome = 'chrome',\r\n    Edge = 'edge',\r\n    Firefox = 'firefox',\r\n    Native = 'native', // Used by embedded mode\r\n    Opera = 'opera',\r\n    Safari = 'safari',\r\n    Other = 'other'\r\n  }\r\n\r\n  export enum OperatingSystem {\r\n    Windows = 'windows',\r\n    macOS = 'macosx',\r\n    Linux = 'linux',\r\n    Android = 'android',\r\n    iOS = 'ios',\r\n    Other = 'other'\r\n  }\r\n\r\n  export enum FormFactor {\r\n    Desktop = 'desktop',\r\n    Phone = 'phone',\r\n    Tablet = 'tablet'\r\n  }\r\n\r\n  /**\r\n   * This class provides an abstract version of com.keyman.Device that is core-friendly, \r\n   * containing only the information needed by web-core for text processing use, devoid\r\n   * of any direct references to the DOM.\r\n   */\r\n  export class DeviceSpec {\r\n    readonly browser: Browser;\r\n    readonly formFactor: FormFactor;\r\n    readonly OS: OperatingSystem;\r\n    readonly touchable: boolean;\r\n\r\n    constructor(browser: string, formFactor: string, OS: string, touchable: boolean) {\r\n      switch(browser.toLowerCase() as Browser) {\r\n        case Browser.Chrome:\r\n        case Browser.Edge:\r\n        case Browser.Firefox:\r\n        case Browser.Native:\r\n        case Browser.Opera:\r\n        case Browser.Safari:\r\n          this.browser = browser.toLowerCase() as Browser;\r\n          break;\r\n        default:\r\n          this.browser = Browser.Other;\r\n      }\r\n\r\n      switch(formFactor.toLowerCase() as FormFactor) {\r\n        case FormFactor.Desktop:\r\n        case FormFactor.Phone:\r\n        case FormFactor.Tablet:\r\n          this.formFactor = formFactor.toLowerCase() as FormFactor;\r\n          break;\r\n        default:\r\n          throw (\"Invalid form factor specified for device: \" + formFactor);\r\n      }\r\n\r\n      switch(OS.toLowerCase() as OperatingSystem) {\r\n        case OperatingSystem.Windows.toLowerCase():\r\n        case OperatingSystem.macOS.toLowerCase():\r\n        case OperatingSystem.Linux.toLowerCase():\r\n        case OperatingSystem.Android.toLowerCase():\r\n        case OperatingSystem.iOS.toLowerCase():\r\n          this.OS = OS.toLowerCase() as OperatingSystem;\r\n          break;\r\n        default:\r\n          this.OS = OperatingSystem.Other;\r\n      }\r\n      \r\n      this.touchable = touchable;\r\n    }\r\n  }\r\n}","namespace com.keyman.utils {\r\n  /**\r\n   * Returns the base global object available to the current JS platform.\r\n   * - In browsers, returns `window`.\r\n   * - In WebWorkers, returns `self`.\r\n   * - In Node, returns `global`.\r\n   */\r\n  export function getGlobalObject(): typeof globalThis {\r\n    // Evergreen browsers have started defining 'globalThis'.  \r\n    // Refer to https://devblogs.microsoft.com/typescript/announcing-typescript-3-4/#type-checking-for-globalthis\r\n    // and its referenced polyfill.  Said polyfill is very complex, so we opt for this far leaner variant.\r\n    if(typeof globalThis != 'undefined') {\r\n      return globalThis;  // Not available in IE or older Edge versions\r\n      // @ts-ignore (TS will throw errors for whatever platform we're not compiling for.)\r\n    } else if(typeof window != 'undefined') {\r\n      // @ts-ignore\r\n      return window; // The browser-based classic\r\n      // @ts-ignore\r\n    } else if(typeof self != 'undefined') {\r\n      // @ts-ignore\r\n      return self; // WebWorker global\r\n    } else {\r\n      // Assumption - if neither of the above exist, we're in Node, for unit-testing.\r\n      // Node doesn't have as many methods and properties as the other two, but what \r\n      // matters for us is that it's the base global.\r\n      //\r\n      // Some other headless JS solutions use 'this' instead, but Node's enough for our needs.\r\n      // @ts-ignore\r\n      return (global as any) as typeof globalThis;\r\n    }\r\n  }\r\n}","// Ensure that this class contains no reference into core KMW code - it is referenced\r\n// by components intended to be modular and possible to separate from core KMW.\r\n\r\nnamespace com.keyman.utils {\r\n  // Dotted-decimal version\r\n  export class Version {\r\n    public static readonly CURRENT = new Version(com.keyman.environment.VERSION);\r\n\r\n    // Represents a default version value for keyboards compiled before this was compiled into keyboards.\r\n    // The exact version is unknown at this point, but the value is \"good enough\" for what we need.\r\n    public static readonly DEVELOPER_VERSION_FALLBACK = new Version([9, 0, 0]);\r\n\r\n    // For 12.0, the old default behavior of adding missing keycaps to the default layers was removed,\r\n    // as it results in unexpected, bug-like behavior for keyboard designers when it is unwanted.\r\n    public static readonly NO_DEFAULT_KEYCAPS = new Version([12, 0]);\r\n\r\n    public static readonly MAC_POSSIBLE_IPAD_ALIAS = new Version([10, 15]);\r\n\r\n    private readonly components: number[]\r\n\r\n    /**\r\n     * Parses version information, preparing it for use in comparisons.\r\n     * @param text Either a string representing a version number (ex: \"9.0.0\") or an array representing\r\n     *             its components (ex: [9, 0, 0]).\r\n     */\r\n    constructor(text: String | number[]) {\r\n      // If a keyboard doesn't specify a version, use the DEVELOPER_VERSION_FALLBACK values.\r\n      if(text === undefined || text === null) {\r\n        this.components = [].concat(Version.DEVELOPER_VERSION_FALLBACK.components);\r\n        return;\r\n      }\r\n\r\n      if(Array.isArray(text)) {\r\n        let components = text as number[];\r\n        if(components.length < 2) {\r\n          throw new Error(\"Version string must have at least a major and minor component!\");\r\n        } else {\r\n          this.components = [].concat(components);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // else, standard constructor path.\r\n      let parts = text.split('.');\r\n      let componentArray: number[] = [];\r\n\r\n      if(parts.length < 2) {\r\n        throw new Error(\"Version string must have at least a major and minor component!\");\r\n      }\r\n\r\n      for(let i=0; i < parts.length; i++) {\r\n        let value = parseInt(parts[i], 10);\r\n        if(isNaN(value)) {\r\n          throw new Error(\"Version string components must be numerical!\");\r\n        }\r\n\r\n        componentArray.push(value);\r\n      }\r\n\r\n      this.components = componentArray;\r\n    }\r\n\r\n    get major(): number {\r\n      return this.components[0];\r\n    }\r\n\r\n    get minor(): number {\r\n      return this.components[1];\r\n    }\r\n\r\n    toString(): string {\r\n      return this.components.join('.');\r\n    }\r\n\r\n    toJSON(): string {\r\n      return this.toString();\r\n    }\r\n\r\n    equals(other: Version): boolean {\r\n      return this.compareTo(other) == 0;\r\n    }\r\n\r\n    precedes(other: Version): boolean {\r\n      return this.compareTo(other) < 0;\r\n    }\r\n\r\n    compareTo(other: Version): number {\r\n      // If the version info depth differs, we need a flag to indicate which instance is shorter.\r\n      var isShorter: boolean = this.components.length < other.components.length;\r\n      var maxDepth: number = (this.components.length < other.components.length) ? this.components.length : other.components.length;\r\n\r\n      var i: number;\r\n      for(i = 0; i < maxDepth; i++) {\r\n        let delta = this.components[i] - other.components[i];\r\n        if(delta != 0) {\r\n          return delta;\r\n        }\r\n      }\r\n\r\n      var longList = isShorter ? other.components : this.components;\r\n      do {\r\n        if(longList[i] > 0) {\r\n          return isShorter ? -1 : 1;\r\n        }\r\n        i++;\r\n      } while (i < longList.length);\r\n\r\n      // Equal.\r\n      return 0;\r\n    }\r\n  }\r\n}","/***\r\n   KeymanWeb 14.0\r\n   Copyright 2020 SIL International\r\n***/\r\n\r\n/*\r\n * TODO:  Remove this file as part of addressing https://github.com/keymanapp/keyman/issues/2492.\r\n */\r\n\r\ninterface StringConstructor {\r\n  kmwFromCharCode(cp0: number): string,\r\n  _kmwFromCharCode(cp0: number): string,\r\n  kmwEnableSupplementaryPlane(bEnable: boolean)\r\n}\r\n\r\ninterface String {\r\n  kmwCharCodeAt(codePointIndex: number): number,\r\n  kmwCharAt(codePointIndex: number) : string,\r\n  kmwIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  kmwLastIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  kmwSlice(beginSlice: number, endSlice: number) : string,\r\n  kmwSubstring(start: number, length: number) : string,\r\n  kmwSubstr(start: number, length?: number) : string,\r\n  kmwBMPSubstr(start: number, length?: number) : string,\r\n  kmwLength(): number,\r\n  kmwBMPLength(): number,\r\n  kmwNextChar(codeUnitIndex: number): number,\r\n  kmwBMPNextChar(codeUnitIndex: number): number,\r\n  kmwPrevChar(codeUnitIndex: number): number,\r\n  kmwBMPPrevChar(codeUnitIndex: number): number,\r\n  kmwCodePointToCodeUnit(codePointIndex: number) : number,\r\n  kmwBMPCodePointToCodeUnit(codePointIndex: number) : number,\r\n  kmwCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n  kmwBMPCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n  _kmwCharCodeAt(codePointIndex: number): number,\r\n  _kmwCharAt(codePointIndex: number) : string,\r\n  _kmwIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  _kmwLastIndexOf(searchValue: string, fromIndex?: number) : number,\r\n  _kmwSlice(beginSlice: number, endSlice: number) : string,\r\n  _kmwSubstring(start: number, length?: number) : string,\r\n  _kmwSubstr(start: number, length?: number) : string,\r\n  _kmwLength(): number,\r\n  _kmwNextChar(codeUnitIndex: number): number,\r\n  _kmwPrevChar(codeUnitIndex: number): number,\r\n  _kmwCodePointToCodeUnit(codePointIndex: number) : number,\r\n  _kmwCodeUnitToCodePoint(codeUnitIndex: number) : number,\r\n}\r\n\r\n/**\r\n * Constructs a string from one or more Unicode character codepoint values \r\n * passed as integer parameters.\r\n * \r\n * @param  {number} cp0,...   1 or more Unicode codepoints, e.g. 0x0065, 0x10000\r\n * @return {string|null}      The new String object.\r\n */\r\nString.kmwFromCharCode = function(cp0) {\r\n  var chars = [], i;\r\n  for (i = 0; i < arguments.length; i++) {\r\n    var c = Number(arguments[i]);\r\n    if (!isFinite(c) || c < 0 || c > 0x10FFFF || Math.floor(c) !== c) {\r\n      throw new RangeError(\"Invalid code point \" + c);\r\n    }\r\n    if (c < 0x10000) {\r\n      chars.push(c);\r\n    } else {\r\n      c -= 0x10000;\r\n      chars.push((c >> 10) + 0xD800);\r\n      chars.push((c % 0x400) + 0xDC00);\r\n    }\r\n  }\r\n  return String.fromCharCode.apply(undefined, chars);\r\n}\r\n\r\n/**\r\n * Returns a number indicating the Unicode value of the character at the given \r\n * code point index, with support for supplementary plane characters.\r\n * \r\n * @param  {number}  codePointIndex  The code point index into the string (not \r\n                                     the code unit index) to return\r\n * @return {number}                  The Unicode character value\r\n */\r\nString.prototype.kmwCharCodeAt = function(codePointIndex) {\r\n  var str = String(this);\r\n  var codeUnitIndex = 0;\r\n  \r\n  if (codePointIndex < 0 || codePointIndex  >= str.length) {\r\n    return NaN;\r\n  }\r\n\r\n  for(var i = 0; i < codePointIndex; i++) {\r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n    if(codeUnitIndex === null) return NaN;\r\n  }\r\n  \r\n  var first = str.charCodeAt(codeUnitIndex);\r\n  if (first >= 0xD800 && first <= 0xDBFF && str.length > codeUnitIndex + 1) {\r\n    var second = str.charCodeAt(codeUnitIndex + 1);\r\n    if (second >= 0xDC00 && second <= 0xDFFF) {\r\n      return ((first - 0xD800) << 10) + (second - 0xDC00) + 0x10000;\r\n    }\r\n  }\r\n  return first;  \r\n}\r\n\r\n/**\r\n * Returns the code point index within the calling String object of the first occurrence\r\n * of the specified value, or -1 if not found.\r\n * \r\n * @param  {string}  searchValue    The value to search for\r\n * @param  {number}  [fromIndex]    Optional code point index to start searching from\r\n * @return {number}                 The code point index of the specified search value\r\n */\r\nString.prototype.kmwIndexOf = function(searchValue, fromIndex) {\r\n  var str = String(this);\r\n  var codeUnitIndex = str.indexOf(searchValue, fromIndex);\r\n  \r\n  if(codeUnitIndex < 0) {\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  var codePointIndex = 0;\r\n  for(var i = 0; i !== null && i < codeUnitIndex; i = str.kmwNextChar(i)) codePointIndex++;\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the code point index within the calling String object of the last occurrence \r\n * of the specified value, or -1 if not found.\r\n * \r\n * @param  {string}  searchValue    The value to search for\r\n * @param  {number}  fromIndex      Optional code point index to start searching from\r\n * @return {number}                 The code point index of the specified search value\r\n */\r\nString.prototype.kmwLastIndexOf = function(searchValue, fromIndex)\r\n{\r\n  var str = String(this);\r\n  var codeUnitIndex = str.lastIndexOf(searchValue, fromIndex);\r\n  \r\n  if(codeUnitIndex < 0) {\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  var codePointIndex = 0;\r\n  for(var i = 0; i !== null && i < codeUnitIndex; i = str.kmwNextChar(i)) codePointIndex++;\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the length of the string in code points, as opposed to code units.\r\n * \r\n * @return {number}                 The length of the string in code points\r\n */\r\nString.prototype.kmwLength = function() {\r\n  var str = String(this);\r\n  \r\n  if(str.length == 0) return 0;\r\n  \r\n  for(var i = 0, codeUnitIndex = 0; codeUnitIndex !== null; i++) \r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n  return i;\r\n}\r\n\r\n/**\r\n * Extracts a section of a string and returns a new string.\r\n * \r\n * @param  {number}  beginSlice    The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number}  endSlice      Optional end code point index in the string\r\n *                                 to extract to\r\n * @return {string}                The substring as selected by beginSlice and\r\n *                                 endSlice\r\n */\r\nString.prototype.kmwSlice = function(beginSlice, endSlice) {\r\n  var str = String(this);\r\n  var beginSliceCodeUnit = str.kmwCodePointToCodeUnit(beginSlice);\r\n  var endSliceCodeUnit = str.kmwCodePointToCodeUnit(endSlice);\r\n  if(beginSliceCodeUnit === null || endSliceCodeUnit === null) \r\n    return '';\r\n  else\r\n    return str.slice(beginSliceCodeUnit, endSliceCodeUnit);\r\n}\r\n\r\n/**\r\n * Returns the characters in a string beginning at the specified location through\r\n * the specified number of characters.\r\n * \r\n * @param  {number}  start         The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number=}  length        Optional length to extract\r\n * @return {string}                The substring as selected by start and length\r\n */\r\nString.prototype.kmwSubstr = function(start, length?)\r\n{\r\n  var str = String(this);\r\n  if(start < 0) \r\n  {\r\n    start = str.kmwLength() + start;\r\n  }\r\n\tif(start < 0) start = 0;\r\n  var startCodeUnit = str.kmwCodePointToCodeUnit(start);\r\n  var endCodeUnit = startCodeUnit;\r\n  \r\n  if(startCodeUnit === null) return '';\r\n  \r\n  if(arguments.length < 2) {\r\n    endCodeUnit = str.length;\r\n  } else {\r\n    for(var i = 0; i < length; i++) endCodeUnit = str.kmwNextChar(endCodeUnit);\r\n  }\r\n  if(endCodeUnit === null)\r\n    return str.substring(startCodeUnit);\r\n  else\r\n    return str.substring(startCodeUnit, endCodeUnit);\r\n}\r\n\r\n/**\r\n * Returns the characters in a string between two indexes into the string.\r\n * \r\n * @param  {number}  indexA        The start code point index in the string to \r\n *                                 extract from\r\n * @param  {number}  indexB        The end code point index in the string to \r\n *                                 extract to\r\n * @return {string}                The substring as selected by indexA and indexB\r\n */\r\nString.prototype.kmwSubstring = function(indexA, indexB)\r\n{\r\n  var str = String(this),indexACodeUnit,indexBCodeUnit;\r\n  \r\n  if(typeof(indexB) == 'undefined') \r\n  {\r\n    indexACodeUnit = str.kmwCodePointToCodeUnit(indexA);\r\n    indexBCodeUnit =  str.length;    \r\n  } \r\n  else\r\n  {\r\n    if(indexA > indexB) { var c = indexA; indexA = indexB; indexB = c; }\r\n  \r\n    indexACodeUnit = str.kmwCodePointToCodeUnit(indexA);\r\n    indexBCodeUnit = str.kmwCodePointToCodeUnit(indexB);\r\n  }\r\n  if(isNaN(indexACodeUnit) || indexACodeUnit === null) indexACodeUnit = 0;\r\n  if(isNaN(indexBCodeUnit) || indexBCodeUnit === null) indexBCodeUnit = str.length;\r\n\r\n  return str.substring(indexACodeUnit, indexBCodeUnit);\r\n}\r\n\r\n/*\r\n  Helper functions\r\n*/\r\n\r\n/**\r\n * Returns the code unit index for the next code point in the string, accounting for\r\n * supplementary pairs \r\n *\r\n * @param  {number|null}  codeUnitIndex  The code unit position to increment\r\n * @return {number|null}                 The index of the next code point in the string,\r\n *                                       in code units\r\n */\r\nString.prototype.kmwNextChar = function(codeUnitIndex) {\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex === null || codeUnitIndex < 0 || codeUnitIndex >= str.length - 1) {\r\n    return null;\r\n  }\r\n  \r\n  var first = str.charCodeAt(codeUnitIndex);\r\n  if (first >= 0xD800 && first <= 0xDBFF && str.length > codeUnitIndex + 1) {\r\n    var second = str.charCodeAt(codeUnitIndex + 1);\r\n    if (second >= 0xDC00 && second <= 0xDFFF) {\r\n      if(codeUnitIndex == str.length - 2) {\r\n        return null;\r\n      }\r\n      return codeUnitIndex + 2;\r\n    }\r\n  }\r\n  return codeUnitIndex + 1;\r\n}\r\n\r\n/**\r\n * Returns the code unit index for the previous code point in the string, accounting\r\n * for supplementary pairs \r\n *\r\n * @param  {number|null}  codeUnitIndex  The code unit position to decrement\r\n * @return {number|null}                 The index of the previous code point in the\r\n *                                       string, in code units\r\n*/\r\nString.prototype.kmwPrevChar = function(codeUnitIndex) {\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex == null || codeUnitIndex <= 0 || codeUnitIndex > str.length) {\r\n    return null;\r\n  }\r\n  \r\n  var second = str.charCodeAt(codeUnitIndex - 1);\r\n  if (second >= 0xDC00 && second <= 0xDFFF && codeUnitIndex > 1) {\r\n    var first = str.charCodeAt(codeUnitIndex - 2);\r\n    if(first >= 0xD800 && first <= 0xDBFF) {\r\n      return codeUnitIndex - 2;\r\n    }\r\n  }\r\n  return codeUnitIndex - 1;\r\n}\r\n\r\n/**\r\n * Returns the corresponding code unit index to the code point index passed\r\n *\r\n * @param  {number|null} codePointIndex  A code point index in the string\r\n * @return {number|null}                 The corresponding code unit index\r\n */\r\nString.prototype.kmwCodePointToCodeUnit = function(codePointIndex) {\r\n  \r\n  if(codePointIndex === null) return null;\r\n  \r\n  var str = String(this);\r\n  var codeUnitIndex = 0;\r\n  \r\n  if(codePointIndex < 0) {\r\n    codeUnitIndex = str.length;\r\n    for(var i = 0; i > codePointIndex; i--) \r\n      codeUnitIndex = str.kmwPrevChar(codeUnitIndex);\t\r\n    return codeUnitIndex;\r\n  }\r\n  \r\n  if(codePointIndex == str.kmwLength()) return str.length;\r\n  \r\n  for(var i = 0; i < codePointIndex; i++)\r\n    codeUnitIndex = str.kmwNextChar(codeUnitIndex);\r\n  return codeUnitIndex;\r\n}\r\n\r\n/**\r\n * Returns the corresponding code point index to the code unit index passed\r\n *\r\n * @param  {number|null}  codeUnitIndex  A code unit index in the string\r\n * @return {number|null}                 The corresponding code point index\r\n */\r\nString.prototype.kmwCodeUnitToCodePoint = function(codeUnitIndex) {\r\n  var str = String(this);\r\n  \r\n  if(codeUnitIndex === null)\r\n    return null;\r\n  else if(codeUnitIndex == 0)\r\n    return 0;\r\n  else if(codeUnitIndex < 0)     \r\n    return str.substr(codeUnitIndex).kmwLength();\r\n  else\r\n    return str.substr(0,codeUnitIndex).kmwLength();\r\n}\r\n\r\n/**\r\n * Returns the character at a the code point index passed\r\n *\r\n * @param  {number}  codePointIndex  A code point index in the string\r\n * @return {string}                  The corresponding character\r\n */\r\nString.prototype.kmwCharAt = function(codePointIndex) {\r\n  var str = String(this);\r\n  \r\n  if(codePointIndex >= 0) return str.kmwSubstr(codePointIndex,1); else return '';\r\n}\r\n\r\n/**\r\n * String prototype library extensions for basic plane characters, \r\n * to simplify enabling or disabling supplementary plane functionality (I3319)\r\n */\r\n \r\n/**\r\n * Returns the code unit index for the next code point in the string\r\n *\r\n * @param  {number}  codeUnitIndex    A code point index in the string\r\n * @return {number|null}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPNextChar = function(codeUnitIndex)\r\n{\r\n  var str = String(this);\r\n  if(codeUnitIndex < 0 || codeUnitIndex >= str.length - 1) {\r\n    return null;\r\n  }\r\n  return codeUnitIndex + 1;\r\n}  \r\n\r\n/**\r\n * Returns the code unit index for the previous code point in the string\r\n *\r\n * @param  {number}  codeUnitIndex    A code unit index in the string\r\n * @return {number|null}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPPrevChar = function(codeUnitIndex)\r\n{\r\n  var str = String(this);\r\n\r\n  if(codeUnitIndex <= 0 || codeUnitIndex > str.length) {\r\n    return null;\r\n  }\r\n  return codeUnitIndex - 1;\r\n}  \r\n\r\n/**\r\n * Returns the code unit index for a code point index\r\n *\r\n * @param  {number}  codePointIndex   A code point index in the string\r\n * @return {number}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPCodePointToCodeUnit = function(codePointIndex)\r\n{\r\n  return codePointIndex;\r\n}\r\n\r\n/**\r\n * Returns the code point index for a code unit index\r\n *\r\n * @param  {number}  codeUnitIndex    A code point index in the string\r\n * @return {number}                   The corresponding character\r\n */ \r\nString.prototype.kmwBMPCodeUnitToCodePoint = function(codeUnitIndex)\r\n{\r\n  return codeUnitIndex;\r\n}\r\n\r\n/**\r\n * Returns the length of a BMP string\r\n *\r\n * @return {number}                   The length in code points\r\n */ \r\nString.prototype.kmwBMPLength = function()\r\n{\r\n  var str = String(this);\r\n  return str.length;\r\n}\r\n\r\n\r\n/**\r\n * Returns a substring \r\n *\r\n * @param  {number}  n\r\n * @param  {number=}  ln\r\n * @return {string}                   \r\n */ \r\nString.prototype.kmwBMPSubstr = function(n,ln?)\r\n{\r\n  var str=String(this);\r\n  if(n > -1) \r\n    return str.substr(n,ln);\r\n  else\r\n    return str.substr(str.length+n,-n);  \r\n}\r\n\r\n/**\r\n * Enable or disable supplementary plane string handling\r\n *\r\n * @param  {boolean}  bEnable\r\n */ \r\nString.kmwEnableSupplementaryPlane = function(bEnable)\r\n{\r\n  var p=String.prototype;\r\n  String._kmwFromCharCode = bEnable ? String.kmwFromCharCode : String.fromCharCode;\r\n  p._kmwCharAt = bEnable ? p.kmwCharAt : p.charAt;\r\n  p._kmwCharCodeAt = bEnable ? p.kmwCharCodeAt : p.charCodeAt;\r\n  p._kmwIndexOf = bEnable ? p.kmwIndexOf :p.indexOf;\r\n  p._kmwLastIndexOf = bEnable ? p.kmwLastIndexOf : p.lastIndexOf ;\r\n  p._kmwSlice = bEnable ? p.kmwSlice : p.slice;\r\n  p._kmwSubstring = bEnable ? p.kmwSubstring : p.substring;\r\n  p._kmwSubstr = bEnable ? p.kmwSubstr : p.kmwBMPSubstr;\r\n  p._kmwLength = bEnable ? p.kmwLength : p.kmwBMPLength;\r\n  p._kmwNextChar = bEnable ? p.kmwNextChar : p.kmwBMPNextChar;\r\n  p._kmwPrevChar = bEnable ? p.kmwPrevChar : p.kmwBMPPrevChar;\r\n  p._kmwCodePointToCodeUnit = bEnable ? p.kmwCodePointToCodeUnit : p.kmwBMPCodePointToCodeUnit;\r\n  p._kmwCodeUnitToCodePoint = bEnable ? p.kmwCodeUnitToCodePoint : p.kmwBMPCodeUnitToCodePoint;\r\n}\r\n\r\n","// References all utility includes from a single file, making import/export simple.\r\n///<reference path=\"deepCopy.ts\" />\r\n///<reference path=\"globalObject.ts\" />\r\n///<reference path=\"version.ts\" />\r\n///<reference path=\"kmwstring.ts\" />\r\n///<reference path=\"deviceSpec.ts\" />"]}